<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Scripts Training - Power Choosers CRM</title>
    <link rel="stylesheet" href="styles/training-tool-animations.css">
    <style>
        :root {
            --orange-primary: #ff6b35;
            --orange-subtle: rgba(255, 107, 53, 0.1);
            --bg-container: #1a1a1a;
            --bg-card: #252525;
            --bg-item: #2d2d2d;
            --bg-secondary: #353535;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #808080;
            --text-inverse: #ffffff;
            --grey-400: #b3b3b3;
            --border-light: #404040;
            --border-radius: 8px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-base: 12px;
            --transition-fast: 0.2s ease;
            --elevation-card: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        html {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-container);
            color: var(--text-primary);
            line-height: 1.5;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .training-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: var(--spacing-lg);
            padding-bottom: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
        }

        .page-header {
            margin-bottom: var(--spacing-md);
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: var(--spacing-md);
        }

        /* Custom Scrollbar Styling - Desktop Only */
        @media (min-width: 768px) {
            /* Webkit browsers (Chrome, Safari, Edge) */
            .script-display::-webkit-scrollbar,
            .tips-panel::-webkit-scrollbar,
            .main-content::-webkit-scrollbar {
                width: 8px;
            }
            
            .script-display::-webkit-scrollbar-track,
            .tips-panel::-webkit-scrollbar-track,
            .main-content::-webkit-scrollbar-track {
                background: var(--bg-container);
                border-radius: 4px;
            }
            
            .script-display::-webkit-scrollbar-thumb,
            .tips-panel::-webkit-scrollbar-thumb,
            .main-content::-webkit-scrollbar-thumb {
                background: #3a3a3a;
                border-radius: 4px;
                border: 1px solid var(--bg-container);
            }
            
            .script-display::-webkit-scrollbar-thumb:hover,
            .tips-panel::-webkit-scrollbar-thumb:hover,
            .main-content::-webkit-scrollbar-thumb:hover {
                background: #4a4a4a;
            }
            
            /* Firefox */
            .script-display,
            .tips-panel,
            .main-content {
                scrollbar-width: thin;
                scrollbar-color: #3a3a3a var(--bg-container);
            }
        }

        .script-display {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            flex: 1 1 auto;
            overflow-y: auto;
            line-height: 1.6;
            color: var(--text-primary);
            font-size: 1.15rem;
            margin-bottom: var(--spacing-md);
            transition: height 0.3s ease;
            min-height: 0;
        }

        .script-display .script-highlight {
            color: var(--orange-primary);
            font-weight: 500;
            display: block;
            margin-top: var(--spacing-sm);
        }

        .name-badge {
            display: inline-block;
            background: var(--orange-subtle);
            color: var(--orange-primary);
            border: 1px solid var(--orange-primary);
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.9em;
            font-weight: 600;
            margin: 0 2px;
            vertical-align: baseline;
        }

        .badge.contact {
            display: inline-block;
            background: var(--orange-subtle);
            color: var(--orange-primary);
            border: 1px solid var(--orange-primary);
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.9em;
            font-weight: 600;
            margin: 0 2px;
            vertical-align: baseline;
        }

        .badge.company {
            display: inline-block;
            background: var(--orange-subtle);
            color: var(--orange-primary);
            border: 1px solid var(--orange-primary);
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.9em;
            font-weight: 600;
            margin: 0 2px;
            vertical-align: baseline;
        }

        .tone-marker {
            display: inline-block;
            padding: 3px 8px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 4px;
            border-radius: 4px;
            border: 1px solid;
            vertical-align: baseline;
        }

        /* Color-coded tone badges */
        .tone-marker.curious {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border-color: #3b82f6;
        }

        .tone-marker.concerned {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border-color: #ef4444;
        }

        .tone-marker.confident {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border-color: #10b981;
        }

        .tone-marker.serious {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
            border-color: #8b5cf6;
        }

        .tone-marker.understanding {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .tone-marker.hopeful {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border-color: #22c55e;
        }

        .tone-marker.professional {
            background: rgba(107, 114, 128, 0.15);
            color: #6b7280;
            border-color: #6b7280;
        }

        .tone-marker.friendly {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
            border-color: #f97316;
        }

        /* Tone badge for guide */
        .tone-badge {
            display: inline-block;
            padding: 3px 8px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 4px 4px 0;
            border-radius: 4px;
            border: 1px solid;
        }

        .tone-badge.curious {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border-color: #3b82f6;
        }

        .tone-badge.concerned {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border-color: #ef4444;
        }

        .tone-badge.confident {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border-color: #10b981;
        }

        .tone-badge.serious {
            background: rgba(139, 92, 246, 0.15);
            color: #8b5cf6;
            border-color: #8b5cf6;
        }

        .tone-badge.understanding {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .tone-badge.professional {
            background: rgba(107, 114, 128, 0.15);
            color: #6b7280;
            border-color: #6b7280;
        }

        .tone-badge.friendly {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
            border-color: #f97316;
        }

        .pause-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--orange-primary);
            border-radius: 50%;
            margin: 0 4px;
            opacity: 0.6;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .response-buttons-container {
            position: sticky;
            bottom: 0;
            background: var(--bg-container);
            border-top: 1px solid var(--border-light);
            padding: var(--spacing-md) var(--spacing-lg);
            margin-top: auto;
            margin-left: calc(-1 * var(--spacing-lg));
            margin-right: calc(-1 * var(--spacing-lg));
            padding-left: var(--spacing-lg);
            padding-right: var(--spacing-lg);
            flex-shrink: 0;
        }

        .response-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: 0;
        }

        .response-buttons.full-width {
            display: block;
        }

        .dial-btn,
        .response-btn {
            background: var(--orange-primary);
            color: var(--text-primary);
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            flex: 1;
            min-width: 150px;
        }

        .response-buttons.full-width .dial-btn,
        .response-buttons.full-width .response-btn {
            width: 100%;
        }

        .dial-btn:hover,
        .response-btn:hover {
            background: #e55a2a;
            transform: translateY(-1px);
        }

        /* Click animation removed - keeping only hover effects */

        .toolbar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: 0;
        }

        .action-btn {
            background: var(--bg-item);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .action-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--orange-primary);
            color: var(--text-inverse);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .phase-navigation {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            flex-wrap: nowrap;
            padding: var(--spacing-sm);
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            cursor: default;
            position: relative;
            overflow: hidden;
            min-height: 54px;
            height: 54px;
            align-items: center;
            box-sizing: border-box;
        }
        
        /* Desktop: Gradient overlay on navigation bar behind active button */
        @media (min-width: 768px) {
            .phase-navigation::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(255, 107, 53, 0.08) 15%,
                    rgba(255, 107, 53, 0.12) 30%,
                    rgba(255, 107, 53, 0.15) 50%,
                    rgba(255, 107, 53, 0.12) 70%,
                    rgba(255, 107, 53, 0.08) 85%,
                    transparent 100%
                );
                pointer-events: none;
                z-index: 0;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .phase-navigation:has(.phase-btn.active)::before {
                opacity: 1;
            }
            
            /* Ensure buttons are above gradient */
            .phase-btn {
                position: relative;
                z-index: 1;
            }
        }

        .phase-btn {
            flex: 1;
            padding: 8px 14px;
            border: 1px solid var(--border-light);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
            min-width: 0;
            min-height: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .phase-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--orange-primary);
        }

        .phase-btn.active {
            background: var(--orange-primary);
            color: var(--text-inverse);
            border-color: var(--orange-primary);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .phase-btn.completed {
            background: var(--orange-subtle);
            color: var(--orange-primary);
            border-color: var(--orange-primary);
        }

        .phase-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .opener-selector {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
            justify-content: flex-end;
        }

        .opener-buttons-container {
            display: flex;
            flex-direction: row;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .opener-label {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
            margin-right: var(--spacing-sm);
            padding-right: var(--spacing-sm);
            border-right: 1px solid var(--border-light);
            white-space: nowrap;
        }

        .opener-btn {
            background: var(--bg-item);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 8px 16px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            text-align: center;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .opener-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--orange-primary);
            color: var(--text-inverse);
        }

        .opener-btn.active {
            background: var(--orange-primary);
            border-color: var(--orange-primary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .toolbar-with-openers {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-md);
        }

        /* Tips Panel */
        .tips-panel {
            width: 320px;
            background: var(--bg-card);
            border-left: 1px solid var(--border-light);
            padding: var(--spacing-md);
            overflow-y: auto;
            height: 100vh;
            flex-shrink: 0;
        }

        .tips-header {
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border-light);
        }

        .tips-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .tips-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .tip-card {
            background: var(--bg-item);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            border-left: 3px solid var(--orange-primary);
            transition: var(--transition-fast);
        }

        .tip-card:hover {
            background: var(--bg-secondary);
            border-left-color: var(--orange-primary);
            transform: translateX(2px);
        }

        .tip-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }

        .tip-icon {
            width: 20px;
            height: 20px;
            color: var(--orange-primary);
            flex-shrink: 0;
        }

        .tip-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .tip-content {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-top: var(--spacing-xs);
        }

        /* Tonality Guide Specific Styles */
        .tonality-guide {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .tone-item {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            min-width: 0;
        }

        .tone-item .tone-badge {
            flex-shrink: 0;
            margin: 0;
        }

        .tone-desc {
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .tip-category {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--orange-primary);
            margin-top: var(--spacing-xs);
            padding: 2px 6px;
            background: var(--orange-subtle);
            border-radius: 4px;
        }

        .brand-header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-light);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius);
        }

        .brand-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--orange-primary);
            margin-bottom: var(--spacing-xs);
        }

        .brand-tagline {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Mobile Tips Toggle Button */
        .mobile-tips-toggle {
            display: none;
            width: 100%;
            padding: 16px;
            background: var(--orange-primary);
            color: var(--text-primary);
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            text-align: center;
            margin-top: 12px;
            border-radius: var(--border-radius);
            transition: var(--transition-fast);
            -webkit-tap-highlight-color: rgba(255, 107, 53, 0.2);
        }

        .mobile-tips-toggle:active {
            background: #e55a2a;
            transform: scale(0.98);
        }

        /* Desktop Layout (Default) */
        @media (min-width: 1024px) {
            .training-container {
                display: flex;
                flex-direction: row;
                height: 100vh;
                width: 100vw;
                overflow: hidden;
                gap: 0;
            }
            
            .main-content {
                flex: 1;
                max-width: none;
                height: 100vh;
                padding: var(--spacing-lg);
                padding-bottom: 0;
                overflow-y: auto;
            }
            
            .tips-panel {
                width: 320px;
                display: block;
                height: 100vh;
                border-left: 1px solid var(--border-light);
                border-top: none;
                flex-shrink: 0;
                overflow-y: auto;
                margin-left: 0;
            }
            
            .training-container {
                margin: 0;
                padding: 0;
            }
        }

        /* Tablet Layout */
        @media (min-width: 768px) and (max-width: 1023px) {
            .training-container {
                flex-direction: row;
            }
            
            .main-content {
                flex: 1;
                padding: 24px;
            }
            
            .tips-panel {
                width: 280px;
                display: block;
                padding: 16px;
            }
        }

        /* Mobile Layout - Vertical Stack */
        @media (max-width: 767px) {
            body {
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
            }

            .training-container {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                overflow-x: hidden;
            }
            
            .main-content {
                flex: 1;
                padding: 20px 16px;
                max-width: 100%;
                order: 1;
                height: auto;
                min-height: calc(100vh - 60px);
                overflow-y: auto;
            }
            
            .training-container {
                height: 100vh;
                overflow: hidden;
            }
            
            .tips-panel {
                width: 100%;
                border-left: none;
                border-top: 2px solid var(--border-light);
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease;
                order: 2;
                padding: 0;
                position: relative;
                background: var(--bg-card);
            }
            
            .tips-panel.expanded {
                max-height: 600px;
                overflow-y: auto;
                padding: 20px 16px;
            }

            .mobile-tips-toggle {
                display: block;
            }

            /* Mobile Header */
            .brand-header {
                padding: 16px;
                margin-bottom: 16px;
            }

            .brand-logo {
                font-size: 1.25rem;
            }

            .page-header {
                margin-bottom: 20px;
                text-align: center;
            }

            .page-title {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }

            .page-subtitle {
                font-size: 0.9rem;
                margin-bottom: 16px;
            }

            /* Mobile Toolbar */
            .toolbar-with-openers {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .toolbar {
                display: flex;
                gap: 8px;
            }

            .opener-selector {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }

            .opener-label {
                border-right: none;
                border-bottom: 1px solid var(--border-light);
                padding-bottom: 8px;
                margin-bottom: 8px;
                margin-right: 0;
            }

            .opener-buttons-container {
                flex-direction: column;
                gap: 8px;
            }

            .opener-btn {
                width: 100%;
                padding: 12px 16px;
            }

            /* Stage Indicator */
            .stage-indicator {
                position: sticky;
                top: 0;
                z-index: 50;
                margin-bottom: 16px;
                font-size: 0.85rem;
                padding: 10px 12px;
            }

            /* Script Display */
            .script-display {
                font-size: 1rem;
                padding: 20px;
                min-height: 200px;
                line-height: 1.8;
                word-spacing: 0.1em;
                letter-spacing: 0.5px;
            }

            .script-text {
                line-height: 1.8;
                word-spacing: 0.1em;
            }

            /* Pause Indicators */
            .pause-indicator {
                width: 6px;
                height: 6px;
                margin: 2px 4px;
            }

            /* Badges */
            .badge, .name-badge {
                padding: 3px 8px;
                font-size: 0.8em;
                margin: 2px 1px;
                word-break: break-word;
            }

            /* Tone Markers */
            .tone-marker {
                font-size: 0.85em;
                margin: 1px 2px;
                padding: 2px 6px;
            }
            
            .tone-badge {
                font-size: 0.8em;
                padding: 2px 6px;
                margin: 0 3px 3px 0;
            }

            /* Buttons - Touch Friendly */
            .response-buttons-container {
                position: sticky;
                bottom: 0;
                margin-left: calc(-1 * 16px);
                margin-right: calc(-1 * 16px);
                padding-left: 16px;
                padding-right: 16px;
            }

            .response-buttons {
                display: grid;
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 0;
            }

            .response-btn, .dial-btn {
                width: 100%;
                min-height: 50px;
                padding: 16px 20px;
                font-size: 1rem;
                margin-bottom: 0;
                -webkit-tap-highlight-color: rgba(255, 107, 53, 0.2);
            }

            .action-btn {
                flex: 1;
                min-height: 44px;
                padding: 12px 16px;
            }

            /* Mobile Phase Carousel */
            .phase-navigation {
                display: flex;
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
                scroll-padding: 0 100px;
                padding: 20px 100px 20px 100px;
                margin-bottom: 16px;
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
                gap: 0;
                position: relative;
                scroll-behavior: smooth;
                align-items: center;
                justify-content: flex-start;
            }
            
            /* Gradient shadows for 3D effect - removed black gradient issue */
            .phase-navigation::before,
            .phase-navigation::after {
                content: '';
                position: absolute;
                top: 0;
                bottom: 0;
                width: 60px;
                z-index: 10;
                pointer-events: none;
            }
            
            .phase-navigation::before {
                left: 0;
                background: linear-gradient(to right, var(--bg-container) 0%, transparent 100%);
            }
            
            .phase-navigation::after {
                right: 0;
                background: linear-gradient(to left, var(--bg-container) 0%, transparent 100%);
            }
            
            /* Remove any black gradient blocks inside phase buttons */
            .phase-btn::before,
            .phase-btn::after {
                display: none !important;
            }

            .phase-btn {
                flex: 0 0 auto;
                min-width: 200px;
                width: 200px;
                padding: 12px 20px;
                font-size: 0.85rem;
                white-space: nowrap;
                scroll-snap-align: center;
                position: relative;
                transform: scale(1);
                opacity: 1;
                transition: transform 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
                z-index: 1;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: center;
                height: auto;
            }
            
            /* Current phase - prominent and centered, fully visible */
            .phase-btn.active {
                transform: scale(1.08);
                z-index: 3;
                box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5);
                min-width: 200px;
                width: 200px;
                background: var(--orange-primary);
                /* Remove any gradient from button itself on mobile */
                background-image: none;
            }
            
            /* Mobile: Remove gradient effect entirely to avoid issues */
            .phase-navigation::after {
                display: none;
            }
            
            /* Previous phase - visible on left */
            .phase-btn.prev-phase {
                transform: scale(0.85) translateX(-10px);
                opacity: 0.5;
                z-index: 2;
            }
            
            /* Next phase - visible on right */
            .phase-btn.next-phase {
                transform: scale(0.85) translateX(10px);
                opacity: 0.5;
                z-index: 2;
            }
            
            /* All other phases - hidden but still scrollable */
            .phase-btn:not(.active):not(.prev-phase):not(.next-phase) {
                opacity: 0.2;
            }

            /* Tips Panel Mobile */
            .tips-header {
                margin-bottom: 16px;
            }

            .tips-title {
                font-size: 1.1rem;
            }

            .tip-card {
                padding: 12px;
                margin-bottom: 12px;
            }

            .tip-content {
                font-size: 0.9rem;
            }
        }

        /* Small Mobile (< 480px) */
        @media (max-width: 479px) {
            .main-content {
                padding: 16px 12px;
            }
            
            .page-title {
                font-size: 1.25rem;
            }

            .script-display {
                font-size: 0.95rem;
                padding: 16px;
                min-height: 180px;
            }

            .response-btn {
                font-size: 0.9rem;
                padding: 14px 16px;
                min-height: 48px;
            }

            .action-btn {
                font-size: 0.85rem;
                padding: 10px 12px;
            }
        }

        /* Prevent body scroll when drawer is open */
        body.drawer-open {
            overflow-y: hidden;
        }
    </style>
</head>
<body>
    <div class="training-container">
        <!-- Main Content -->
        <div class="main-content">
            <div class="brand-header">
                <div class="brand-logo">Power Choosers CRM</div>
                <div class="brand-tagline">Call Scripts Training Mode</div>
            </div>

            <div class="page-header">
                <h1 class="page-title">Call Scripts Practice</h1>
                <p class="page-subtitle">Practice your cold calling responses and navigate through different scenarios</p>
            </div>

            <div class="toolbar-with-openers">
                <div class="toolbar">
                    <button class="action-btn" id="back-btn" disabled>Back</button>
                    <button class="action-btn" id="restart-btn">Restart</button>
                </div>
                
                <div class="opener-selector" id="opener-selector">
                    <div class="opener-label">Select your opening:</div>
                    <div class="opener-buttons-container">
                        <!-- Opener buttons will be dynamically generated -->
                    </div>
                </div>
            </div>

            <div class="phase-navigation" id="phase-navigation">
                <!-- Phase buttons will be dynamically generated -->
            </div>

            <div class="script-display" id="script-display">
                Click 'Dial' to begin the call.
            </div>

            <div class="response-buttons-container">
                <div class="response-buttons" id="response-buttons"></div>
            </div>

            <!-- Mobile Tips Toggle Button -->
            <button class="mobile-tips-toggle" id="tipsToggle">
                Tips & Resources ▼
            </button>
        </div>

        <!-- Tips Panel -->
        <div class="tips-panel" id="tipsPanel">
            <div class="tips-header">
                <h2 class="tips-title">Call Notes & Tips</h2>
                <p class="tips-subtitle">Electricity sales best practices</p>
            </div>

            <!-- Market Facts Section -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    <div class="tip-title">Market Facts</div>
                </div>
                <div class="tip-content">
                    <strong>ERCOT prices:</strong> 2.5x higher than 4 years ago<br>
                    <strong>Commercial rates:</strong> 23% increase since 2020<br>
                    <strong>Data center impact:</strong> 50% rate increase (2023-2024)<br>
                    <strong>Demand growth:</strong> 42% expected by 2035
                </div>
                <span class="tip-category">Market Data</span>
            </div>

            <!-- Pattern Interrupt Opening -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    <div class="tip-title">Pattern Interrupt Opening</div>
                </div>
                <div class="tip-content">
                    Use: "I'll be direct — electricity costs are something most business leaders have NO strategy around, and it's costing them thousands. Do you feel like you have a solid handle on your electricity costs?"
                    <br><br>
                    <strong>Why it works:</strong> Bold, honest, creates pattern interrupt. Most businesses have zero strategy.
                </div>
                <span class="tip-category">Opening</span>
            </div>

            <!-- 4-Stage Discovery Process -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <div class="tip-title">Discovery Flow</div>
                </div>
                <div class="tip-content">
                    <strong>Stage 1 - Situation:</strong> "Walk me through your current setup"<br>
                    <strong>Stage 2 - Problem:</strong> "What's most frustrating?"<br>
                    <strong>Stage 3 - Consequence:</strong> "What's this costing you?"<br>
                    <strong>Stage 4 - Solution:</strong> "What would be ideal?"
                </div>
                <span class="tip-category">Discovery</span>
            </div>

            <!-- Key Discovery Questions -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <div class="tip-title">Key Discovery Questions</div>
                </div>
                <div class="tip-content">
                    • When does your contract expire?<br>
                    • Who is your current supplier?<br>
                    • How much do you spend monthly?<br>
                    • Are you locked in or variable?<br>
                    • Have you shopped in the last 12 months?
                </div>
                <span class="tip-category">Discovery</span>
            </div>

            <!-- Objection Handling -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                    <div class="tip-title">Objection: "Happy with Supplier"</div>
                </div>
                <div class="tip-content">
                    <strong>Don't rebut — ask:</strong><br>
                    "That's fair. Have you shopped the market in the last 12 months to make sure you're getting the best rate available?"
                    <br><br>
                    <strong>If they haven't:</strong> Market has moved significantly — use data center boom talking point.
                </div>
                <span class="tip-category">Objections</span>
            </div>

            <!-- Market Talking Points -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <div class="tip-title">Data Center Talking Point</div>
                </div>
                <div class="tip-content">
                    "Between 2023-2024, electricity rates went up 50% because data centers and AI are consuming massive power. When you renew, that's the market you're shopping into. The question isn't 'should I shop?' — it's 'when should I lock in before prices go higher?'"
                </div>
                <span class="tip-category">Market Context</span>
            </div>

            <!-- Tonality Guide -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    <div class="tip-title">Tonality Guide</div>
                </div>
                <div class="tip-content tonality-guide">
                    <div class="tone-item"><span class="tone-badge curious">curious</span><span class="tone-desc">Higher pitch, genuine</span></div>
                    <div class="tone-item"><span class="tone-badge concerned">concerned</span><span class="tone-desc">Lower pitch, empathetic</span></div>
                    <div class="tone-item"><span class="tone-badge confident">confident</span><span class="tone-desc">Steady, authoritative</span></div>
                    <div class="tone-item"><span class="tone-badge serious">serious</span><span class="tone-desc">Lower, slower pace</span></div>
                    <div class="tone-item"><span class="tone-badge understanding">understanding</span><span class="tone-desc">Empathetic, patient</span></div>
                    <div class="tone-item"><span class="tone-badge professional">professional</span><span class="tone-desc">Formal, respectful</span></div>
                    <div class="tone-item"><span class="tone-badge friendly">friendly</span><span class="tone-desc">Warm, approachable</span></div>
                    <div style="margin-top: 12px;"><strong>Pause indicators:</strong> Use pauses for authority & emphasis</div>
                </div>
                <span class="tip-category">Delivery</span>
            </div>

            <!-- Closing Framework -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    <div class="tip-title">Closing Framework</div>
                </div>
                <div class="tip-content">
                    <strong>Step 1:</strong> Trial close (summarize their goal)<br>
                    <strong>Step 2:</strong> Confirm pain point (why it matters)<br>
                    <strong>Step 3:</strong> Suggest next step (15-min analysis)<br>
                    <strong>Step 4:</strong> Binary choice (Tuesday or Wednesday?)
                </div>
                <span class="tip-category">Closing</span>
            </div>

            <!-- Renewal Risk -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <div class="tip-title">Renewal Risk</div>
                </div>
                <div class="tip-content">
                    If contract expires without renewal:<br>
                    • Variable rates spike 50-100% higher<br>
                    • Some suppliers auto-renew at unfavorable rates<br>
                    • Missing deadline = catastrophic cost increase<br>
                    <br>
                    <strong>Key insight:</strong> Start planning 6 months before expiry.
                </div>
                <span class="tip-category">Risk</span>
            </div>

            <!-- Discovery Checklist -->
            <div class="tip-card">
                <div class="tip-header">
                    <svg class="tip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    <div class="tip-title">Discovery Checklist</div>
                </div>
                <div class="tip-content">
                    <strong>Must learn:</strong><br>
                    ☐ Contract expiration date<br>
                    ☐ Current supplier name<br>
                    ☐ Monthly spend (roughly)<br>
                    ☐ Fixed vs variable rate<br>
                    ☐ Who makes the decision
                </div>
                <span class="tip-category">Checklist</span>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        // Escape HTML helper
        function escapeHtml(str) {
            if (str == null) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Day part helper - returns greeting for gatekeeper script
        function dayPart() {
            try {
                const h = new Date().getHours();
                if (h >= 5 && h < 12) return 'Good morning';
                if (h >= 12 && h < 17) return 'Good afternoon';
                if (h >= 17 && h <= 20) return 'Good evening';
                return 'Hello';
            } catch(_) { return 'Hello'; }
        }

        // Mock data for training (simplified)
        function getLiveData() {
            return {
                ctx: { name: '', company: '', number: '', isActive: false },
                contact: { firstName: '', lastName: '', fullName: '', phone: '', email: '', company: '' },
                account: { name: '', industry: '', city: '', state: '', website: '', supplier: '', contractEnd: '' }
            };
        }

        // Render template with mock data
        function renderTemplate(str, mode) {
            if (!str) return '';
            const dp = dayPart();
            const data = getLiveData();
            
            // Get agent name from settings (first name only from general settings)
            let agentFirstName = '';
            try {
                if (typeof SettingsPage !== 'undefined' && SettingsPage.getSettings) {
                    const settings = SettingsPage.getSettings();
                    if (settings && settings.general) {
                        agentFirstName = settings.general.firstName || '';
                    }
                }
            } catch (_) {
                // Fallback if settings not available
                agentFirstName = '';
            }
            
            // Calculate savings based on monthly spend from state
            let monthlySpend = 0;
            let annualSpend = 0;
            let potentialSavings = 0;
            
            // Use stored monthly spend value if available
            if (state.monthlySpend && state.monthlySpend > 0) {
                monthlySpend = state.monthlySpend;
                annualSpend = monthlySpend * 12;
                potentialSavings = Math.round(annualSpend * 0.25); // 25% savings estimate
            }
            
            // Format numbers with commas
            const formatCurrency = (num) => {
                if (num === 0 || !num) return 'an estimated amount';
                return '$' + num.toLocaleString();
            };
            
            // Define replacements with badges
            const replacements = {
                'day.part': dp,
                'agent.first_name': '<span class="badge contact">(your name)</span>',
                'contact.first_name': '<span class="badge contact">(contact name)</span>',
                'contact.last_name': '<span class="badge contact">(contact name)</span>',
                'contact.full_name': '<span class="badge contact">(contact name)</span>',
                'contact.phone': '(phone number)',
                'contact.mobile': '(mobile number)',
                'contact.email': '(email address)',
                'contact.title': '(job title)',
                'account.name': '<span class="badge company">(company name)</span>',
                'account.industry': '<span class="badge company">(industry)</span>',
                'account.city': '<span class="badge company">(city)</span>',
                'account.state': '(state)',
                'account.website': '(website)',
                'account.supplier': '(supplier)',
                'account.contract_end': '(contract end date)',
                'monthly_spend': formatCurrency(monthlySpend),
                'annual_spend': formatCurrency(annualSpend),
                'potential_savings': formatCurrency(potentialSavings)
            };
            
            let result = String(str);
            for (const [key, value] of Object.entries(replacements)) {
                const pattern = new RegExp(`\\{\\{\\s*${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\s*\\}\\}`, 'gi');
                result = result.replace(pattern, value);
            }
            return result;
        }

        // Improved Call Flow (Based on 2025 Best Practices + Gap Analysis)
        const FLOW = {
            start: {
                stage: 'Ready',
                text: "Click 'Dial' to begin the call.",
                responses: []
            },
            pre_call_qualification: {
                stage: 'Pre-Call Prep',
                text: "<strong>Before we dial... qualify this prospect using PEACE framework.</strong><br><br><em>Think through these questions:</em><br><br>• Who are you calling? (Decision maker / Gatekeeper / Unknown)<br>• What's their industry and company size?<br>• What research do you have on their situation?<br>• What's your FIRST OBJECTIVE? (Run a broker audit / Get meeting / Understand situation)<br><br><strong>Remember:</strong> You're a broker competing against other brokers. Position as a \"second opinion\" and \"audit tool\" - not a replacement. We run competitive events across 100+ suppliers.<br><br><strong>Key Stats:</strong> 11-14 discovery questions = 70% higher success. Second opinion positioning = 43% better conversion.",
                responses: [
                    { label: 'Ready - I have answers', next: 'dialing' },
                    { label: 'I need more time', next: 'start' }
                ]
            },
            dialing: {
                stage: 'Connecting',
                text: 'Dialing... Ringing...',
                responses: [
                    { label: 'Call connected', next: 'hook' },
                    { label: 'Voicemail', next: 'voicemail' },
                    { label: 'No answer', next: 'no_answer' }
                ]
            },
            hook: {
                stage: 'Opening',
                text: '{{day.part}}, is this <span class="badge contact">(contact name)</span>?',
                responses: [
                    { label: 'Yes, speaking', next: 'opening_quick_intro' },
                    { label: "Who's calling?", next: 'opening_quick_intro' },
                    { label: 'Gatekeeper', next: 'gatekeeper_intro' }
                ]
            },
            // ===== SIX SCENARIOS NATURAL OPENING + TIMING QUALIFICATION =====
            opening_quick_intro: {
                stage: 'Opening - Quick Intro & Permission',
                text: "Hey {{contact.first_name}}! This is {{agent.first_name}}.<br><br><span class=\"pause-indicator\"></span> <em>[PAUSE 1 second]</em><br><br>Real quick... did I catch you at a bad time... or do you have about 30 seconds?",
                responses: [
                    { label: 'Yeah, go ahead', next: 'opening_industry_context' },
                    { label: 'I got 30 seconds', next: 'opening_industry_context' },
                    { label: 'Actually, not a good time', next: 'reschedule_callback' },
                    { label: 'What is this about?', next: 'opening_industry_context' }
                ]
            },
            opening_industry_context: {
                stage: 'Opening - Industry Context & Problem Bridge',
                text: "Perfect. So I work with {{account.industry}} companies on electricity procurement.<br><br><span class=\"pause-indicator\"></span> <em>[PAUSE 1 second - let that land]</em><br><br>And im reaching out because most companies in {{account.city}} are overpaying on electricity...<br><br><span class=\"pause-indicator\"></span><em>[PAUSE]</em><br><br>not because they're doing anything wrong...<br><br>its because the market's set up in a way that makes it really hard to see what's available.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE]</em><br><br>Are you involved in how {{account.name}} handles electricity?",
                responses: [
                    { label: 'Yeah, somewhat', next: 'timing_qualification' },
                    { label: 'I handle it', next: 'timing_qualification' },
                    { label: 'We have a corporate person', next: 'timing_qualification' },
                    { label: "That's someone else", next: 'gatekeeper_route' },
                    { label: 'Not really sure', next: 'clarify_involvement' }
                ]
            },
            timing_qualification: {
                stage: 'Qualification - Contract Timing',
                text: "Got it. So quick question... have you already extended your agreements past 2026... or is that renewal window still open for you?",
                responses: [
                    { label: 'Still open / renew before 2026', next: 'discovery_process' },
                    { label: 'We renew in 2026', next: 'discovery_process' },
                    { label: 'Not sure when it expires', next: 'discovery_process' },
                    { label: 'We just renewed / locked in', next: 'locked_in_future' }
                ]
            },
            discovery_process: {
                stage: 'Discovery - Current Process',
                text: "Good. So walk me through it... when you renew... how many quotes do you typically get?",
                responses: [
                    { label: '2 or 3 quotes', next: 'key_question_confidence' },
                    { label: 'Just current supplier', next: 'key_question_confidence' },
                    { label: '5 to 10 quotes', next: 'discovery_supplier_count' },
                    { label: 'We have a broker handle it', next: 'objection_broker_intro' },
                    { label: 'Never really counted', next: 'key_question_confidence' }
                ]
            },
            key_question_confidence: {
                stage: 'Discovery - Key Question',
                text: "So [however many they said]...<br><br><span class=\"pause-indicator\"></span><em>[PAUSE 2 seconds - let that sink in]</em><br><br>How confident are you that's actually enough to make sure you're getting competitive pricing?<br><br><span class=\"pause-indicator\"></span><em>[PAUSE - silence is your friend here. Let them think.]</em>",
                responses: [
                    { label: 'Pretty confident', next: 'probe_confidence' },
                    { label: 'They work fine', next: 'probe_confidence' },
                    { label: 'Not 100% sure', next: 'probe_confidence' },
                    { label: 'Not very confident', next: 'gap_creator' },
                    { label: 'We use a broker', next: 'objection_broker_intro' }
                ]
            },
            probe_confidence: {
                stage: 'Discovery - Probe Confidence',
                text: "And is that because you've actually compared your rates to what the rest of the market is quoting... or more just because you've been with them for a while and you trust them?<br><br><span class=\"pause-indicator\"></span><em>[PAUSE]</em>",
                responses: [
                    { label: "We haven't really compared", next: 'gap_creator' },
                    { label: 'Just been with them forever', next: 'gap_creator' },
                    { label: "We don't really know", next: 'gap_creator' },
                    { label: "We've compared before", next: 'discovery_supplier_count' },
                    { label: "That's what our broker does", next: 'objection_broker_intro' }
                ]
            },
            gap_creator: {
                stage: 'Discovery - Gap Creator',
                text: "So when you last renewed... did you get like 5-10 competitive quotes from different suppliers... or was it more like 2-3 options?",
                responses: [
                    { label: '5-10 quotes', next: 'discovery_market_check' },
                    { label: '2-3 options', next: 'discovery_market_check' },
                    { label: 'Just renewed with same supplier', next: 'discovery_market_check' }
                ]
            },
            discovery_supplier_count: {
                stage: 'Discovery - Supplier Count',
                text: "Okay, so when you last renewed... did you end up getting like 5, 10 quotes from different suppliers... or more like 2 or 3 options?",
                responses: [
                    { label: '5 to 10 quotes', next: 'discovery_market_check' },
                    { label: '2 or 3 options', next: 'discovery_market_check' },
                    { label: 'Just stuck with the same one', next: 'discovery_market_check' },
                    { label: "Don't remember", next: 'discovery_market_check' }
                ]
            },
            discovery_market_check: {
                stage: 'Discovery - Market Check',
                text: "Alright, so like 2 or 3 quotes...<br><br>Here's what I'm curious about: Do you know roughly how many different suppliers are actually available in the {{account.industry}} market?<br><br>Like, are we talking 10 or 20 suppliers... or more like 100 plus?<br><br><em>[PAUSE - they usually guess low]</em>",
                responses: [
                    { label: '10 to 20 suppliers', next: 'gap_revealed' },
                    { label: '50 suppliers', next: 'gap_revealed' },
                    { label: '100 plus', next: 'gap_revealed' },
                    { label: 'I have no idea', next: 'gap_revealed' }
                ]
            },
            gap_revealed: {
                stage: 'Discovery - Gap Revealed',
                text: "Actually, there's like 100 plus suppliers out there.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE 3 SECONDS - let this sink in]</em><br><br>So if there's a supplier quoting 15, 20 percent lower than your current rate... you probably wouldn't even know about them.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE 2 SECONDS]</em><br><br>I mean, has that ever crossed your mind? That there could be better rates out there that you're just not seeing?",
                responses: [
                    { label: 'Yeah, that bothers me', next: 'nepq_situation_questions' },
                    { label: 'I guess I never thought about it', next: 'nepq_situation_questions' },
                    { label: 'Not really', next: 'confidence_challenge' },
                    { label: 'We trust our current supplier', next: 'confidence_challenge' }
                ]
            },
            confidence_challenge: {
                stage: 'Objection - Confidence Challenge',
                text: "I'm sure you are happy. They're probably good.<br><br>But quick question... have you ever had like a second opinion? Where someone actually compared your rates to what else is available just to make sure?<br><br><em>[PAUSE]</em>",
                responses: [
                    { label: 'No, we just trust them', next: 'gap_creator' },
                    { label: "Actually that's a good point", next: 'gap_creator' },
                    { label: 'Still not interested', next: 'close_respect_decision' }
                ]
            },
            consequence_challenge: {
                stage: 'Objection - Consequence Challenge',
                text: "I get it, not a priority right now. But here's the thing... while you're handling everything else, your electricity costs are going up in the background. And nobody's shopping, so you're locked in at rates way higher than new customers get.<br><br>When renewal hits... it's a crisis. No leverage, stuck.<br><br>What would that cost you? Maybe {{potential_savings}} over like 3 years?",
                responses: [
                    { label: "Wow, didn't think about it like that", next: 'solution_audit_proposal' },
                    { label: "That's a good point", next: 'solution_audit_proposal' },
                    { label: 'Still not interested', next: 'close_respect_decision' }
                ]
            },
            consequence_quantify: {
                stage: 'Discovery - Consequence Quantified',
                text: "So here's what I'm thinking... you're spending {{monthly_spend}} a month on electricity right now, right?<br><br>And if there's a 15, 20 percent gap you don't know about, that's roughly {{potential_savings}} a year you could be leaving on the table.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE - let that land]</em><br><br>Over like 3 years, that's... well, you do the math. That's a lot of money.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE 2 SECONDS]</em><br><br>Are you really willing to just settle for that?",
                responses: [
                    { label: 'No, definitely not', next: 'solution_audit_proposal' },
                    { label: 'I should look into it', next: 'solution_audit_proposal' },
                    { label: "That's a lot of money", next: 'solution_audit_proposal' },
                    { label: "We're locked in anyway", next: 'locked_in_future' }
                ]
            },
            solution_audit_proposal: {
                stage: 'Solution - Audit Proposal',
                text: "Here's what I'd suggest we do:<br><br>I pull together a quick audit for you. Takes me like 2 or 3 days. I reach out to 100 plus suppliers, get competitive bids from ones you probably haven't even talked to.<br><br>Then we jump on a quick call... maybe 15 minutes. I show you what's out there, you compare, and you decide if it makes sense.<br><br>No pressure, no obligation. Just data so you can make a smart decision.<br><br>Fair?",
                responses: [
                    { label: "Fair, let's do it", next: 'close_calendar_commitment' },
                    { label: 'How would that actually work?', next: 'solution_explain_process' },
                    { label: 'Send me something first', next: 'solution_email_first' },
                    { label: 'When would we talk?', next: 'close_calendar_commitment' }
                ]
            },
            solution_explain_process: {
                stage: 'Solution - Explain Process',
                text: "Super simple. You give me like three things: your monthly spend, when your contract ends, and who your current supplier is. That's it.<br><br>I take a couple days, I coordinate with all these suppliers, pull competitive bids from the ones you haven't talked to.<br><br>We hop on a 15 minute call. I walk you through what everyone's quoting. You look at the numbers, you compare, you decide.<br><br>Simple as that.",
                responses: [
                    { label: "Okay, let's do it", next: 'close_calendar_commitment' },
                    { label: 'When would we talk?', next: 'close_calendar_commitment' },
                    { label: 'Send me info first', next: 'solution_email_first' }
                ]
            },
            close_calendar_commitment: {
                stage: 'Close - Calendar Commitment',
                text: "Perfect. So here's what I need: Your monthly spend, when you renew, and your current supplier name if you know it.<br><br>That's it. I'll handle the rest.<br><br>When works this week for a quick call? Monday, Tuesday, or Wednesday?",
                responses: [
                    { label: 'Monday afternoon', next: 'close_invite_sent' },
                    { label: 'Tuesday morning', next: 'close_invite_sent' },
                    { label: 'Wednesday anytime', next: 'close_invite_sent' },
                    { label: 'Let me check', next: 'close_send_calendar_link' }
                ]
            },
            close_invite_sent: {
                stage: 'Close - Invite Sent',
                text: "Perfect. I'm sending you a calendar invite right now.<br><br>We'll go over your specs and I'll pull those quotes for you.<br><br>See you then.",
                responses: []
            },
            close_send_calendar_link: {
                stage: 'Close - Send Calendar Link',
                text: "No problem. I'll send you a calendar link so you can pick a time that works for you.<br><br>Sound good?",
                responses: [
                    { label: 'Sounds good', next: 'close_invite_sent' },
                    { label: 'Perfect', next: 'close_invite_sent' }
                ]
            },
            solution_email_first: {
                stage: 'Solution - Email First',
                text: "Sure thing. What's your email? I'll send you over a quick breakdown of how this works.",
                responses: []
            },
            locked_in_future: {
                stage: 'Objection - Locked In',
                text: "Got it. When does your contract actually expire?",
                responses: [
                    { label: '18 months', next: 'locked_in_plant_seed' },
                    { label: '12 months', next: 'locked_in_plant_seed' },
                    { label: '6 months', next: 'locked_in_plant_seed' },
                    { label: '[Any timeframe]', next: 'locked_in_plant_seed' }
                ]
            },
            locked_in_plant_seed: {
                stage: 'Objection - Plant Seed',
                text: "Perfect timing actually. Here's the thing... most companies start thinking about this like 6 months before it expires.<br><br>So you've still got some time to plan this right.<br><br>What I'd suggest... let me put on my calendar to reach back out to you in like [appropriate month]. That way, you're not scrambling at the last minute when rates are going up.<br><br>Sound good?",
                responses: [
                    { label: 'Yeah, that works', next: 'locked_in_confirm_callback' },
                    { label: 'Sure, reach out later', next: 'locked_in_confirm_callback' },
                    { label: 'Actually send info now', next: 'solution_email_first' }
                ]
            },
            locked_in_confirm_callback: {
                stage: 'Objection - Callback Confirmed',
                text: "Perfect. I'm putting it on my calendar to reach out in [X months].<br><br>We'll get you a game plan sorted out before you're in a crunch.<br><br>Talk soon.",
                responses: []
            },
            reschedule_callback: {
                stage: 'Reschedule - Callback',
                text: "No problem at all. When's a better time this week... or next week?",
                responses: [
                    { label: 'Tomorrow at 2', next: 'close_send_invite' },
                    { label: 'Next week Monday', next: 'close_send_invite' },
                    { label: '[Any time]', next: 'close_send_invite' }
                ]
            },
            gatekeeper_route: {
                stage: 'Gatekeeper - Route',
                text: "Got it. Can you transfer me to {{contact.first_name}}... or should I just follow up with them directly?",
                responses: [
                    { label: "I'll transfer you", next: 'gatekeeper_wait' },
                    { label: "Here's their number", next: 'close_respect_decision' },
                    { label: 'Let me take your info', next: 'gatekeeper_info' }
                ]
            },
            gatekeeper_wait: {
                stage: 'Gatekeeper - Hold',
                text: "Perfect. I'll hold.",
                responses: [
                    { label: 'New person answers', next: 'transferred_person_warmup' }
                ]
            },
            transferred_person_warmup: {
                stage: 'Opening - Transferred Warmup',
                text: "Hey {{contact.first_name}}! Thanks for picking up. {{previousContact}} passed me over to you.<br><br>I know this is kind of random... but do you have about 30 seconds?",
                responses: [
                    { label: 'Yeah, go ahead', next: 'opening_industry_context' },
                    { label: 'What is this about?', next: 'opening_industry_context' },
                    { label: 'Not a good time', next: 'reschedule_callback' }
                ]
            },
            gatekeeper_info: {
                stage: 'Gatekeeper - Info Capture',
                text: "Sure. What's the best way to reach them? Email or phone?",
                responses: [
                    { label: 'Shared contact info', next: 'followup_scheduled' }
                ]
            },
            clarify_involvement: {
                stage: 'Clarify - Involvement',
                text: "No problem. Here's the thing... most {{account.industry}} companies are leaving like {{potential_savings}} on the table a year just from bad timing on their renewal.<br><br>Does that sound like something you'd be involved in... or is that more of a procurement team thing?",
                responses: [
                    { label: "That's me", next: 'timing_qualification' },
                    { label: "That's [name]", next: 'gatekeeper_route' },
                    { label: 'Both of us', next: 'timing_qualification' }
                ]
            },
            // ===== NEPQ BROKER OBJECTION HANDLING (Per NEPQ Document) =====
            objection_broker_intro: {
                stage: 'Objection - Broker (Clarify)',
                text: "Oh, you use a broker... So when you say that, do they handle like everything or just coordinate quotes for you?<br><br><em>[PAUSE]</em>",
                responses: [
                    { label: 'They handle everything', next: 'objection_broker_discuss' },
                    { label: 'They shop rates', next: 'objection_broker_discuss' },
                    { label: 'They get us quotes', next: 'objection_broker_discuss' },
                    { label: 'They negotiate for us', next: 'objection_broker_discuss' }
                ]
            },
            objection_broker_discuss: {
                stage: 'Objection - Broker (Discuss)',
                text: "Got it. So when you last renewed, how many quotes did they actually bring you? Like 5, 10... or more like 2, 3?",
                responses: [
                    { label: '2 or 3 quotes', next: 'objection_broker_gap' },
                    { label: '5 to 10 quotes', next: 'objection_broker_gap' },
                    { label: 'Just renewed with same supplier', next: 'objection_broker_gap' },
                    { label: 'Not sure', next: 'objection_broker_gap' }
                ]
            },
            objection_broker_gap: {
                stage: 'Objection - Broker Gap Reveal',
                text: "Okay so like 2 or 3 quotes. And do you know how many suppliers your broker actually works with? Like 20, 30... or closer to 100 plus?<br><br><em>[PAUSE]</em>",
                responses: [
                    { label: '20 to 30', next: 'objection_broker_reveal_gap' },
                    { label: '50 suppliers', next: 'objection_broker_reveal_gap' },
                    { label: '100 plus', next: 'consequence_quantify' },
                    { label: 'I have no idea', next: 'objection_broker_reveal_gap' }
                ]
            },
            objection_broker_reveal_gap: {
                stage: 'Objection - Broker Gap Revealed',
                text: "So there's actually 100 plus suppliers in the market... but your broker probably only works with like 20, 30, maybe 50.<br><br><span class=\"pause-indicator\"></span><em>[PAUSE 3 SECONDS]</em><br><br>That means like half the market... your broker doesn't even have access to.<br><br>Wouldn't it be worth seeing what that other half is quoting?",
                responses: [
                    { label: 'Yeah, that makes sense', next: 'solution_audit_proposal' },
                    { label: 'How would that work?', next: 'solution_explain_process' },
                    { label: "We're happy with them", next: 'objection_broker_happy' }
                ]
            },
            objection_broker_happy: {
                stage: 'Objection - Broker Happy',
                text: "I get it. They're probably doing a good job.<br><br>But real quick... have you ever had like a second opinion? Where someone compared your broker's rates to the broader market just to see?<br><br><em>[PAUSE]</em>",
                responses: [
                    { label: 'No, we just trust them', next: 'gap_creator' },
                    { label: "We've checked before", next: 'gap_creator' },
                    { label: 'Why would we need to?', next: 'gap_creator' }
                ]
            },
            // ===== NEPQ + PEACE INTEGRATED OPENER =====
            pattern_interrupt_opening: {
                stage: 'Opening - Quick Intro & Permission',
                text: "Hey {{contact.first_name}}! This is {{agent.first_name}}.<br><br><span class=\"pause-indicator\"></span> <em>[PAUSE 1 second]</em><br><br>Real quick... did I catch you at a bad time... or do you have about 30 seconds?",
                responses: [
                    { label: 'Yeah, go ahead', next: 'opening_industry_context' },
                    { label: 'I got 30 seconds', next: 'opening_industry_context' },
                    { label: 'Actually, not a good time', next: 'reschedule_callback' },
                    { label: 'What is this about?', next: 'opening_industry_context' }
                ]
            },
            // ===== NEPQ DISCOVERY SYSTEM =====
            nepq_situation_questions: {
                stage: 'NEPQ Discovery - Situation',
                text: "<span class=\"tone-marker curious\">🔍 STAGE 1: NEPQ SITUATION QUESTIONS</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span> (no judgment, just gathering data)<br><br>\"So what are you doing now for your electricity procurement... <span class=\"pause-indicator\"></span> just so I have more context?\"<br><br><em>⏸️ Wait for answer, then follow up:</em><br><br>\"And roughly how much are you spending monthly... <span class=\"pause-indicator\"></span> just so I understand the scope we're talking about?\"",
                responses: [
                    { label: "$10K-25K monthly", next: 'nepq_situation_broker_check' },
                    { label: "$25K-50K monthly", next: 'nepq_situation_broker_check' },
                    { label: "$50K+ monthly", next: 'nepq_situation_broker_check' },
                    { label: "Not sure exactly", next: 'nepq_situation_broker_check' }
                ]
            },
            nepq_situation_broker_check: {
                stage: 'NEPQ Discovery - Situation',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span> (trailing off to invite deeper answer)<br><br>\"And who handles the electricity decisions there... <span class=\"pause-indicator\"></span> is that something you own personally, or...?\"<br><br><em>⏸️ Let them fill in the blank</em>",
                responses: [
                    { label: "I handle it myself", next: 'nepq_problem_awareness' },
                    { label: "We have a broker", next: 'nepq_broker_clarify' },
                    { label: "Someone else handles it", next: 'gatekeeper_intro' },
                    { label: "It's a shared responsibility", next: 'nepq_problem_awareness' }
                ]
            },
            nepq_problem_awareness: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker confused\">🔍 STAGE 2: NEPQ PROBLEM AWARENESS</span><br><br><span class=\"tone-marker skeptical\">SKEPTICAL/CURIOUS TONE</span> (emphasis on \"LIKE\")<br><br>\"Okay, so you're spending ${{monthly_spend}} monthly... <span class=\"pause-indicator\"></span> your {{current_process}}... <span class=\"pause-indicator\"></span> Got it.<br><br><em>[PAUSE 2 seconds]</em><br><br>So you've been handling this for the last... <span class=\"pause-indicator\"></span> few years... <span class=\"pause-indicator\"></span><br><br>I mean, do you LIKE the results you've been getting?\"<br><br><em>⏸️ Wait for their answer - this opens the door to the confidence question</em>",
                responses: [
                    { label: "Yeah, it's been fine", next: 'nepq_problem_probe_fine' },
                    { label: "Not really / Could be better", next: 'nepq_problem_probe_impact' },
                    { label: "It's complicated", next: 'nepq_problem_probe_complexity' },
                    { label: "We use a broker for that", next: 'nepq_broker_clarify' }
                ]
            },
            nepq_problem_probe_fine: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker confused\">CONFUSED TONE</span> (furrowed brow, like you don't understand)<br><br>\"Oh... <span class=\"pause-indicator\"></span> so it's been fine... <span class=\"pause-indicator\"></span><br><br>When you say 'fine'... <span class=\"pause-indicator\"></span> what do you mean by that?\"<br><br><em>⏸️ Force them to define \"fine\" - most can't</em>",
                responses: [
                    { label: "We renew on time, no issues", next: 'nepq_confidence_question' },
                    { label: "Costs are stable", next: 'nepq_confidence_question' },
                    { label: "Actually... there are some issues", next: 'nepq_problem_probe_impact' }
                ]
            },
            // ===== THE CONFIDENCE QUESTION (KEY INSERTION POINT) =====
            nepq_confidence_question: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker curious\">🔑 THE CONFIDENCE QUESTION - THIS IS THE PROBE</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span> (genuinely asking, lean in)<br><br>\"You don't sound so sure about it... <span class=\"pause-indicator\"></span><br><br>Can I ask... <span class=\"pause-indicator\"></span> how confident are you that your current rates are actually competitive?\"<br><br><em>💡 THIS IS THE KEY QUESTION</em><br><em>⏸️ Use curious tone - like you genuinely want to know</em><br><em>⏸️ Wait for their answer - don't fill the silence</em>",
                responses: [
                    { label: "Pretty confident / They're fine", next: 'nepq_confidence_probe' },
                    { label: "I'm not 100% sure / Could be better", next: 'nepq_confidence_probe' },
                    { label: "Not very confident / Definitely concerned", next: 'nepq_problem_probe_impact' },
                    { label: "We use a broker for that", next: 'nepq_broker_clarify' }
                ]
            },
            nepq_confidence_probe: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker confused\">CONFUSED TONE - PROBING DEEPER</span><br><br>\"Oh... <span class=\"pause-indicator\"></span> so they're pretty competitive... <span class=\"pause-indicator\"></span><br><br>And is that because you've actually COMPARED them to what the full market is quoting... <span class=\"pause-indicator\"></span><br><br>or more just because you've been with them a while?\"<br><br><em>⏸️ Wait for answer</em><br><br><em>If they can't articulate why they're confident...</em><br><br>\"I see... <span class=\"pause-indicator\"></span> so you don't really KNOW if they're competitive... <span class=\"pause-indicator\"></span> you just... <span class=\"pause-indicator\"></span> haven't looked?\"<br><br><em>⏸️ PAUSE - let that land</em>",
                responses: [
                    { label: "We haven't really compared", next: 'nepq_problem_probe_comparison' },
                    { label: "We just trust them / Been with them long", next: 'nepq_problem_probe_comparison' },
                    { label: "We HAVE compared", next: 'nepq_problem_probe_comparison' },
                    { label: "That's something our broker handles", next: 'nepq_broker_clarify' }
                ]
            },
            nepq_problem_probe_comparison: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker curious\">CURIOUS/SKEPTICAL TONE</span> (genuinely asking)<br><br>\"When you last renewed... <span class=\"pause-indicator\"></span> did you get like... <span class=\"pause-indicator\"></span> 5-10 competitive quotes from different suppliers... <span class=\"pause-indicator\"></span> or was it more like 2-3 options?\"<br><br><em>⏸️ This question creates the gap</em>",
                responses: [
                    { label: "5-10 competitive quotes", next: 'nepq_problem_supplier_count' },
                    { label: "Just 2-3 options", next: 'nepq_problem_supplier_count' },
                    { label: "We just renewed with same supplier", next: 'nepq_problem_supplier_count' },
                    { label: "Not sure / Don't remember", next: 'nepq_problem_supplier_count' }
                ]
            },
            nepq_problem_supplier_count: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker confused\">CONFUSED/CURIOUS TONE</span> (creating the gap)<br><br>\"Oh... <span class=\"pause-indicator\"></span> 2-3 quotes... <span class=\"pause-indicator\"></span><br><br>And do you know roughly how many suppliers are actually in the market? <span class=\"pause-indicator\"></span><br><br>Like, are we talking 10-20... <span class=\"pause-indicator\"></span> or more like 50... <span class=\"pause-indicator\"></span> or over 100?\"<br><br><em>💡 They'll usually guess low - this creates the gap</em><br><em>⏸️ Most say 10-20. Reality is 100+.</em>",
                responses: [
                    { label: "10-20 suppliers", next: 'nepq_problem_reveal_gap' },
                    { label: "50 suppliers", next: 'nepq_problem_reveal_gap' },
                    { label: "100+ suppliers", next: 'nepq_problem_impact' },
                    { label: "I have no idea", next: 'nepq_problem_reveal_gap' }
                ]
            },
            nepq_problem_reveal_gap: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker concerned\">CONCERNED TONE</span> (reveal the gap)<br><br>\"I see... <span class=\"pause-indicator\"></span> so there are actually 100+ suppliers in the market... <span class=\"pause-indicator\"></span><br><br>But your broker probably only works with 10-20... <span class=\"pause-indicator\"></span><br><br><em>[PAUSE 3 seconds - let that sink in]</em>\"",
                responses: [
                    { label: "They continue listening", next: 'nepq_problem_impact' },
                    { label: "They seem surprised", next: 'nepq_problem_impact' },
                    { label: "They push back", next: 'nepq_broker_clarify' }
                ]
            },
            nepq_problem_impact: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker concerned\">CONCERNED TONE</span> (empathy, lean in)<br><br>\"Has that... <span class=\"pause-indicator\"></span> has that had an impact on you... <span class=\"pause-indicator\"></span> not knowing if you're getting the best rates?\"<br><br><em>💡 THEY START TO FEEL THE PROBLEM HERE</em><br><em>⏸️ Wait - let them process this</em>",
                responses: [
                    { label: "Yeah, it bothers me", next: 'nepq_solution_awareness' },
                    { label: "I guess I never thought about it", next: 'nepq_solution_awareness' },
                    { label: "Not really / We trust our broker", next: 'nepq_broker_clarify' }
                ]
            },
            nepq_problem_probe_impact: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker concerned\">CONCERNED TONE</span> (empathetic)<br><br>\"Tell me more about that... <span class=\"pause-indicator\"></span> what specifically hasn't been working?\"<br><br><em>⏸️ Let them talk. Take notes.</em>",
                responses: [
                    { label: "Costs keep going up", next: 'nepq_solution_awareness' },
                    { label: "Too confusing to compare", next: 'nepq_solution_awareness' },
                    { label: "Don't have time to shop", next: 'nepq_solution_awareness' },
                    { label: "Not sure if we're getting good rates", next: 'nepq_solution_awareness' }
                ]
            },
            nepq_problem_probe_complexity: {
                stage: 'NEPQ Discovery - Problem Awareness',
                text: "<span class=\"tone-marker confused\">CONFUSED TONE</span> (probing deeper)<br><br>\"Oh... <span class=\"pause-indicator\"></span> how do you mean by 'complicated'?\"<br><br><em>⏸️ Don't fill the silence. Let them explain.</em>",
                responses: [
                    { label: "Too many options to compare", next: 'nepq_solution_awareness' },
                    { label: "Contracts are confusing", next: 'nepq_solution_awareness' },
                    { label: "Don't have bandwidth", next: 'nepq_solution_awareness' }
                ]
            },
            nepq_solution_awareness: {
                stage: 'NEPQ Discovery - Solution Awareness',
                text: "<span class=\"tone-marker curious\">🎯 STAGE 3: NEPQ SOLUTION AWARENESS</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span> (painting the future)<br><br>\"So before we started talking today... <span class=\"pause-indicator\"></span> were you out there looking for a second opinion on your rates... <span class=\"pause-indicator\"></span> or what were you doing?\"<br><br><em>⏸️ Understand their starting point</em>",
                responses: [
                    { label: "No, we just trust our current setup", next: 'nepq_solution_vision' },
                    { label: "We've been meaning to look into it", next: 'nepq_solution_vision' },
                    { label: "We hadn't really thought about it", next: 'nepq_solution_barriers' }
                ]
            },
            nepq_solution_barriers: {
                stage: 'NEPQ Discovery - Solution Awareness',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span> (no judgment)<br><br>\"What prevented you from doing that in the past?\"<br><br><em>⏸️ This reveals their real blockers</em>",
                responses: [
                    { label: "Too busy / Not a priority", next: 'nepq_solution_vision' },
                    { label: "Didn't know where to start", next: 'nepq_solution_vision' },
                    { label: "Tried before, was a nightmare", next: 'nepq_solution_vision' },
                    { label: "Happy with current setup", next: 'nepq_solution_vision' }
                ]
            },
            nepq_solution_vision: {
                stage: 'NEPQ Discovery - Solution Awareness',
                text: "<span class=\"tone-marker curious\">CURIOUS/COLLABORATIVE TONE</span><br><br>\"Let's say we could show you what competitive rates look like from 100+ suppliers... <span class=\"pause-indicator\"></span> not just the 10-20 your broker probably works with... <span class=\"pause-indicator\"></span><br><br>How do you see that benefiting you the most?\"<br><br><em>⏸️ Make them articulate the benefit themselves</em>",
                responses: [
                    { label: "We'd know if we're getting a good deal", next: 'nepq_solution_personal' },
                    { label: "Could save money", next: 'nepq_solution_personal' },
                    { label: "More options to choose from", next: 'nepq_solution_personal' }
                ]
            },
            nepq_solution_personal: {
                stage: 'NEPQ Discovery - Solution Awareness',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span> (dig for emotional drivers)<br><br>\"Right... <span class=\"pause-indicator\"></span> and what would that do for you... <span class=\"pause-indicator\"></span> personally?\"<br><br><em>💡 \"Personally\" = gold. This is where they reveal their real motivation.</em>",
                responses: [
                    { label: "Peace of mind", next: 'nepq_consequence_questions' },
                    { label: "Less stress", next: 'nepq_consequence_questions' },
                    { label: "Look good to leadership", next: 'nepq_consequence_questions' },
                    { label: "Save time", next: 'nepq_consequence_questions' }
                ]
            },
            nepq_consequence_questions: {
                stage: 'NEPQ Discovery - Consequence',
                text: "<span class=\"tone-marker challenging\">⚠️ STAGE 4: NEPQ CONSEQUENCE QUESTIONS (MOST POWERFUL)</span><br><br><span class=\"tone-marker concerned\">CHALLENGING TONE</span> (make inaction feel riskier than action)<br><br>\"So if this stays the same for the next 6-12 months... <span class=\"pause-indicator\"></span> and you're still overpaying without knowing it... <span class=\"pause-indicator\"></span><br><br>What do you think that could cost you?\"<br><br><em>⏸️ Wait. Let them calculate. They'll usually guess conservative.</em>",
                responses: [
                    { label: "$10K-30K potentially", next: 'nepq_consequence_quantify' },
                    { label: "$50K+ potentially", next: 'nepq_consequence_quantify' },
                    { label: "I don't know, could be significant", next: 'nepq_consequence_quantify' },
                    { label: "Not that much", next: 'nepq_consequence_challenge' }
                ]
            },
            nepq_consequence_quantify: {
                stage: 'NEPQ Discovery - Consequence',
                text: "<span class=\"tone-marker challenging\">CHALLENGING TONE</span> (direct but not aggressive)<br><br>\"So let's say that's {{potential_savings}} per year... <span class=\"pause-indicator\"></span><br><br>Over 3 years that's triple that amount... <span class=\"pause-indicator\"></span><br><br><strong>Are you willing to settle for that?</strong>\"<br><br><em>💡 DIRECT CHALLENGE - they have to defend staying put</em><br><em>⏸️ Wait for their response. Don't soften it.</em>",
                responses: [
                    { label: "No, definitely not", next: 'nepq_micro_commitment_1' },
                    { label: "I should probably look into it", next: 'nepq_micro_commitment_1' },
                    { label: "We're locked in anyway", next: 'nepq_consequence_lockedin' }
                ]
            },
            nepq_consequence_challenge: {
                stage: 'NEPQ Discovery - Consequence',
                text: "<span class=\"tone-marker challenging\">CHALLENGING/PLAYFUL TONE</span> (reverse psychology)<br><br>\"I mean... <span class=\"pause-indicator\"></span> you've been doing it this way for years now... <span class=\"pause-indicator\"></span><br><br>Why look at getting a second opinion NOW... <span class=\"pause-indicator\"></span> why not just push it down the road like... <span class=\"pause-indicator\"></span> most companies who don't know they're overpaying?\"<br><br><em>⏸️ This makes them DEFEND why they need to change</em>",
                responses: [
                    { label: "Because we need to know before renewal", next: 'nepq_qualifying_questions' },
                    { label: "You're right, I should look at this", next: 'nepq_qualifying_questions' },
                    { label: "Fair point, maybe I'll wait", next: 'nepq_final_consequence' }
                ]
            },
            nepq_final_consequence: {
                stage: 'NEPQ Discovery - Consequence',
                text: "<span class=\"tone-marker concerned\">CONCERNED TONE</span><br><br>\"What happens if you don't do anything about this... <span class=\"pause-indicator\"></span> and your contract renews at even HIGHER rates?\"<br><br><em>⏸️ Paint the worst case</em>",
                responses: [
                    { label: "That would be bad", next: 'nepq_qualifying_questions' },
                    { label: "I guess I should look at it", next: 'nepq_qualifying_questions' },
                    { label: "We'll figure it out", next: 'respect_decision' }
                ]
            },
            nepq_qualifying_questions: {
                stage: 'NEPQ Discovery - Qualifying',
                text: "<span class=\"tone-marker curious\">QUALIFYING QUESTION (Optional)</span><br><br><span class=\"tone-marker curious\">CURIOUS/SKEPTICAL TONE</span><br><br>\"How important is it for you to find out if there's a gap... <span class=\"pause-indicator\"></span> versus just assuming your broker has you covered?\"<br><br><em>⏸️ This separates buyers from lookers</em><br><em>💡 Note: Can skip directly to Micro-Commitment #1 if momentum is strong</em>",
                responses: [
                    { label: "Pretty important", next: 'nepq_micro_commitment_1' },
                    { label: "Worth exploring", next: 'nepq_micro_commitment_1' },
                    { label: "Not a priority right now", next: 'nepq_consequence_challenge' }
                ]
            },
            nepq_consequence_lockedin: {
                stage: 'NEPQ Discovery - Consequence',
                text: "<span class=\"tone-marker understanding\">UNDERSTANDING TONE</span> (not pushy)<br><br>\"I get it - you're locked in, so this isn't urgent right now. That's fair. <span class=\"pause-indicator\"></span><br><br>But real talk - when you locked in, did you actually shop around or just renew with who you had? <span class=\"pause-indicator\"></span><br><br>If you just renewed without shopping, you're probably paying rates that were locked in during peak season. <span class=\"pause-indicator\"></span> Could be $50K-$100K overpaid over the next few years. <span class=\"pause-indicator\"></span><br><br>Not asking you to do anything now. Just want you to think about approaching it differently next time renewal comes up. <span class=\"pause-indicator\"></span> Make sense?\"",
                responses: [
                    { label: "That makes sense - reach out in 6 months", next: 'future_opportunity' },
                    { label: "Yeah, I want to avoid that", next: 'nepq_micro_commitment_1' },
                    { label: "Not really concerned right now", next: 'respect_decision' }
                ]
            },
            // ===== NEPQ 3-STEP OBJECTION FORMULA =====
            nepq_broker_clarify: {
                stage: 'NEPQ Objection - Broker',
                text: "<span class=\"tone-marker confused\">🔄 NEPQ 3-STEP: CLARIFY</span><br><br><span class=\"tone-marker confused\">CONFUSED TONE</span> (like you don't understand)<br><br>\"Oh... <span class=\"pause-indicator\"></span> you use a broker...<br><br>Can I ask... what do you mean by that?\"<br><br><em>Don't assume. Make them explain.</em>",
                responses: [
                    { label: "They handle our electricity", next: 'nepq_broker_discuss' },
                    { label: "They shop rates for us", next: 'nepq_broker_discuss' }
                ]
            },
            nepq_broker_discuss: {
                stage: 'NEPQ Objection - Broker',
                text: "<span class=\"tone-marker confused\">🔄 NEPQ 3-STEP: DISCUSS</span><br><br><span class=\"tone-marker confused\">CONFUSED TONE</span> (probing deeper)<br><br>\"Oh I see... <span class=\"pause-indicator\"></span> so they handle everything... <span class=\"pause-indicator\"></span><br><br>In what way, though?\"<br><br><em>⏸️ Wait for answer, then:</em><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"Aww okay... <span class=\"pause-indicator\"></span> and when you last renewed... <span class=\"pause-indicator\"></span> how many quotes did they bring you?\"",
                responses: [
                    { label: "2-3 quotes", next: 'nepq_broker_supplier_count' },
                    { label: "5-10 quotes", next: 'nepq_broker_supplier_count' },
                    { label: "Just renewed with same supplier", next: 'nepq_broker_supplier_count' },
                    { label: "Not sure", next: 'nepq_broker_supplier_count' }
                ]
            },
            nepq_broker_supplier_count: {
                stage: 'NEPQ Objection - Broker',
                text: "<span class=\"tone-marker confused\">CONFUSED/CURIOUS TONE</span><br><br>\"Oh... <span class=\"pause-indicator\"></span> 2-3 quotes... <span class=\"pause-indicator\"></span><br><br>And do you know roughly how many suppliers they work with?\"<br><br><em>⏸️ Creating the gap</em>",
                responses: [
                    { label: "Maybe 10-20", next: 'nepq_broker_diffuse' },
                    { label: "Not sure", next: 'nepq_broker_diffuse' },
                    { label: "Probably a lot", next: 'nepq_broker_diffuse' }
                ]
            },
            nepq_broker_diffuse: {
                stage: 'NEPQ Objection - Broker',
                text: "<span class=\"tone-marker challenging\">🔄 NEPQ 3-STEP: DIFFUSE</span><br><br><span class=\"tone-marker challenging\">CHALLENGING TONE</span> (make THEM say it)<br><br>\"I see... <span class=\"pause-indicator\"></span> so here's what I'm curious about... <span class=\"pause-indicator\"></span><br><br>There are 100+ suppliers in the actual market... <span class=\"pause-indicator\"></span><br><br>If your broker only works with 10-20... <span class=\"pause-indicator\"></span> what do you think that means for the rates you're seeing?\"<br><br><em>⏸️ They'll say it themselves: \"We might be missing options\"</em>",
                responses: [
                    { label: "We might not be seeing all options", next: 'nepq_broker_audit_offer' },
                    { label: "I guess we could be missing out", next: 'nepq_broker_audit_offer' },
                    { label: "They shop everything", next: 'nepq_broker_audit_offer' }
                ]
            },
            nepq_broker_audit_offer: {
                stage: 'NEPQ Objection - Broker',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"Right... <span class=\"pause-indicator\"></span> so would it make sense to at least SEE what that other 80% of the market is quoting... <span class=\"pause-indicator\"></span> just so you KNOW?\"<br><br><em>💡 Key: You never TOLD them they had a problem. You ASKED questions that made them REALIZE it.</em>",
                responses: [
                    { label: "Yeah, that makes sense", next: 'nepq_micro_commitment_1' },
                    { label: "How would that work?", next: 'broker_audit_close' },
                    { label: "We're happy with our broker", next: 'nepq_broker_happy_clarify' }
                ]
            },
            nepq_broker_happy_clarify: {
                stage: 'NEPQ Objection - Happy Broker',
                text: "<span class=\"tone-marker confused\">🔄 NEPQ 3-STEP: CLARIFY</span><br><br><span class=\"tone-marker confused\">CONFUSED TONE</span><br><br>\"Oh... <span class=\"pause-indicator\"></span> you're happy with them... <span class=\"pause-indicator\"></span><br><br>What do you mean by that?\"<br><br><em>⏸️ Make them define \"happy\"</em>",
                responses: [
                    { label: "Been with them for years, good service", next: 'nepq_broker_happy_discuss' },
                    { label: "They handle everything for us", next: 'nepq_broker_happy_discuss' },
                    { label: "No complaints", next: 'nepq_broker_happy_discuss' }
                ]
            },
            nepq_broker_happy_discuss: {
                stage: 'NEPQ Objection - Happy Broker',
                text: "<span class=\"tone-marker curious\">🔄 NEPQ 3-STEP: DISCUSS</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span> (not challenging, genuinely asking)<br><br>\"Aww okay... <span class=\"pause-indicator\"></span> and what is it about what they do that makes you feel they do a good job?\"<br><br><em>⏸️ Wait for answer, then:</em><br><br>\"I see... <span class=\"pause-indicator\"></span> so they make it easy for you... <span class=\"pause-indicator\"></span><br><br>Can I ask though... <span class=\"pause-indicator\"></span> have you ever had a second opinion on whether the rates they're getting you are competitive?\"",
                responses: [
                    { label: "No, we just trust them", next: 'nepq_broker_happy_diffuse' },
                    { label: "We've compared before", next: 'nepq_broker_happy_diffuse' },
                    { label: "Why would we need to?", next: 'nepq_broker_happy_diffuse' }
                ]
            },
            nepq_broker_happy_diffuse: {
                stage: 'NEPQ Objection - Happy Broker',
                text: "<span class=\"tone-marker challenging\">🔄 NEPQ 3-STEP: DIFFUSE</span><br><br><span class=\"tone-marker challenging\">CHALLENGING TONE</span> (direct but not aggressive)<br><br>\"Okay... <span class=\"pause-indicator\"></span> and is that because you've compared them to what the full market quotes... <span class=\"pause-indicator\"></span> or more just because you've been with them a long time?\"<br><br><em>⏸️ Wait for answer</em><br><br>\"So here's what I'm curious about... <span class=\"pause-indicator\"></span><br><br>If you HAVEN'T compared... <span class=\"pause-indicator\"></span> how do you KNOW they're doing a good job?\"<br><br><em>💡 Make THEM question their assumption</em>",
                responses: [
                    { label: "I guess we don't know for sure", next: 'nepq_micro_commitment_1' },
                    { label: "Fair point", next: 'nepq_micro_commitment_1' },
                    { label: "We trust the relationship", next: 'broker_audit_no_switch' }
                ]
            },
            nepq_objection_clarify: {
                stage: 'NEPQ Objection - Not Interested',
                text: "<span class=\"tone-marker confused\">🔄 NEPQ 3-STEP: CLARIFY</span><br><br><span class=\"tone-marker confused\">CONFUSED TONE</span> (genuinely curious)<br><br>\"Oh... <span class=\"pause-indicator\"></span> not interested... <span class=\"pause-indicator\"></span><br><br>Can I ask... <span class=\"pause-indicator\"></span> not interested in what specifically?\"<br><br><em>⏸️ Most people can't articulate WHY they're not interested</em>",
                responses: [
                    { label: "Not interested in changing suppliers", next: 'nepq_not_interested_discuss' },
                    { label: "Too busy right now", next: 'nepq_timing_discuss' },
                    { label: "We're happy with what we have", next: 'nepq_broker_happy_clarify' },
                    { label: "Just not interested", next: 'nepq_not_interested_discuss' }
                ]
            },
            nepq_not_interested_discuss: {
                stage: 'NEPQ Objection - Not Interested',
                text: "<span class=\"tone-marker curious\">🔄 NEPQ 3-STEP: DISCUSS</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"Aww okay... <span class=\"pause-indicator\"></span> so you don't want to change suppliers... <span class=\"pause-indicator\"></span><br><br>And is that because your current rates are competitive... <span class=\"pause-indicator\"></span> or more just because changing is a hassle?\"<br><br><em>⏸️ Understand the real objection</em>",
                responses: [
                    { label: "Changing is a hassle", next: 'nepq_not_interested_diffuse' },
                    { label: "Our rates are fine", next: 'nepq_not_interested_diffuse' },
                    { label: "Both", next: 'nepq_not_interested_diffuse' }
                ]
            },
            nepq_not_interested_diffuse: {
                stage: 'NEPQ Objection - Not Interested',
                text: "<span class=\"tone-marker understanding\">🔄 NEPQ 3-STEP: DIFFUSE</span><br><br><span class=\"tone-marker understanding\">UNDERSTANDING TONE</span><br><br>\"I totally get that... <span class=\"pause-indicator\"></span> and just to be clear... <span class=\"pause-indicator\"></span> I'm not asking you to change anything right now. <span class=\"pause-indicator\"></span><br><br>Here's the only question: <span class=\"pause-indicator\"></span> Would it be valuable to at least KNOW if you're leaving money on the table? <span class=\"pause-indicator\"></span><br><br>Because if your rates ARE competitive... <span class=\"pause-indicator\"></span> great, I'll tell you that. <span class=\"pause-indicator\"></span> If there's a gap... <span class=\"pause-indicator\"></span> at least you KNOW.\"",
                responses: [
                    { label: "I guess that would be useful", next: 'nepq_micro_commitment_1' },
                    { label: "How long would that take?", next: 'nepq_micro_commitment_1' },
                    { label: "Still not interested", next: 'respect_decision' }
                ]
            },
            nepq_timing_discuss: {
                stage: 'NEPQ Objection - Bad Timing',
                text: "<span class=\"tone-marker curious\">🔄 NEPQ 3-STEP: DISCUSS</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"Aww okay... <span class=\"pause-indicator\"></span> so timing's tight right now... <span class=\"pause-indicator\"></span><br><br>I'm curious though... <span class=\"pause-indicator\"></span> when WOULD be a good time to look at this? <span class=\"pause-indicator\"></span><br><br>Because here's the thing... <span class=\"pause-indicator\"></span> rates are actually going UP right now. <span class=\"pause-indicator\"></span> So the longer you wait... <span class=\"pause-indicator\"></span> the worse the deal you'll get when you renew.\"",
                responses: [
                    { label: "Maybe next month", next: 'schedule_followup' },
                    { label: "I can spare 15 minutes now", next: 'nepq_micro_commitment_1' },
                    { label: "Just email me something", next: 'email_first' }
                ]
            },
            // ===== NEPQ MICRO-COMMITMENT CLOSING SEQUENCE =====
            nepq_micro_commitment_1: {
                stage: 'NEPQ Closing - Micro-Commitment',
                text: "<span class=\"tone-marker curious\">🎯 STAGE 5: MICRO-COMMITMENT #1 - Worth Exploring?</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"So do you feel like running an audit... <span class=\"pause-indicator\"></span> to see what the full market is actually quoting... <span class=\"pause-indicator\"></span> is something worth exploring?\"<br><br><em>⏸️ WAIT FOR YES - if they hesitate, go back to consequence</em>",
                responses: [
                    { label: "Yeah, I think so", next: 'nepq_micro_commitment_2' },
                    { label: "Definitely", next: 'nepq_micro_commitment_2' },
                    { label: "Maybe... tell me more", next: 'broker_audit_close' },
                    { label: "I need to think about it", next: 'nepq_commitment_hesitation' }
                ]
            },
            nepq_micro_commitment_2: {
                stage: 'NEPQ Closing - Micro-Commitment',
                text: "<span class=\"tone-marker curious\">✅ MICRO-COMMITMENT #2 - Why Worth It?</span><br><br><span class=\"tone-marker curious\">CURIOUS TONE</span> (make them SELL IT TO THEMSELVES)<br><br>\"Perfect. <span class=\"pause-indicator\"></span> Why do you feel it's worth it, though?\"<br><br><em>💡 THIS IS GOLD - They're now convincing themselves</em><br><em>⏸️ Listen to their reason - this is their buying motivation</em>",
                responses: [
                    { label: "Want to make sure we're not overpaying", next: 'nepq_micro_commitment_3' },
                    { label: "Would be good to know where we stand", next: 'nepq_micro_commitment_3' },
                    { label: "Could save us money", next: 'nepq_micro_commitment_3' },
                    { label: "Peace of mind", next: 'nepq_micro_commitment_3' }
                ]
            },
            nepq_micro_commitment_3: {
                stage: 'NEPQ Closing - Micro-Commitment',
                text: "<span class=\"tone-marker curious\">✅ MICRO-COMMITMENT #3 - Calendar Lock</span><br><br><span class=\"tone-marker curious\">ASSUMPTIVE TONE</span> (you're not asking IF, you're asking WHEN)<br><br>\"Perfect. <span class=\"pause-indicator\"></span> So here's what makes sense... <span class=\"pause-indicator\"></span><br><br>I'll run that audit over the next 2-3 days... <span class=\"pause-indicator\"></span><br><br>I'll pull quotes from 100+ suppliers... <span class=\"pause-indicator\"></span><br><br>Then we'll hop on a 15-minute call and I'll show you what I found... <span class=\"pause-indicator\"></span><br><br>If your broker's rates are competitive, I'll tell you that... <span class=\"pause-indicator\"></span><br><br>If there's a gap, at least you KNOW... <span class=\"pause-indicator\"></span><br><br>No obligation, no pressure... <span class=\"pause-indicator\"></span> Just data so you can make an informed decision... <span class=\"pause-indicator\"></span><br><br><strong>Does Thursday at 2 PM work... <span class=\"pause-indicator\"></span> or would Friday morning be better?</strong>\"<br><br><em>💡 BINARY CHOICE - they're not choosing WHETHER, they're choosing WHEN</em>",
                responses: [
                    { label: "Thursday works", next: 'nepq_micro_commitment_4' },
                    { label: "Friday works", next: 'nepq_micro_commitment_4' },
                    { label: "Let me check my calendar", next: 'nepq_micro_commitment_4' },
                    { label: "What do you need from me?", next: 'audit_info_needed' }
                ]
            },
            nepq_micro_commitment_4: {
                stage: 'NEPQ Closing - Micro-Commitment',
                text: "<span class=\"tone-marker confident\">✅ MICRO-COMMITMENT #4 - Calendar Confirmation</span><br><br><span class=\"tone-marker confident\">CONFIDENT TONE</span><br><br>\"Great. <span class=\"pause-indicator\"></span> I'm sending you a calendar invite right now... <span class=\"pause-indicator\"></span>\"<br><br><em>⏸️ SEND WHILE ON PHONE</em><br><br>\"Did you get it?\"<br><br><em>⚠️ CRITICAL: STAY ON LINE until they confirm!</em><br><em>💡 This alone = 87% show-up rate vs 40% if sent after call</em><br><br><div style=\"background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(34, 197, 94, 0.3); margin-top: 12px;\"><strong style=\"color: #22c55e;\">🎯 4 MICRO-COMMITMENTS LOCKED:</strong><br>✅ 1. Yes to audit (worth exploring)<br>✅ 2. Defended WHY they want it<br>✅ 3. Committed to specific time<br>✅ 4. Accepted calendar invite</div>",
                responses: [
                    { label: "Yeah, I see it", next: 'close_invoice_soft_ask' },
                    { label: "Got it", next: 'close_invoice_soft_ask' },
                    { label: "Didn't get it yet", next: 'close_send_invite_retry' }
                ]
            },
            nepq_commitment_hesitation: {
                stage: 'NEPQ Closing - Handle Hesitation',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span> (not pushy)<br><br>\"Fair enough... <span class=\"pause-indicator\"></span> what's holding you back?\"<br><br><em>⏸️ Listen to their real concern</em>",
                responses: [
                    { label: "Need to think about it", next: 'close_think_about_it' },
                    { label: "Need to check with someone", next: 'objection_need_to_check' },
                    { label: "Not sure it's worth the time", next: 'nepq_time_concern' },
                    { label: "We're happy with our setup", next: 'nepq_broker_happy_clarify' }
                ]
            },
            nepq_time_concern: {
                stage: 'NEPQ Closing - Time Concern',
                text: "<span class=\"tone-marker curious\">CURIOUS TONE</span><br><br>\"I hear you... <span class=\"pause-indicator\"></span> so let me ask... <span class=\"pause-indicator\"></span><br><br>If we could show you in 15 minutes whether you're leaving $50K+ on the table... <span class=\"pause-indicator\"></span> would that be worth the time?\"<br><br><em>⏸️ Reframe time vs value</em>",
                responses: [
                    { label: "Yeah, that would be worth it", next: 'nepq_micro_commitment_3' },
                    { label: "I guess so", next: 'nepq_micro_commitment_3' },
                    { label: "Still not sure", next: 'email_first' }
                ]
            },
            // ===== BROKER AUDIT STRATEGY (Non-Combative Competitive) =====
            broker_audit_intro: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker understanding\">Acknowledge (validate their relationship)</span><br><br><span class=\"pause-indicator\"></span><span class=\"pause-indicator\"></span> <em>(Wait 2 seconds, don't jump in immediately)</em><br><br>That's actually really smart. <span class=\"pause-indicator\"></span> A lot of companies use brokers because they don't have the bandwidth to manage this themselves. <span class=\"pause-indicator\"></span> That makes total sense.<br><br><span class=\"pause-indicator\"></span> <em>(Let that land)</em><br><br><span class=\"tone-marker curious\">Ask (dig deeper with strategic questions)</span><br><br>Quick question though— <span class=\"pause-indicator\"></span> when you last renewed, did your broker bring you 5-10 competitive quotes from different suppliers, <span class=\"pause-indicator\"></span> or was it more like 2-3 options?",
                responses: [
                    { label: "5-10 competitive quotes", next: 'broker_performance_good' },
                    { label: "Just 2-3 options", next: 'broker_performance_limited' },
                    { label: "They mostly just renew what we have", next: 'broker_performance_limited' },
                    { label: "Not sure / Don't remember", next: 'broker_audit_reframe' }
                ]
            },
            broker_performance_limited: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker understanding\">empathetic, not attacking</span> <span class=\"pause-indicator\"></span> That's actually really common. <span class=\"pause-indicator\"></span> A lot of brokers focus on administration and renewals rather than true competitive shopping. <span class=\"pause-indicator\"></span> They've got their preferred suppliers, and it's easier to just go back to them.<br><br><span class=\"tone-marker confident\">Here's the thing though</span>— <span class=\"pause-indicator\"></span> when you run a REAL competitive event where 100+ suppliers are actually bidding against each other, <span class=\"pause-indicator\"></span> the quotes are typically 15-20% lower than renewal quotes from the same suppliers. <span class=\"pause-indicator\"></span> That's just how the market works.<br><br>Your broker probably doesn't have access to that full network. <span class=\"pause-indicator\"></span> Not their fault, that's just their model. <span class=\"pause-indicator\"></span> But that gap? <span class=\"pause-indicator\"></span> That's real money you might be leaving on the table.",
                responses: [
                    { label: "That sounds like us", next: 'broker_audit_close' },
                    { label: "How much money are we talking?", next: 'situation_monthly_spend' },
                    { label: "We're happy with our broker", next: 'broker_performance_good' }
                ]
            },
            broker_performance_good: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker confident\">respectful tone</span> <span class=\"pause-indicator\"></span> That's awesome, and I respect that. <span class=\"pause-indicator\"></span> Real talk though—even the best brokers work with a limited supplier network. <span class=\"pause-indicator\"></span> They probably have relationships with maybe 30-50 suppliers, which is solid. <span class=\"pause-indicator\"></span> But there are 100+ in the actual market.<br><br><span class=\"tone-marker curious\">What if there's supply out there at better rates that your broker doesn't have access to?</span> <span class=\"pause-indicator\"></span> Not because they're bad at their job, but just because their network is finite.",
                responses: [
                    { label: "That's possible", next: 'broker_audit_reframe' },
                    { label: "They shop everything", next: 'broker_audit_reframe' },
                    { label: "Not interested in switching", next: 'broker_audit_no_switch' }
                ]
            },
            broker_audit_no_switch: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> <span class=\"pause-indicator\"></span> I hear you—and just to be clear, I'm not asking you to switch brokers. <span class=\"pause-indicator\"></span><br><br>Think of this like getting a second medical opinion before major surgery. <span class=\"pause-indicator\"></span> Your current broker might be doing a solid job, <span class=\"pause-indicator\"></span> but wouldn't you want to KNOW if you're leaving $50K-$100K on the table just because you've only seen one side of the market?<br><br>We're not saying your broker is bad. <span class=\"pause-indicator\"></span> We're saying you probably don't have all the information you need to make the best decision.",
                responses: [
                    { label: "That makes sense", next: 'broker_audit_close' },
                    { label: "What would this look like?", next: 'broker_audit_close' },
                    { label: "Still not interested", next: 'respect_decision' }
                ]
            },
            broker_audit_reframe: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker confident\">Reframe (position as Second Opinion)</span><br><br>Here's why I'm asking: <span class=\"pause-indicator\"></span> Most brokers work with a handful of preferred suppliers—maybe 10-20. <span class=\"pause-indicator\"></span> That's fine for administrative purposes, but it means you're only seeing 10-20% of what's actually available in the market.<br><br><span class=\"tone-marker understanding\">We call this a 'broker audit.'</span> <span class=\"pause-indicator\"></span> Here's what it is: <span class=\"pause-indicator\"></span> We pull quotes from our network of 100+ suppliers—completely different ones than your broker probably works with—and show you what that OTHER 80% of the market is quoting.<br><br>Think of it like getting a second medical opinion before major surgery. <span class=\"pause-indicator\"></span> Your current broker might be doing a solid job, <span class=\"pause-indicator\"></span> but wouldn't you want to KNOW if you're leaving $50K-$100K on the table just because you've only seen one side of the market?",
                responses: [
                    { label: "That makes sense", next: 'broker_audit_close' },
                    { label: "What would this cost?", next: 'solution_faq_cost' },
                    { label: "We're happy with our broker", next: 'future_opportunity' }
                ]
            },
            broker_audit_close: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker confident\">Audit Close (Low-Pressure)</span><br><br>\"So here's what makes sense: <span class=\"pause-indicator\"></span> Let me run a quick audit. <span class=\"pause-indicator\"></span> Takes me 2-3 days. <span class=\"pause-indicator\"></span> I'll pull quotes from suppliers your broker probably isn't working with.<br><br>Then we hop on a 15-minute call and I show you what I found.<br><br>If your broker's rates are actually competitive, <span class=\"pause-indicator\"></span> I'll tell you that. <span class=\"pause-indicator\"></span> If there's a gap, at least you KNOW.<br><br>No obligation, no pressure. <span class=\"pause-indicator\"></span> Just data so you can make an informed decision. <span class=\"pause-indicator\"></span> Fair?\"",
                responses: [
                    { label: "Fair - let's do it", next: 'nepq_micro_commitment_3' },
                    { label: "What do you need from me?", next: 'audit_info_needed' },
                    { label: "Send me information first", next: 'objection_send_something' },
                    { label: "I need to think about it", next: 'close_think_about_it' },
                    { label: "I'll talk to my broker first", next: 'objection_talk_to_broker' }
                ]
            },
            audit_info_needed: {
                stage: 'Broker Audit',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Really just a few things:<br><br>1. <span class=\"pause-indicator\"></span> Roughly what you're spending monthly (even a ballpark)<br>2. <span class=\"pause-indicator\"></span> When your contract expires<br>3. <span class=\"pause-indicator\"></span> Your current rate per kWh if you know it<br><br>That's it. <span class=\"pause-indicator\"></span> We handle everything else. <span class=\"pause-indicator\"></span> I'll pull the quotes, standardize them so you can compare apples to apples, <span class=\"pause-indicator\"></span> and then walk you through what the market is actually offering.<br><br>What's a good time for a 15-minute call later this week to review what I found?",
                responses: [
                    { label: "Thursday works", next: 'close_meeting_scheduled' },
                    { label: "Friday works", next: 'close_meeting_scheduled' },
                    { label: "Let me check my calendar", next: 'close_meeting' }
                ]
            },
            ack_confident_handle: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker confident\">positive, respecting tone</span> <span class=\"pause-indicator\"></span> Okay, perfect. So you're on top of it - that's good to hear. <span class=\"pause-indicator\"></span> Let me ask though, roughly how much are you spending monthly on electricity? <span class=\"pause-indicator\"></span> Just want to see if there's any opportunity we might be missing.",
                responses: [] // Special handling - will render input field in render() function
            },
            ack_struggling: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker understanding\">empathetic, normalizing tone</span> <span class=\"pause-indicator\"></span> Okay, so it's been a challenge - I hear that a lot actually. <span class=\"pause-indicator\"></span> Most companies I talk to are in the same boat. <span class=\"pause-indicator\"></span> Help me understand, roughly how much are you spending monthly?",
                responses: [] // Special handling - will render input field in render() function
            },
            ack_no_idea: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker understanding\">non-judgmental, reassuring tone</span> <span class=\"pause-indicator\"></span> Fair enough - most people don't, to be honest. <span class=\"pause-indicator\"></span> You're not alone on that one. <span class=\"pause-indicator\"></span> So let me ask, roughly how much are you spending monthly? <span class=\"pause-indicator\"></span> Even a ballpark estimate is fine.",
                responses: [] // Special handling - will render input field in render() function
            },
            ack_vendor_handling: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker curious\">respectful, curious tone</span> <span class=\"pause-indicator\"></span> Okay, so you've got someone handling it— <span class=\"pause-indicator\"></span> is that a broker or an internal team?",
                responses: [
                    { label: "We use a broker", next: 'broker_audit_intro' },
                    { label: "Internal team handles it", next: 'situation_discovery' },
                    { label: "Not sure exactly", next: 'situation_discovery' }
                ]
            },
            ack_defensive: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker friendly\">honest, disarming tone</span> <span class=\"pause-indicator\"></span> Yeah, totally fair question. <span class=\"pause-indicator\"></span> I'm just trying to understand your situation before I spend your time with something that might not be relevant. <span class=\"pause-indicator\"></span> Most companies I talk to don't have a strategy around this, and it's costing them. <span class=\"pause-indicator\"></span> So I wanted to see if that's even something worth exploring with you. <span class=\"pause-indicator\"></span> Is that fair?",
                responses: [
                    { label: "Fair enough, go ahead", next: 'situation_discovery' },
                    { label: "I hear you, but what exactly?", next: 'value_proposition' },
                    { label: "Now's not a good time", next: 'objection_bad_timing' },
                    { label: "We use a broker", next: 'broker_audit_intro' },
                    { label: "We're not interested", next: 'objection_not_interested' }
                ]
            },
            ack_just_renewed: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker curious\">curious, informative tone</span> <span class=\"pause-indicator\"></span> Okay, so you're locked in - when did you guys renew? <span class=\"pause-indicator\"></span> And just out of curiosity, roughly how much are you paying? <span class=\"pause-indicator\"></span> Might be worth knowing what the market is offering, just for reference down the road.",
                responses: [
                    { label: "Renewed 3 months ago / amount known", next: 'future_opportunity' },
                    { label: "Just locked in / locked until 2027+", next: 'future_opportunity' },
                    { label: "Not sure exactly when", next: 'future_opportunity' },
                    { label: "Don't want to discuss now", next: 'objection_locked_in' }
                ]
            },
            future_opportunity: {
                stage: 'Discovery - Future Opportunity',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Got it. <span class=\"pause-indicator\"></span> So here's what I'd suggest - when you're about 6 months out from your next renewal, that's when we start getting competitive quotes. <span class=\"pause-indicator\"></span><br><br>That gives you real leverage because suppliers are competing for your business during off-peak periods. <span class=\"pause-indicator\"></span> Plus, you're not scrambling at the last minute.<br><br>Do you know roughly when your contract expires so we can mark a date to reconnect? <span class=\"pause-indicator\"></span> I can send you a calendar reminder or just reach out when it makes sense.",
                responses: [
                    { label: 'Know expiration date', next: 'schedule_followup' },
                    { label: 'Not sure, will check', next: 'email_first' },
                    { label: "Just contact me when it's time", next: 'followup_scheduled' }
                ]
            },
            value_proposition: {
                stage: 'Value - Explanation',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Sure, happy to explain. <span class=\"pause-indicator\"></span> Most companies I talk to don't have a strategy around electricity renewals - they wait until 60-90 days before contract expiry to start shopping. <span class=\"pause-indicator\"></span><br><br>The problem is that's peak season when suppliers are busy, rates are less negotiable, and you've got limited time. <span class=\"pause-indicator\"></span><br><br>What we do is run what we call a \"broker audit\"— <span class=\"pause-indicator\"></span> we pull quotes from 100+ suppliers and show you what the full market is actually quoting. <span class=\"pause-indicator\"></span> Think of it like getting a second opinion. <span class=\"pause-indicator\"></span> Does that make sense?",
                responses: [
                    { label: 'Yes, that makes sense', next: 'broker_audit_close' },
                    { label: 'Tell me more about the process', next: 'solution_faq_process' },
                    { label: "We use a broker already", next: 'broker_audit_intro' },
                    { label: "Not interested", next: 'objection_not_interested' }
                ]
            },
            objection_bad_timing: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> Totally get it. <span class=\"pause-indicator\"></span> When would be a better time to chat? <span class=\"pause-indicator\"></span> Or would you prefer I just send you some information first so you can look it over when it's convenient?",
                responses: [
                    { label: 'Send me information', next: 'email_first' },
                    { label: 'What\'s the market context?', next: 'market_context' },
                    { label: 'Try later today', next: 'schedule_followup' },
                    { label: 'Try next week', next: 'schedule_followup' },
                    { label: "Just forget it", next: 'respect_decision' }
                ]
            },
            objection_locked_in: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> I totally understand - you're locked in, so this isn't relevant right now. <span class=\"pause-indicator\"></span> Here's what I'd suggest though: when you're about 6 months out from your next renewal, that's when it makes sense to start shopping competitively. <span class=\"pause-indicator\"></span><br><br>Would it be okay if I reach out around that time? <span class=\"pause-indicator\"></span> Or would you prefer I just send some information now for reference down the road?",
                responses: [
                    { label: 'Yes, reach out in 6 months', next: 'schedule_followup' },
                    { label: 'Send information for later', next: 'email_first' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            opener_direct_question: {
                stage: 'Opening',
                text: "<span class=\"tone-marker confident\">confident, conversational tone</span> <span class=\"pause-indicator\"></span> Hi {{contact.first_name}}, this is <span class=\"name-badge\">(your name)</span> from Power Choosers. <span class=\"pause-indicator\"></span> Real quick - I'm calling because most companies I talk to are either overpaying on their electricity or don't really have visibility into what they're spending. <span class=\"pause-indicator\"></span><br><br>Can I ask - how is {{account.name}} actually managing that right now?",
                responses: [
                    { label: "Yeah, we're on top of it", next: 'ack_dq_confident' },
                    { label: "Not really, it's kind of a mess", next: 'ack_dq_struggling' },
                    { label: "We have someone handling it", next: 'ack_dq_delegated' },
                    { label: "Why are you calling? / What's this about?", next: 'ack_dq_defensive' },
                    { label: "Not interested / we're fine", next: 'ack_dq_not_interested' },
                    { label: "We just locked in a contract", next: 'ack_dq_just_renewed' }
                ]
            },
            ack_dq_confident: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Cool - that's good to hear. <span class=\"pause-indicator\"></span> So roughly, how much are you spending monthly just so I understand the scope?",
                responses: [] // Special handling - will render input field in render() function
            },
            ack_dq_struggling: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker understanding\">empathetic tone</span> <span class=\"pause-indicator\"></span> Yeah, I hear that all the time - you're not alone. <span class=\"pause-indicator\"></span> Help me understand though, roughly what are you spending monthly?",
                responses: [] // Special handling - will render input field in render() function
            },
            ack_dq_delegated: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Got it - so you've delegated it. <span class=\"pause-indicator\"></span> That's smart. <span class=\"pause-indicator\"></span> Just curious though - do you know what you're actually spending annually? <span class=\"pause-indicator\"></span> And who's your vendor right now?",
                responses: [
                    { label: 'Know spending / vendor is known', next: 'situation_contract_expiry' },
                    { label: 'Know spending / vendor unknown', next: 'situation_supplier_name' },
                    { label: "Don't know spending or vendor", next: 'situation_monthly_spend' }
                ]
            },
            ack_dq_defensive: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker friendly\">honest, disarming tone</span> <span class=\"pause-indicator\"></span> Yeah, fair question. <span class=\"pause-indicator\"></span> I basically saw that most companies in your industry are overpaying without knowing it. <span class=\"pause-indicator\"></span> Thought it was worth exploring. <span class=\"pause-indicator\"></span> You opposed to a quick conversation?",
                responses: [
                    { label: "Fair enough, let's talk", next: 'situation_discovery' },
                    { label: "I hear you, but what exactly?", next: 'value_proposition' },
                    { label: "Not interested", next: 'objection_not_interested' }
                ]
            },
            ack_dq_not_interested: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> I totally understand. <span class=\"pause-indicator\"></span> You've got a solution that's working, and changing is risky.<br><br><span class=\"tone-marker curious\">Reframe</span> <span class=\"pause-indicator\"></span> Real quick question though— <span class=\"pause-indicator\"></span> have you had a second opinion on your current rates in the last 12-18 months? <span class=\"pause-indicator\"></span> Because we typically find that companies are overpaying 15-20% just because they haven't seen the full market.<br><br><span class=\"tone-marker confident\">Close</span> <span class=\"pause-indicator\"></span> What if we just ran an audit to see what the market's actually quoting right now? <span class=\"pause-indicator\"></span> No obligation. <span class=\"pause-indicator\"></span> If your current rates are competitive, I'll tell you that. <span class=\"pause-indicator\"></span> If there's a gap, now you know.",
                responses: [
                    { label: "That sounds reasonable", next: 'broker_audit_close' },
                    { label: 'I know when our contract expires', next: 'schedule_followup' },
                    { label: "We use a broker", next: 'broker_audit_intro' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            ack_dq_just_renewed: {
                stage: 'Discovery - Transition',
                text: "<span class=\"tone-marker curious\">curious, informative tone</span> <span class=\"pause-indicator\"></span> Okay, locked in - for how long? <span class=\"pause-indicator\"></span> Just want to know when we should revisit this conversation.",
                responses: [
                    { label: "Renewed 3 months ago / locked until 2027+", next: 'future_opportunity' },
                    { label: "Just locked in recently", next: 'future_opportunity' },
                    { label: "Not sure exactly when", next: 'future_opportunity' },
                    { label: "Don't want to discuss now", next: 'objection_locked_in' }
                ]
            },
            opener_transparent: {
                stage: 'Opening',
                text: "Hi {{contact.first_name}}, this is <span class=\"name-badge\">(your name)</span> from Power Choosers. <span class=\"pause-indicator\"></span> I know this is random, but I'm calling about electricity costs. <span class=\"pause-indicator\"></span> Full transparency - this is a sales call. I know I'm calling you out of the blue. <span class=\"pause-indicator\"></span> Is now actually a bad time for a quick chat?",
                responses: [
                    { label: 'Now is fine / I\'ve got a minute', next: 'opener_transparent_followup' },
                    { label: 'What is this about?', next: 'opener_transparent_followup' },
                    { label: 'Actually, now is bad', next: 'opener_transparent_bad_time' },
                    { label: 'Not interested', next: 'objection_not_interested' }
                ]
            },
            opener_transparent_followup: {
                stage: 'Opening',
                text: "<span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> So real talk - most companies I talk to, they don't have a strategy around electricity costs. <span class=\"pause-indicator\"></span> And it's costing them real money. Do you feel like you have a solid handle on your electricity costs?",
                responses: [
                    { label: 'Yes, I handle it well', next: 'probe_deeper' },
                    { label: "Not really / I'm not sure", next: 'consequence_variant_happy' },
                    { label: "We use a broker", next: 'broker_audit_intro' },
                    { label: "I don't handle that", next: 'gatekeeper_intro' }
                ]
            },
            opener_transparent_bad_time: {
                stage: 'Opening',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> Totally get it. <span class=\"pause-indicator\"></span> When would be a better time to chat? <span class=\"pause-indicator\"></span> Or would you prefer I just send you some information first?",
                responses: [
                    { label: 'Send me information', next: 'email_first' },
                    { label: 'Try later today', next: 'schedule_followup' },
                    { label: 'Just forget it', next: 'respect_decision' }
                ]
            },
            opener_social_proof: {
                stage: 'Opening',
                text: "<span class=\"tone-marker confident\">Market Data Opener</span><br><br>Hey {{contact.first_name}}, this is (your name) from Power Choosers. <span class=\"pause-indicator\"></span> I'm calling because we just ran analysis on {{account.industry}} companies in the Texas market, <span class=\"pause-indicator\"></span> and we're seeing that most are paying 15-20% more than market rates. <span class=\"pause-indicator\"></span><br><br>Wanted to see if {{account.name}} is experiencing something similar?",
                responses: [
                    { label: 'Yes, costs have been going up', next: 'consequence_variant_rates' },
                    { label: "Not really an issue", next: 'opener_social_proof_skeptical' },
                    { label: "We use a broker", next: 'broker_audit_intro' },
                    { label: 'Tell me more', next: 'broker_audit_reframe' },
                    { label: 'Not interested', next: 'objection_not_interested' }
                ]
            },
            opener_social_proof_skeptical: {
                stage: 'Opening',
                text: "<span class=\"tone-marker curious\">curious tone</span> I totally get that, you know? <span class=\"pause-indicator\"></span> So let me ask you this though - are you aware of how much electricity rates have gone up in the last 4 years? <span class=\"pause-indicator\"></span> Like, the market has moved a LOT.",
                responses: [
                    { label: 'I\'ve heard about rate increases', next: 'market_context' },
                    { label: 'Not really aware', next: 'market_context' },
                    { label: 'Still not interested', next: 'objection_not_interested' }
                ]
            },
            opener_quick_check: {
                stage: 'Opening',
                text: "<span class=\"tone-marker confident\">Audit Positioning Opener</span><br><br>Hi {{contact.first_name}}, this is (your name) from Power Choosers. <span class=\"pause-indicator\"></span> What we do is run what we call broker audits— <span class=\"pause-indicator\"></span> basically a market check on your current energy rates. <span class=\"pause-indicator\"></span><br><br>We pull quotes from 100+ suppliers and show you what you're actually paying vs. market. <span class=\"pause-indicator\"></span><br><br>Have you ever had something like that run before?",
                responses: [
                    { label: "No, never heard of that", next: 'broker_audit_reframe' },
                    { label: "What exactly is that?", next: 'broker_audit_reframe' },
                    { label: "We use a broker already", next: 'broker_audit_intro' },
                    { label: "Not interested", next: 'objection_not_interested' }
                ]
            },
            situation_discovery: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Got it. <span class=\"pause-indicator\"></span> So help me understand - roughly how much are you spending monthly on electricity?",
                responses: [] // Special handling - will render input field in render() function
            },
            situation_monthly_spend: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Okay, that helps. <span class=\"pause-indicator\"></span> So let me calculate this real quick - if you're spending roughly {{monthly_spend}} monthly, that's about {{annual_spend}} annually. <span class=\"pause-indicator\"></span> With the way rates are moving and most companies overpaying by 20-30% on renewal, we could be talking {{potential_savings}} annually in potential savings. <span class=\"pause-indicator\"></span><br><br>Does that kind of impact matter to you?",
                responses: [
                    { label: 'Yes, that matters', next: 'situation_rate_check' },
                    { label: "That's too much to estimate", next: 'situation_rate_check' },
                    { label: "Not really a priority", next: 'objection_not_priority' }
                ]
            },
            situation_rate_check: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Fair. <span class=\"pause-indicator\"></span> So do you know roughly what rate you're paying per kWh right now?",
                responses: [
                    { label: 'Know the rate (X.X cents/kWh)', next: 'situation_decision_committee' },
                    { label: "Don't know it", next: 'situation_decision_committee' }
                ]
            },
            situation_decision_committee: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Got it. <span class=\"pause-indicator\"></span> So before we go deeper - is this just you, or do other people need to be involved in electricity decisions? <span class=\"pause-indicator\"></span> Like your CFO or finance team?",
                responses: [
                    { label: 'Just me', next: 'situation_supplier_name' },
                    { label: 'CFO / Finance team involved', next: 'situation_team_decision' },
                    { label: 'Multiple people involved', next: 'situation_team_decision' }
                ]
            },
            situation_team_decision: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Smart. <span class=\"pause-indicator\"></span> Should we loop them in on this conversation, or do you want to review first and then bring them in later?",
                responses: [
                    { label: 'Let\'s loop them in now', next: 'situation_supplier_name' },
                    { label: 'I\'ll review first', next: 'situation_supplier_name' },
                    { label: 'We\'ll include them when ready', next: 'situation_supplier_name' }
                ]
            },
            situation_supplier_name: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Got it. <span class=\"pause-indicator\"></span> And who is your current electricity supplier?",
                responses: [
                    { label: 'Named a supplier', next: 'situation_contract_expiry' },
                    { label: "Not sure / Don't remember", next: 'situation_contract_expiry' }
                ]
            },
            situation_contract_expiry: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker curious\">curious tone</span> And do you happen to know when your contract expires? <span class=\"pause-indicator\"></span> Just helps me understand the timing for when we'd want to lock in competitive rates, you know?",
                responses: [
                    { label: 'Within 3 months - HOT', next: 'situation_decision_process_urgent' },
                    { label: '3-6 months out', next: 'problem_discovery' },
                    { label: '6-12 months out', next: 'problem_discovery' },
                    { label: 'Not sure / Don\'t know', next: 'problem_discovery' },
                    { label: 'Just renewed recently', next: 'problem_discovery' }
                ]
            },
            situation_decision_process_urgent: {
                stage: 'Discovery - Situation',
                text: "<span class=\"tone-marker concerned\">concerned tone</span> That's really tight timing, you know? <span class=\"pause-indicator\"></span> But actually, that's perfect because we can help you lock in competitive rates NOW before the market moves.<br><br>So who else needs to be involved in the decision besides you?",
                responses: [
                    { label: 'Just me / I decide', next: 'problem_discovery' },
                    { label: 'Involves CFO / Finance', next: 'problem_discovery' },
                    { label: 'Multiple stakeholders', next: 'problem_discovery' }
                ]
            },
            market_context: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker concerned\">concerned tone</span> That's perfect timing actually. <span class=\"pause-indicator\"></span> So here's something most people don't realize - electricity prices have doubled in the last 4 years because of data centers and AI. <span class=\"pause-indicator\"></span><br><br>So when you renew, you're shopping into that market, right? <span class=\"pause-indicator\"></span> What would it cost {{account.name}} if your rates go up another 15-20%?",
                responses: [
                    { label: 'That would hurt our budget', next: 'consequence_variant_rates' },
                    { label: "Not sure about the impact", next: 'consequence_variant_rates' },
                    { label: "We're fine with current setup", next: 'objection_happy_supplier' }
                ]
            },
            problem_discovery: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker curious\">Curious, empathetic tone</span> <span class=\"pause-indicator\"></span> Okay, that's helpful. <span class=\"pause-indicator\"></span> So I'm curious - when it comes to electricity, what's been causing you the most stress? <span class=\"pause-indicator\"></span> Or is it even on your radar?",
                responses: [
                    { label: 'Costs are too high', next: 'probe_problem_costs' },
                    { label: 'Complexity / too many options', next: 'probe_problem_complexity' },
                    { label: 'Budget uncertainty', next: 'probe_problem_budget' },
                    { label: "We're happy / no problems", next: 'consequence_variant_happy' },
                    { label: "We're locked in / just renewed", next: 'consequence_variant_lockedin' },
                    { label: "Tried before / was a nightmare", next: 'consequence_variant_triedbefore' }
                ]
            },
            probe_problem_costs: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Tell me more about that... <span class=\"pause-indicator\"></span> When did you first notice the costs going up? <span class=\"pause-indicator\"></span> Like, was it recent or has it been going on for a while? <span class=\"pause-indicator\"></span> And how has that impacted your ability to plan your budget? <span class=\"pause-indicator\"></span> Has leadership noticed this too?",
                responses: [
                    { label: 'Recent increase, significant budget impact', next: 'consequence_variant_rates' },
                    { label: 'Ongoing issue, some impact on planning', next: 'consequence_variant_rates' },
                    { label: 'Long-term problem, leadership is aware', next: 'consequence_variant_rates' }
                ]
            },
            probe_problem_complexity: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> I hear that a lot, you know? <span class=\"pause-indicator\"></span> So what specifically makes it complex for you? <span class=\"pause-indicator\"></span> Is it comparing all the options, or is it more about understanding the contracts?",
                responses: [
                    { label: 'Too many options to compare', next: 'consequence_variant_complicated' },
                    { label: 'Contracts are confusing', next: 'consequence_variant_complicated' },
                    { label: 'Don\'t have time to research', next: 'consequence_variant_notime' }
                ]
            },
            probe_problem_budget: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Budget uncertainty is a real pain point, I know. <span class=\"pause-indicator\"></span> How long has that been an issue for you? <span class=\"pause-indicator\"></span> And what impact does that actually have on your planning?",
                responses: [
                    { label: 'Makes planning difficult', next: 'consequence_variant_notime' },
                    { label: 'Can\'t predict costs', next: 'consequence_variant_notime' },
                    { label: 'Leadership wants more certainty', next: 'consequence_variant_notime' }
                ]
            },
            probe_problem_generic: {
                stage: 'Discovery - Problem',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Tell me more about what's challenging for you... <span class=\"pause-indicator\"></span> Is it the cost, the complexity, or something else?",
                responses: [
                    { label: 'Cost is the issue', next: 'probe_problem_costs' },
                    { label: 'Complexity is the issue', next: 'probe_problem_complexity' },
                    { label: 'Budget uncertainty', next: 'probe_problem_budget' }
                ]
            },
            consequence_discovery: {
                stage: 'Discovery - Consequence (2-Layer)',
                text: "<span class=\"tone-marker serious\">pause, then real tone</span> <span class=\"pause-indicator\"></span> Look - most companies wait until 90 days before renewal to shop. <span class=\"pause-indicator\"></span> That's a bad play. <span class=\"pause-indicator\"></span> Rates have typically gone up, and suppliers know you don't have much time before your contract expires, so they'll give you a higher quote. <span class=\"pause-indicator\"></span><br><br>It's almost like booking a plane ticket <span class=\"pause-indicator\"></span> - when you go on a flight, do you reserve that flight months in advance or the week before? <span class=\"pause-indicator\"></span><br><br>Exactly. <span class=\"pause-indicator\"></span> The more seats available on the plane, the cheaper the ticket. <span class=\"pause-indicator\"></span><br><br>Electricity works the same way but on a massive scale. <span class=\"pause-indicator\"></span> The earlier you reserve your price, the more supply is actually available. <span class=\"pause-indicator\"></span> And with electricity prices rising right now, that gap is huge - we're seeing companies forced to pay 30%, 50%, sometimes 100% more. <span class=\"pause-indicator\"></span><br><br>Companies are being forced to pay that premium just because of timing. <span class=\"pause-indicator\"></span><br><br>What do you think?",
                responses: [
                    { label: 'That would be significant / $20K-$40K', next: 'solution_variant_rates' },
                    { label: "We always shop the market", next: 'probe_timing_strategy' },
                    { label: "We're locked in another year", next: 'schedule_future_planning' },
                    { label: 'Seems expensive / complicated', next: 'value_justification' }
                ]
            },
            consequence_variant_rates: {
                stage: 'Discovery - Consequence (Rates)',
                text: "<span class=\"tone-marker serious\">pause, then real tone</span> <span class=\"pause-indicator\"></span> Look - most companies wait until 90 days before renewal to shop. <span class=\"pause-indicator\"></span> That's a bad play. Rates have typically gone up, and suppliers know you don't have much time before your contract expires, so they'll give you a higher quote. <span class=\"pause-indicator\"></span><br><br>It's almost like booking a plane ticket <span class=\"pause-indicator\"></span> - when you go on a flight, do you reserve that flight months in advance or the week before? <span class=\"pause-indicator\"></span><br><br>Exactly. The more seats available on the plane, the cheaper the ticket. <span class=\"pause-indicator\"></span><br><br>Electricity works the same way but on a massive scale. <span class=\"pause-indicator\"></span> The earlier you reserve your price, the more supply is actually available. And with electricity prices rising right now, that gap is huge - we're seeing companies forced to pay 30%, 50%, sometimes 100% more. <span class=\"pause-indicator\"></span><br><br>Companies are being forced to pay that premium just because of timing. <span class=\"pause-indicator\"></span><br><br>What do you think?",
                responses: [
                    { label: "That's probably $20K-$40K", next: 'solution_variant_rates' },
                    { label: "Could be $50K+ a year", next: 'solution_variant_rates' },
                    { label: "Not sure but significant", next: 'solution_variant_rates' },
                    { label: "We always shop the market", next: 'probe_timing_strategy' },
                    { label: "We're locked in another year", next: 'schedule_future_planning' }
                ]
            },
            consequence_variant_complicated: {
                stage: 'Discovery - Consequence (Complexity)',
                text: "<span class=\"tone-marker confident\">real talk tone</span> <span class=\"pause-indicator\"></span> Real talk - suppliers make this confusing on purpose. <span class=\"pause-indicator\"></span> They know you won't spend 2 hours comparing quotes. So you pick whoever sounds most professional or calls the most. <span class=\"pause-indicator\"></span><br><br>But that confusion? <span class=\"pause-indicator\"></span> It's costing you. You're paying 20-30% more than market rate just because you can't see the gap. <span class=\"pause-indicator\"></span><br><br>Over the next 3 years, what's your guess on what that confusion costs you?",
                responses: [
                    { label: 'Could be $30K-$50K over 3 years', next: 'solution_variant_complicated' },
                    { label: 'Not sure, but definitely something', next: 'solution_variant_complicated' },
                    { label: 'Seems high', next: 'value_justification' },
                    { label: "We're locked in another year", next: 'schedule_future_planning' }
                ]
            },
            consequence_variant_notime: {
                stage: 'Discovery - Consequence (Time/Priority)',
                text: "<span class=\"tone-marker serious\">serious tone</span> <span class=\"pause-indicator\"></span> Here's the reality though - while you're handling everything else, your electricity costs are going up 15-20% in the background. <span class=\"pause-indicator\"></span> And because nobody's shopping, you're locked into rates 20-30% higher than what new customers pay. <span class=\"pause-indicator\"></span><br><br>So the consequence of not dealing with it now? <span class=\"pause-indicator\"></span> When renewal comes up in a couple years, it's a crisis. No leverage. Stuck. <span class=\"pause-indicator\"></span><br><br>What would you guess - is that costing you 25-30% more a year than you should?",
                responses: [
                    { label: 'That would be $30K-$50K', next: 'solution_variant_notime' },
                    { label: "That's significant cost", next: 'solution_variant_notime' },
                    { label: 'More than I thought', next: 'solution_variant_notime' },
                    { label: "We're locked in another year", next: 'schedule_future_planning' }
                ]
            },
            consequence_variant_happy: {
                stage: 'Discovery - Consequence (Hidden Cost)',
                text: "<span class=\"tone-marker curious\">curious but straight tone</span> <span class=\"pause-indicator\"></span> I get that you're happy. But here's the thing - are you happy because it's a solid deal, or just because you don't know what else is out there? <span class=\"pause-indicator\"></span><br><br>Real quick - when a NEW company comes to your supplier, they get quoted 20-30% lower than you do. <span class=\"pause-indicator\"></span><br><br>So you might be overpaying 20-30% annually without even knowing it. <span class=\"pause-indicator\"></span> Just no frame of reference. <span class=\"pause-indicator\"></span> Does that track?",
                responses: [
                    { label: 'That could be $15K-$25K', next: 'solution_variant_happy' },
                    { label: 'That seems high but possible', next: 'solution_variant_happy' },
                    { label: 'I should check our rates', next: 'solution_variant_happy' },
                    { label: "We're locked in another year", next: 'schedule_future_planning' }
                ]
            },
            consequence_variant_lockedin: {
                stage: 'Discovery - Consequence (Future Planning)',
                text: "<span class=\"tone-marker understanding\">understanding, not pushy</span> <span class=\"pause-indicator\"></span> I get it - you're locked in, so this isn't urgent right now. That's fair. <span class=\"pause-indicator\"></span><br><br>But real talk - when you locked in, did you actually shop around or just renew with who you had? <span class=\"pause-indicator\"></span><br><br>If you just renewed without shopping, you're probably paying rates that were locked in during peak season. <span class=\"pause-indicator\"></span> Could be $50K-$100K overpaid over the next few years. <span class=\"pause-indicator\"></span><br><br>Not asking you to do anything now. Just want you to think about approaching it differently next time renewal comes up. <span class=\"pause-indicator\"></span> Make sense?",
                responses: [
                    { label: "That makes sense - reach out in 6 months", next: 'future_opportunity' },
                    { label: "Yeah, I want to avoid that", next: 'solution_variant_lockedin' },
                    { label: "Not really concerned right now", next: 'respect_decision' }
                ]
            },
            consequence_variant_triedbefore: {
                stage: 'Discovery - Consequence (Try Again)',
                text: "<span class=\"tone-marker understanding\">validating but forward-looking</span> <span class=\"pause-indicator\"></span> Yeah, I hear that. Most companies have tried and it wasn't worth it. <span class=\"pause-indicator\"></span><br><br>Here's why - every supplier quotes different. You can't compare. So you get frustrated, give up, and they win. You stay locked in at higher rates for 3 more years. <span class=\"pause-indicator\"></span><br><br>That probably cost you $30K-$60K. <span class=\"pause-indicator\"></span><br><br>The good news? <span class=\"pause-indicator\"></span> We run 100+ suppliers through a structured process. Standardized quotes, easy to compare. You don't have to figure it out yourself. <span class=\"pause-indicator\"></span> That better than trying on your own again?",
                responses: [
                    { label: "That sounds like what happened to us", next: 'solution_variant_triedbefore' },
                    { label: "Would be worth doing it right", next: 'solution_variant_triedbefore' },
                    { label: "Still skeptical", next: 'value_justification' }
                ]
            },
            probe_timing_strategy: {
                stage: 'Discovery - Consequence',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> That's great, actually. <span class=\"pause-indicator\"></span> So you already get how important timing is. <span class=\"pause-indicator\"></span><br><br>So I gotta ask - when do you typically START shopping? <span class=\"pause-indicator\"></span> Like 90 days out? <span class=\"pause-indicator\"></span> Or are you thinking 6 months ahead?<br><br>Because what I'm seeing with the companies getting the best rates - they're shopping 6-12 months out. <span class=\"pause-indicator\"></span> And here's the key - they're not just comparing their current supplier's renewal offer, you know? They're getting quotes from 5-6 different competitors. That creates real pricing pressure. <span class=\"pause-indicator\"></span> You're making them compete.<br><br>So is that what you're doing, or do you think there's room to optimize that timing?",
                responses: [
                    { label: 'We shop 6+ months ahead', next: 'solution_variant_rates' },
                    { label: 'We shop 90 days out', next: 'solution_variant_rates' },
                    { label: 'Not sure when we shop', next: 'solution_variant_rates' }
                ]
            },
            schedule_future_planning: {
                stage: 'Discovery - Consequence',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> So we actually have TIME to do this right, you know? <span class=\"pause-indicator\"></span><br><br>Here's what I usually do with companies in your situation... <span class=\"pause-indicator\"></span> About 6 months before your contract expires, we start getting market quotes. That gives us real leverage, right? And we're not scrambling at the last minute.<br><br>Plus, we can check if your current supplier will give you early renewal incentives to lock you in now. <span class=\"pause-indicator\"></span> Sometimes that actually works out really well for you.<br><br>So when does your contract actually expire? <span class=\"pause-indicator\"></span> Let's get that date, and then mark 6 months before on the calendar. That's when we start this process.",
                responses: [
                    { label: 'I know the expiration date', next: 'followup_scheduled' },
                    { label: 'Not sure of exact date', next: 'solution_variant_lockedin' },
                    { label: 'Let me check and get back to you', next: 'email_first' }
                ]
            },
            value_justification: {
                stage: 'Discovery - Consequence',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> <span class=\"pause-indicator\"></span> I totally get that, you know? <span class=\"pause-indicator\"></span> And honestly, here's why I think this is worth looking at...<br><br>Most companies THINK they're handling this well because they renew on time. <span class=\"pause-indicator\"></span> Here's what I've found though - they're still overpaying because of the timing piece. <span class=\"pause-indicator\"></span> It adds up.<br><br>So it's not about what you're paying NOW, right? <span class=\"pause-indicator\"></span> It's about what you COULD be paying if we planned this out properly. <span class=\"pause-indicator\"></span><br><br>We're talking $30K-$50K over 3 years. <span class=\"pause-indicator\"></span> That's not an expense - that's money you could be keeping. That's savings.<br><br>Would it be worth 15 minutes to see what that gap actually looks like for {{account.name}}? <span class=\"pause-indicator\"></span> No pressure, just so you know what's possible. Make sense?",
                responses: [
                    { label: 'Yes, let\'s see the gap', next: 'close_meeting' },
                    { label: 'Send me something first', next: 'email_first' },
                    { label: 'Not interested', next: 'respect_decision' }
                ]
            },
            solution_variant_rates: {
                stage: 'Discovery - Solution (Rates)',
                text: "<span class=\"tone-marker confident\">direct, action-oriented tone</span> <span class=\"pause-indicator\"></span> Okay, so we've talked about the timing piece. <span class=\"pause-indicator\"></span> Here's what we do different. <span class=\"pause-indicator\"></span><br><br>We don't wait for your renewal deadline. <span class=\"pause-indicator\"></span> We actually START early - like 6 months before your contract ends. <span class=\"pause-indicator\"></span> Why? Suppliers give their BEST rates during off-peak seasons, not during crunch time when they're slammed. <span class=\"pause-indicator\"></span><br><br>We pull quotes from 100+ suppliers in that window when prices are actually competitive. <span class=\"pause-indicator\"></span> Then you lock in early before rates go higher. <span class=\"pause-indicator\"></span><br><br>That timing advantage alone is typically worth 15-25% savings compared to waiting till 90 days before. <span class=\"pause-indicator\"></span><br><br>Does getting ahead of rate increases matter to you?",
                responses: [
                    { label: "Yeah, that matters", next: 'close_variant_rates' },
                    { label: "How does your process actually work?", next: 'solution_faq_process' },
                    { label: "Need to think about it", next: 'email_first' },
                    { label: "Not interested right now", next: 'respect_decision' }
                ]
            },
            solution_variant_complicated: {
                stage: 'Discovery - Solution (Simplify)',
                text: "<span class=\"tone-marker confident\">confident, clarifying tone</span> <span class=\"pause-indicator\"></span> So we heard you on the confusion piece - that's actually why we do this. <span class=\"pause-indicator\"></span><br><br>What we do is pull quotes from multiple suppliers BUT we standardize them. <span class=\"pause-indicator\"></span> Same format, same terms, same fields. <span class=\"pause-indicator\"></span> So you're actually comparing apples to apples. <span class=\"pause-indicator\"></span><br><br>We send you like 3-5 options side by side where it's OBVIOUS which one's the best deal for what you need. <span class=\"pause-indicator\"></span> No decoding. No guessing. <span class=\"pause-indicator\"></span><br><br>You literally just look at three options and pick one. <span class=\"pause-indicator\"></span> That's your job. <span class=\"pause-indicator\"></span><br><br>Think that's easier than trying to figure it out yourself?",
                responses: [
                    { label: "Yeah, that's way easier", next: 'close_variant_complicated' },
                    { label: "How does your process actually work?", next: 'solution_faq_process' },
                    { label: "Seems too good to be true", next: 'value_justification' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            solution_variant_notime: {
                stage: 'Discovery - Solution (Done For You)',
                text: "<span class=\"tone-marker understanding\">understanding, solution-focused tone</span> <span class=\"pause-indicator\"></span> Here's the good news - you don't have to make this a priority. <span class=\"pause-indicator\"></span> We do. <span class=\"pause-indicator\"></span><br><br>We handle the whole shopping process. <span class=\"pause-indicator\"></span> We pull quotes, we compare, we negotiate with suppliers, we manage the paperwork. <span class=\"pause-indicator\"></span> Everything. <span class=\"pause-indicator\"></span><br><br>Your part? <span class=\"pause-indicator\"></span> Literally just review 3-5 options and say yes to one of them. <span class=\"pause-indicator\"></span> That's 15 minutes of your time, not months of back and forth. <span class=\"pause-indicator\"></span><br><br>And by doing it NOW instead of later, you actually avoid the crisis situation when your renewal's in 90 days and rates are already up again. <span class=\"pause-indicator\"></span><br><br>Worth 15 minutes to avoid that headache?",
                responses: [
                    { label: "Yeah, that's worth it", next: 'close_variant_notime' },
                    { label: "How much time are we talking?", next: 'solution_faq_timeline' },
                    { label: "Need to think about it", next: 'email_first' },
                    { label: "Still too busy right now", next: 'respect_decision' }
                ]
            },
            solution_variant_happy: {
                stage: 'Discovery - Solution (Reality Check)',
                text: "<span class=\"tone-marker curious\">respectful, curious tone</span> <span class=\"pause-indicator\"></span> Look, I'm not here to convince you there's a problem if there isn't one. <span class=\"pause-indicator\"></span><br><br>But here's what I'd suggest - let us do a quick rate analysis. <span class=\"pause-indicator\"></span> We pull what you're currently paying versus what the market's actually quoting right now. <span class=\"pause-indicator\"></span><br><br>If you're genuinely getting a good deal, you'll KNOW it because you've seen the alternatives. <span class=\"pause-indicator\"></span> If there IS a gap, now you can do something about it. <span class=\"pause-indicator\"></span><br><br>Either way, you're not guessing anymore. <span class=\"pause-indicator\"></span> You've got real data. <span class=\"pause-indicator\"></span><br><br>Worth 15 minutes to actually KNOW where you stand?",
                responses: [
                    { label: "Yeah, let's run the analysis", next: 'close_variant_happy' },
                    { label: "What would that analysis include?", next: 'solution_faq_process' },
                    { label: "I'm skeptical but curious", next: 'close_variant_happy' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            solution_variant_lockedin: {
                stage: 'Discovery - Solution (Future Proofing)',
                text: "<span class=\"tone-marker confident\">patient, strategic tone</span> <span class=\"pause-indicator\"></span> I hear you - you're locked in and that's fine. <span class=\"pause-indicator\"></span> This isn't about NOW. <span class=\"pause-indicator\"></span><br><br>But here's what smart companies do - mark your calendar for 6 months BEFORE your next renewal. <span class=\"pause-indicator\"></span> We start pulling quotes early when you actually have leverage. <span class=\"pause-indicator\"></span><br><br>That way you're not scrambling when renewal hits. <span class=\"pause-indicator\"></span> You already know what competitive rates look like. <span class=\"pause-indicator\"></span> You've got options queued up. <span class=\"pause-indicator\"></span><br><br>We literally just put it on the calendar now. <span class=\"pause-indicator\"></span> No urgency, no pressure. <span class=\"pause-indicator\"></span><br><br>So when does your contract actually expire?",
                responses: [
                    { label: "I know the date - [date]", next: 'close_variant_lockedin' },
                    { label: "Not sure, I'll check", next: 'email_first' },
                    { label: "Sounds good, reach out in 6 months", next: 'close_variant_lockedin' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            solution_variant_triedbefore: {
                stage: 'Discovery - Solution (Do It Right)',
                text: "<span class=\"tone-marker confident\">empowering, different tone</span> <span class=\"pause-indicator\"></span> Okay, so here's where it's different this time. <span class=\"pause-indicator\"></span><br><br>Last time you probably reached out to random suppliers who each quote differently. <span class=\"pause-indicator\"></span> That's where it falls apart. <span class=\"pause-indicator\"></span> We coordinate across 100+ suppliers SIMULTANEOUSLY and standardize the quotes. <span class=\"pause-indicator\"></span><br><br>That's not DIY shopping anymore. <span class=\"pause-indicator\"></span> That's structured, competitive event. <span class=\"pause-indicator\"></span> Suppliers know they're competing, so they actually quote you REAL rates, not inflated stuff. <span class=\"pause-indicator\"></span><br><br>It's not a nightmare because we've eliminated the chaos. <span class=\"pause-indicator\"></span><br><br>Would it be worth trying again if we took out all the nightmare parts?",
                responses: [
                    { label: "Yeah, let's try it right", next: 'close_variant_triedbefore' },
                    { label: "How is this different from last time?", next: 'solution_faq_process' },
                    { label: "Still skeptical", next: 'value_justification' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            solution_discovery: {
                stage: 'Discovery - Solution',
                text: "<span class=\"tone-marker hopeful\">hopeful tone</span> <span class=\"pause-indicator\"></span> Okay, that's significant. <span class=\"pause-indicator\"></span> So if we could solve this, what would matter most to you? <span class=\"pause-indicator\"></span><br><br>Like, is it competitive rates, budget certainty, or someone handling the complexity for you?",
                responses: [
                    { label: 'Access to competitive rates', next: 'trial_close_1' },
                    { label: 'Budget certainty', next: 'trial_close_1' },
                    { label: 'Handle the complexity', next: 'trial_close_1' },
                    { label: 'All of the above', next: 'trial_close_1' }
                ]
            },
            trial_close_1: {
                stage: 'Closing - Trial Close',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> So if I'm hearing you right, the real issue is [reference their specific pain - high costs / complexity / budget uncertainty]. <span class=\"pause-indicator\"></span> And if there was a way to solve that by locking in competitive rates BEFORE market prices go up <span class=\"pause-indicator\"></span> that would be worth exploring, right?",
                responses: [
                    { label: 'Yes, that would be worth exploring', next: 'trial_close_2' },
                    { label: 'Maybe / I need to think', next: 'trial_close_hesitation' },
                    { label: "Not really", next: 'objection_not_priority' }
                ]
            },
            trial_close_2: {
                stage: 'Closing - Confirm Value',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Great. <span class=\"pause-indicator\"></span> And the reason that matters is because if we don't act soon <span class=\"pause-indicator\"></span> [reference consequence they mentioned - rate increases / renewal risk / budget impact]. <span class=\"pause-indicator\"></span> That sound right?",
                responses: [
                    { label: 'Yes, that\'s correct', next: 'close_meeting' },
                    { label: 'Partially / Sort of', next: 'close_meeting' },
                    { label: "Not sure", next: 'close_meeting' }
                ]
            },
            trial_close_hesitation: {
                stage: 'Closing - Handle Hesitation',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> <span class=\"pause-indicator\"></span> Totally fair, you know? <span class=\"pause-indicator\"></span> So what would you want me to have prepared so you can make a good decision? <span class=\"pause-indicator\"></span> Is it market rate comparison? <span class=\"pause-indicator\"></span> How our process works? <span class=\"pause-indicator\"></span> Or is it more about understanding what rates are actually available right now before the market moves?",
                responses: [
                    { label: 'Market rate comparison', next: 'email_first' },
                    { label: 'How your process works', next: 'email_first' },
                    { label: 'See what rates are available now', next: 'close_meeting' }
                ]
            },
            close_variant_rates: {
                stage: 'Closing (Rates)',
                text: "<span class=\"tone-marker confident\">calm, peer-to-peer tone</span> <span class=\"pause-indicator\"></span> Okay, so here's what makes sense. <span class=\"pause-indicator\"></span> We've identified that timing is your leverage. <span class=\"pause-indicator\"></span> The earlier you lock something in, the better rates you get. <span class=\"pause-indicator\"></span><br><br>So here's what I'm thinking - we could do a quick 15-minute video walkthrough right now where I show you exactly how the process works. <span class=\"pause-indicator\"></span> Then you'll KNOW what you're getting into before we schedule the full analysis. <span class=\"pause-indicator\"></span> Or we can set up a quick 30-minute call where I walk you through exactly what we pulled from the market right now. <span class=\"pause-indicator\"></span><br><br>No pressure, no commitment - just data so you can make an informed decision. <span class=\"pause-indicator\"></span><br><br>What works better - video walkthrough now or scheduled call?",
                responses: [
                    { label: 'Video walkthrough now', next: 'video_walkthrough' },
                    { label: 'Friday works for call', next: 'close_meeting_scheduled' },
                    { label: 'Tomorrow works for call', next: 'close_meeting_scheduled' },
                    { label: 'I need to check with my team first', next: 'close_meeting_team_involved' },
                    { label: 'Let me think about it', next: 'close_meeting_think_about_it' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_variant_complicated: {
                stage: 'Closing (Simplify)',
                text: "<span class=\"tone-marker confident\">confident, demystifying tone</span> <span class=\"pause-indicator\"></span> So what I'm going to do is pull quotes from our network - and I mean I'll standardize them so you see them all in the same format. <span class=\"pause-indicator\"></span> Same columns, same terms, same everything. <span class=\"pause-indicator\"></span><br><br>Then I'll show you like 3-5 options side by side. <span class=\"pause-indicator\"></span> You just look at them and pick which one looks best for you. <span class=\"pause-indicator\"></span><br><br>That's literally it. <span class=\"pause-indicator\"></span> No confusion, no comparing apples to oranges. <span class=\"pause-indicator\"></span><br><br>We could do a quick 15-minute video walkthrough right now where I show you exactly what that looks like. <span class=\"pause-indicator\"></span> Then you'll KNOW what you're getting into. <span class=\"pause-indicator\"></span> Or we can set up a call Thursday. <span class=\"pause-indicator\"></span><br><br>What works better - video walkthrough now or Thursday afternoon call?",
                responses: [
                    { label: 'Video walkthrough now', next: 'video_walkthrough' },
                    { label: 'Thursday 2 PM works', next: 'close_meeting_scheduled' },
                    { label: 'Thursday afternoon works', next: 'close_meeting_scheduled' },
                    { label: 'What if I don\'t like any of them?', next: 'close_meeting_scheduled' },
                    { label: 'I don\'t want to waste your time', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_variant_notime: {
                stage: 'Closing (Done For You)',
                text: "<span class=\"tone-marker confident\">efficient, action-focused tone</span> <span class=\"pause-indicator\"></span> Here's what we do - we handle all of this. <span class=\"pause-indicator\"></span> You literally just review the options and pick one. <span class=\"pause-indicator\"></span><br><br>So here's the plan. <span class=\"pause-indicator\"></span> We could do a quick 15-minute video walkthrough right now where I show you exactly how the process works - then you'll KNOW what we're handling for you. <span class=\"pause-indicator\"></span> Or I'll pull quotes from our network - takes us 3-4 days. <span class=\"pause-indicator\"></span> Then I'll call you back with like 3 options I think are best for you. <span class=\"pause-indicator\"></span><br><br>That's your whole job. <span class=\"pause-indicator\"></span> 30 minutes, and you've got competitive quotes locked in while you focus on your actual business. <span class=\"pause-indicator\"></span><br><br>What works better - video walkthrough now or book Friday at 2 PM for me to show you those options?",
                responses: [
                    { label: 'Video walkthrough now', next: 'video_walkthrough' },
                    { label: 'Friday works', next: 'close_meeting_scheduled' },
                    { label: 'Thursday works', next: 'close_meeting_scheduled' },
                    { label: 'I need to talk to my finance team first', next: 'close_meeting_team_involved' },
                    { label: 'Can you just send me options?', next: 'close_meeting_send_options' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_variant_happy: {
                stage: 'Closing (Reality Check)',
                text: "<span class=\"tone-marker curious\">non-threatening, validation tone</span> <span class=\"pause-indicator\"></span> So here's what I propose - let me run a quick rate analysis. <span class=\"pause-indicator\"></span> I'll pull what the market's actually quoting right now, compare it to what you're paying, and show you if there's a gap. <span class=\"pause-indicator\"></span><br><br>No obligation, no strings. <span class=\"pause-indicator\"></span> Just data. <span class=\"pause-indicator\"></span> If you're actually getting a good deal, I'll tell you that too. <span class=\"pause-indicator\"></span><br><br>We could do a quick 15-minute video walkthrough right now where I show you exactly how the analysis works. <span class=\"pause-indicator\"></span> Then you'll KNOW what you're getting into. <span class=\"pause-indicator\"></span> Or takes me about 3 days to pull everything, then we hop on a quick call and I show you what I found. <span class=\"pause-indicator\"></span><br><br>What works better - video walkthrough now or Thursday afternoon call?",
                responses: [
                    { label: 'Video walkthrough now', next: 'video_walkthrough' },
                    { label: 'Thursday works', next: 'close_meeting_scheduled' },
                    { label: 'Thursday afternoon works', next: 'close_meeting_scheduled' },
                    { label: 'What\'s this going to cost me?', next: 'close_meeting_cost_question' },
                    { label: 'Seems like a lot of work', next: 'close_meeting_work_concern' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_variant_lockedin: {
                stage: 'Closing (Future Proofing)',
                text: "<span class=\"tone-marker confident\">patient, strategic tone</span> <span class=\"pause-indicator\"></span> I get it - you just renewed and you're not looking to do anything now. <span class=\"pause-indicator\"></span> That's fine. <span class=\"pause-indicator\"></span><br><br>But here's what I'm thinking. <span class=\"pause-indicator\"></span> Let's mark your calendar for 6 months BEFORE your next renewal. <span class=\"pause-indicator\"></span> That's when you actually have leverage with suppliers. <span class=\"pause-indicator\"></span><br><br>So what date is your contract up? <span class=\"pause-indicator\"></span> Let me just put a note on our side too so when that 6-month mark hits, I reach out and we start pulling quotes when you're in the best negotiating position. <span class=\"pause-indicator\"></span><br><br>When does your contract expire?",
                responses: [
                    { label: 'I know the date - [date]', next: 'future_opportunity_marked' },
                    { label: 'That seems far away', next: 'future_opportunity_marked' },
                    { label: 'Just call me when it gets closer', next: 'future_opportunity_marked' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_variant_triedbefore: {
                stage: 'Closing (Redemption)',
                text: "<span class=\"tone-marker confident\">empowering, redemption tone</span> <span class=\"pause-indicator\"></span> So here's the deal - last time you probably reached out to a bunch of suppliers individually and they all quoted different. <span class=\"pause-indicator\"></span> We're different. <span class=\"pause-indicator\"></span><br><br>We pull 100+ suppliers at ONCE. <span class=\"pause-indicator\"></span> They all know they're competing so they quote real rates. <span class=\"pause-indicator\"></span> We standardize everything so you can actually compare. <span class=\"pause-indicator\"></span><br><br>It's not a nightmare because we eliminate the chaos. <span class=\"pause-indicator\"></span><br><br>We could do a quick 15-minute video walkthrough right now where I show you exactly how the process works this time. <span class=\"pause-indicator\"></span> You'll see it's way different. <span class=\"pause-indicator\"></span> Or we can set up a call Thursday. <span class=\"pause-indicator\"></span><br><br>What works better - video walkthrough now or Thursday 2 PM call?",
                responses: [
                    { label: 'Video walkthrough now', next: 'video_walkthrough' },
                    { label: 'Thursday 2 PM works', next: 'close_meeting_scheduled' },
                    { label: 'Thursday works', next: 'close_meeting_scheduled' },
                    { label: 'But last time it still didn\'t work out', next: 'close_meeting_scheduled' },
                    { label: 'I\'m still skeptical', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_meeting_scheduled: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">Calendar Confirmation</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> I'm sending you the calendar invite right now... <span class=\"pause-indicator\"></span><br><br>\"Did you get it in your inbox?\"<br><br><em>⚠️ Stay on line until they confirm!</em>",
                responses: [
                    { label: 'They confirmed - ask for invoice', next: 'close_invoice_soft_ask' },
                    { label: 'They confirmed - wrap up', next: 'close_final_confirmation' }
                ]
            },
            video_walkthrough: {
                stage: 'Closing - Video Walkthrough',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> So I'm going to share my screen right now and walk you through exactly how this works. <span class=\"pause-indicator\"></span> It's a quick 15-minute overview - you'll see the process, see what we pull from the market, and then you'll KNOW exactly what you're getting into before we schedule the full analysis. <span class=\"pause-indicator\"></span><br><br>After this walkthrough, if it makes sense, we can book time to actually pull your quotes. <span class=\"pause-indicator\"></span> If not, no worries at all. <span class=\"pause-indicator\"></span><br><br>Ready when you are - I'm sharing my screen now.",
                responses: [
                    { label: 'Makes sense, let\'s pull quotes', next: 'close_meeting_scheduled' },
                    { label: 'I have questions first', next: 'solution_faq_hub' },
                    { label: 'Need to think about it', next: 'email_first' }
                ]
            },
            close_meeting_team_involved: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Totally fair. <span class=\"pause-indicator\"></span> This is actually a good conversation to include them in - we'll show both of you exactly what's available in the market. <span class=\"pause-indicator\"></span> Why don't we schedule for tomorrow afternoon and you loop them in? <span class=\"pause-indicator\"></span> That way everyone sees it together.",
                responses: [
                    { label: 'Tomorrow afternoon works', next: 'close_meeting_scheduled' },
                    { label: 'Friday works better', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_meeting_think_about_it: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> I get it. <span class=\"pause-indicator\"></span> But here's the thing - the earlier we pull those quotes, the better your position. <span class=\"pause-indicator\"></span> How about we lock in 30 minutes Friday and I just walk you through what's out there? <span class=\"pause-indicator\"></span> You might be surprised. <span class=\"pause-indicator\"></span> Then you have all the info to think about it.",
                responses: [
                    { label: 'Friday works', next: 'close_meeting_scheduled' },
                    { label: 'Thursday works', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_meeting_send_options: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> I could, but it's better if I walk you through them - I can explain the trade-offs. <span class=\"pause-indicator\"></span> Plus, if you have questions, I'm right there. <span class=\"pause-indicator\"></span> Trust me, 30 minutes on Friday is worth it. <span class=\"pause-indicator\"></span> 2 PM good?",
                responses: [
                    { label: 'Friday 2 PM works', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_meeting_cost_question: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> It's free - that's the point. <span class=\"pause-indicator\"></span> We get paid by suppliers, not by you. <span class=\"pause-indicator\"></span> You get the analysis for free, and if you decide to move forward with someone we bring you, then they pay us. <span class=\"pause-indicator\"></span> No cost to you either way.",
                responses: [
                    { label: 'Thursday works then', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            close_meeting_work_concern: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> It's not a lot of work for us - we literally do this 100+ times a month. <span class=\"pause-indicator\"></span> And for you it's just one 30-minute call. <span class=\"pause-indicator\"></span> Easiest way to actually know where you stand is to compare apples to apples. <span class=\"pause-indicator\"></span> Thursday 2 PM?",
                responses: [
                    { label: 'Thursday 2 PM works', next: 'close_meeting_scheduled' },
                    { label: 'Send me something first', next: 'email_first' }
                ]
            },
            future_opportunity_marked: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> So November 2025 is when we start pulling quotes. <span class=\"pause-indicator\"></span> I'm putting that on my calendar right now, and I'll reach out then. <span class=\"pause-indicator\"></span><br><br>What's the best email to send you a calendar reminder 60 days before? <span class=\"pause-indicator\"></span> That way you don't have to remember - I'll ping you.",
                responses: [
                    { label: '[Provides email]', next: 'email_captured' },
                    { label: 'Just call me when it\'s time', next: 'future_opportunity_email_sent' }
                ]
            },
            future_opportunity_email_sent: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Got it. <span class=\"pause-indicator\"></span> I'll reach out November 2025. <span class=\"pause-indicator\"></span> In the meantime, let me send you a quick breakdown of what market rates are doing - just so you've got context for when we reconnect.",
                responses: [
                    { label: 'Sounds good, thanks', next: 'email_captured' },
                    { label: 'Looking forward to it', next: 'email_captured' }
                ]
            },
            close_meeting: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">STEP 1: Recap (15 seconds)</span><br><br>\"Okay, so just to recap: <span class=\"pause-indicator\"></span> You're spending about {{monthly_spend}} monthly, <span class=\"pause-indicator\"></span> your contract expires {{contract_end}}, <span class=\"pause-indicator\"></span> and you're using {{account.supplier}} right now. <span class=\"pause-indicator\"></span> That about right?\"<br><br><em>(Wait for confirmation - builds \"yes momentum\")</em>",
                responses: [
                    { label: 'Yes, that\'s right', next: 'close_step2_value' },
                    { label: 'Let me correct something', next: 'close_step2_value' },
                    { label: 'Actually, I need to think about this', next: 'close_think_about_it' },
                    { label: 'I need to check with my team', next: 'objection_need_to_check' }
                ]
            },
            close_step2_value: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">STEP 2: Reaffirm Value (20 seconds)</span><br><br>\"The reason I'm calling is because most companies in your situation— <span class=\"pause-indicator\"></span> spending that amount with that contract timeline— <span class=\"pause-indicator\"></span> are leaving 15-20% on the table without realizing it. <span class=\"pause-indicator\"></span><br><br>That's roughly {{potential_savings}} annually you might be overpaying. <span class=\"pause-indicator\"></span><br><br>An audit is how we find out if you're one of them.\"",
                responses: [
                    { label: 'That would be significant', next: 'close_step3_assumptive' },
                    { label: 'Makes sense', next: 'close_step3_assumptive' },
                    { label: 'How do you know that?', next: 'close_step3_assumptive' },
                    { label: "What's your commission?", next: 'objection_commission' }
                ]
            },
            close_step3_assumptive: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">STEP 3: The Assumptive Move (10 seconds)</span><br><br>\"So here's what makes sense: <span class=\"pause-indicator\"></span> I run this audit over the next 2-3 days, <span class=\"pause-indicator\"></span> then we jump on a quick call and I walk you through what I found.\"<br><br><em>(You're not asking permission. You're laying out the plan.)</em>",
                responses: [
                    { label: 'Sounds good', next: 'close_step4_calendar' },
                    { label: 'How long will the call take?', next: 'close_step4_calendar' },
                    { label: 'What would you need from me?', next: 'close_invoice_soft_ask' },
                    { label: 'Let me think about it', next: 'close_think_about_it' }
                ]
            },
            close_step4_calendar: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">STEP 4: Lock In Commitment (Binary Choice)</span><br><br>\"Thursday afternoon at 2 PM or Friday morning at 10 AM— <span class=\"pause-indicator\"></span> what works better?\"<br><br><em>(They're not deciding WHETHER to meet, they're choosing WHEN.)</em>",
                responses: [
                    { label: 'Thursday at 2 PM', next: 'close_send_invite' },
                    { label: 'Friday at 10 AM', next: 'close_send_invite' },
                    { label: 'Another time works better', next: 'close_send_invite' }
                ]
            },
            close_send_invite: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">Send Calendar Invite NOW (Stay on Line!)</span><br><br>\"Perfect. <span class=\"pause-indicator\"></span> I'm sending you a calendar invite right now. <span class=\"pause-indicator\"></span><br><br>Did you get it in your inbox?\"<br><br><em>⚠️ CRITICAL: DO NOT hang up until they confirm receipt!</em><br><em>This alone = 87% show-up rate vs 40% if sent after call.</em>",
                responses: [
                    { label: 'They confirmed receipt', next: 'close_invoice_soft_ask' },
                    { label: "They didn't get it - resend", next: 'close_send_invite_retry' }
                ]
            },
            close_send_invite_retry: {
                stage: 'Closing',
                text: "<span class=\"tone-marker understanding\">Troubleshoot Calendar Invite</span><br><br>\"No worries, let me try again. <span class=\"pause-indicator\"></span> Can you spell your email for me? <span class=\"pause-indicator\"></span><br><br><em>(Confirm email, resend)</em><br><br>\"Sending again... <span class=\"pause-indicator\"></span> check your inbox now. <span class=\"pause-indicator\"></span> Also check spam or promotions folder.\"<br><br><em>Stay patient. This confirmation is worth the extra minute.</em>",
                responses: [
                    { label: 'They got it now', next: 'close_invoice_soft_ask' },
                    { label: 'Still not working - will call back', next: 'close_meeting_scheduled' }
                ]
            },
            close_invoice_soft_ask: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">Soft Invoice Ask (After Calendar Locked)</span><br><br>\"Perfect. <span class=\"pause-indicator\"></span> I can run the audit with just the info we've talked about.<br><br>But honestly? <span class=\"pause-indicator\"></span> Having your actual invoice makes it even more accurate. <span class=\"pause-indicator\"></span><br><br>Do you have your last bill handy, <span class=\"pause-indicator\"></span> or should I just work with what we discussed?\"",
                responses: [
                    { label: 'I can send it over', next: 'close_final_confirmation' },
                    { label: 'Just work with what we discussed', next: 'close_final_confirmation' }
                ]
            },
            close_final_confirmation: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">Final Wrap-Up</span><br><br>\"You're all set. <span class=\"pause-indicator\"></span> I'll have the audit done by Thursday morning. <span class=\"pause-indicator\"></span><br><br>I'll give you a quick call Wednesday afternoon just to confirm we're still good. <span class=\"pause-indicator\"></span><br><br>Looking forward to showing you what I find!\"",
                responses: [
                    { label: 'End call - SUCCESS!', next: 'meeting_scheduled' }
                ]
            },
            close_think_about_it: {
                stage: 'Closing',
                text: "<span class=\"tone-marker understanding\">Handle \"Let Me Think About It\"</span><br><br>\"I totally understand. <span class=\"pause-indicator\"></span> Here's what makes sense— <span class=\"pause-indicator\"></span> let me run the audit anyway. <span class=\"pause-indicator\"></span><br><br>Then you'll have the data to think about instead of guessing. <span class=\"pause-indicator\"></span><br><br>I'll have it ready by Friday. <span class=\"pause-indicator\"></span> How about I call you Friday afternoon to walk through what I found?\"",
                responses: [
                    { label: 'Friday works', next: 'close_send_invite' },
                    { label: 'That makes sense', next: 'close_send_invite' },
                    { label: 'Just send me information first', next: 'objection_send_something' },
                    { label: 'Not interested', next: 'respect_decision' }
                ]
            },
            close_prep_question: {
                stage: 'Closing',
                text: "<span class=\"tone-marker confident\">confident tone</span> Great question. <span class=\"pause-indicator\"></span> So what I'd do is pull competitive rates from 100+ suppliers in your market, compare them to what you're paying now, and show you exactly what you could save by locking those rates in before the market moves. <span class=\"pause-indicator\"></span><br><br>Plus I'd walk you through how our process works - basically, we handle everything, you just approve whichever option works best. <span class=\"pause-indicator\"></span> Make sense? <span class=\"pause-indicator\"></span> So Tuesday or Wednesday?",
                responses: [
                    { label: 'Tuesday works', next: 'meeting_scheduled' },
                    { label: 'Wednesday works', next: 'meeting_scheduled' },
                    { label: 'Send email first', next: 'email_first' }
                ]
            },
            meeting_scheduled: {
                stage: 'Success',
                text: '✅ <strong>AUDIT SCHEDULED - NEPQ SUCCESS!</strong><br><br><strong>🎯 NEPQ Framework Complete!</strong><br><br><strong>You successfully used:</strong><br>• 🎤 <strong>5 Tonalities</strong> (Curious, Confused, Concerned, Challenging, Playful)<br>• 🔍 <strong>5 Question Types</strong> (Situation → Problem → Solution → Consequence → Qualifying)<br>• 🔄 <strong>3-Step Objection Formula</strong> (Clarify → Discuss → Diffuse)<br>• ✅ <strong>4 Micro-Commitments</strong> (Audit → Why → Calendar → Confirmed)<br><br><strong>Key NEPQ Principle:</strong><br>\"The prospect persuaded THEMSELVES. You asked the right questions.\"<br><br><strong>No-Show Prevention:</strong><br>• 📅 Calendar invite while ON call (87% show-up)<br>• 📄 Invoice requested (soft ask)<br>• 📞 24-hour reminder call<br>• 📧 Morning-of confirmation email<br><br><strong>Target:</strong> 35-45% audit request rate with NEPQ!',
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            email_first: {
                stage: 'Solution - Email First',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> Totally get it - no pressure. <span class=\"pause-indicator\"></span><br><br>Let me do this... I'll shoot you an email with a quick summary of what we talked about and what the next step would look like. <span class=\"pause-indicator\"></span> That way you've got it in writing and you can think it over. <span class=\"pause-indicator\"></span><br><br>If it makes sense after you think about it, just reply to that email and we'll get the quotes pulled. <span class=\"pause-indicator\"></span> If not, no worries at all. <span class=\"pause-indicator\"></span><br><br>Fair? <span class=\"pause-indicator\"></span><br><br>What's the best email to send that to?",
                responses: [
                    { label: "Sure, it's [email]", next: 'email_captured' },
                    { label: "Just send it to my work email", next: 'email_captured' },
                    { label: "Actually, let's just do it now", next: 'close_meeting' },
                    { label: "I don't want to give my email", next: 'respect_decision' }
                ]
            },
            email_captured: {
                stage: 'Solution - Email Captured',
                text: "<span class=\"tone-marker confident\">professional, upbeat tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> I'll send that over in the next hour. <span class=\"pause-indicator\"></span><br><br>Just so you know what to expect - it'll have a quick recap of what we talked about, the potential savings we discussed, and the next step if you want to move forward. <span class=\"pause-indicator\"></span><br><br>No spam, no constant follow-ups - just that one email. <span class=\"pause-indicator\"></span> If you want to move forward, reply. <span class=\"pause-indicator\"></span> If not, no worries. <span class=\"pause-indicator\"></span><br><br>Appreciate your time today, {{contact.first_name}}. <span class=\"pause-indicator\"></span> Anything else you want to ask before I let you go?",
                responses: [
                    { label: "Nope, that's it", next: 'end_call_email_sent' },
                    { label: "Actually, one more question...", next: 'solution_faq_hub' },
                    { label: "Actually, let's just schedule it now", next: 'close_meeting' }
                ]
            },
            end_call_email_sent: {
                stage: 'End - Email Sent',
                text: "<span class=\"tone-marker friendly\">friendly tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> Email on the way. <span class=\"pause-indicator\"></span> Have a good one, {{contact.first_name}}!",
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            solution_faq_hub: {
                stage: 'Solution - FAQ Hub',
                text: "<span class=\"tone-marker confident\">confident tone</span> <span class=\"pause-indicator\"></span> Sure, what do you want to know? <span class=\"pause-indicator\"></span><br><br>Is it about how the process works, how long it takes, what it costs, or something else?",
                responses: [
                    { label: 'How does your process work?', next: 'solution_faq_process' },
                    { label: 'How long does this take?', next: 'solution_faq_timeline' },
                    { label: 'What does this cost?', next: 'solution_faq_cost' },
                    { label: 'What if I don\'t like the options?', next: 'solution_faq_no_obligation' },
                    { label: 'Something else', next: 'email_first' }
                ]
            },
            solution_faq_process: {
                stage: 'Solution - Process FAQ',
                text: "<span class=\"tone-marker confident\">confident, clear tone</span> <span class=\"pause-indicator\"></span> Yeah, it's pretty straightforward actually. <span class=\"pause-indicator\"></span><br><br>We pull quotes from 100+ suppliers across our network - all at once. <span class=\"pause-indicator\"></span> We tell them they're competing, so they give you actual competitive rates, not the jacked-up renewal quotes they usually send. <span class=\"pause-indicator\"></span><br><br>Then we standardize everything into the same format so you can actually compare apples to apples. <span class=\"pause-indicator\"></span> No confusing terms, no hidden fees. <span class=\"pause-indicator\"></span><br><br>We send you the top 3-5 options with our recommendation based on what you told us matters most - could be price, could be contract flexibility, whatever. <span class=\"pause-indicator\"></span><br><br>You pick which one you want, or you say no to all of them. <span class=\"pause-indicator\"></span> That's it. <span class=\"pause-indicator\"></span><br><br>We handle everything - the back and forth with suppliers, the paperwork, the onboarding. <span class=\"pause-indicator\"></span> Your job is literally just to say yes or no. <span class=\"pause-indicator\"></span><br><br>So it's not like you're doing the shopping yourself. <span class=\"pause-indicator\"></span> We're doing it FOR you. <span class=\"pause-indicator\"></span><br><br>Does that answer it, or you got other questions?",
                responses: [
                    { label: "That makes sense, let's do it", next: 'close_meeting' },
                    { label: "How long does this take?", next: 'solution_faq_timeline' },
                    { label: "What's the catch?", next: 'solution_faq_cost' },
                    { label: "Still need to think about it", next: 'email_first' }
                ]
            },
            solution_faq_timeline: {
                stage: 'Solution - Timeline FAQ',
                text: "<span class=\"tone-marker confident\">direct tone</span> <span class=\"pause-indicator\"></span> From start to finish? <span class=\"pause-indicator\"></span> About 2 weeks max. <span class=\"pause-indicator\"></span><br><br>Here's the breakdown - we pull quotes in 2-3 days. <span class=\"pause-indicator\"></span> You review them, pick one you like, takes you maybe 15 minutes. <span class=\"pause-indicator\"></span> Then we handle the onboarding and contract paperwork, which is another week or so. <span class=\"pause-indicator\"></span><br><br>But here's the thing - the actual TIME you spend on this is like 30 minutes total. <span class=\"pause-indicator\"></span> One call with me to go over options, you make a decision, done. <span class=\"pause-indicator\"></span><br><br>Everything else happens in the background while you're doing your actual job. <span class=\"pause-indicator\"></span><br><br>So yeah, 2 weeks calendar time, but 30 minutes of YOUR time. <span class=\"pause-indicator\"></span><br><br>That work for you?",
                responses: [
                    { label: "Yeah, that's not bad", next: 'close_meeting' },
                    { label: "What happens if I don't like any quotes?", next: 'solution_faq_no_obligation' },
                    { label: "Still thinking about it", next: 'email_first' }
                ]
            },
            solution_faq_cost: {
                stage: 'Solution - Cost FAQ',
                text: "<span class=\"tone-marker confident\">straightforward tone</span> <span class=\"pause-indicator\"></span> No catch. <span class=\"pause-indicator\"></span> We get paid by the suppliers, not you. <span class=\"pause-indicator\"></span><br><br>When you sign with one of the suppliers we bring you, they pay us a referral fee. <span class=\"pause-indicator\"></span> You pay the same rate whether you go direct or through us - we just handle all the legwork. <span class=\"pause-indicator\"></span><br><br>So there's no fee to you, no hidden costs, nothing like that. <span class=\"pause-indicator\"></span> You're just getting the quotes and the service for free. <span class=\"pause-indicator\"></span><br><br>The only way we make money is if you actually pick one of the options we bring you. <span class=\"pause-indicator\"></span> If you don't, we don't get paid. <span class=\"pause-indicator\"></span> So we're motivated to bring you good options. <span class=\"pause-indicator\"></span><br><br>That's the whole model. <span class=\"pause-indicator\"></span><br><br>Clear?",
                responses: [
                    { label: "Okay, that makes sense", next: 'close_meeting' },
                    { label: "Sounds good, let's do it", next: 'close_meeting' },
                    { label: "Still not sure", next: 'email_first' }
                ]
            },
            solution_faq_no_obligation: {
                stage: 'Solution - No Obligation FAQ',
                text: "<span class=\"tone-marker confident\">honest tone</span> <span class=\"pause-indicator\"></span> Then you say no. <span class=\"pause-indicator\"></span> That's it. <span class=\"pause-indicator\"></span><br><br>No obligation, no pressure, no long-term commitment. <span class=\"pause-indicator\"></span> We pull the quotes, you see what's out there, and if nothing makes sense, you stick with what you got. <span class=\"pause-indicator\"></span><br><br>The only thing that changes is now you KNOW what the market looks like. <span class=\"pause-indicator\"></span> So you're not flying blind anymore. <span class=\"pause-indicator\"></span><br><br>Most companies actually DO find something better because we're pulling from 100+ suppliers. <span class=\"pause-indicator\"></span> But if you're genuinely getting a good deal already, we'll tell you that too. <span class=\"pause-indicator\"></span><br><br>We're not here to force you into something worse just to make a sale. <span class=\"pause-indicator\"></span> That's not how this works. <span class=\"pause-indicator\"></span><br><br>Make sense?",
                responses: [
                    { label: "Okay, let's see what you can pull", next: 'close_meeting' },
                    { label: "What do you charge for this?", next: 'solution_faq_cost' },
                    { label: "I'll think about it", next: 'email_first' }
                ]
            },
            email_follow_up: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker confident\">confident tone</span> Perfect. <span class=\"pause-indicator\"></span> And when you get that... <span class=\"pause-indicator\"></span> when should I follow up with you? <span class=\"pause-indicator\"></span> End of this week? <span class=\"pause-indicator\"></span> Or next week?",
                responses: [
                    { label: 'End of this week', next: 'email_scheduled' },
                    { label: 'Next week', next: 'email_scheduled' },
                    { label: 'Don\'t follow up', next: 'respect_decision' }
                ]
            },
            email_scheduled: {
                stage: 'Follow-up Scheduled',
                text: '✅ <strong>Email Follow-up Scheduled!</strong><br><br>Excellent! You:<br>• Identified what they wanted to see<br>• Got commitment on follow-up timing<br>• Left door open for next conversation<br><br>This creates accountability and keeps the conversation moving forward.',
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            objection_not_interested: {
                stage: 'Objection - Not Interested',
                text: "Fair enough. Can I ask why? Is it because you're happy with what you're paying right now... or more just not a priority at the moment?<br><br><em>[PAUSE]</em>",
                responses: [
                    { label: 'Happy with rates', next: 'confidence_challenge' },
                    { label: 'Just not a priority', next: 'consequence_challenge' },
                    { label: 'Still not interested', next: 'close_respect_decision' }
                ]
            },
            close_respect_decision: {
                stage: 'Close - Respected',
                text: "Totally fair. No pressure at all.<br><br>But hey, if anything changes or you ever want to just see what the market's doing, feel free to reach out.<br><br>Take care.",
                responses: []
            },
            objection_not_interested_legacy: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">understanding tone</span> I totally understand. <span class=\"pause-indicator\"></span> Can I ask though <span class=\"pause-indicator\"></span> is it because you've already got a solution that's working great <span class=\"pause-indicator\"></span> or is it more that this just isn't a priority right now?",
                responses: [
                    { label: 'Already have solution', next: 'objection_happy_supplier' },
                    { label: 'Not a priority', next: 'objection_not_priority' },
                    { label: 'What\'s the market context?', next: 'market_context' },
                    { label: 'Just not interested', next: 'respect_decision' }
                ]
            },
            objection_happy_supplier: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker confident\">confident tone</span> That's fair. <span class=\"pause-indicator\"></span> And just so you know, we work with ALL suppliers - I'm not trying to switch you or anything like that. <span class=\"pause-indicator\"></span><br><br>What we do is run competitive events across 100+ suppliers so you can lock in the best rate available before the market moves. <span class=\"pause-indicator\"></span><br><br>So I gotta ask - have you shopped the market in the last 12 months to make sure you're getting the best rate available?",
                responses: [
                    { label: 'Yes, recently shopped', next: 'probe_deeper' },
                    { label: 'Not recently', next: 'consequence_variant_happy' },
                    { label: "No, we haven't", next: 'consequence_variant_happy' }
                ]
            },
            objection_market_moved: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker concerned\">concerned tone</span> So here's something important... <span class=\"pause-indicator\"></span> the market has moved A LOT in the last 12-24 months. <span class=\"pause-indicator\"></span><br><br>Between 2023-2024, electricity rates went up like 50% because data centers and AI are using crazy amounts of power. <span class=\"pause-indicator\"></span><br><br>So when your contract renews, that's the market you're shopping into, you know? <span class=\"pause-indicator\"></span> It's not really 'should we shop?' - it's more like 'when should we lock in competitive rates before prices go even higher?' <span class=\"pause-indicator\"></span><br><br>Does that make sense?",
                responses: [
                    { label: 'Yes, that makes sense', next: 'close_meeting' },
                    { label: 'We\'ll handle it ourselves', next: 'objection_not_priority' },
                    { label: "Still not interested", next: 'respect_decision' }
                ]
            },
            probe_deeper: {
                stage: 'Discovery',
                text: "<span class=\"tone-marker curious\">curious tone</span> <span class=\"pause-indicator\"></span> Interesting. <span class=\"pause-indicator\"></span> So you're happy with what you're paying— <span class=\"pause-indicator\"></span> let me ask though, have you actually compared your rates to what's available in the market RIGHT NOW?<br><br>Because here's what I see— <span class=\"pause-indicator\"></span> even companies that shopped 12 months ago are finding the market has shifted. <span class=\"pause-indicator\"></span> New suppliers have entered, rates have moved 15-20%.<br><br>The only way to KNOW if you're getting a good deal is to see what else is out there. <span class=\"pause-indicator\"></span> That's what the audit does— <span class=\"pause-indicator\"></span> takes 2-3 days, no obligation, and you'll KNOW where you stand.<br><br>Worth 15 minutes to confirm you're getting the best rate?",
                responses: [
                    { label: "Yeah, that makes sense", next: 'broker_audit_close' },
                    { label: "How does that work?", next: 'solution_faq_process' },
                    { label: "We just renewed", next: 'ack_just_renewed' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            objection_not_priority: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> Makes sense. <span class=\"pause-indicator\"></span> You've got a ton on your plate.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> Here's the thing though— <span class=\"pause-indicator\"></span> while it's not a priority, rates are actually going UP right now. <span class=\"pause-indicator\"></span> So the longer you wait, the worse the deal you'll get when you renew. <span class=\"pause-indicator\"></span> Shopping 6-12 months early is how you actually get leverage.<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> How long until your contract expires? <span class=\"pause-indicator\"></span> Let me just put a note on my side so I can reach out when the timing's right for you.",
                responses: [
                    { label: 'I know the date', next: 'schedule_followup' },
                    { label: 'What\'s the market context?', next: 'market_context' },
                    { label: 'Not sure', next: 'email_first' },
                    { label: 'Not interested', next: 'respect_decision' }
                ]
            },
            objection_need_to_check: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> Totally fair. <span class=\"pause-indicator\"></span> This needs buy-in from the team.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> Here's what I'd suggest— <span class=\"pause-indicator\"></span> why don't we loop them in on a quick call? <span class=\"pause-indicator\"></span> That way there's no game of telephone and everyone hears the audit results at the same time.<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> What works better for you guys— <span class=\"pause-indicator\"></span> Thursday at 2 PM or Friday afternoon?",
                responses: [
                    { label: "Thursday works", next: 'meeting_scheduled' },
                    { label: "Friday works better", next: 'meeting_scheduled' },
                    { label: "I'll talk to them first", next: 'email_first' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            objection_commission: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> Fair question. <span class=\"pause-indicator\"></span> I appreciate the directness.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> We make money from suppliers when you sign with them. <span class=\"pause-indicator\"></span> Just like your current broker does. <span class=\"pause-indicator\"></span><br><br>But here's the key— <span class=\"pause-indicator\"></span> you pay the same rate whether you go direct or through any broker. <span class=\"pause-indicator\"></span> The supplier already builds in broker commission. <span class=\"pause-indicator\"></span> So you're not paying extra. <span class=\"pause-indicator\"></span> We just handle the shopping so you don't have to.<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> And honestly, if we're pulling better rates from 100+ suppliers, <span class=\"pause-indicator\"></span> you might save more than our commission anyway.",
                responses: [
                    { label: "That makes sense", next: 'close_meeting' },
                    { label: "Let's see what you find", next: 'meeting_scheduled' },
                    { label: "I need to think about it", next: 'email_first' }
                ]
            },
            objection_send_something: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> I can definitely do that. <span class=\"pause-indicator\"></span> But honestly, most of the time these emails end up in the wrong folder and nothing happens.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> How about this— <span class=\"pause-indicator\"></span> let's skip the email for now. <span class=\"pause-indicator\"></span> I'll run a quick audit for you over the next 2-3 days. <span class=\"pause-indicator\"></span> Takes me like 30 minutes of work. <span class=\"pause-indicator\"></span> Then when I call you back, I'll actually have data to show you instead of a generic brochure.<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> That way you get something concrete to look at instead of just marketing material. <span class=\"pause-indicator\"></span> Fair?",
                responses: [
                    { label: "Friday works", next: 'meeting_scheduled' },
                    { label: "Just send the email first", next: 'email_first' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            objection_talk_to_broker: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> That makes sense. <span class=\"pause-indicator\"></span> They should know what's up.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> Actually, here's what I'd suggest— <span class=\"pause-indicator\"></span> let me run the audit first. <span class=\"pause-indicator\"></span> Then YOU have the data. <span class=\"pause-indicator\"></span> When you talk to your broker, you can show them what the actual market is quoting. <span class=\"pause-indicator\"></span> That way the conversation is way more productive.<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> I'll have the audit done by Thursday. <span class=\"pause-indicator\"></span> Then you can bring it to your broker conversation. <span class=\"pause-indicator\"></span> Sound fair?",
                responses: [
                    { label: "That makes sense", next: 'meeting_scheduled' },
                    { label: "I'll still talk to them first", next: 'email_first' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            objection_broker_friend: {
                stage: 'Objection Handling',
                text: "<span class=\"tone-marker understanding\">ARC: Acknowledge</span> <span class=\"pause-indicator\"></span> I totally get it. <span class=\"pause-indicator\"></span> Relationships matter, and they should.<br><br><span class=\"tone-marker confident\">Reframe</span> <span class=\"pause-indicator\"></span> I'm not asking you to leave them. <span class=\"pause-indicator\"></span> I'm asking you to know what the full market is quoting. <span class=\"pause-indicator\"></span> Your friend would want you to have the best rates, right?<br><br>Think of me as a second opinion so you can go to your broker and say, <span class=\"pause-indicator\"></span> 'Hey, I ran an audit. <span class=\"pause-indicator\"></span> Here's what competitive rates look like. <span class=\"pause-indicator\"></span> Can you match this or beat this?'<br><br><span class=\"tone-marker curious\">Close</span> <span class=\"pause-indicator\"></span> Let me run the audit. <span class=\"pause-indicator\"></span> You can use it however you want with your broker. <span class=\"pause-indicator\"></span> Fair?",
                responses: [
                    { label: "That makes sense", next: 'broker_audit_close' },
                    { label: "I don't want to upset them", next: 'broker_audit_no_switch' },
                    { label: "Not interested", next: 'respect_decision' }
                ]
            },
            schedule_followup: {
                stage: 'Follow-up',
                text: "Perfect. <span class=\"pause-indicator\"></span> Let me put that on my calendar and I'll reach out 60 days before, you know? <span class=\"pause-indicator\"></span> Sound good?",
                responses: [
                    { label: 'Yes, that works', next: 'followup_scheduled' },
                    { label: 'Just forget it', next: 'respect_decision' }
                ]
            },
            followup_scheduled: {
                stage: 'Success',
                text: '✅ <strong>Follow-up Scheduled!</strong><br><br>Excellent! You:<br>• Respected their timeline<br>• Got specific renewal date<br>• Positioned for future outreach<br>• Left door open (not pushy)<br><br>This is often how deals close!',
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            respect_decision: {
                stage: 'Closing',
                text: "<span class=\"tone-marker professional\">professional tone</span> Fair enough. <span class=\"pause-indicator\"></span> I appreciate the time. <span class=\"pause-indicator\"></span> If anything changes or you want to explore options <span class=\"pause-indicator\"></span> you know how to reach me. <span class=\"pause-indicator\"></span> Have a great day!",
                responses: [
                    { label: 'End Call', next: 'call_success' }
                ]
            },
            gatekeeper_intro: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker friendly\">friendly, confident tone</span> {{day.part}}, this is {{agent.first_name}}. <span class=\"pause-indicator\"></span> Just a quick question — how does your company typically handle energy contract renewals? <span class=\"pause-indicator\"></span> Is that something (CFO/Operations Manager/{{contact.first_name}}) handles?",
                responses: [
                    { label: "Who should I connect you with?", next: 'gatekeeper_connect_request' },
                    { label: "What is this about?", next: 'gatekeeper_what_about' },
                    { label: "They're busy / Can I take a message?", next: 'gatekeeper_busy' },
                    { label: "They transferred me", next: 'gatekeeper_transferred' },
                    { label: "They decline / block", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_connect_request: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker friendly\">appreciative tone</span> Great, I appreciate that. <span class=\"pause-indicator\"></span> Could you please connect me with the person responsible for utilities or energy contracts?",
                responses: [
                    { label: "They transferred me", next: 'gatekeeper_transferred' },
                    { label: "They need more info", next: 'gatekeeper_what_about' },
                    { label: "They said they're busy", next: 'gatekeeper_busy' },
                    { label: "They declined", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_what_about: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker confident\">confident, value-focused tone</span> I'm reaching out about timing for electricity contract renewals — a critical window right now where locking in early often saves companies 15-20% on their energy costs. <span class=\"pause-indicator\"></span> Would it be best to speak with the person managing those contracts?",
                responses: [
                    { label: "They'll connect me", next: 'gatekeeper_transferred' },
                    { label: "They need the person's name", next: 'gatekeeper_connect_request' },
                    { label: "They're still busy", next: 'gatekeeper_busy' },
                    { label: "They decline", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_busy: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker understanding\">understanding, respectful tone</span> I understand. <span class=\"pause-indicator\"></span> When's usually a good time to reach them to discuss this time-sensitive window?",
                responses: [
                    { label: "They give a time", next: 'gatekeeper_followup_time' },
                    { label: "They prefer voicemail", next: 'gatekeeper_voicemail_offer' },
                    { label: "They want to respect their time", next: 'gatekeeper_respect_time' },
                    { label: "They decline", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_voicemail_offer: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker helpful\">helpful tone</span> I can leave a quick voicemail if you'd like; that way they have the details and can call me back if it's relevant.",
                responses: [
                    { label: "Yes, leave voicemail", next: 'voicemail' },
                    { label: "They give a time instead", next: 'gatekeeper_followup_time' },
                    { label: "They decline", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_respect_time: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker understanding\">respectful tone</span> Thanks for letting me know. <span class=\"pause-indicator\"></span> I want to respect their time but also make sure they don't miss this. <span class=\"pause-indicator\"></span> When works best?",
                responses: [
                    { label: "They give a time", next: 'gatekeeper_followup_time' },
                    { label: "They prefer voicemail", next: 'gatekeeper_voicemail_offer' },
                    { label: "They decline", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_followup_time: {
                stage: 'Gatekeeper',
                text: "<span class=\"tone-marker professional\">professional tone</span> Perfect. <span class=\"pause-indicator\"></span> I'll reach out at that time. <span class=\"pause-indicator\"></span> Should I also leave a brief voicemail now so they have context, or just wait until the time you mentioned?",
                responses: [
                    { label: "Leave voicemail now", next: 'voicemail' },
                    { label: "Just wait until that time", next: 'gatekeeper_scheduled' },
                    { label: "They decline", next: 'gatekeeper_decline' }
                ]
            },
            gatekeeper_scheduled: {
                stage: 'Gatekeeper - Scheduled',
                text: "✅ <strong>Follow-up scheduled!</strong><br><br>You've successfully scheduled a call back time. <span class=\"pause-indicator\"></span> Make sure to follow up when you said you would.",
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            gatekeeper_transferred: {
                stage: 'Gatekeeper - Transfer',
                text: "<span class=\"tone-marker professional\">professional tone</span> <strong>HOLD FOR TRANSFER...</strong><br><br><em>Once connected, immediately transition to your decision maker script.</em>",
                responses: [
                    { label: 'Connected to decision maker', next: null }, // Will be set dynamically to currentOpener
                    { label: 'Still gatekeeper / wrong person', next: 'gatekeeper_intro' },
                    { label: 'Transfer failed / hung up', next: 'no_answer' }
                ]
            },
            gatekeeper_decline: {
                stage: 'Gatekeeper - Decline',
                text: "<span class=\"tone-marker professional\">professional, respectful tone</span> Thanks for your time. <span class=\"pause-indicator\"></span> I'll try again later. <span class=\"pause-indicator\"></span><br><br><em>Note: Consider noting the best time to call back or any alternative contacts if possible.</em>",
                responses: [
                    { label: 'Try again later', next: 'start' },
                    { label: 'Leave voicemail instead', next: 'voicemail' },
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            asked_to_speak: {
                stage: 'Transfer',
                text: "Great! Can I tell them who's calling and what it's about?<br><br><em>HOLD FOR TRANSFER...</em>",
                responses: [
                    { label: 'They transferred me', next: 'hook' },
                    { label: "They said no thanks", next: 'respect_decision' }
                ]
            },
            voicemail: {
                stage: 'Voicemail',
                text: "<span class=\"tone-marker professional\">Voicemail Script (30 seconds - Keep It Short)</span><br><br>\"Hi {{contact.first_name}}, this is (your name) from Power Choosers.<br><br><span class=\"pause-indicator\"></span> I'm calling because we ran analysis on companies in your industry, and most are paying 15-20% more on electricity than they should be.<br><br><span class=\"pause-indicator\"></span> I wanted to see if {{account.name}} might be experiencing the same thing. <span class=\"pause-indicator\"></span> It's literally just a 15-minute conversation.<br><br><span class=\"pause-indicator\"></span> You can reach me at (your number) or find me on LinkedIn.<br><br><span class=\"pause-indicator\"></span> Again, (your name). Thanks.\"<br><br><em>✅ Name stated twice (they might only catch end)<br>✅ Specific problem (overpaying 15-20%)<br>✅ Time commitment clear (15 minutes)<br>✅ Two ways to reach you (phone + LinkedIn)<br>✅ Under 30 seconds</em>",
                responses: [
                    { label: 'Left voicemail - move on', next: 'voicemail_left' },
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            voicemail_left: {
                stage: 'Voicemail',
                text: "✅ <strong>Voicemail Left!</strong><br><br><strong>Next Steps:</strong><br>• Wait 3-5 days before second callback (not same day)<br>• Send LinkedIn connection request<br>• Move to next prospect<br><br><strong>Remember:</strong> Leave this voicemail ONCE. Don't sound needy on follow-ups.",
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            second_callback: {
                stage: 'Second Callback',
                text: "<span class=\"tone-marker confident\">Second Callback Script (More Direct)</span><br><br>\"Hey {{contact.first_name}}, (your name), Power Choosers— <span class=\"pause-indicator\"></span> calling back real quick.<br><br><span class=\"pause-indicator\"></span> Last time I tried to reach you, I mentioned we audit electricity costs. <span class=\"pause-indicator\"></span> Honestly, the reason I'm persistent is because we typically find that 60-70% of companies are overpaying just because they haven't had a second opinion in a while.<br><br><span class=\"pause-indicator\"></span> You might not be one of them— <span class=\"pause-indicator\"></span> your broker might have you dialed in perfectly. <span class=\"pause-indicator\"></span> But wouldn't it be worth 15 minutes to know for sure?<br><br><span class=\"pause-indicator\"></span> I'm going to stop by your LinkedIn, but reach out if you want to chat.\"",
                responses: [
                    { label: 'They answered - proceed', next: 'hook' },
                    { label: 'Left second voicemail', next: 'second_callback_sent' },
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            second_callback_sent: {
                stage: 'Second Callback',
                text: "✅ <strong>Second Callback Complete!</strong><br><br><strong>Next Steps:</strong><br>• Move to email outreach (Day 5)<br>• Send LinkedIn message (Day 10)<br>• One more call attempt (Day 15)<br>• Then respect the no<br><br><strong>Remember:</strong> 5+ follow-ups close 80% of deals!",
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            vm_feedback2: {
                stage: 'Feedback',
                text: "✅ <strong>Good voicemail!</strong><br><br>You mentioned:<br>• Specific reason for call<br>• Relevant market context<br>• Permission for them to not call back<br><br>That increases callback rate by 30%+",
                responses: [
                    { label: 'Next scenario', next: 'start' },
                    { label: 'Review call flow', next: 'start' }
                ]
            },
            no_answer: {
                stage: 'No Answer',
                text: "<span class=\"tone-marker professional\">No one answered. What's your next move?</span><br><br><em>Tip: If this is a first attempt, leave a voicemail. If you've called before, consider the second callback approach.</em>",
                responses: [
                    { label: 'Leave voicemail (first attempt)', next: 'voicemail' },
                    { label: 'Second callback (called before)', next: 'second_callback' },
                    { label: 'Hang up & try later', next: 'start' },
                    { label: 'Try different number', next: 'dialing' }
                ]
            },
            call_success: {
                stage: 'Complete',
                text: '📞 <strong>Call Ended</strong><br><br>Call Summary:<br>• Duration: ~4-6 minutes<br>• Outcome: Professional close<br>• Key Learning: Not every call closes, but professional respect opens doors for future opportunities.<br><br>Ready for the next prospect?',
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            },
            email_captured: {
                stage: 'Solution - Email Captured',
                text: "<span class=\"tone-marker confident\">professional, upbeat tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> I'll send that over in the next hour. <span class=\"pause-indicator\"></span><br><br>Just so you know what to expect - it'll have a quick recap of what we talked about, the potential savings we discussed, and the next step if you want to move forward. <span class=\"pause-indicator\"></span><br><br>No spam, no constant follow-ups - just that one email. <span class=\"pause-indicator\"></span> If you want to move forward, reply. If not, no worries. <span class=\"pause-indicator\"></span><br><br>Appreciate your time today, {{contact.first_name}}. <span class=\"pause-indicator\"></span> Anything else you want to ask before I let you go?",
                responses: [
                    { label: "Nope, that's it", next: 'end_call_email_sent' },
                    { label: "Actually, one more question...", next: 'solution_faq_process' },
                    { label: "Actually, let's just schedule it now", next: 'close_meeting' }
                ]
            },
            end_call_email_sent: {
                stage: 'End - Email Sent',
                text: "<span class=\"tone-marker friendly\">friendly tone</span> <span class=\"pause-indicator\"></span> Perfect. <span class=\"pause-indicator\"></span> Email on the way. <span class=\"pause-indicator\"></span> Have a good one, {{contact.first_name}}!",
                responses: [
                    { label: 'Start New Call', next: 'start' }
                ]
            }
        };

        // State management
        let state = {
            current: 'start',
            history: [],
            monthlySpend: null  // Store entered monthly spend value
        };

        // DOM elements
        const display = document.getElementById('script-display');
        const responses = document.getElementById('response-buttons');
        const backBtn = document.getElementById('back-btn');
        const restartBtn = document.getElementById('restart-btn');

        // Phase definitions with entry points
        const PHASES = [
            { name: 'Pre-Call', stagePattern: 'Pre-Call Prep', entryPoint: 'pre_call_qualification' },
            { name: 'Opening', stagePattern: 'Opening', entryPoint: 'hook' },
            { name: 'Situation', stagePattern: 'Discovery - Situation', entryPoint: 'situation_discovery' },
            { name: 'Problem', stagePattern: 'Discovery - Problem', entryPoint: 'problem_discovery' },
            { name: 'Consequence', stagePattern: 'Discovery - Consequence', entryPoint: 'consequence_discovery' },
            { name: 'Solution', stagePattern: 'Discovery - Solution', entryPoint: 'solution_discovery' },
            { name: 'Closing', stagePattern: 'Closing', entryPoint: 'trial_close_1' },
            { name: 'Objections', stagePattern: 'Objection Handling', entryPoint: 'objection_not_interested' },
            { name: 'Success', stagePattern: 'Success', entryPoint: 'meeting_scheduled' }
        ];

        // Track completed phases
        let completedPhases = new Set();

        // Opener management
        // Opener management (PEACE Framework - 5 Tested Openers)
        const OPENER_CONFIGS = {
            default: {
                key: 'pattern_interrupt_opening',
                label: 'Permission + Empathy (Primary)',
                state: 'pattern_interrupt_opening',
                description: 'PEACE-aligned. Best for: Decision-makers who value respect for their time. Highest conversion.'
            },
            direct_question: {
                key: 'opener_direct_question',
                label: 'Second Opinion',
                state: 'opener_direct_question',
                description: 'Best for: Prospects skeptical of their current broker.'
            },
            social_proof: {
                key: 'opener_social_proof',
                label: 'Market Data',
                state: 'opener_social_proof',
                description: 'Best for: Building credibility with market intelligence.'
            },
            quick_check: {
                key: 'opener_quick_check',
                label: 'Audit Positioning',
                state: 'opener_quick_check',
                description: 'Best for: Explaining your unique value upfront.'
            },
            transparent: {
                key: 'opener_transparent',
                label: 'Transparent',
                state: 'opener_transparent',
                description: 'Best for: Disarming skeptical prospects.'
            }
        };

        let currentOpener = OPENER_CONFIGS.default;
        let availableOpeners = [
            OPENER_CONFIGS.direct_question,
            OPENER_CONFIGS.transparent,
            OPENER_CONFIGS.social_proof,
            OPENER_CONFIGS.quick_check
        ];

        // Build opener selector buttons
        function buildOpenerSelector() {
            const container = document.querySelector('.opener-buttons-container');
            if (!container) return;

            // Check if buttons already exist to prevent re-animation
            const existingButtons = container.querySelectorAll('.opener-btn');
            const hadButtons = existingButtons.length > 0;

            // Clear existing buttons
            container.innerHTML = '';

            // Create array with all openers (current + available)
            const allOpeners = [currentOpener, ...availableOpeners];

            // Create buttons for all openers
            allOpeners.forEach(opener => {
                const btn = document.createElement('button');
                btn.className = hadButtons ? 'opener-btn animated' : 'opener-btn';
                btn.textContent = opener.label;
                btn.dataset.openerKey = opener.key;
                btn.dataset.openerState = opener.state;
                
                // Highlight if this is the current active opener
                if (currentOpener.key === opener.key) {
                    btn.classList.add('active');
                }

                btn.addEventListener('click', () => {
                    // Only swap if clicking a different opener
                    if (currentOpener.key !== opener.key) {
                        // Swap: move current opener to available list, make selected the default
                        const oldDefault = currentOpener;
                        currentOpener = opener;
                        availableOpeners = availableOpeners.filter(o => o.key !== opener.key);
                        availableOpeners.push(oldDefault);

                        // Hook will be updated automatically via updateHookOpener()

                        // Rebuild buttons
                        buildOpenerSelector();

                        // If we're at the opening phase, jump to the new opener
                        if (state.current === 'hook' || state.current === 'pattern_interrupt_opening' || 
                            state.current.startsWith('opener_')) {
                            state.history.push(state.current);
                            state.current = opener.state;
                            render();
                        }
                    }
                });

                container.appendChild(btn);
            });
        }

        // Determine which phase a stage belongs to
        function getCurrentPhase() {
            const currentStage = FLOW[state.current]?.stage || 'Ready';
            const currentStateKey = state.current;

            // Direct state matches
            if (currentStateKey === 'start') return null;
            if (currentStateKey === 'pre_call_qualification') return 'Pre-Call';
            if (currentStateKey === 'dialing' || currentStateKey === 'hook' || currentStateKey === 'pattern_interrupt_opening') return 'Opening';
            // Gatekeeper states are part of Opening phase
            if (currentStateKey.startsWith('gatekeeper_')) return 'Opening';

            // Stage pattern matching
            for (const phase of PHASES) {
                if (currentStage === phase.stagePattern || 
                    (phase.stagePattern === 'Closing' && currentStage.includes('Closing')) ||
                    (phase.stagePattern === 'Opening' && (currentStage === 'Opening' || currentStage === 'Connecting' || currentStage.includes('Gatekeeper')))) {
                    return phase.name;
                }
            }

            // Fallback: check stage patterns more flexibly
            if (currentStage.includes('Situation')) return 'Situation';
            if (currentStage.includes('Problem')) return 'Problem';
            if (currentStage.includes('Consequence')) return 'Consequence';
            if (currentStage.includes('Solution')) return 'Solution';
            if (currentStage.includes('Closing')) return 'Closing';
            if (currentStage.includes('Objection')) return 'Objections';
            if (currentStage === 'Success' || currentStage === 'Complete') return 'Success';

            return null;
        }

        // Track phase progression
        let lastPhase = null;

        // Build phase navigation
        function buildPhaseNavigation() {
            const navEl = document.getElementById('phase-navigation');
            if (!navEl) return;

            // PRESERVE SCROLL POSITION before clearing (prevents jump to beginning)
            const currentScroll = navEl.scrollLeft;
            const isMobile = window.innerWidth <= 767;
            
            // Mark that we're rebuilding to prevent MutationObserver from interfering
            navEl.dataset.isRebuilding = 'true';

            navEl.innerHTML = '';
            const currentPhase = getCurrentPhase();
            
            // If we've moved to a new phase, mark previous as completed
            if (lastPhase && currentPhase && lastPhase !== currentPhase) {
                const lastIndex = PHASES.findIndex(p => p.name === lastPhase);
                const currentIndex = PHASES.findIndex(p => p.name === currentPhase);
                
                // Mark all phases before current as completed
                if (currentIndex > lastIndex) {
                    for (let i = 0; i < currentIndex; i++) {
                        completedPhases.add(PHASES[i].name);
                    }
                }
            }
            
            if (currentPhase) {
                lastPhase = currentPhase;
            }
            
            // Find current phase index for mobile carousel
            const currentIndex = currentPhase ? PHASES.findIndex(p => p.name === currentPhase) : -1;
            
            PHASES.forEach((phase, index) => {
                const btn = document.createElement('button');
                btn.className = 'phase-btn';
                btn.textContent = phase.name;
                btn.dataset.phase = phase.name;
                btn.dataset.entryPoint = phase.entryPoint;

                // Check if this phase is active
                if (currentPhase === phase.name) {
                    btn.classList.add('active');
                }
                
                // For mobile carousel: mark previous and next phases
                if (isMobile && currentIndex >= 0) {
                    if (index === currentIndex - 1) {
                        btn.classList.add('prev-phase');
                    } else if (index === currentIndex + 1) {
                        btn.classList.add('next-phase');
                    }
                }

                // Check if this phase is completed
                if (completedPhases.has(phase.name) && currentPhase !== phase.name) {
                    btn.classList.add('completed');
                }

                // Check if entry point exists in FLOW
                if (!FLOW[phase.entryPoint]) {
                    btn.disabled = true;
                }

                // Add click handler - allow clicking on any available phase (including future phases)
                btn.addEventListener('click', () => {
                    if (FLOW[phase.entryPoint] && !btn.disabled) {
                        // If jumping to a future phase, clear completed phases after it
                        const clickedIndex = PHASES.findIndex(p => p.name === phase.name);
                        const currentIndex = PHASES.findIndex(p => p.name === currentPhase);
                        
                        if (clickedIndex > currentIndex || currentPhase === null) {
                            // Jumping ahead - clear completion status for phases after
                            for (let i = clickedIndex; i < PHASES.length; i++) {
                                completedPhases.delete(PHASES[i].name);
                            }
                        }
                        
                        state.history.push(state.current);
                        state.current = phase.entryPoint;
                        render();
                    }
                });

                navEl.appendChild(btn);
            });
            
            // RESTORE SCROLL POSITION immediately after rebuilding (prevents jump to beginning)
            if (isMobile && currentScroll > 0) {
                // Restore scroll position synchronously to prevent visible jump
                navEl.scrollLeft = currentScroll;
            }
            
            // Clear the rebuilding flag after layout completes to allow MutationObserver to work
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    navEl.dataset.isRebuilding = 'false';
                    // Center active phase after rebuild completes
                    if (isMobile) {
                        setTimeout(() => {
                            centerActivePhase();
                        }, 50);
                    }
                });
            });
        }
        
        // Function to center active phase in mobile carousel
        function centerActivePhase() {
            const phaseNav = document.getElementById('phase-navigation');
            if (!phaseNav || window.innerWidth > 767) return;
            
            // Wait for layout to complete
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    const activeBtn = phaseNav.querySelector('.phase-btn.active');
                    if (!activeBtn) return;
                    
                    const containerWidth = phaseNav.offsetWidth;
                    const buttonWidth = activeBtn.offsetWidth;
                    const buttonLeft = activeBtn.offsetLeft;
                    const targetScroll = buttonLeft - (containerWidth / 2) + (buttonWidth / 2);
                    
                    // Check if already close to target
                    const currentScroll = phaseNav.scrollLeft;
                    const scrollDiff = Math.abs(targetScroll - currentScroll);
                    
                    // Only scroll if we're not already close (within 5px for more precision)
                    if (scrollDiff > 5) {
                        phaseNav.scrollTo({
                            left: targetScroll,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Mobile phase carousel swipe support
        function initPhaseCarousel() {
            const phaseNav = document.getElementById('phase-navigation');
            if (!phaseNav) return;
            
            // Only enable on mobile
            if (window.innerWidth > 767) return;
            
            let startX = 0;
            let scrollLeft = 0;
            let isDown = false;
            
            phaseNav.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - phaseNav.offsetLeft;
                scrollLeft = phaseNav.scrollLeft;
                phaseNav.style.cursor = 'grabbing';
            });
            
            phaseNav.addEventListener('mouseleave', () => {
                isDown = false;
                phaseNav.style.cursor = 'grab';
            });
            
            phaseNav.addEventListener('mouseup', () => {
                isDown = false;
                phaseNav.style.cursor = 'grab';
            });
            
            phaseNav.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - phaseNav.offsetLeft;
                const walk = (x - startX) * 2;
                phaseNav.scrollLeft = scrollLeft - walk;
            });
            
            // Touch events for mobile swipe
            let touchStartX = 0;
            let touchScrollLeft = 0;
            
            phaseNav.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].pageX - phaseNav.offsetLeft;
                touchScrollLeft = phaseNav.scrollLeft;
            }, { passive: true });
            
            phaseNav.addEventListener('touchmove', (e) => {
                if (!touchStartX) return;
                const x = e.touches[0].pageX - phaseNav.offsetLeft;
                const walk = (x - touchStartX) * 1.5;
                phaseNav.scrollLeft = touchScrollLeft - walk;
            }, { passive: true });
            
            // Track previous active phase to avoid unnecessary scrolling
            let previousActivePhase = null;
            let isScrolling = false;
            
            // Auto-scroll to active phase when it changes - robust approach (backup to direct call)
            const observer = new MutationObserver(() => {
                // Don't scroll if we're currently rebuilding (prevents duplicate scroll handlers)
                if (phaseNav.dataset.isRebuilding === 'true') {
                    return;
                }
                
                // Use the centralized centering function
                if (window.innerWidth <= 767) {
                    // Small delay to ensure layout is complete
                    setTimeout(() => {
                        centerActivePhase();
                    }, 100);
                }
            });
            
            observer.observe(phaseNav, { 
                childList: true, 
                subtree: true, 
                attributes: true, 
                attributeFilter: ['class'] 
            });
        }

        // Update hook to point to current opener
        function updateHookOpener() {
            if (FLOW.hook && FLOW.hook.responses) {
                FLOW.hook.responses.forEach(response => {
                    if (response.label === 'Yes, speaking' || response.label === "Who's calling?") {
                        response.next = currentOpener.state;
                    }
                });
            }
            // Also update gatekeeper transfer to point to current opener
            if (FLOW.gatekeeper_transferred && FLOW.gatekeeper_transferred.responses) {
                FLOW.gatekeeper_transferred.responses.forEach(response => {
                    if (response.label === 'Connected to decision maker') {
                        response.next = currentOpener.state;
                    }
                });
            }
        }

        // Render function
        function render() {
            const node = FLOW[state.current] || FLOW.start;
            
            // Track previous stage to prevent re-animation on same stage
            const previousStage = display && display.dataset.currentStage ? display.dataset.currentStage : null;
            const currentStage = node.stage || state.current;
            const isSameStage = previousStage === currentStage;

            // Update hook to use current opener
            updateHookOpener();

            // Update phase navigation
            buildPhaseNavigation();
            
            // Center active phase on mobile after navigation is built
            if (window.innerWidth <= 767) {
                centerActivePhase();
            }

            // Update opener selector (only show when in opening phase or about to be)
            updateOpenerSelectorVisibility();

            // Build opener buttons
            buildOpenerSelector();

            if (display) {
                // Check if this is initial load or update
                const isInitialLoad = !display.classList.contains('has-content');
                display.classList.add('has-content');
                
                // Store current stage for next comparison
                display.dataset.currentStage = currentStage;
                
                // Only animate on content updates if stage actually changed
                if (!isInitialLoad && !isSameStage) {
                    display.classList.add('updating');
                    
                    // Remove update animation class after it completes
                    setTimeout(() => {
                        display.classList.remove('updating');
                    }, 300);
                }
                
                // Render content
                const html = renderTemplate(node.text || '', 'text');
                display.innerHTML = html;
                
                // Smooth scroll to top of script display (only if stage changed)
                if (!isSameStage) {
                    requestAnimationFrame(() => {
                        display.scrollTop = 0;
                    });
                }
            }

            if (responses) {
                // Track if buttons already exist and if we're on the same stage
                const existingButtons = responses.querySelectorAll('.response-btn, .dial-btn');
                const hadButtons = existingButtons.length > 0;
                const previousResponses = responses.dataset.responseLabels || '';
                const currentResponseLabels = (node.responses || []).map(r => r.label).join(',');
                const sameResponses = previousResponses === currentResponseLabels && hadButtons;
                
                // Store current response labels for next comparison
                responses.dataset.responseLabels = currentResponseLabels;
                
                responses.innerHTML = '';
                responses.classList.remove('full-width');

                if (state.current === 'start') {
                    const btn = document.createElement('button');
                    btn.className = (hadButtons || sameResponses) ? 'dial-btn animated' : 'dial-btn';
                    btn.type = 'button';
                    btn.textContent = 'Dial';
                    btn.addEventListener('click', () => go('pre_call_qualification'));
                    responses.appendChild(btn);
                    responses.classList.add('full-width');
                } else if (state.current === 'situation_discovery' || 
                           state.current === 'ack_confident_handle' || 
                           state.current === 'ack_struggling' || 
                           state.current === 'ack_no_idea' ||
                           state.current === 'ack_dq_confident' ||
                           state.current === 'ack_dq_struggling' ||
                           state.current === 'ack_vendor_handling') {
                    // Special handling for monthly spend input
                    const inputWrap = document.createElement('div');
                    inputWrap.className = 'monthly-spend-input-wrap';
                    inputWrap.style.cssText = 'width: 100%; margin-bottom: 12px;';
                    
                    const label = document.createElement('label');
                    label.textContent = 'Monthly Spend:';
                    label.style.cssText = 'display: block; margin-bottom: 6px; color: var(--text-primary); font-size: 14px;';
                    inputWrap.appendChild(label);
                    
                    const inputContainer = document.createElement('div');
                    inputContainer.style.cssText = 'display: flex; gap: 8px; align-items: center;';
                    
                    const dollarSign = document.createElement('span');
                    dollarSign.textContent = '$';
                    dollarSign.style.cssText = 'color: var(--text-primary); font-size: 16px; font-weight: 500;';
                    inputContainer.appendChild(dollarSign);
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.placeholder = 'Enter amount (e.g., 5000)';
                    input.min = '0';
                    input.step = '100';
                    input.className = 'monthly-spend-input';
                    input.style.cssText = 'flex: 1; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: 6px; background: var(--bg-main); color: var(--text-primary); font-size: 16px;';
                    if (state.monthlySpend) {
                        input.value = state.monthlySpend;
                    }
                    inputContainer.appendChild(input);
                    inputWrap.appendChild(inputContainer);
                    responses.appendChild(inputWrap);
                    
                    const nextBtn = document.createElement('button');
                    nextBtn.className = (hadButtons || sameResponses) ? 'response-btn animated' : 'response-btn';
                    nextBtn.type = 'button';
                    nextBtn.textContent = 'Continue';
                    nextBtn.style.cssText = 'width: 100%; margin-bottom: 8px;';
                    const handleContinue = () => {
                        const value = parseFloat(input.value);
                        if (value && value > 0) {
                            state.monthlySpend = value;
                            go('situation_monthly_spend');
                        } else {
                            alert('Please enter a valid monthly spend amount.');
                        }
                    };
                    nextBtn.addEventListener('click', handleContinue);
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            handleContinue();
                        }
                    });
                    responses.appendChild(nextBtn);
                    
                    // Add "Don't know offhand" button (different labels based on state)
                    const dontKnowLabel = state.current === 'ack_no_idea' ? "Honestly don't have a guess" : 
                                        state.current === 'ack_confident_handle' || state.current === 'ack_dq_confident' || state.current === 'ack_dq_struggling' ? "Don't know exact amount" :
                                        "Don't know offhand";
                    const dontKnowBtn = document.createElement('button');
                    dontKnowBtn.className = (hadButtons || sameResponses) ? 'response-btn animated' : 'response-btn';
                    dontKnowBtn.type = 'button';
                    dontKnowBtn.textContent = dontKnowLabel;
                    dontKnowBtn.style.cssText = 'width: 100%;';
                    dontKnowBtn.addEventListener('click', () => {
                        state.monthlySpend = null;
                        go('situation_monthly_spend');
                    });
                    responses.appendChild(dontKnowBtn);
                    responses.classList.add('full-width');
                } else {
                    (node.responses || []).forEach(r => {
                        const b = document.createElement('button');
                        b.className = (hadButtons || sameResponses) ? 'response-btn animated' : 'response-btn';
                        b.type = 'button';
                        b.textContent = r.label;
                        b.addEventListener('click', () => go(r.next));
                        responses.appendChild(b);
                    });
                    if ((node.responses || []).length === 1) responses.classList.add('full-width');
                }
            }

            if (backBtn) {
                backBtn.disabled = state.history.length === 0;
            }
        }

        // Navigation functions
        function go(next) {
            if (!next || !FLOW[next]) return;
            state.history.push(state.current);
            state.current = next;
            render();
        }

        function back() {
            if (state.history.length === 0) return;
            state.current = state.history.pop();
            render();
        }

        function restart() {
            state.current = 'start';
            state.history = [];
            state.monthlySpend = null;
            completedPhases.clear();
            lastPhase = null;
            // Reset opener to default
            currentOpener = OPENER_CONFIGS.default;
            availableOpeners = [
                OPENER_CONFIGS.direct_question,
                OPENER_CONFIGS.transparent,
                OPENER_CONFIGS.social_proof,
                OPENER_CONFIGS.quick_check
            ];
            
            // Reset phase navigation scroll tracking for mobile
            const phaseNav = document.getElementById('phase-navigation');
            if (phaseNav) {
                phaseNav.dataset.hasScrolled = '';
            }
            
            // Hook will be updated automatically via updateHookOpener() in render()
            render();
        }

        // Show/hide opener selector based on current state
        function updateOpenerSelectorVisibility() {
            const selector = document.getElementById('opener-selector');
            const toolbarContainer = selector?.closest('.toolbar-with-openers');
            const mainContent = selector?.closest('.main-content');
            if (!selector) return;

            const isMobile = window.innerWidth <= 767;
            const currentPhase = getCurrentPhase();
            
            // On mobile: hide if we're past the Opening stage with animation
            if (isMobile) {
                // Show if we're at start, Pre-Call, or Opening stage
                // Hide if we're past Opening (Situation, Problem, etc.)
                const shouldShow = currentPhase === null || 
                    currentPhase === 'Pre-Call' || 
                    currentPhase === 'Opening' ||
                    state.current === 'start' ||
                    state.current === 'pre_call_qualification' ||
                    state.current === 'dialing' ||
                    state.current === 'hook' ||
                    state.current === 'pattern_interrupt_opening' ||
                    state.current.startsWith('opener_');
                
                if (shouldShow) {
                    // Show opener selector - remove exit classes and reset display
                    selector.classList.remove('exiting', 'exited');
                    selector.style.display = 'flex';
                    if (toolbarContainer) toolbarContainer.classList.remove('has-exiting-opener');
                    if (mainContent) {
                        mainContent.classList.remove('has-exiting-opener');
                    }
                } else {
                    // Check if already hidden/exiting to avoid re-triggering animation
                    if (!selector.classList.contains('exiting') && !selector.classList.contains('exited')) {
                        // Start exit animation - let natural layout flow handle content movement
                        selector.classList.add('exiting');
                        if (toolbarContainer) toolbarContainer.classList.add('has-exiting-opener');
                        
                        // After animation completes, hide it completely
                        setTimeout(() => {
                            selector.classList.remove('exiting');
                            selector.classList.add('exited');
                        }, 400); // Match animation duration
                    }
                }
            } else {
                // Desktop: always show
                selector.classList.remove('exiting', 'exited');
                selector.style.display = 'flex';
                if (toolbarContainer) toolbarContainer.classList.remove('has-exiting-opener');
                if (mainContent) mainContent.classList.remove('has-exiting-opener');
            }
        }

        // Event listeners
        backBtn.addEventListener('click', back);
        restartBtn.addEventListener('click', restart);

        // ============================================
        // MOBILE DEVICE DETECTION & DRAWER TOGGLE
        // ============================================
        
        // Detect device type
        function detectDevice() {
            const isMobile = window.matchMedia("(max-width: 767px)").matches;
            const isSmallMobile = window.matchMedia("(max-width: 479px)").matches;
            const isTablet = window.matchMedia("(min-width: 768px) and (max-width: 1023px)").matches;
            
            // Store for later use
            window.deviceConfig = {
                isMobile,
                isSmallMobile,
                isTablet,
                width: window.innerWidth,
                height: window.innerHeight
            };
            
            // Apply mobile class to body
            if (isMobile) {
                document.body.classList.add('mobile-mode');
            } else {
                document.body.classList.remove('mobile-mode');
            }
            
            if (isSmallMobile) {
                document.body.classList.add('small-mobile');
            } else {
                document.body.classList.remove('small-mobile');
            }
            
            return { isMobile, isSmallMobile, isTablet };
        }
        
        // Initialize device detection
        detectDevice();
        
        // Re-detect on window resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                detectDevice();
            }, 250);
        });
        
        // Mobile drawer toggle functionality
        const tipsToggle = document.getElementById('tipsToggle');
        const tipsPanel = document.getElementById('tipsPanel');
        
        if (tipsToggle && tipsPanel) {
            tipsToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                const isExpanded = tipsPanel.classList.contains('expanded');
                
                if (isExpanded) {
                    tipsPanel.classList.remove('expanded');
                    tipsToggle.textContent = 'Tips & Resources ▼';
                    document.body.classList.remove('drawer-open');
                } else {
                    tipsPanel.classList.add('expanded');
                    tipsToggle.textContent = 'Hide Tips ▲';
                    document.body.classList.add('drawer-open');
                }
            });
            
            // Close drawer when clicking outside (on mobile only)
            document.addEventListener('click', function(event) {
                if (window.deviceConfig && window.deviceConfig.isMobile) {
                    if (!tipsPanel.contains(event.target) && !tipsToggle.contains(event.target)) {
                        if (tipsPanel.classList.contains('expanded')) {
                            tipsPanel.classList.remove('expanded');
                            tipsToggle.textContent = 'Tips & Resources ▼';
                            document.body.classList.remove('drawer-open');
                        }
                    }
                }
            });
            
            // Prevent drawer from closing when clicking inside it
            tipsPanel.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }
        
        // Update toggle button visibility on resize
        function updateMobileUI() {
            if (tipsToggle) {
                const isMobile = window.matchMedia("(max-width: 767px)").matches;
                if (!isMobile && tipsPanel) {
                    // Ensure drawer is closed on desktop
                    tipsPanel.classList.remove('expanded');
                    document.body.classList.remove('drawer-open');
                }
            }
        }
        
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                updateMobileUI();
            }, 250);
        });

        // Initial render
        render();
        
        // Build opener selector on load
        buildOpenerSelector();
        
        // Initialize mobile phase carousel
        initPhaseCarousel();
        
        // Re-initialize carousel on resize
        let carouselResizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(carouselResizeTimeout);
            carouselResizeTimeout = setTimeout(function() {
                initPhaseCarousel();
                // Rebuild navigation if switching between mobile/desktop
                buildPhaseNavigation();
            }, 250);
        });
    </script>
</body>
</html>
