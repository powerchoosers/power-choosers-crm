<!DOCTYPE html>
<html>
<head>
    <title>Test Incoming Call</title>
    <script src="https://sdk.twilio.com/js/client/releases/1.13.1/twilio.min.js"></script>
    <script src="scripts/widgets/phone.js"></script>
    <script src="scripts/notifications.js"></script>
</head>
<body>
    <h1>Test Incoming Call Parameters</h1>
    <button id="simulateCall">Simulate Incoming Call</button>
    
    <script>
        document.getElementById('simulateCall').addEventListener('click', function() {
            // Initialize the phone widget system
            if (window.initPhoneWidget) {
                window.initPhoneWidget();
            }
            
            // Simulate an incoming call with custom parameters
            const fakeConnection = {
                customParameters: {
                    originalCaller: '+19876543210'
                },
                parameters: {
                    From: '+18176630380', // This would be the Twilio number
                    To: '+18176630380'
                },
                on: function(event, callback) {
                    if (event === 'incoming') {
                        // Simulate immediate incoming call
                        setTimeout(callback, 100, this);
                    }
                }
            };
            
            // Trigger the incoming call handler manually
            if (window.TwilioRTC && window.TwilioRTC.state && window.TwilioRTC.state.device) {
                window.TwilioRTC.state.device.emit('incoming', fakeConnection);
            }
        });
    </script>
</body>
</html>
