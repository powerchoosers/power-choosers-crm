/* Power Choosers CRM - Strategic CSS Foundation */
/* Apollo-inspired layout with consistent 25px spacing and grey theme */

/* === CSS VARIABLES === */
:root {
    /* Grey Color Scheme - Primary Theme */
    --grey-50: #f8f9fa;
    --grey-100: #f1f3f4;
    --grey-200: #e9ecef;
    --grey-300: #dee2e6;
    --grey-400: #ced4da;
    --grey-500: #adb5bd;
    --grey-600: #6c757d;
    --grey-700: #495057;
    --grey-750: #3e454d; /* between 700 and 800 for subtle darkening */
    --grey-775: #383f46; /* closer to 800 for near-match */
    --grey-780: #373d44; /* very close to 800 */
    --grey-790: #353b41; /* extremely close to 800 */
    --grey-800: #343a40;
    --grey-820: #2f353b; /* slightly darker than 800 for inner items */
    --grey-900: #212529;
    
    /* Subtle Company Colors */
    --orange-subtle: #ff6b35;
    --blue-subtle: #1e3a8a;
    --orange-muted: rgba(255, 107, 53, 0.1);
    --blue-muted: rgba(30, 58, 138, 0.1);
    /* Call outcome badges */
    --green-subtle: #28a745;
    --green-muted: rgba(40, 167, 69, 0.15);
    --red-subtle: #dc3545;
    --red-muted: rgba(220, 53, 69, 0.15);
    --yellow-subtle: #ffc107;
    --yellow-muted: rgba(255, 193, 7, 0.15);
    
    /* Background Colors - Two-tone system */
    --bg-main: var(--grey-780);   /* Main content slightly lighter than before */
    --bg-widget: var(--grey-800); /* Widget panel background (slightly darker) */
    --bg-container: var(--grey-775); /* Containers align with card tone for consistent system theme */
    --bg-card: var(--grey-775);   /* Section/card backgrounds slightly lighter */
    --bg-item: var(--grey-700);   /* Inner tiles (list items, action buttons) lighter than card */
    --bg-hover: var(--grey-700);  /* Hover states on dark */
    
    /* Text Colors */
    --text-primary: var(--grey-100);
    --text-secondary: var(--grey-300);
    --text-muted: var(--grey-400);
    --text-inverse: #ffffff;      /* For dark containers */
    
    /* Border Colors - subtle, consistent 1px (darker so less distracting) */
    --border-light: var(--grey-700);
    --border-medium: var(--grey-700);
    --border-dark: var(--grey-750);
    
    /* Spacing System - Critical 25px base */
    --spacing-base: 25px;         /* Primary spacing unit */
    --spacing-sm: 12px;           /* Small spacing */
    --spacing-md: 16px;           /* Medium spacing */
    --spacing-lg: 32px;           /* Large spacing */
    
    /* Layout Dimensions */
    --topbar-height: 70px;
    --sidebar-width: 60px;        /* Collapsed width */
    --sidebar-expanded: 240px;    /* Expanded width */
    --widget-panel-width: 320px;  /* Widget panel width for 3:1 ratio */
    
    /* Consistent Border Radius */
    --border-radius: 8px;         /* Consistent rounded corners */
    --border-radius-sm: 4px;      /* Small radius */
    --border-radius-lg: 12px;     /* Large radius */
    
    /* Shadows - slightly stronger for depth on dark UI */
    --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.18);
    --shadow-md: 0 6px 12px rgba(0, 0, 0, 0.22);
    --shadow-lg: 0 12px 24px rgba(0, 0, 0, 0.28);
    
    /* Elevation System - use these everywhere */
    --elevation-topbar: var(--shadow-md);
    --elevation-page: var(--shadow-md);
    --elevation-card: var(--shadow-md);
    --elevation-card-hover: var(--shadow-lg);
    
    /* Transitions */
    --transition-fast: 0.15s ease;
    --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* === VARIABLES POPOVER (anchored dropdown) === */
.vars-popover {
    position: fixed; /* positioned via JS near the toolbar button */
    background: var(--grey-800);
    color: var(--text-inverse);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    width: min(680px, calc(100vw - 16px));
    z-index: 120; /* above editors and dropdowns */
}
.vars-popover-inner {
    padding: var(--spacing-base);
    max-height: min(60vh, 520px);
    overflow: auto;
}
.vars-popover .vars-tabs { margin-bottom: var(--spacing-sm); }

/* === DELAY EDIT POPOVER === */
.delay-popover {
    position: fixed; /* positioned via JS under the Edit delay button */
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    min-width: 300px;
    max-width: min(420px, calc(100vw - 16px));
    z-index: 120; /* above editors and dropdowns */
    --arrow-size: 10px; /* square size before rotation */
}
.delay-popover::before,
.delay-popover::after {
    content: "";
    position: absolute;
    width: var(--arrow-size);
    height: var(--arrow-size);
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    transform: rotate(45deg);
    pointer-events: none;
}
/* Border layer */
.delay-popover[data-placement="bottom"]::before {
    top: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
/* Fill layer */
.delay-popover[data-placement="bottom"]::after {
    top: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}
/* When placed above anchor */
.delay-popover[data-placement="top"]::before {
    bottom: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
.delay-popover[data-placement="top"]::after {
    bottom: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}
.delay-popover-inner {
    padding: var(--spacing-base);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}
.delay-header { font-weight: 600; color: var(--text-primary); }
.delay-options { display: flex; flex-direction: column; gap: 8px; }
.delay-options .radio-row { display: flex; align-items: center; gap: 8px; }
.delay-options .number-unit { display: flex; align-items: center; gap: 8px; }
.delay-popover input[type="radio"] { accent-color: var(--orange-subtle); }
.delay-popover input[type="number"] { width: 110px; }
.delay-popover input[disabled],
.delay-popover select[disabled] { opacity: 0.65; cursor: not-allowed; }
.delay-popover select {
    height: 34px;
    background: var(--bg-item);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: 0 8px;
    transition: var(--transition-fast);
}
.delay-popover select:focus {
    outline: none;
    border-color: var(--orange-subtle);
    background: var(--grey-600);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
}
.delay-popover .input-dark {
    height: 34px;
    background: var(--bg-item);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
}
.delay-popover .input-dark::placeholder { color: var(--text-muted); }
.delay-popover .input-dark:hover { background: var(--grey-680, #545b62); }
.delay-popover .input-dark:focus {
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
    background: var(--grey-650, #5a6168);
}
.delay-popover .btn-row {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}
.delay-popover .btn-apply,
.delay-popover .btn-cancel {
    height: 32px;
    padding: 0 10px;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-light);
    background: var(--bg-item);
    color: var(--text-primary);
    cursor: pointer;
    transition: background var(--transition-fast), border-color var(--transition-fast), filter var(--transition-fast);
}
.delay-popover .btn-apply:hover,
.delay-popover .btn-cancel:hover { background: var(--grey-600); border-color: var(--grey-500); }
.delay-popover .btn-apply:focus-visible,
.delay-popover .btn-cancel:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }
.delay-popover .btn-apply {
    background: var(--orange-subtle);
    border-color: var(--orange-subtle);
    color: var(--text-inverse);
}
.delay-popover .btn-apply:hover { filter: brightness(0.95); }
.delay-popover .btn-apply:focus-visible { outline-color: var(--orange-muted); }

/* === DELETE CONFIRM POPOVER === */
.delete-popover {
    position: fixed; /* positioned via JS under the trash icon */
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    min-width: 220px;
    max-width: 280px;
    z-index: 960; /* above bulk bar (850) and dropdowns, below modal overlay (1100) */
    --arrow-size: 10px; /* square size before rotation */
    animation: popIn 130ms ease-out;
}
.delete-popover::before,
.delete-popover::after {
    content: "";
    position: absolute;
    width: var(--arrow-size);
    height: var(--arrow-size);
    transform: rotate(45deg);
    pointer-events: none;
}
/* Border layer */
.delete-popover[data-placement="bottom"]::before {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    top: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
/* Fill layer */
.delete-popover[data-placement="bottom"]::after {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    top: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}
/* When placed above anchor */
.delete-popover[data-placement="top"]::before {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    bottom: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
.delete-popover[data-placement="top"]::after {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    bottom: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}

/* When placed to the left of anchor (arrow on right edge of popover) */
.delete-popover[data-placement="left"]::before {
    right: calc(-1 * var(--arrow-size) / 2 + 1px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--border-light);
}
.delete-popover[data-placement="left"]::after {
    right: calc(-1 * var(--arrow-size) / 2 + 2px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--bg-card);
}

/* When placed to the right of anchor (arrow on left edge of popover) */
.delete-popover[data-placement="right"]::before {
    left: calc(-1 * var(--arrow-size) / 2 + 1px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--border-light);
}
.delete-popover[data-placement="right"]::after {
    left: calc(-1 * var(--arrow-size) / 2 + 2px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--bg-card);
}
.delete-popover-inner {
    padding: var(--spacing-sm);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}
.delete-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95rem;
}
.delete-popover .btn-row {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}
.delete-popover .btn-cancel {
    height: 30px;
    padding: 0 10px;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-light);
    background: var(--bg-item);
    color: var(--text-primary);
    cursor: pointer;
    transition: background var(--transition-fast), border-color var(--transition-fast), filter var(--transition-fast);
}
.delete-popover .btn-cancel:hover { background: var(--grey-600); border-color: var(--grey-500); }
.delete-popover .btn-cancel:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }
.delete-popover .btn-danger {
    height: 30px;
    padding: 0 12px;
    border-radius: var(--border-radius);
    background: var(--red-subtle);
    color: var(--text-inverse);
    border: 1px solid var(--red-subtle);
    cursor: pointer;
    transition: filter var(--transition-fast), background var(--transition-fast), border-color var(--transition-fast);
}
.delete-popover .btn-danger:hover { filter: brightness(0.95); }
.delete-popover .btn-danger:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

/* Keyboard focus: confirm button in Add Contact popover */
.add-contact-popover .btn-confirm:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

/* === STEP TYPE SELECTION MODAL === */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-base);
    z-index: 1100;
}

.step-type-modal {
    width: 860px;
    max-width: calc(100% - 48px);
    background: var(--grey-800);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    color: var(--text-inverse);
}
.step-type-modal .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-md) var(--spacing-base);
    border-bottom: 1px solid var(--border-light);
}
.step-type-modal .title-wrap {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.step-type-modal .title {
    font-size: 1.1rem;
    font-weight: 600;
}
.step-type-modal .subtitle {
    color: var(--text-secondary);
    font-size: 0.9rem;
}
.step-type-modal .close-btn {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    width: 32px;
    height: 32px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
}
.step-type-modal .close-btn:hover { background: var(--grey-700); }
.step-type-modal .close-btn:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
.step-type-modal .body {
    padding: var(--spacing-base);
    max-height: min(70vh, 720px);
    overflow: auto;
}

.step-type-category {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-base);
    margin-bottom: var(--spacing-base);
}
.step-type-category .cat-title {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--text-primary);
}
.step-type-category .cat-desc {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: -8px;
    margin-bottom: var(--spacing-md);
}
.step-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-sm);
}
/* Keep one-column layout for clarity */

.step-option {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: 12px var(--spacing-md);
    cursor: pointer;
    transition: var(--transition-fast);
}
.step-option:hover { background: var(--grey-700); }
.step-option:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
.step-option .icon { width: 22px; height: 22px; color: var(--grey-300); }
.step-option .label { font-weight: 500; color: var(--text-inverse); }

/* === CONTACTS MODAL (Sequence contacts list) === */
.contacts-modal .empty-text { color: var(--text-secondary); padding: var(--spacing-md) 0; }
.contacts-modal .contact-list { display: flex; flex-direction: column; gap: 6px; }
.contacts-modal .contact-row {
    display: flex;
    align-items: center;
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: 10px 12px;
}
.contacts-modal .contact-row .left { display: flex; align-items: center; gap: var(--spacing-md); }
.contacts-modal .contact-row .avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--grey-700);
    color: var(--text-inverse);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.85rem;
    letter-spacing: 0.3px;
}
.contacts-modal .contact-row .meta { display: flex; flex-direction: column; }
.contacts-modal .contact-row .name { font-weight: 600; color: var(--text-inverse); background: none; border: 0; padding: 0; cursor: pointer; text-align: left; }
.contacts-modal .contact-row .subtitle { color: var(--text-secondary); font-size: 0.9rem; margin-top: 1px; }

/* Contacts modal: selection + actions layout */
.contacts-modal .contact-row { gap: var(--spacing-md); justify-content: space-between; }
.contacts-modal .contact-row .row-select { margin-right: 6px; }
.contacts-modal .contact-row .actions { display: flex; align-items: center; gap: 10px; margin-left: auto; }
.contacts-modal .contact-row .action-link { background: none; border: 0; color: var(--text-secondary); cursor: pointer; padding: 4px 6px; border-radius: var(--border-radius-sm); }
.contacts-modal .contact-row .action-link:hover { background: var(--grey-700); color: var(--text-inverse); }
.contacts-modal .contact-row .action-link.danger { color: var(--red-300); }
.contacts-modal .contact-row .action-link.danger:hover { background: var(--red-muted); color: var(--text-inverse); }

/* Add Contact Modal: orange focus ring and layout */
.add-contact-modal input:focus,
.add-contact-modal .focus-orange {
  outline: none !important;
  border-color: var(--orange-subtle) !important;
  box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25) !important;
}
.add-contact-modal .form-row {
  display: flex;
  gap: 24px;
  margin-bottom: 18px;
}
.add-contact-modal label {
  flex: 1 1 0;
  display: flex;
  flex-direction: column;
  font-size: 0.98em;
  color: var(--text-primary);
}
.add-contact-modal input {
  margin-top: 6px;
  height: 34px;
  padding: 6px 10px;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-light);
  background: var(--bg-item);
  color: var(--text-primary);
  font-size: 0.98rem;
  transition: box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast);
}
.add-contact-modal input::placeholder { color: var(--text-muted); }
.add-contact-modal .form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 12px;
}
.add-contact-modal .btn-primary,
.add-contact-modal .btn-secondary {
  min-width: 90px;
}
.add-contact-modal .header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 18px;
}
.add-contact-modal .close-btn {
  background: none;
  border: 1px solid var(--border-light);
  color: var(--grey-300);
  width: 32px;
  height: 32px;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
}
.add-contact-modal .title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-inverse);
}
.add-contact-modal.step-type-modal {
  width: min(520px, calc(100% - 48px));
}

/* Toolbar: select all */
.contacts-modal .contacts-toolbar { display: flex; align-items: center; justify-content: flex-start; margin-bottom: var(--spacing-sm); }
.contacts-modal .contacts-toolbar .sel-all { display: inline-flex; align-items: center; gap: 8px; color: var(--text-secondary); }

/* Bulk actions bar inside contacts modal */
.contacts-modal .bulk-actions-modal { position: sticky; top: 0; left: auto; transform: none; width: 100%; max-width: none; z-index: 5; margin-bottom: var(--spacing-sm); }

/* === SEQUENCE BUILDER === */
/* Contact Search Styles */
.contact-search-container {
    position: relative;
    width: 300px;
}


#contact-search-results,
.contact-search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    z-index: 900; /* below modal overlay (1100) */
    max-height: 300px;
    overflow-y: auto;
    margin-top: 6px;
    animation: popIn 130ms ease-out;
}

.contact-results-list {
    padding: var(--spacing-sm);
}

.contact-result {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.contact-result:hover:not(.already-added) {
    background: var(--bg-hover);
}

.contact-result.already-added {
    opacity: 0.6;
    cursor: default;
}

/* subtle separators inside dropdown */
.contact-results-list .contact-result + .contact-result {
    border-top: 1px solid var(--border-dark);
}

/* Keyboard focus: highlight activatable contact rows */
.contact-result:focus { outline: none; }
.contact-result:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

.contact-info {
    flex: 1;
    min-width: 0;
    margin-right: 10px; /* breathing room from Add button */
}

.contact-name {
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 2px;
    font-size: 0.8rem; /* much smaller title in dropdown */
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.contact-details {
    font-size: 12px; /* slightly smaller subtext */
    color: var(--text-secondary);
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.contact-action {
    margin-left: var(--spacing-sm);
}

.btn-add-contact {
    background: var(--orange-subtle);
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: var(--border-radius-sm);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.btn-add-contact:hover {
    background: #e55a2b;
}

/* Keyboard focus: Add Contact button */
.btn-add-contact:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

.added-indicator {
    font-size: 12px;
    color: var(--green-subtle);
    font-weight: 500;
}

.search-loading, .search-empty, .search-error {
    padding: var(--spacing-md);
    text-align: center;
}

/* Themed scrollbars for dropdowns */
#contact-search-results::-webkit-scrollbar,
.contact-search-results::-webkit-scrollbar,
.preview-results::-webkit-scrollbar {
    width: 10px;
}
#contact-search-results::-webkit-scrollbar-track,
.contact-search-results::-webkit-scrollbar-track,
.preview-results::-webkit-scrollbar-track {
    background: var(--grey-780);
}
#contact-search-results::-webkit-scrollbar-thumb,
.contact-search-results::-webkit-scrollbar-thumb,
.preview-results::-webkit-scrollbar-thumb {
    background: var(--grey-600);
    border-radius: 10px;
    border: 2px solid var(--grey-780);
}
#contact-search-results,
.contact-search-results,
.preview-results {
    scrollbar-width: thin;                 /* Firefox */
    scrollbar-color: var(--grey-600) var(--grey-780);
}

/* === PREVIEW CONTACT PICKER DROPDOWN (inside step cards) === */
.preview-contact-picker { position: relative; }
.preview-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    z-index: 900; /* below modal overlay (1100) */
    max-height: 260px;
    overflow-y: auto;
    margin-top: 6px;
    padding: 4px 0;
    display: none;
}
.preview-results.open { display: block; }
.preview-result {
    padding: 8px 12px;
    cursor: pointer;
}
.preview-result:hover,
.preview-result[aria-selected="true"] { background: var(--bg-hover); }
.preview-result .title { color: var(--text-primary); font-weight: 500; font-size: 0.8rem; }
.preview-result .subtitle { color: var(--text-secondary); font-size: 12px; }

/* === ADD CONTACT POPOVER (ensure above dropdowns) === */
.add-contact-popover {
    position: fixed; /* anchored by JS */
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    z-index: 960; /* above dropdowns, below modal overlay */
    animation: popIn 130ms ease-out;
    --arrow-size: 10px;
}

.add-contact-popover::before,
.add-contact-popover::after {
    content: "";
    position: absolute;
    width: var(--arrow-size);
    height: var(--arrow-size);
    transform: rotate(45deg);
    pointer-events: none;
}
/* Right of anchor (arrow on left edge) */
.add-contact-popover[data-placement="right"]::before {
    left: calc(-1 * var(--arrow-size) / 2 + 1px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--border-light);
}
.add-contact-popover[data-placement="right"]::after {
    left: calc(-1 * var(--arrow-size) / 2 + 2px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--bg-card);
}
/* Left of anchor (arrow on right edge) */
.add-contact-popover[data-placement="left"]::before {
    right: calc(-1 * var(--arrow-size) / 2 + 1px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--border-light);
}
.add-contact-popover[data-placement="left"]::after {
    right: calc(-1 * var(--arrow-size) / 2 + 2px);
    top: calc(var(--arrow-top, 20px) - (var(--arrow-size) / 2));
    background: var(--bg-card);
}
/* Bottom of anchor (arrow on top edge) - fallback */
.add-contact-popover[data-placement="bottom"]::before {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    top: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
.add-contact-popover[data-placement="bottom"]::after {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    top: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}
/* Top of anchor (arrow on bottom edge) - fallback */
.add-contact-popover[data-placement="top"]::before {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    bottom: calc(-1 * var(--arrow-size) / 2 + 1px);
    background: var(--border-light);
}
.add-contact-popover[data-placement="top"]::after {
    left: calc(var(--arrow-left, 20px) - (var(--arrow-size) / 2));
    bottom: calc(-1 * var(--arrow-size) / 2 + 2px);
    background: var(--bg-card);
}

.search-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
}

.loading-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--grey-600);
    border-top: 2px solid var(--orange-subtle);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.search-loading span {
    color: var(--text-secondary);
    font-size: 13px;
}

.empty-text, .error-text {
    color: var(--text-primary);
    font-weight: 500;
    margin-bottom: 4px;
}

.empty-subtext, .error-subtext {
    color: var(--text-muted);
    font-size: 12px;
}

/* Global focus ring for small search inputs */
.search-input-small:focus {
    outline: none;
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
}

.builder-content {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

/* Subtle animations for Sequence Builder */
@keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(4px) scale(0.98); }
    to   { opacity: 1; transform: none; }
}
@keyframes popIn {
    from { opacity: 0; transform: translateY(4px) scale(0.98); }
    to   { opacity: 1; transform: none; }
}
@keyframes fadeSlideOut {
    from { opacity: 1; transform: none; }
    to   { opacity: 0; transform: translateY(-2px) scale(0.98); }
}
@media (prefers-reduced-motion: reduce) {
    .seq-title-actions,
    .seq-title-edit-row,
    .delete-popover { transition: none !important; animation: none !important; }
}

/* Sequence title display + inline edit */
.seq-title-wrap {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    animation: fadeSlideIn 140ms ease-out;
}
.seq-title-text {
    font-size: 0.85rem;         /* match .label-desc */
    font-weight: 400;           /* match .label-desc */
    color: var(--text-secondary); /* match .label-desc */
}
.seq-title-actions {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    opacity: 0;
    pointer-events: none;
    transform: translateX(4px);
    transition: opacity var(--transition-fast), transform var(--transition-fast);
}
.seq-title-wrap:hover .seq-title-actions,
.seq-title-wrap:focus-within .seq-title-actions {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0);
}
.seq-title-wrap.actions-pinned .seq-title-actions {
    /* keep actions visible while delete popover is open */
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0);
}
.seq-title-wrap.no-hover .seq-title-actions {
    /* force-hide actions briefly after cancel/save/close regardless of hover */
    opacity: 0 !important;
    pointer-events: none !important;
    transform: translateX(4px);
}
.seq-title-edit-row {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
    animation: fadeSlideIn 160ms ease-out;
}

/* generic anim-out hook used by JS just before swapping views */
.seq-title-wrap.anim-out,
.seq-title-edit-row.anim-out {
    animation: fadeSlideOut 120ms ease-in forwards;
}
.seq-title-edit-row .seq-title-input {
    width: clamp(120px, 20vw, 180px);
    max-width: 100%;
    height: 30px;
    font-size: 0.95rem;
}

@media (max-width: 640px) {
    .seq-title-text { font-size: 1.1rem; }
}

.sequence-steps {
    display: flex;
    flex-direction: column;
    gap: 25px;             /* spacing between step items */
    padding-top: 0;        /* top spacing handled by .page-content padding */
    margin-top: 0;         /* avoid compounding with external gaps */
}

.step-item { position: relative; }

.delay-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    margin: 0 0 25px 0;
    width: 100%;
    position: relative; /* allow top connector to anchor above */
}

.delay-pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    margin-top: 0;         /* top spacing now handled by .sequence-steps padding */
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: 999px;
    color: var(--text-inverse);
    box-shadow: var(--elevation-card);
    align-self: center;
}
.delay-pill:hover { background: var(--grey-700); }
.delay-pill:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }
button.delay-pill { cursor: pointer; -webkit-appearance: none; appearance: none; }
.delay-pill .icon { color: var(--grey-300); display:inline-flex; }
.delay-pill .delay-label { color: var(--text-inverse); }
.delay-pill .icon-btn-sm {
    border: none;
    width: 24px;
    height: 24px;
    color: var(--grey-300);
}
.delay-pill .icon-btn-sm:hover { background: var(--grey-600); }
.delay-pill .icon-btn-sm:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

/* Re-introduce the in-step connector (pill to card) */
.sequence-steps .step-item .delay-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.sequence-steps .step-item .delay-container .delay-connector {
    width: 2px;
    height: var(--connector-height);
    background: var(--border-light);
    border-radius: 1px;
    margin-top: 6px; /* breathing space under pill */
}

/* Old CSS connectors (hidden in favor of SVG overlay) */
.builder-content .add-step-row .between-steps,
.builder-content .add-step-row .between-steps::after,
.builder-content .sequence-steps .step-item .delay-container::before,
.builder-content .sequence-steps .step-item .delay-container::after { display: none !important; }

.add-step-container { margin-top: 0; }

.add-step-row {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 0; /* rely on sequence-steps spacing control */
}

/* Use natural spacing; SVG overlay will visually connect elements */
.builder-content > .add-step-row {
    margin-top: 0 !important; /* rely on builder-content gap (25px) */
}

/* Clean up - remove all connector-related styles */
.builder-content .sequence-steps .step-item .delay-container .delay-connector,
.builder-content .add-step-row .delay-connector {
    display: none !important;
}

/* Remove legacy step-to-step arrows in builder context */
.builder-content .sequence-steps .step-item:not(:first-child) .delay-container::before,
.builder-content .sequence-steps .step-item:not(:first-child) .delay-container::after { display: none !important; }

.add-step-container {
    display: flex;
    justify-content: center;
    width: 100%;
}

.step-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
}

.step-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-base);
    /* Move divider to .step-body to avoid double line when collapsed */
    border-bottom: 0;
}
 .step-header .spacer { flex: 1 1 auto; }

/* Step status toggle (Active/Paused) */
.step-status-toggle { display: inline-flex; align-items: center; gap: 8px; margin-left: 0; }
.step-status-toggle .toggle-switch { margin: 0; }
.step-status-toggle .switch-text { color: var(--text-secondary); font-size: 0.85rem; }

/* Legacy switch styles (kept for compatibility) */
.switch { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
.switch input { position: absolute; opacity: 0; width: 1px; height: 1px; pointer-events: none; }
.switch-track {
    position: relative;
    width: 40px;
    height: 22px;
    border-radius: 999px;
    background: var(--grey-700);
    border: 1px solid var(--border-light);
    transition: background var(--transition-fast), border-color var(--transition-fast);
    display: inline-block;
}
.switch-track::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 2px;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--text-inverse);
    box-shadow: 0 1px 2px rgba(0,0,0,0.4);
    transition: transform var(--transition-fast);
}
.switch input:checked + .switch-track { background: var(--green-subtle); border-color: var(--green-subtle); }
.switch input:checked + .switch-track::after { transform: translate(18px, -50%); }

.collapse-btn,
.icon-btn-sm {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    width: 28px;
    height: 28px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-fast);
}
.collapse-btn:hover,
.icon-btn-sm:hover { background: var(--grey-600); border-color: var(--grey-500); color: var(--text-inverse); }
.collapse-btn:focus-visible,
.icon-btn-sm:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

.step-title {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 600;
}

/* Inline icon + label + short description for automatic email steps */
.step-title .label-wrap {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.step-title .label-wrap .label-icon {
    display: inline-flex;
    color: var(--grey-300);
}
.step-title .label-wrap .label-icon svg {
    width: 16px;
    height: 16px;
    display: block;
}
.step-title .label-wrap .label-desc {
    color: var(--text-secondary);
    font-weight: 400;
    font-size: 0.85rem;
}

.badge {
    display: inline-flex;
    align-items: center;
    height: 20px;
    padding: 0 8px;
    border-radius: 10px;
    font-size: 0.75rem;
    border: 1px solid var(--border-dark);
}
.badge-email { background: var(--blue-muted); color: var(--text-inverse); }
.badge-phone { background: var(--green-muted); color: var(--text-inverse); }
.badge-linkedin { background: #0077b5; color: var(--text-inverse); }
.badge-neutral { background: var(--grey-700); color: var(--text-inverse); }

.step-meta {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
}
.delay-label { color: var(--text-secondary); }

.step-body { padding: var(--spacing-base); border-top: 1px solid var(--border-light); }

/* Editor toolbar inside email step */
.editor-toolbar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-sm);
    padding: 6px;
    margin-bottom: var(--spacing-sm); /* even gap with subject row */
}

.editor-toolbar .toolbar-btn {
    background: none;
    border: 1px solid var(--grey-600);
    color: var(--grey-300);
    width: 30px;
    height: 30px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-fast);
    position: relative; /* for separators */
}
.editor-toolbar .toolbar-btn:hover {
    background: var(--grey-700);
    color: var(--text-inverse);
    border-color: var(--grey-500);
}
.editor-toolbar .toolbar-btn:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
.editor-toolbar .toolbar-btn:active {
    transform: translateY(0.5px);
}
.editor-toolbar .toolbar-btn svg {
    width: 22px;
    height: 22px;
    display: block;
}
.editor-toolbar .toolbar-btn[data-action="formatting"] svg text {
    /* Center the rendered glyph vertically within the 22x22 viewbox */
    transform: translateY(2.5px);
}
/* Make sure clicks target the button, not the inner SVG or its paths */
.editor-toolbar .toolbar-btn svg,
.editor-toolbar .toolbar-btn svg * {
    pointer-events: none;
}

/* Inline tooltips on hover/focus using aria-label */
.editor-toolbar .toolbar-btn::after {
    content: attr(aria-label);
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px);
    transform: translate(-50%, 4px);
    background: var(--grey-820);
    color: var(--text-inverse);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-sm);
    padding: 4px 8px;
    font-size: 12px;
    white-space: nowrap;
    box-shadow: var(--shadow-sm);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    z-index: 20;
}
.editor-toolbar .toolbar-btn::before {
    content: '';
    position: absolute;
    left: 50%;
    bottom: calc(100% + 2px);
    transform: translate(-50%, 4px);
    border-width: 6px 6px 0 6px;
    border-style: solid;
    border-color: var(--grey-820) transparent transparent transparent;
    opacity: 0;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    pointer-events: none;
    z-index: 19;
}
.editor-toolbar .toolbar-btn:hover::after,
.editor-toolbar .toolbar-btn:focus-visible::after,
.editor-toolbar .toolbar-btn:hover::before,
.editor-toolbar .toolbar-btn:focus-visible::before {
    opacity: 1;
    transform: translate(-50%, 0);
}

/* Icon container (if present) */
.editor-toolbar .toolbar-btn .icon {
    display: inline-flex;
    color: var(--grey-300);
}

/* Hide verbose label inside the AI button to keep toolbar compact */
.editor-toolbar .toolbar-ai .label {
    display: none;
}

/* Editor toolbar layout: even spacing + thin dividers between icons */
.editor-toolbar {
    display: flex;
    align-items: center;
    gap: 12px; /* even spacing between all buttons */
}
/* No inter-button divider; each icon has its own 1px border */
/* Remove legacy group-specific separators to avoid duplicates */
.editor-toolbar .toolbar-btn[data-action="formatting"],
.editor-toolbar .toolbar-btn[data-action="attach"] {
    margin-right: 0;
    box-shadow: none;
}

/* Future toggle state */
.editor-toolbar .toolbar-btn.is-active {
    background: var(--grey-700);
    color: var(--text-inverse);
    border-color: var(--grey-600);
}

/* === EMAIL EDITOR: FORMATTING BAR === */
/* Slides down under the editor toolbar when the Formatting button is toggled */
.step-card .formatting-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    background: var(--bg-item);
    border: 0; /* no border when hidden to avoid extra gap */
    border-radius: var(--border-radius-sm);
    padding: 0; /* remove padding when hidden so height collapses fully */
    margin-bottom: 0; /* no extra gap when hidden */
    /* hidden by default; JS toggles .open */
    max-height: 0;
    opacity: 0;
    transform: translateY(-6px);
    overflow: hidden;
    pointer-events: none;
    transition: max-height var(--transition-smooth), opacity var(--transition-smooth), transform var(--transition-smooth);
    position: relative; /* anchor popovers */
    z-index: 1;
}

.step-card .formatting-bar.open {
    max-height: 200px; /* enough for one-row controls */
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    border: 1px solid var(--border-light);
    padding: 6px;
    margin-bottom: var(--spacing-sm); /* even spacing below */
    /* Ensure popovers are not clipped when bar is open */
    overflow: visible;
}

.step-card .formatting-bar .fmt-group { position: relative; display: inline-flex; align-items: center; }

/* Buttons inside formatting bar */
.step-card .formatting-bar .fmt-btn {
    background: none;
    border: 1px solid var(--grey-600); /* match top toolbar buttons */
    color: var(--grey-300);
    height: 30px;
    min-width: 30px;
    padding: 0 8px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-fast);
    position: relative; /* anchor custom tooltip */
}
.step-card .formatting-bar .fmt-btn:hover {
    background: var(--grey-700);
    color: var(--text-inverse);
    border-color: var(--grey-500); /* match top toolbar hover */
}
.step-card .formatting-bar .fmt-btn:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
.step-card .formatting-bar .fmt-btn:active { transform: translateY(0.5px); }

/* Inline tooltips on hover/focus using aria-label (match top toolbar style) */
.step-card .formatting-bar .fmt-btn::after {
    content: attr(aria-label);
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px);
    transform: translate(-50%, 4px);
    background: var(--grey-820);
    color: var(--text-inverse);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-sm);
    padding: 4px 8px;
    font-size: 12px;
    white-space: nowrap;
    box-shadow: var(--shadow-sm);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    z-index: 20;
}
.step-card .formatting-bar .fmt-btn::before {
    content: '';
    position: absolute;
    left: 50%;
    bottom: calc(100% + 2px);
    transform: translate(-50%, 4px);
    border-width: 6px 6px 0 6px;
    border-style: solid;
    border-color: var(--grey-820) transparent transparent transparent;
    opacity: 0;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    pointer-events: none;
    z-index: 19;
}
.step-card .formatting-bar .fmt-btn:hover::after,
.step-card .formatting-bar .fmt-btn:focus-visible::after,
.step-card .formatting-bar .fmt-btn:hover::before,
.step-card .formatting-bar .fmt-btn:focus-visible::before {
    opacity: 1;
    transform: translate(-50%, 0);
}
.step-card .formatting-bar .fmt-btn[aria-expanded="true"] {
    background: var(--grey-700);
    color: var(--text-inverse);
    border: 1px solid var(--grey-600);
}
.step-card .formatting-bar .fmt-btn[aria-expanded="true"]:hover {
    border-color: var(--grey-500);
}
/* Exception: Highlight button should only appear selected when a color is active,
   not merely when its popover is open. Hide the border/background if expanded
   but not pressed. */
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"][aria-expanded="true"]:not([aria-pressed="true"]) {
    background: none;
    border: none;
    color: var(--grey-300);
}
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"][aria-expanded="true"]:not([aria-pressed="true"]):hover {
    background: var(--grey-700);
    border: none;
    color: var(--text-inverse);
}
/* Active/toggled state for toggleable formatting controls (bold/italic/underline/lists) */
.step-card .formatting-bar .fmt-btn[aria-pressed="true"] {
    background: var(--grey-700);
    color: var(--text-inverse);
    border: 1px solid var(--grey-600); /* ensure a border appears when selected */
}
.step-card .formatting-bar .fmt-btn[aria-pressed="true"]:hover {
    border-color: var(--grey-500);
}
/* SVG icons inside formatting buttons */
.step-card .formatting-bar .fmt-btn svg {
    width: 20px;
    height: 20px;
    display: block;
}
.step-card .formatting-bar .fmt-btn .ql-stroke {
    fill: none;
    stroke: currentColor;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 1.5;
}
.step-card .formatting-bar .fmt-btn .ql-stroke.ql-thin { stroke-width: 1; }
.step-card .formatting-bar .fmt-btn .ql-fill { fill: currentColor; }

/* === EMAIL EDITOR: LINK BAR === */
/* Slides down under the editor toolbar when the Link button is toggled */
.step-card .link-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    background: var(--bg-item);
    border: 0; /* no border when hidden to avoid extra gap */
    border-radius: var(--border-radius-sm);
    padding: 0; /* remove padding when hidden so height collapses fully */
    margin-bottom: 0; /* avoid stacking with toolbar when hidden */
    /* hidden by default; JS toggles .open */
    max-height: 0;
    opacity: 0;
    transform: translateY(-6px);
    overflow: hidden;
    pointer-events: none;
    transition: max-height var(--transition-smooth), opacity var(--transition-smooth), transform var(--transition-smooth);
}

.step-card .link-bar.open {
    max-height: 200px;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    border: 1px solid var(--border-light);
    padding: 6px;
    margin-bottom: var(--spacing-sm); /* spacing below when open */
    margin-top: 0; /* keep even spacing above (toolbar -> link bar) */
}

.step-card .link-bar .field { display: flex; flex-direction: column; gap: 4px; min-width: 180px; }
.step-card .link-bar .field .fmt-label { min-width: 0; }
.step-card .link-bar .actions { display: inline-flex; gap: 6px; margin-left: auto; }

/* Reuse button styling from formatting bar */
.step-card .formatting-bar .fmt-btn,
.step-card .link-bar .fmt-btn {
    background: none;
    border: 1px solid var(--grey-600); /* match top toolbar buttons */
    color: var(--grey-300);
    height: 30px;
    min-width: 30px;
    padding: 0 10px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-fast);
}
.step-card .link-bar .fmt-btn:hover { background: var(--grey-700); color: var(--text-inverse); border-color: var(--grey-500); }

/* Inline formatting buttons: remove default border so selection stands out */
.step-card .formatting-bar .fmt-btn[data-fmt="bold"]:not([aria-pressed="true"]):not([aria-expanded="true"]),
.step-card .formatting-bar .fmt-btn[data-fmt="italic"]:not([aria-pressed="true"]):not([aria-expanded="true"]),
.step-card .formatting-bar .fmt-btn[data-fmt="underline"]:not([aria-pressed="true"]):not([aria-expanded="true"]),
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"]:not([aria-pressed="true"]):not([aria-expanded="true"]),
.step-card .formatting-bar .fmt-btn[data-fmt="ol"]:not([aria-pressed="true"]):not([aria-expanded="true"]),
.step-card .formatting-bar .fmt-btn[data-fmt="ul"]:not([aria-pressed="true"]):not([aria-expanded="true"]) {
    border: none;
    box-shadow: none;
}
/* Ensure highlight shows no border when popover is open but no color is active.
   Placed here (after the later base rule) so it wins in cascade. */
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"][aria-expanded="true"]:not([aria-pressed="true"]) {
    background: none;
    border: none;
    color: var(--grey-300);
}
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"][aria-expanded="true"]:not([aria-pressed="true"]):hover {
    background: var(--grey-700);
    border: none;
    color: var(--text-inverse);
}
.step-card .link-bar .fmt-btn:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

/* Future-proof: if any top toolbar buttons become toggleable */
.editor-toolbar .toolbar-btn[aria-pressed="true"] {
    background: var(--grey-700);
    color: var(--text-inverse);
    border-color: var(--grey-600);
}

/* Final fail-safe: Highlight button should NEVER show a border unless pressed */
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"]:not([aria-pressed="true"]) {
    border: none !important;
    background: none;
}
.step-card .formatting-bar .fmt-btn[data-fmt="highlight"]:not([aria-pressed="true"]):hover {
    background: var(--grey-700);
    color: var(--text-inverse);
    border: none !important;
}

/* Labels and glyphs */
.step-card .formatting-bar .fmt-label {
    color: var(--text-inverse);
    font-size: 0.85rem;
    font-weight: 500;
    line-height: 1;
    min-width: 90px;
    text-align: left;
}
.step-card .formatting-bar .fmt-glyph {
    color: var(--text-inverse);
    font-weight: 700;
    line-height: 1;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

/* Popovers for font, size, highlight */
.step-card .formatting-bar .format-popover {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    background: var(--grey-820);
    color: var(--text-inverse);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: 6px;
    min-width: 180px;
    box-shadow: var(--shadow-sm);
    opacity: 0;
    transform: translateY(-4px);
    pointer-events: none;
    transition: opacity var(--transition-fast), transform var(--transition-fast);
    z-index: 50;
}
.step-card .formatting-bar .format-popover.open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.step-card .formatting-bar .format-popover .popover-item {
    width: 100%;
    background: none;
    border: none;
    color: var(--text-inverse);
    padding: 6px 8px;
    border-radius: var(--border-radius-sm);
    text-align: left;
    cursor: pointer;
    font-size: 0.9rem;
}
.step-card .formatting-bar .format-popover .popover-item:hover {
    background: var(--grey-700);
}
.step-card .formatting-bar .format-popover .popover-item:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

/* Font list can be a bit long */
.step-card .formatting-bar .font-popover { max-height: 240px; overflow: auto; }

/* Highlight swatches */
.step-card .formatting-bar .highlight-popover {
    min-width: auto;
    left: 50%;
    /* Keep horizontal centering in both closed/open states */
    transform: translate(-50%, -4px);
}
.step-card .formatting-bar .highlight-popover.open {
    transform: translate(-50%, 0);
}
.step-card .formatting-bar .highlight-popover .swatches { display: flex; gap: 8px; padding: 2px; justify-content: center; }
.step-card .formatting-bar .highlight-popover .swatch {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 1px solid var(--border-light);
    background: var(--sw, #ffd54f);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}
.step-card .formatting-bar .highlight-popover .swatch:hover {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
}
.step-card .formatting-bar .highlight-popover .swatch:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
/* Visual for the 'No highlight' option */
.step-card .formatting-bar .highlight-popover .swatch[data-color="none"] {
    background: linear-gradient(45deg, transparent 46%, var(--grey-600) 48%, var(--grey-600) 52%, transparent 54%), var(--grey-800);
    border: 1px dashed var(--grey-600);
}

.step-tabs {
    display: flex;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    align-items: center; /* keep tabs height stable even with picker */
}
.tab {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    padding: 6px 10px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.85rem;
}
.tab:hover { background: var(--grey-700); color: var(--text-inverse); }
.tab.active { background: var(--grey-700); color: var(--text-inverse); border-color: var(--grey-600); }
.tab:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

.form-row { margin-bottom: var(--spacing-md); }

/* In email editor, use smaller, even spacing between Subject and Toolbar */
.step-card .tab-panels .tab-panel[data-tab="editor"] > .form-row {
    margin-bottom: var(--spacing-sm);
}

.textarea-dark {
    width: 100%;
    min-height: 180px;
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    color: var(--text-inverse);
    border-radius: var(--border-radius);
    padding: var(--spacing-sm);
    resize: vertical;
}
.step-card .body-input {
    /* Extra inline padding so numbers/cursors don't hug the border */
    padding-left: 14px;
    padding-right: 14px;
    /* Ensure ~25px space from editor bottom to its container bottom.
       Compensate for parent padding using CSS variables. */
    margin-bottom: max(0px, calc(25px - var(--spacing-base)));
}

/* Keep list markers comfortably inside the editor box */
.step-card .body-input ol,
  .step-card .body-input ul {
    padding-left: 1.25rem; /* indent bullets/numbers inside the padded box */
    margin-left: 0;
    list-style-position: outside; /* markers inside content box due to padding */
  }
  .textarea-dark::placeholder { color: var(--grey-400); }

  /* Notes widget: match textarea font to status/clock (use app sans stack) */
  .notes-textarea {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }
  .notes-textarea::placeholder {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }

  /* Notes widget close button: light grey container with centered X */
  .widget-card .notes-close {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    min-width: 24px;
    min-height: 24px;
    padding: 0;
    background: var(--bg-item);
    color: var(--grey-300);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-sm);
    line-height: 1;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    box-sizing: border-box;
  }
  .widget-card .notes-close:hover {
    background: var(--grey-600);
    color: var(--text-inverse);
  }
  .widget-card .notes-close:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
  }

  /* Focus ring preference (orange glow) */
  .input-dark:focus,
  .textarea-dark:focus {
    outline: none;
    border-color: var(--orange-subtle);
    background: var(--grey-600);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
}

.email-preview {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-base);
}
.preview-subject { font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--text-primary); }
.preview-body { color: var(--text-inverse); }

/* Preview Contact Picker (Email Preview tab) */
.preview-contact-picker {
    position: relative;
    max-width: 520px;
    margin-bottom: var(--spacing-md);
}
.preview-contact-picker .preview-contact-input {
    width: 100%;
}
.step-tabs .preview-contact-picker {
    margin-bottom: 0;
    margin-left: auto; /* push search to right in flex container */
}
.step-tabs .preview-contact-input {
    height: 30px; /* match tab height */
    padding: 0 10px;
}
.preview-results {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: var(--grey-800);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    max-height: 240px;
    overflow: auto;
    display: none;
    z-index: 70;
}
.preview-results.open { display: block; }
.preview-result {
    padding: 8px 10px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-light);
}
.preview-result:last-child { border-bottom: none; }
.preview-result .title { color: var(--text-inverse); font-weight: 500; }
.preview-result .subtitle { color: var(--text-secondary); font-size: 12px; margin-top: 2px; }
.preview-result:hover,
.preview-result[aria-selected="true"] {
    background: var(--grey-700);
}
.preview-result[aria-selected="true"] {
    box-shadow: inset 2px 0 0 var(--orange-subtle);
}

/* === GLOBAL RESET === */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    height: 100vh;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-main);
    color: var(--text-primary);
    line-height: 1.5;
    font-size: 14px;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}
::-webkit-scrollbar-track {
    background: transparent;
}
::-webkit-scrollbar-thumb {
    background: var(--grey-400);
    border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
    background: var(--grey-500);
}

/* === UTILITY CLASSES === */
/* Force-hide an element irrespective of its default display */
.hidden {
    display: none !important;
}

/* === APP CONTAINER === */
.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* Smaller height while loading to avoid excessive empty space */
.global-search-modal.is-loading {
    max-height: 240px;
}
.global-search-modal.is-loading .search-results-container {
    max-height: 200px;
}

/* === TOP BAR === */
.top-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--topbar-height);
    background: var(--grey-800);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--spacing-base);
    box-shadow: var(--elevation-topbar);
    z-index: 1000;
}

.top-bar-left {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.logo {
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-sm);
}

.app-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-inverse);
}

.top-bar-center {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.search-container {
    position: relative;
    display: flex;
    align-items: center;
}

.search-input {
    width: 400px;
    height: 36px;
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    border-radius: var(--border-radius);
    padding: 0 40px 0 var(--spacing-md);
    color: var(--text-inverse);
    font-size: 0.875rem;
    transition: var(--transition-fast);
}

.search-input::placeholder {
    color: var(--grey-400);
}

.search-input:focus {
    outline: none;
    border-color: var(--orange-subtle);
    background: var(--grey-600);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
}

.search-btn {
    position: absolute;
    right: 8px;
    background: none;
    border: none;
    color: var(--grey-400);
    cursor: pointer;
    padding: 6px;
    border-radius: var(--border-radius-sm);
    transition: var(--transition-fast);
}

.search-btn:hover {
    color: var(--text-inverse);
    background: var(--grey-600);
}

.call-btn {
    background: var(--orange-subtle);
    border: none;
    color: var(--text-inverse);
    width: 40px;
    height: 40px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius); /* keep existing rounded px */
    cursor: pointer;
    transition: var(--transition-fast);
    line-height: 0; /* remove inline content vertical offset */
}

.call-btn:hover {
    background: #e55a2b;
    transform: translateY(-1px);
}

/* Ensure the phone icon is centered and sized consistently */
.call-btn svg {
    display: block;
    width: 20px;
    height: 20px;
}

.top-bar-right {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.icon-btn {
    position: relative;
    background: none;
    border: none;
    color: var(--grey-400);
    cursor: pointer;
    padding: 8px;
    border-radius: var(--border-radius);
    transition: var(--transition-fast);
}

.icon-btn:hover {
    color: var(--text-inverse);
    background: var(--grey-700);
}

.notification-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: var(--orange-subtle);
    color: var(--text-inverse);
    font-size: 0.6rem;
    padding: 2px 5px;
    border-radius: 10px;
    min-width: 16px;
    text-align: center;
    font-weight: 600;
}

.profile-container {
    margin-left: var(--spacing-sm);
}

.profile-avatar {
    width: 36px;
    height: 36px;
    background: var(--blue-subtle);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: var(--text-inverse);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.875rem;
}

.profile-avatar:hover {
    background: #1e40af;
    transform: scale(1.05);
}

/* === MAIN LAYOUT === */
.main-layout {
    display: flex;
    margin-top: var(--topbar-height);
    height: calc(100vh - var(--topbar-height));
    overflow: hidden;
}

/* === SIDEBAR === */
.sidebar {
    width: var(--sidebar-width);
    background: var(--grey-800);
    border-right: 1px solid var(--grey-700);
    transition: width var(--transition-smooth);
    overflow: hidden;
    z-index: 100;
}

.sidebar:hover {
    width: var(--sidebar-expanded);
}

/* Also support JS-applied expanded class for hover intent */
.sidebar.expanded {
    width: var(--sidebar-expanded);
}

.sidebar-content {
    padding: var(--spacing-base) 0;
    height: 100%;
    /* No scrollbars when collapsed */
    overflow-y: hidden;
    overflow-x: hidden;
}

/* Enable scrolling only when expanded */
.sidebar.expanded .sidebar-content,
.sidebar:hover .sidebar-content {
    overflow-y: auto;
}

.nav-item {
    display: flex;
    align-items: center;
    padding: var(--spacing-md) var(--spacing-base);
    color: var(--grey-400);
    text-decoration: none;
    transition: var(--transition-fast);
    white-space: nowrap;
    border-left: 3px solid transparent;
    font-size: 0.875rem;
}

.nav-item:hover {
    background: var(--grey-700);
    color: var(--text-inverse);
}

.nav-item.active {
    background: var(--grey-700);
    color: var(--text-inverse);
    border-left-color: var(--orange-subtle);
}

.nav-item svg {
    min-width: 20px;
    margin-right: var(--spacing-md);
}

.nav-text {
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.sidebar:hover .nav-text {
    opacity: 1;
}

/* Collapsed state: center icons and hide labels */
.sidebar:not(.expanded):not(:hover) .nav-item {
    justify-content: center;
    padding: var(--spacing-md) 0; /* remove side padding so icons center */
}
.sidebar:not(.expanded):not(:hover) .nav-item svg {
    margin-right: 0;
}
.sidebar:not(.expanded):not(:hover) .nav-text {
    display: none;
}

/* Expanded state (via class or hover): show labels */
.sidebar.expanded .nav-text {
    opacity: 1;
}

.nav-divider {
    height: 1px;
    background: var(--grey-700);
    margin: var(--spacing-base) var(--spacing-md);
}

/* Finetune: Lists icon appears slightly right-shifted. Make it a bit larger and nudge left when collapsed */
.sidebar:not(.expanded):not(:hover) .nav-item[data-page="lists"] svg {
    width: 23px;
    height: 23px;
    transform: translateX(-2px);
}

/* === CONTENT AREA === */
.content-area {
    flex: 1;
    display: flex;
    overflow: hidden;
}

/* === MAIN CONTENT === */
.main-content {
    flex: 3;
    background: var(--bg-main);
    overflow: hidden;
    position: relative;
}

/* === DASHBOARD (SCROLLABLE) === */
.dashboard-content {
    padding: var(--spacing-base);
    overflow-y: auto;
    height: 100%;
}

.stat-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-base);
    margin-bottom: var(--spacing-base);
}

.stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-base);
    text-align: center;
    box-shadow: var(--elevation-card);
    transition: var(--transition-fast);
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--elevation-card-hover);
}

.stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--text-inverse);
    margin-bottom: 8px;
}

.stat-label {
    color: var(--text-inverse);
    font-size: 0.875rem;
}

.dashboard-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-base);
    margin-bottom: var(--spacing-base);
    box-shadow: var(--elevation-card);
}

.card-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--text-primary);
}

/* === CONTAINER-BASED PAGES === */
.page {
    display: none;
    height: 100%;
}

.page.active {
    display: block;
}

.page-container {
    margin: var(--spacing-base);
    height: calc(100vh - var(--topbar-height) - (var(--spacing-base) * 2));
    background: var(--bg-container);
    border: 1px solid var(--border-dark);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-page);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.page-header {
    padding: var(--spacing-base);
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-container);
}

/* Sequence Builder header layout: place title right of back arrow */
#sequence-builder-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
#sequence-builder-header .page-title-section {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* keep title next to back button */
    gap: var(--spacing-base);
}

/* Sequence Builder header actions ordering */
#sequence-builder-header .page-actions .contact-search-container { order: 0; }
#sequence-builder-header .page-actions #contacts-btn { order: 1; }
#sequence-builder-header .page-actions #add-step-btn { order: 2; }

/* Tighter, even spacing between search, Contacts, and Add Step */
#sequence-builder-header .page-actions {
    display: flex;
    align-items: center;
    gap: 8px; /* bring search closer to Contacts */
}

/* Ensure the search input fills the 300px container to avoid extra internal gap */
#sequence-builder-header .contact-search-container .search-input-small {
    width: 300px;
}

.page-title-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
}

.page-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-inverse);
}

.page-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.page-filters {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.filter-tabs {
    display: flex;
    gap: var(--spacing-sm);
}

.filter-tab {
    background: none;
    border: none;
    color: var(--grey-400);
    padding: 8px var(--spacing-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.875rem;
}

.filter-tab.active {
    background: var(--orange-subtle);
    color: var(--text-inverse);
}

.filter-tab:hover:not(.active) {
    background: var(--grey-700);
    color: var(--text-inverse);
}

.tab-count {
    margin-left: 6px;
    font-size: 0.75rem;
}

.filter-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.search-input-small {
    width: 200px;
    height: 32px;
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    border-radius: var(--border-radius);
    padding: 0 var(--spacing-sm);
    color: var(--text-inverse);
    font-size: 0.875rem;
}

.search-input-small::placeholder {
    color: var(--grey-400);
}

.results-count {
    color: var(--grey-400);
    font-size: 0.875rem;
}

/* === PEOPLE PAGE: TOOLBAR & FILTERS === */
.people-toolbar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-sm);
}

.filter-panel {
    margin-top: var(--spacing-md);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    box-shadow: var(--elevation-card);
}

.filter-tabs-row {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: var(--spacing-md);
}

@media (max-width: 900px) {
    .filter-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 600px) {
    .filter-grid { grid-template-columns: 1fr; }
}

.filter-field label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 6px;
}

.input-dark {
    width: 100%;
    height: 34px;
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    border-radius: var(--border-radius);
    padding: 0 var(--spacing-sm);
    color: var(--text-inverse);
}

/* === CHIP INPUT (tokenized) === */
.chip-input {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 6px;
    min-height: 34px;
    padding: 4px 34px 4px 6px; /* right space for clear button */
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    border-radius: var(--border-radius);
    position: relative;
}
.chip-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}
.chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    height: 24px;
    padding: 0 6px;
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-inverse);
    border-radius: var(--border-radius-sm);
    font-size: 0.8rem;
}
.chip-remove {
    background: none;
    border: none;
    color: var(--grey-300);
    width: 18px;
    height: 18px;
    line-height: 18px;
    border-radius: 9px;
    cursor: pointer;
}
.chip-remove:hover {
    background: var(--grey-700);
    color: var(--text-inverse);
}
.chip-input-field {
    flex: 1 1 120px;
    min-width: 120px;
    height: 24px;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text-inverse);
    font-size: 0.9rem;
}
.chip-input-field::placeholder { color: var(--grey-400); }

.chip-clear {
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 24px;
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    color: var(--grey-400);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
}
.chip-clear:hover {
    background: var(--grey-600);
    color: var(--text-inverse);
}

.chip-suggest {
    position: absolute;
    left: 0;
    right: 0;
    top: calc(100% + 6px);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    max-height: 220px;
    overflow: auto;
    z-index: 15;
}
.chip-suggest .item {
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--text-primary);
    cursor: pointer;
}
.chip-suggest .item:hover {
    background: var(--grey-700);
    color: var(--text-inverse);
}

.filter-field.checkbox label {
    display: flex;
    align-items: center;
    gap: 8px;
    line-height: 1;
}

.filter-actions-row {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
}

.filter-count-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    height: 18px;
    font-size: 0.7rem;
    padding: 0 6px;
    border-radius: 9px;
    background: var(--orange-subtle);
    color: var(--text-inverse);
    border: 1px solid var(--border-dark);
    margin-left: 6px;
}

.filter-icon {
    margin-right: 6px;
}

.page-content {
    flex: 1;
    padding: var(--spacing-base);
    overflow-y: auto;
}

/* === BUTTONS === */
.btn-primary {
    background: var(--grey-700);
    border: 1px solid var(--border-light);
    color: var(--text-inverse);
    padding: 8px var(--spacing-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: var(--transition-fast);
}

.btn-primary:hover {
    background: var(--grey-600);
    border-color: var(--grey-500);
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--grey-600);
    border: 1px solid var(--grey-500);
    color: var(--text-inverse);
    padding: 8px var(--spacing-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    transition: var(--transition-fast);
}

.btn-secondary:hover {
    background: var(--grey-500);
}

.btn-success {
    background: #28a745;
    border: 1px solid #28a745;
    color: var(--text-inverse);
    padding: 6px var(--spacing-sm);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 500;
    transition: var(--transition-fast);
}

.btn-success:hover {
    background: #218838;
}

.btn-text {
    background: none;
    border: none;
    color: var(--grey-400);
    padding: 6px var(--spacing-sm);
    cursor: pointer;
    font-size: 0.875rem;
    transition: var(--transition-fast);
}

.btn-text:hover {
    color: var(--text-inverse);
}

/* === TABLE STYLES === */
.table-container {
    overflow: hidden; /* clip rounded corners; horizontal scroll handled by .table-scroll */
    overflow-x: hidden;
    position: relative; /* needed for popovers/modals anchored inside */
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    background: var(--bg-card);
}

/* Inner scroll area so only the table scrolls horizontally */
.table-scroll {
    display: block;
    width: 100%;
    overflow-x: auto;
    overflow-y: auto; /* allow vertical scrolling for table rows */
    flex: 1 1 auto;
    min-height: 0; /* allow flexbox to shrink properly */
}

.data-table {
    /* Allow table to expand horizontally to fit content; container provides scroll */
    width: max-content;
    min-width: 100%;
    border-collapse: separate; /* allow rounded corners and vertical dividers */
    border-spacing: 0;
}

/* === QUICK ACTIONS (Accounts) === */
.qa-cell { min-width: 200px; }
.qa-actions {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.qa-btn {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: #ffffff; /* white icons */
    width: 28px;
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
}
.qa-btn:hover { background: var(--grey-700); }
.qa-btn svg { display:block; width: 14px; height: 14px; stroke: currentColor; fill: none; }

/* Keep all headers and cells on a single line */
.data-table th,
.data-table td {
    white-space: nowrap;
}

.data-table th {
    background: var(--grey-800);
    color: var(--text-inverse);
    padding: var(--spacing-sm) var(--spacing-md);
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid var(--grey-700);
    border-right: 1px solid var(--grey-700); /* vertical divider */
}

/* Sticky header within the scroll container: fixed vertically, scrolls horizontally */
.table-scroll .data-table thead th {
    position: sticky;
    top: 0;
    z-index: 2;
    background: var(--grey-800); /* ensure header covers rows when stuck */
}

.data-table td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--grey-700);
    border-right: 1px solid var(--grey-700); /* vertical divider */
    color: var(--text-inverse);
}

/* remove last column right border to avoid double border at container edge */
.data-table th:last-child,
.data-table td:last-child {
    border-right: none;
}

.data-table tr:hover {
    background: var(--grey-800);
}

/* Selected row highlight */
.data-table tr.row-selected {
    background: var(--grey-800);
}

/* Select column */
.data-table .col-select {
    width: 40px;
    text-align: center;
}

.data-table td.col-select {
    text-align: center;
    padding-left: var(--spacing-sm);
    padding-right: var(--spacing-sm);
}

/* === TOGGLE SWITCH (compact, fits in col-select) === */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 34px;
  height: 18px;
  vertical-align: middle;
}
.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}
.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--grey-700);
  border: 1px solid var(--border-light);
  border-radius: 999px;
  transition: background var(--transition-fast), border-color var(--transition-fast);
}
.toggle-slider:before {
  content: "";
  position: absolute;
  width: 14px;
  height: 14px;
  left: 2px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--text-inverse);
  border-radius: 50%;
  box-shadow: 0 1px 2px rgba(0,0,0,0.3);
  transition: left var(--transition-fast), transform var(--transition-fast);
}
.toggle-switch input:checked + .toggle-slider {
  background: var(--orange-subtle);
  border-color: var(--orange-subtle);
}
.toggle-switch input:checked + .toggle-slider:before {
  left: calc(100% - 2px - 14px);
}
.toggle-switch input:focus + .toggle-slider {
  box-shadow: 0 0 0 2px var(--orange-muted);
}

.row-select,
#select-all-contacts,
#select-all-accounts,
#select-all-lists,
#select-all-calls,
#select-all-tasks {
    width: 16px;
    height: 16px;
    accent-color: var(--orange-subtle);
}

/* Consistent focus ring for table checkboxes */
.data-table input[type="checkbox"]:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

/* === TABLE PAGINATION === */
.table-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    border-top: 1px solid var(--border-light);
}

/* Provide outer bottom spacing like other pages (People, Accounts, Calls, Sequences) */
#tasks-page .page-container {
    padding-bottom: var(--spacing-base);
    overflow: visible;
}

/* === BULK SELECT POPOVER (step 1) === */
.bulk-select-popover {
    position: fixed;
    min-width: 320px;
    max-width: 420px;
    padding: var(--spacing-md);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    background-clip: padding-box; /* keep bg inside rounded border */
    clip-path: inset(0 round var(--border-radius)); /* hard-clip the corners */
    box-shadow: var(--elevation-card);
    overflow: hidden; /* ensure children respect rounded corners */
    z-index: 20;
}
.bulk-select-popover .option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    color: var(--text-primary);
}
.bulk-select-popover .hint { color: var(--text-secondary); font-size: 0.85rem; }
.bulk-select-popover input[type="number"],
.bulk-select-popover select {
    height: 30px;
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    border-radius: var(--border-radius-sm);
    padding: 0 8px;
    width: 90px;
}
/* Hover/placeholder to match other modal controls */
.bulk-select-popover input[type="number"]::placeholder { color: var(--text-muted); }
.bulk-select-popover input[type="number"]:hover,
.bulk-select-popover select:hover { background: var(--grey-680, #545b62); }
.bulk-select-popover .actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
}

/* Backdrop used to capture outside clicks (kept visually transparent) */
.bulk-select-backdrop {
    position: fixed;
    inset: 0;
    background: transparent; /* no dimming for small popovers */
    z-index: 15; /* below popover (20) */
}

/* Inputs and controls inside the bulk select popover match modal focus styling */
.bulk-select-popover input[type="radio"] { accent-color: var(--orange-subtle); }
.bulk-select-popover input[type="number"],
.bulk-select-popover select { transition: var(--transition-fast); }
.bulk-select-popover input[type="number"]:focus,
.bulk-select-popover select:focus {
    outline: none;
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
    background: var(--grey-650, #5a6168);
}
.bulk-select-popover input[disabled],
.bulk-select-popover select[disabled] {
    opacity: 0.65;
    cursor: not-allowed;
}

/* Buttons inside the popover follow app focus ring */
.bulk-select-popover .actions .btn-primary:focus-visible,
.bulk-select-popover .actions .btn-text:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

/* === BULK ACTIONS MODAL (step 2) === */
.bulk-actions-modal {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 12px; /* just below table header area */
    width: calc(100% - 24px);
    max-width: 1100px;
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--grey-800);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    z-index: 25;
}
.bulk-actions-modal .bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}
.bulk-actions-modal .spacer { flex: 1 1 auto; }
.bulk-actions-modal .muted { color: var(--text-secondary); }
.bulk-actions-modal .danger { background: var(--red-muted); border-color: var(--red-subtle); }

/* small pill buttons for bar actions */
.bulk-actions-modal .action-btn-sm {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-inverse);
    border-radius: var(--border-radius-sm);
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.85rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
.bulk-actions-modal .action-btn-sm:hover { background: var(--grey-700); }

/* Icons in action buttons */
.bulk-actions-modal .action-btn-sm .icon,
.bulk-actions-modal .action-btn-sm svg {
    width: 14px;
    height: 14px;
}
.bulk-actions-modal .action-btn-sm svg { fill: currentColor; }

.pagination-summary {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.table-pagination {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    justify-content: flex-end;
    padding: var(--spacing-md) var(--spacing-sm);
    color: var(--text-secondary);
}

/* When pagination is inside a table footer, reduce padding and push right */
.table-footer .table-pagination {
    margin-left: auto;
    padding: 0;
}

/* === PEOPLE PAGE TABLE LAYOUT (pin footer to bottom) === */
#people-page .page-container {
    display: flex;
    flex-direction: column;
    /* Exact 25px bottom gap using base spacing */
    padding-bottom: var(--spacing-base);
    overflow: visible; /* allow inner shadows to render */
}

/* In contact detail mode, remove bottom padding so content uses full height */
#people-page.contact-detail-mode .page-container {
    padding-bottom: 0;
}

#people-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    /* Allow card box-shadow to render outside its bounds */
    overflow: visible;
}

/* When showing contact details, make the content area scrollable so widgets stay inside the container */
#people-page.contact-detail-mode .page-content {
    overflow-y: auto;
    overflow-x: hidden;
    min-height: 0;
    padding-bottom: var(--spacing-base); /* 25px bottom breathing room for last widget */
}

/* Remove extra space at bottom in contact detail mode */
#people-page.contact-detail-mode #contact-detail-view > *:last-child {
    margin-bottom: 0;
}

/* Account Detail: exact bottom spacing when scrolled to bottom */
#account-details-page .page-content {
    padding-bottom: 25px; /* ensure 25px space below last card */
}
#account-details-page #account-detail-view > *:last-child {
    margin-bottom: 0; /* avoid extra margin stacking below the last section */
}

#people-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
    /* Allow popovers anchored inside to render rounded corners and shadows */
    overflow: visible;
}

#people-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* === ACCOUNTS PAGE TABLE LAYOUT (pin footer to bottom) === */
#accounts-page .page-container {
    display: flex;
    flex-direction: column;
    /* Exact 25px bottom gap using base spacing */
    padding-bottom: var(--spacing-base);
    overflow: visible; /* allow inner shadows to render */
}

#accounts-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    /* Allow card box-shadow to render outside its bounds */
    overflow: visible;
}

#accounts-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
    /* Allow popovers anchored inside to render rounded corners and shadows */
    overflow: visible;
}

#accounts-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* === CALLS PAGE TABLE LAYOUT (pin footer to bottom) === */
#calls-page .page-container {
    display: flex;
    flex-direction: column;
    /* Exact 25px bottom gap using base spacing */
    padding-bottom: var(--spacing-base);
    overflow: visible; /* allow inner shadows to render */
}

#calls-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    /* Allow card box-shadow to render outside its bounds */
    overflow: visible;
}

#calls-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
}

#calls-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* === SEQUENCES PAGE TABLE LAYOUT (pin footer to bottom) === */
#sequences-page .page-container {
    display: flex;
    flex-direction: column;
    /* Exact 25px bottom gap using base spacing */
    padding-bottom: var(--spacing-base);
    overflow: visible; /* allow inner shadows to render */
}

#sequences-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    /* Allow card box-shadow to render outside its bounds */
    overflow: visible;
}

#sequences-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
}

#sequences-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* === LISTS PAGE TABLE LAYOUT (pin footer to bottom) === */
#lists-page .page-container {
    display: flex;
    flex-direction: column;
    /* Removed bottom padding to eliminate grey bar */
    padding-bottom: 0;
    overflow: visible; /* allow inner shadows to render */
}

#lists-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    /* Allow card box-shadow to render outside its bounds */
    overflow: visible;
}

#lists-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
}

#lists-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* Ensure the list detail view itself is a flex column so its footer can pin to the bottom */
#lists-page #lists-detail {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
}

/* Let the scroll area consume remaining space and scroll while footer stays pinned */
#lists-page #lists-detail .table-scroll {
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto;
}

/* === Lists page header layout: group back icon and title together === */
#lists-page .page-title-section {
    justify-content: flex-start; /* left-align children so title sits next to back button */
    align-items: center; /* vertically center icon and title */
    gap: var(--spacing-md); /* small gap between back icon and title */
}

#lists-page .page-title-section .page-actions {
    margin-left: auto; /* keep actions aligned to the right */
}

/* Ensure the title doesn't center itself */
#lists-page .page-title-section .page-title {
    margin: 0; /* no auto margins */
    text-align: left;
    flex: 0 0 auto; /* don't grow to center */
}

/* === Lists toolbar: swap Quick Search and Filters toggle positions === */
#lists-page #lists-header-toolbar {
    display: flex; /* already via .people-toolbar, but ensure flex here */
}
#lists-page #lists-header-toolbar #lists-view-toggle { order: 0; }
#lists-page #lists-header-toolbar #toggle-lists-filters { order: 1; }
#lists-page #lists-header-toolbar #lists-switch-btn { order: 2; }
#lists-page #lists-header-toolbar #lists-quick-search { order: 3; }

/* Lists page: subtle orange focus ring for quick search and chip inputs */
#lists-page .search-input-small:focus,
#lists-page .search-input-small:focus-visible {
    outline: none;
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
}

#lists-page .chip-input:focus-within {
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
}

/* Center empty state and add horizontal padding so border doesn't hit screen edges */
#lists-page .table-container.--empty {
    justify-content: center; /* vertical center (main axis in column) */
    align-items: center;    /* horizontal center */
    padding-left: var(--spacing-base);
    padding-right: var(--spacing-base);
}

#lists-page .page-content.--empty .empty-state {
    max-width: 500px !important;
    width: 100% !important;
    text-align: center !important;
    z-index: 10 !important;
}

#lists-page .page-content.--empty {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-height: calc(100vh - 240px) !important;
    padding: 0 !important;
    margin: 0 !important;
    width: 100% !important;
    position: relative !important;
}

/* Web Insights page layout/centering */
#insights-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    overflow: visible; /* allow shadows to render */
}

#insights-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    margin-bottom: 0;
}

#insights-page .table-container .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
}

/* Center the empty state within the container */
#insights-page .table-container.--empty {
    justify-content: center; /* vertical center (main axis in column) */
    align-items: center;      /* horizontal center */
    padding-left: var(--spacing-base);
    padding-right: var(--spacing-base);
}

#insights-page .table-container.--empty .empty-state {
    align-self: center; /* prevent stretch */
    width: 100%;
    max-width: 820px;
}

.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: calc(var(--spacing-base) * 2);
    border: 1px dashed var(--border-light);
    border-radius: var(--border-radius);
    background: var(--bg-card);
    color: var(--text-secondary);
    min-height: 240px;
}
.empty-title {
    color: var(--text-inverse);
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-sm);
}
.empty-desc {
    max-width: 640px;
    margin-bottom: var(--spacing-base);
}
.empty-actions {
    display: flex;
    gap: var(--spacing-sm);
}

/* Create List Popover */
.create-list-popover {
    position: fixed; /* set by JS */
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border-dark);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    padding: var(--spacing-md);
    z-index: 1100; /* above top bar */
}

.create-list-popover .popover-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.create-list-popover .form-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.create-list-popover label {
    font-size: 12px;
    color: var(--text-muted);
}

.create-list-popover .input-dark {
    height: 36px;
    background: var(--bg-item);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius-sm);
    padding: 6px 10px;
    outline: none;
    transition: border-color var(--transition-fast);
}

.create-list-popover .input-dark:focus {
    border-color: var(--border-medium);
}

.create-list-popover select.input-dark {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: linear-gradient(45deg, transparent 50%, var(--text-secondary) 50%),
                      linear-gradient(135deg, var(--text-secondary) 50%, transparent 50%);
    background-position: calc(100% - 18px) 50%, calc(100% - 12px) 50%;
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
    padding-right: 28px;
}

.create-list-popover .actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}

/* Lists overview grid */
#lists-page .page-content.lists-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: var(--spacing-base);
    padding: var(--spacing-base) var(--spacing-base) var(--spacing-base) var(--spacing-base);
    overflow-y: auto;
    max-height: calc(100vh - 200px);
}

/* Delete confirmation modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1200;
}

.modal-content {
    background: var(--bg-card);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-modal);
    max-width: 400px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-base) var(--spacing-lg);
    border-bottom: 1px solid var(--border-light);
}

.modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-inverse);
}

.modal-body {
    padding: var(--spacing-lg);
    color: var(--text-inverse);
}

.modal-body p {
    margin: 0 0 var(--spacing-base) 0;
}

.modal-body p:last-child {
    margin-bottom: 0;
}

.modal-actions {
    padding: var(--spacing-base) var(--spacing-lg) var(--spacing-lg) var(--spacing-lg);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}

/* === GENERIC APP MODAL (pc-modal) === */
.pc-modal[hidden] { display: none !important; }
.pc-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 1300; /* above popovers and bulk bars */
}
.pc-modal__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.45);
    backdrop-filter: blur(1.5px);
}
.pc-modal__dialog {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 520px;
    max-width: calc(100vw - 40px);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    color: var(--text-inverse);
    overflow: hidden; /* keep rounded corners on children */
}
.pc-modal__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-base) var(--spacing-lg);
    border-bottom: 1px solid var(--border-light);
}
.pc-modal__header .card-title { margin: 0; font-size: 1.1rem; letter-spacing: 0.2px; }
.pc-modal__close {
    background: none;
    border: 1px solid transparent;
    color: var(--grey-400);
    font-size: 1.25rem;
    line-height: 1;
    width: 28px;
    height: 28px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
}
.pc-modal__close:hover { color: var(--text-inverse); border-color: var(--border-light); background: var(--grey-700); }
.pc-modal__body { padding: var(--spacing-lg); }
.pc-modal__body label { display:block; margin-bottom: 6px; }
.pc-modal__body .help-text { color: var(--text-muted); font-size: 0.8rem; margin-top: 6px; }
.pc-modal input[type="text"] {
    background: var(--grey-700);
    border: 1px solid var(--grey-600);
    color: var(--text-inverse);
    border-radius: var(--border-radius);
    padding: 10px var(--spacing-md);
    height: 38px;
    outline: none;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
}
.pc-modal input[type="text"]::placeholder { color: var(--grey-400); }
.pc-modal input[type="text"]:hover { background: var(--grey-680, #545b62); }
.pc-modal input[type="text"]:focus {
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
    background: var(--grey-650, #5a6168);
}
.pc-modal input[type="checkbox"] {
    accent-color: var(--orange-subtle);
    width: 16px; height: 16px;
}
.pc-modal__footer {
    padding: var(--spacing-base) var(--spacing-lg) var(--spacing-lg) var(--spacing-lg);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}
.pc-modal .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
.pc-modal .form-row {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}
.pc-modal label { color: var(--text-secondary); font-size: 0.9rem; }
.pc-modal input[type="text"],
.pc-modal input[type="email"],
.pc-modal input[type="tel"],
.pc-modal input[type="url"] { width: 100%; }

@media (max-width: 560px) {
    .pc-modal__dialog { width: calc(100vw - 20px); }
}

.btn-danger {
    background: #dc3545;
    color: white;
    border: 1px solid #dc3545;
    padding: var(--spacing-sm) var(--spacing-base);
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-danger:hover {
    background: #c82333;
    border-color: #c82333;
}

.btn-danger:disabled {
    background: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
}

.list-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    padding: var(--spacing-base);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    color: var(--text-inverse);
    height: 160px; /* Fixed height to prevent vertical stretching */
}
.list-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.list-card-title { 
    font-weight: 600; 
    font-size: 1rem; 
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.list-card-count { 
    color: var(--text-secondary); 
    font-size: 0.9rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.list-card-meta {
    display: flex;
    flex-wrap: nowrap;
    gap: 8px 16px;
    color: var(--text-secondary);
    font-size: 0.85rem;
    white-space: nowrap;
    overflow: hidden;
}
.list-card-actions {
    margin-top: auto;
    display: flex;
    gap: var(--spacing-sm);
}

.table-pagination .page-btn {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-inverse);
    border-radius: var(--border-radius-sm);
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: var(--transition-fast);
}

.table-pagination .page-btn:hover:not(:disabled) {
    background: var(--grey-700);
}

.table-pagination .page-btn.active {
    background: var(--orange-muted);
    border-color: var(--orange-subtle);
}

.table-pagination .page-btn:disabled {
    opacity: 0.5;
    cursor: default;
}

.table-pagination .page-ellipsis {
    padding: 0 4px;
    opacity: 0.7;
}

/* === TASKS PAGE TABLE LAYOUT (pin footer to bottom) === */
#tasks-page .page-container {
    display: flex;
    flex-direction: column;
    /* Exact 25px bottom gap using base spacing */
    padding-bottom: var(--spacing-base);
    overflow: visible; /* allow inner shadows to render */
}

#tasks-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow children to flex properly */
    padding-bottom: 0; /* ensure table container touches bottom of page container */
    overflow: visible;
}

#tasks-page .table-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    /* No extra external margin; page-container padding defines the gap */
    margin-bottom: 0;
    /* Match other pages: clip inner overflow, keep card shadow */
    overflow: hidden;
}

#tasks-page .table-scroll {
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto; /* only table content scrolls */
}

#tasks-page .table-footer {
    margin-top: auto; /* push footer to bottom of table container */
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    /* Standard footer padding to match other pages */
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-card);
    border-top: 1px solid var(--border-light);
}

.task-info {
    display: flex;
    flex-direction: column;
}

.task-title {
    font-weight: 500;
    margin-bottom: 4px;
}

.task-subtitle {
    font-size: 0.75rem;
    color: var(--grey-400);
}

.action-buttons {
    display: flex;
    gap: 8px;
}

/* === BADGES === */
.type-badge, .priority-badge, .status-badge {
    padding: 4px 8px;
    border-radius: var(--border-radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: lowercase;
}

.type-badge.call {
    background: var(--blue-muted);
    color: var(--blue-subtle);
}

.type-badge.email {
    background: var(--blue-muted);
    color: var(--blue-subtle);
}

.type-badge.follow-up {
    background: var(--yellow-muted);
    color: var(--yellow-subtle);
}

.type-badge.demo {
    background: var(--green-muted);
    color: var(--green-subtle);
}

.type-badge.linkedin-connect,
.type-badge.linkedin-message,
.type-badge.linkedin-view,
.type-badge.linkedin-interact {
    background: #0077b5;
    color: var(--text-inverse);
}

.priority-badge.low {
    background: var(--grey-700);
    color: var(--grey-200);
}

.priority-badge.medium {
    background: var(--yellow-muted);
    color: var(--yellow-subtle);
}

.priority-badge.high {
    background: var(--red-muted);
    color: var(--red-subtle);
}

.status-badge.completed {
    background: var(--green-muted);
    color: var(--green-subtle);
}

.status-badge.pending {
    background: var(--yellow-muted);
    color: var(--yellow-subtle);
}

/* === WIDGET PANEL === */
.widget-panel {
    flex: 1;
    width: var(--widget-panel-width);
    background: var(--bg-widget);
    border-left: 1px solid var(--border-light);
    overflow-y: auto;
}

.widget-content {
    padding: var(--spacing-base);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-base);
}

.widget-card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    box-shadow: var(--elevation-card);
}

/* Notes widget structure */
.widget-card-header {
    display: flex;
    align-items: center; /* center items vertically for even top/bottom padding */
    justify-content: space-between;
    gap: 8px;
    margin-bottom: var(--spacing-md);
}
.widget-card-header .widget-title { margin: 0; }
.notes-body {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

/* Notes-specific padding to give breathing room for header X and footer buttons */
.notes-card {
  /* Match base widget-card padding for uniform spacing */
  padding: var(--spacing-md, 12px);
}

.notes-footer {
  margin-top: var(--spacing-sm, 8px);
}

/* Notes widget mount animation helper */
.notes-anim {
  will-change: height, opacity, transform;
}
@media (prefers-reduced-motion: reduce) {
  .notes-anim { will-change: auto; }
}

/* Notes widget: orange focus ring on textarea */
.widget-card .notes-textarea:focus,
.widget-card .focus-orange {
  outline: none !important;
  border-color: var(--orange-subtle) !important;
  box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25) !important;
}

.widget-title {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--text-primary);
}

.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.action-btn {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    padding: var(--spacing-sm);
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    cursor: pointer;
    transition: var(--transition-fast);
    text-align: left;
}

.action-btn:hover {
    background: var(--grey-600);
    transform: translateY(-1px);
}

/* === WIDGET LISTS === */
.tasks-list, .news-list, .leads-list, .activities-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.task-item, .news-item, .lead-item, .activity-item {
    padding: var(--spacing-sm);
    background: var(--bg-item);
    border-radius: var(--border-radius-sm);
    transition: var(--transition-fast);
}

.task-item:hover, .news-item:hover, .lead-item:hover, .activity-item:hover {
    background: var(--grey-600);
}

.task-name, .news-title, .lead-name {
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 0.875rem;
}

.task-time, .news-time {
    font-size: 0.75rem;
    color: var(--text-muted);
}

/* === PRICE WIDGET === */
.price-display {
    text-align: center;
}

.current-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--orange-subtle);
}

.price-unit {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.price-change {
    font-size: 0.875rem;
    font-weight: 600;
}

.price-change.positive {
    color: #28a745;
}

.price-change.negative {
    color: #dc3545;
}

/* === ACTIVITY ICONS === */
.activity-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-right: var(--spacing-sm);
}

.activity-icon.call {
    background: #28a745;
}

.activity-icon.email {
    background: var(--blue-subtle);
}

/* === DEALS BOARD (KANBAN) === */
#deals-page .page-container {
    display: flex;
    flex-direction: column;
    padding-bottom: var(--spacing-base);
    overflow: visible;
}

#deals-page .page-content {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow inner flex children to size properly */
    padding-bottom: 0;
    overflow: visible;
}

/* Outer wrapper that scrolls horizontally */
.board-container {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    padding: var(--spacing-base);
    overflow-x: auto;
    overflow-y: hidden;
    display: flex;                 /* ensure inner board stretches full height */
    height: clamp(420px, calc(100vh - 320px), 72vh); /* fixed visual height to preserve bottom spacing */
}

/* The lane strip */
.deals-board {
    display: flex;
    gap: var(--spacing-base);
    min-height: 320px;
    align-items: stretch;          /* make columns equal height */
}

.deal-column {
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    min-width: 280px;
    max-width: 320px;
    display: flex;
    flex-direction: column;
    height: 100%;                  /* Global Search Modal Styles */
}

/* Ensure any element with [hidden] is never displayed */
[hidden] {
  display: none !important;
}

.global-search-modal {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
    max-width: 90vw;
    background: #3a3f47;
    border: 1px solid #4a5058;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    z-index: 2000;
    max-height: 500px;
    overflow: hidden;
}

.search-modal-content {
  padding: 0 !important;
  margin: 0 !important;

    display: flex;
    flex-direction: column;
    height: 100%;
}

.search-results-container {
    flex: 1;
    overflow-y: auto;
    max-height: 500px;
    width: 100%;
    box-sizing: border-box;
    padding-right: 0;
}

.search-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 20px;
    min-height: 120px;
    color: var(--color-text-secondary);
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid var(--color-border);
    border-top: 2px solid var(--color-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.search-results {
    padding: 0;
}

.search-category {
    background: var(--bg-item);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-sm);
    overflow: hidden; /* keep rounded corners on inner elements */
    margin: var(--spacing-sm);
}

/* extra bottom space after last category */
.search-category:last-child {
    margin-bottom: var(--spacing-sm);
}

.category-header {
    padding: 12px 20px;
    background: transparent; /* match light grey container */
    border-bottom: 1px solid var(--color-border);
    font-weight: 600;
    font-size: 12px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.category-results {
    padding: 0;
}

.search-result-item {
    padding: 12px 20px;
    border-bottom: 1px solid var(--color-border-light);
    cursor: pointer;
    transition: background-color 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.search-result-item:hover {
    background: var(--color-bg-hover);
}

.search-result-item:last-child {
    border-bottom: none;
}

.result-main {
    flex: 1;
    min-width: 0;
}

.result-title {
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 4px 0;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.result-subtitle {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.result-actions {
    display: flex;
    gap: 8px;
    margin-left: 12px;
    opacity: 0;
    transition: opacity 0.15s ease;
}

.search-result-item:hover .result-actions {
    opacity: 1;
}

.result-action-btn {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 11px;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
}

.result-action-btn:hover {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

.search-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 40px;
    text-align: center;
}

.empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-text {
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 8px 0;
    font-size: 16px;
}

.empty-subtext {
    color: var(--color-text-secondary);
    font-size: 14px;
    margin: 0;
}

/* Deals Board Styles */
.board-container {
    height: clamp(420px, calc(100vh - 320px), 72vh);
    overflow-x: auto;
    overflow-y: hidden;
}

.deals-board {
    display: flex;
    gap: 25px;
    height: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0 25px 25px 25px;
}

.board-stage {
    min-width: 300px;
    width: 300px;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    height: fit-content;
    max-height: calc(100vh - 200px);
}

.stage-header {
    padding: 16px;
    border-bottom: 1px solid var(--color-border);
    background: var(--color-bg-primary);
    border-radius: 8px 8px 0 0;
}

.stage-title {
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 4px 0;
    font-size: 14px;
}

.stage-count {
    font-size: 12px;
    color: var(--color-text-secondary);
}

.stage-cards {
    padding: 16px;
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.deal-card {
    background: transparent; /* let inner body provide the surface */
    border: none;            /* only inner body shows a border */
    border-radius: 6px;
    padding: 6px;            /* tighter spacing around the inner body */
    cursor: grab;
    transition: all 0.2s ease;
}

.deal-card:hover {
    border-color: var(--color-border); /* keep consistent, no highlight */
    box-shadow: none; /* remove phantom outer shadow */
}

.deal-card:focus,
.deal-card:focus-visible {
    outline: none;
    box-shadow: none;
}

.deal-card.dragging {
    opacity: 0.9;
    cursor: grabbing;
    background: transparent; /* keep outer transparent while dragging */
    border: 1px solid var(--color-primary); /* clear drag outline */
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}

/* New class names used by scripts/pages/deals.js */
.deal-column-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--color-border);
    background: var(--bg-item);
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.deal-column-title {
    font-weight: 600;
    color: var(--color-text-primary);
}

.deal-count {
    font-size: 12px;
    color: var(--color-text-secondary);
}

.deal-list {
    padding: 12px;           /* reduce inner padding of the list */
    flex: 1;
    overflow-y: auto;
    display: flex;           /* control spacing via gap */
    flex-direction: column;
    gap: 8px;                /* tighter space between cards */
}

.drop-target-highlight {
    background: rgba(59, 130, 246, 0.1);
    outline: 2px dashed var(--color-primary);
    outline-offset: -6px;
    border-radius: 6px;
}

.deal-card-title {
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 8px 0;
    font-size: 14px;
}

.deal-card-subtitle {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin: 0 0 8px 0;
}

.deal-card-meta {
    display: flex;
    gap: 12px;
    font-size: 11px;
    color: var(--color-text-tertiary);
}

/* Unified inner body container with border, shadow, darker background */
.deal-card-body {
    background: var(--color-bg-secondary); /* darker than card */
    /* Stronger, always-visible 1px outline with safe fallbacks */
    border: 1px solid var(--color-border-strong, var(--color-border, rgba(255,255,255,0.16)));
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.25); /* single shadow only */
    padding: 10px 12px;
    width: 100%;
    box-sizing: border-box;
}

/* Remove gaps between lines inside the body */
.deal-card-body .deal-card-title,
.deal-card-body .deal-card-subtitle,
.deal-card-body .deal-card-meta {
    margin: 0;           /* no extra spacing between lines */
    padding: 0;          /* ensure tight stack */
    border: none;        /* undo previous border style */
    background: none;
}

/* Red dotted insertion marker for drop position (full rectangle) */
.deal-drop-placeholder {
    border: 2px dotted #ff4d4f;
    height: 60px; /* JS syncs this to the dragged card's height */
    border-radius: 6px;
    width: 100%;
    box-sizing: border-box;
    pointer-events: none;
    background: transparent;
}

/* Custom drag ghost container (different color than its list container) */
.deal-card-ghost {
    position: absolute;
    top: -10000px; /* keep offscreen */
    left: -10000px;
    padding: 12px;
    border-radius: 6px;
    background: var(--color-bg-secondary);
    border: 2px solid var(--color-primary);
    box-shadow: 0 12px 32px rgba(0,0,0,0.35);
    color: var(--color-text-primary);
    pointer-events: none;
    z-index: 9999;
}

.deal-title {
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 8px 0;
    font-size: 14px;
}

.deal-company {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin: 0 0 8px 0;
}

.deal-value {
    font-weight: 600;
    color: var(--color-success);
    font-size: 14px;
    margin: 0 0 8px 0;
}

.deal-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
    color: var(--color-text-tertiary);
}

.stage-cards.drag-over {
    background: rgba(59, 130, 246, 0.1);
    border-radius: 6px;
}

/* === CONTACT DETAIL STYLES === */
.contact-detail {
    display: contents; /* flatten wrapper: children render directly in parent flow */
}
.contact-detail-container {
    height: 100%;
    overflow-y: auto;
    background: var(--bg-container);
    border: 1px solid var(--border-light);
    border-top: 0;
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    padding: var(--spacing-base);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-base);
}

/* Avoid double bottom spacing inside contact detail flow */
.contact-detail-container > .page-content {
    padding-bottom: 0;
}

/* Remove the nested page-header styles since header is now at root level */

.contact-header-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.contact-header-profile {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.avatar-circle-small {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--orange-subtle);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.contact-header-text {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.contact-page-title {
    margin: 0;
    font-size: 1.5rem;
}

.contact-subtitle {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

.linkedin-header-btn {
    margin-left: var(--spacing-sm);
}

.contact-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
}

.back-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    background: transparent;
    border: 1px solid var(--border-light);
    color: var(--text-secondary);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.back-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: var(--border-medium);
}

/* Icon-only square back button */
.back-btn--icon {
    width: 36px;
    height: 36px;
    min-width: 36px;
    min-height: 36px;
    padding: 0;           /* remove text padding */
    gap: 0;               /* no gap since icon-only */
    display: flex;
    align-items: center;
    justify-content: center;
}
.back-btn--icon svg {
    width: 18px;
    height: 18px;
}

.contact-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.contact-profile-section {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
    padding: var(--spacing-lg);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    max-width: 100%;
}

.contact-avatar {
    flex-shrink: 0;
}

.avatar-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--orange-subtle);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.contact-basic-info {
    flex: 1;
}

.contact-name {
font-size: 1.75rem;
font-weight: 600;
color: var(--text-primary);
}

/* Overrides: dropdown and preview picker use compact title size */
#contact-search-results .contact-name,
.contact-search-results .contact-name,
.contact-result .contact-name { 
font-size: 0.82rem; 
line-height: 1.2; 
}

.preview-results .title { 
font-size: 0.82rem; 
}

/* Compact Add button inside search dropdown */
#contact-search-results .btn-add-contact,
.contact-search-results .btn-add-contact {
padding: 2px 10px;
font-size: 11px;
}

/* Ensure action area doesn't shrink or overlap */
.contact-result .contact-action { flex: 0 0 auto; }

.contact-title-company {
font-size: 1rem;
color: var(--text-secondary);
margin-bottom: var(--spacing-md);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-md);
}

.contact-quick-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.quick-action-btn {
    width: 36px;
    height: 36px;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-light);
    background: var(--bg-item);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.quick-action-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: var(--border-medium);
}

.contact-details-grid {
    margin-bottom: var(--spacing-xl);
}

.contact-info-section {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-base);
    box-shadow: var(--elevation-card);
    max-width: 100%;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 var(--spacing-md) 0;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
}

.info-row {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Account Detail: links inside info values */
#account-detail-view .info-value a {
    color: var(--text-primary);
    text-decoration: none;
    outline: none;
    transition: color var(--transition-fast), text-decoration-color var(--transition-fast), text-underline-offset var(--transition-fast), text-decoration-thickness var(--transition-fast), text-shadow var(--transition-fast);
}
#account-detail-view .info-value a:visited {
    color: var(--text-primary); /* avoid default visited purple */
}
#account-detail-view .info-value a:hover {
    color: var(--text-inverse);
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
    text-shadow: 0 0 6px rgba(255, 255, 255, 0.25);
}
#account-detail-view .info-value a:focus { outline: none; }
#account-detail-view .info-value a:focus-visible {
    color: var(--text-inverse);
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
    text-shadow: 0 0 6px rgba(255, 255, 255, 0.25);
}

.info-value {
    font-size: 0.9rem;
    color: var(--text-primary);
    word-break: break-word;
}

/* Hover-edit and copy actions for contact info */
.info-value-wrap {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding-right: 64px; /* space for action buttons */
}
.info-value-text {
    cursor: pointer; /* click-to-copy */
}
/* Contact detail: keep long values (like email) on one line with ellipsis */
#contact-detail-view .info-value-wrap { max-width: 100%; display: flex; width: 100%; padding-right: 0; align-items: center; min-height: 24px; }
#contact-detail-view .info-value .info-value-text {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    word-break: normal; /* override parent break-word */
    min-width: 0;       /* allow flex shrink */
    flex: 1 1 auto;     /* occupy available space next to actions */
}
/* Keep consistent line height to avoid vertical jump on hover */
#contact-detail-view .info-value { line-height: 24px; }
/* In contact detail, show actions to the right without overlapping text */
#contact-detail-view .info-actions {
    position: static;
    right: auto;
    top: auto;
    transform: none;
    margin-left: 6px;
    display: none; /* do not reserve space until hover */
}
#contact-detail-view .info-value-wrap:hover .info-actions,
#contact-detail-view .info-value-wrap:focus-within .info-actions {
    display: inline-flex;
}
.info-actions {
    position: absolute;
    right: 8px;
    top: 50%; transform: translateY(-50%);
    display: inline-flex;
    gap: 6px;
    background: transparent;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-fast, 120ms) ease;
}
.info-value-wrap:hover .info-actions,
.info-value-wrap.editing .info-actions {
    opacity: 1;
    pointer-events: auto;
}

/* Compact icon button style */
.icon-btn-sm {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border-radius: 6px;
    border: 1px solid var(--border-light);
    background: transparent;
    color: var(--text-muted);
    padding: 0;
    cursor: pointer;
    box-sizing: border-box; /* keep total size 24x24 including border */
    transition: background var(--transition-fast, 120ms), color var(--transition-fast, 120ms), border-color var(--transition-fast, 120ms), box-shadow var(--transition-fast, 120ms);
}
.icon-btn-sm:hover {
    background: var(--grey-600);
    color: var(--text-inverse);
    border-color: var(--grey-500);
    box-shadow: none;
}
.icon-btn-sm svg { pointer-events: none; }

/* Editing input */
.info-edit-input {
    width: 100%;
    max-width: 100%;
    border: 1px solid var(--border-medium);
    background: var(--bg-input, #171717);
    color: var(--text-primary);
    border-radius: var(--border-radius);
    padding: 6px 8px;
    outline: none;
}
.info-edit-input:focus {
    border-color: var(--orange-subtle);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.25);
}

.contact-activity-section {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    padding: var(--spacing-lg);
    margin: 0 0 var(--spacing-base);
    box-shadow: var(--elevation-card);
    max-width: 100%;
}

.activity-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
}

.activity-timeline {
    min-height: 120px;
}

.activity-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-xl);
    color: var(--text-muted);
    text-align: center;
}

.placeholder-icon {
    margin-bottom: var(--spacing-sm);
    opacity: 0.5;
}

.placeholder-text {
    font-size: 0.9rem;
}

/* Make contact names clickable in people table */
#people-table .name-cell {
    cursor: pointer;
    color: var(--grey-400);
    font-weight: 400;
    text-decoration: none;
    outline: none;
    transition: var(--transition-fast);
}

#people-table .name-cell:hover {
    color: var(--text-inverse);
    text-decoration: none;
}

/* Keyboard focus: mirror hover without rectangle */
#people-table .name-cell:focus {
    outline: none;
}
#people-table .name-cell:focus-visible {
    color: var(--text-inverse);
    text-decoration: none;
}

/* People table: name cell layout with initials avatar */
#people-table .name-cell .name-cell__wrap {
    display: inline-flex;
    align-items: center;
    gap: 10px;
}
#people-table .name-cell .avatar-initials {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--orange-subtle);
    color: #fff;
    display: grid;
    place-items: center; /* ensures optical centering for 12 letters */
    line-height: 1;
    font-weight: 600;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    flex-shrink: 0;
}
#people-table .name-cell .name-text {
    display: inline-block;
}

/* People table: company favicon + name */
#people-table td .company-cell__wrap {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
#people-table td .company-favicon {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    flex-shrink: 0;
    object-fit: cover;
}
#people-table td .company-name {
    display: inline-block;
}

/* Accounts table: make account names behave like People names (subtle brighten, no underline) */
#accounts-table .acct-link {
    cursor: pointer;
    color: var(--grey-400);
    font-weight: 400;
    text-decoration: none;
    outline: none;
    transition: var(--transition-fast);
    display: inline-block;
}
#accounts-table .acct-link:hover {
    color: var(--text-inverse);
    text-decoration: none;
}
#accounts-table .acct-link:focus { outline: none; }
#accounts-table .acct-link:focus-visible {
    color: var(--text-inverse);
    text-decoration: none;
}

/* Accounts table: company favicon + name layout (mirror People table) */
#accounts-table .name-cell .company-cell__wrap {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
#accounts-table .name-cell .company-favicon {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    flex-shrink: 0;
    object-fit: cover;
}
#accounts-table .name-cell .name-text {
    display: inline-block;
}

/* People table: make company names clickable with subtle brighten (match contact hover) */
#people-table .company-link {
    cursor: pointer;
    color: var(--grey-400);
    font-weight: 400;
    text-decoration: none;
    outline: none;
    transition: var(--transition-fast);
    display: inline-block;
}
#people-table .company-link:hover {
    color: var(--text-inverse);
    text-decoration: none;
}
#people-table .company-link:focus { outline: none; }
#people-table .company-link:focus-visible {
    color: var(--text-inverse);
    text-decoration: none;
}

/* Contact Detail header: company link subtle hover (match People/Accounts) */
#contact-detail-header .company-link {
    cursor: pointer;
    color: var(--grey-400);
    font-weight: 400;
    text-decoration: none;
    outline: none;
    transition: var(--transition-fast);
}
#contact-detail-header .company-link:hover {
    color: var(--text-inverse);
    text-decoration: none;
}
#contact-detail-header .company-link:focus { outline: none; }
#contact-detail-header .company-link:focus-visible {
    color: var(--text-inverse);
    text-decoration: none;
}

/* Contact Detail header: square, centered Widgets icon button */
#contact-detail-header #open-widgets {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;   /* match quick-action icon size */
    height: 36px;  /* enforce perfect square */
    padding: 0;    /* remove default button padding */
    line-height: 0; /* prevent baseline offset */
    box-sizing: border-box; /* include border in total size */
    border-radius: var(--border-radius);
    vertical-align: middle;
}
#contact-detail-header #open-widgets svg {
    width: 18px;
    height: 18px;
    display: block; /* avoid inline SVG baseline spacing */
    pointer-events: none;
}

/* Prevent hover translate on this icon-only primary button */
#contact-detail-header #open-widgets:hover {
    transform: none;
}

/* Widgets drawer container and slide-out behavior */
#contact-detail-header .widgets-wrap {
    position: relative;
    display: inline-flex;
    align-items: center;
    /* Hover bridge to the left so users can move into the drawer without losing hover */
    padding-left: 16px;
    margin-left: -16px; /* neutralize layout shift */
}
#contact-detail-header .widgets-drawer {
    position: absolute;
    top: 50%;
    right: 100%;
    transform: translateY(-50%) translateX(0); /* flush to button */
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    background: var(--grey-700);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    padding: 6px;
    display: inline-flex;
    gap: 6px;
    z-index: 5;
    transition: opacity var(--transition-fast), transform var(--transition-fast), visibility var(--transition-fast);
}
#contact-detail-header .widgets-wrap:hover .widgets-drawer,
#contact-detail-header .widgets-wrap:focus-within .widgets-drawer,
#contact-detail-header .widgets-wrap.open .widgets-drawer {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateY(-50%) translateX(0); /* keep flush while visible */
}

/* Widget icon buttons inside drawer */
#contact-detail-header .widgets-drawer .widget-item {
    width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
}
#contact-detail-header .widgets-drawer .widget-item:hover {
    background: var(--grey-600);
    color: var(--text-inverse);
    border-color: var(--grey-500);
}
#contact-detail-header .widgets-drawer .widget-item:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
#contact-detail-header .widgets-drawer .widget-item svg {
    width: 18px;
    height: 18px;
    display: block;
    pointer-events: none;
}

/* People table: company favicon + name layout (mirror Accounts table) */
#people-table .company-cell__wrap {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
#people-table .company-favicon {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    flex-shrink: 0;
    object-fit: cover;
}
#people-table .company-name {
    display: inline-block;
}

/* === VARIABLES MODAL === */
.vars-modal {
    width: 720px;
    max-width: calc(100% - 48px);
    background: var(--grey-800);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    box-shadow: var(--elevation-card);
    color: var(--text-inverse);
}
.vars-modal .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-md) var(--spacing-base);
    border-bottom: 1px solid var(--border-light);
}
.vars-modal .title-wrap { display: flex; flex-direction: column; gap: 2px; }
.vars-modal .title { font-size: 1.05rem; font-weight: 600; }
.vars-modal .subtitle { color: var(--text-secondary); font-size: 0.9rem; }
.vars-modal .close-btn {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    width: 32px;
    height: 32px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
}
.vars-modal .close-btn:hover { background: var(--grey-700); }
.vars-modal .close-btn:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }
.vars-modal .body { padding: var(--spacing-base); max-height: min(70vh, 640px); overflow: auto; }

.vars-tabs { display: flex; gap: 8px; margin-bottom: var(--spacing-md); }
.vars-tab {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--grey-300);
    padding: 6px 10px;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.85rem;
}
.vars-tab:hover { background: var(--grey-700); color: var(--text-inverse); }
.vars-tab.active { background: var(--grey-700); color: var(--text-inverse); border-color: var(--grey-600); }
.vars-tab:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }

.vars-panels { display: block; }
.vars-panel { margin-top: 0; }
.vars-panel[aria-hidden="true"] { display: none; }

.var-list {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
}
.var-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 10px 12px;
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    color: var(--text-inverse);
    cursor: pointer;
    transition: var(--transition-fast);
}
.var-item:hover { background: var(--grey-700); }
.var-item:focus-visible { outline: 2px solid var(--orange-muted); outline-offset: 2px; }
.var-item-label { font-weight: 500; }
.var-item-token { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color: var(--grey-300); }

/* Inline variable chip used in rich editor */
.var-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    line-height: 1;
    color: var(--text-inverse);
    background: var(--orange-subtle);
    border: 1px solid rgba(255, 107, 53, 0.35);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.12);
    font-weight: 600;
    user-select: none;
    -webkit-user-select: none;
}

.var-chip:hover {
    background: #e55a2b; /* matches call button hover */
}

/* HTML editor badge and container */
.html-editor-wrap { position: relative; }
.html-editor-wrap .textarea-dark { padding-top: 26px; }
.html-mode-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    line-height: 1;
    color: var(--text-inverse);
    background: var(--yellow-muted);
    border: 1px solid var(--border-light);
    box-shadow: var(--shadow-sm);
    pointer-events: none;
}

/* === PHONE CALL STEP: SKIP SETTINGS === */
/* Scoped to phone-call step so other checkboxes remain unchanged */
.step-card[data-type="phone-call"] .form-row { margin-top: 8px; }
.step-card[data-type="phone-call"] .fmt-label {
    color: var(--text-secondary);
    font-weight: 600;
    margin-bottom: 6px;
}
.step-card[data-type="phone-call"] .checkbox-row {
    display: flex;
    align-items: center;
    gap: 14px;
    margin: 6px 0;
}
.step-card[data-type="phone-call"] .checkbox-row label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--text-primary);
    cursor: pointer;
}
.step-card[data-type="phone-call"] .checkbox-row input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--orange-subtle);
    cursor: pointer;
}
.step-card[data-type="phone-call"] .checkbox-row input[type="checkbox"]:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
/* number input next to skip checkbox */
.step-card[data-type="phone-call"] .checkbox-row .call-skip-after-days {
    width: 82px; /* fits 3 digits comfortably */
    text-align: center;
    padding: 6px 8px;
}
.step-card[data-type="phone-call"] .checkbox-row .call-skip-after-days:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* LinkedIn task checkbox styling - match phone call styling */
.step-card[data-type="li-connect"] .checkbox-row,
.step-card[data-type="li-message"] .checkbox-row,
.step-card[data-type="li-view-profile"] .checkbox-row,
.step-card[data-type="li-interact-post"] .checkbox-row {
    display: flex;
    align-items: center;
    gap: 14px;
    margin: 6px 0;
}
.step-card[data-type="li-connect"] .checkbox-row label,
.step-card[data-type="li-message"] .checkbox-row label,
.step-card[data-type="li-view-profile"] .checkbox-row label,
.step-card[data-type="li-interact-post"] .checkbox-row label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--text-primary);
    cursor: pointer;
}
.step-card[data-type="li-connect"] .checkbox-row input[type="checkbox"],
.step-card[data-type="li-message"] .checkbox-row input[type="checkbox"],
.step-card[data-type="li-view-profile"] .checkbox-row input[type="checkbox"],
.step-card[data-type="li-interact-post"] .checkbox-row input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--orange-subtle); /* Match other checkboxes */
    cursor: pointer;
}
.step-card[data-type="li-connect"] .checkbox-row input[type="checkbox"]:focus-visible,
.step-card[data-type="li-message"] .checkbox-row input[type="checkbox"]:focus-visible,
.step-card[data-type="li-view-profile"] .checkbox-row input[type="checkbox"]:focus-visible,
.step-card[data-type="li-interact-post"] .checkbox-row input[type="checkbox"]:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}
/* number input next to LinkedIn skip checkbox */
.step-card[data-type="li-connect"] .checkbox-row .linkedin-skip-after-days,
.step-card[data-type="li-message"] .checkbox-row .linkedin-skip-after-days,
.step-card[data-type="li-view-profile"] .checkbox-row .linkedin-skip-after-days,
.step-card[data-type="li-interact-post"] .checkbox-row .linkedin-skip-after-days {
    width: 82px; /* fits 3 digits comfortably */
    text-align: center;
    padding: 6px 8px;
}
.step-card[data-type="li-connect"] .checkbox-row .linkedin-skip-after-days:disabled,
.step-card[data-type="li-message"] .checkbox-row .linkedin-skip-after-days:disabled,
.step-card[data-type="li-view-profile"] .checkbox-row .linkedin-skip-after-days:disabled,
.step-card[data-type="li-interact-post"] .checkbox-row .linkedin-skip-after-days:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
/* phone call note textarea placeholder styling */
.step-card[data-type="phone-call"] .call-note::placeholder {
    color: var(--grey-400);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* LinkedIn task note textarea styling - match phone call styling */
.step-card[data-type="li-connect"] .linkedin-note::placeholder,
.step-card[data-type="li-message"] .linkedin-note::placeholder,
.step-card[data-type="li-view-profile"] .linkedin-note::placeholder,
.step-card[data-type="li-interact-post"] .linkedin-note::placeholder {
    color: var(--grey-400);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* === DRAG AND DROP FOR SEQUENCE STEPS === */
.step-item {
    position: relative;
    cursor: default; /* keep normal cursor until drag actually starts */
    transition: transform 0.2s ease, opacity 0.2s ease;
}

.step-item:active {
    cursor: default;
}

.step-card {
    cursor: default; /* avoid hand cursor over email editor before drag */
}

.step-card:active {
    cursor: default;
}

.step-item.dragging {
    opacity: 0.7;
    transform: rotate(2deg);
    z-index: 1000;
    pointer-events: none;
}

.step-item.drag-ghost {
    opacity: 0.3;
}

/* Drop zone indicator */
.step-drop-indicator {
    height: 4px;
    background: #ff4d4f;
    border-radius: 2px;
    margin: 8px 0;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.step-drop-indicator.active {
    opacity: 1;
}

/* Red dotted placeholder showing drop position */
.step-drop-placeholder {
    border: 2px dotted #ff4d4f;
    border-radius: 8px;
    margin: 12px 0;
    background: rgba(255, 77, 79, 0.05);
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff4d4f;
    font-size: 0.9rem;
    font-weight: 500;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.step-drop-placeholder.active {
    opacity: 1;
}

.step-drop-placeholder::after {
    content: "Drop step here";
}

/* Disable text selection during drag */
body.dragging-steps, body.dragging-steps * {
    user-select: none !important;
    -webkit-user-select: none !important;
    -ms-user-select: none !important;
}

/* Global: orange checkmark for selectable row checkboxes */
input.row-select[type="checkbox"] {
    accent-color: var(--orange-subtle);
}
input.row-select[type="checkbox"]:focus-visible {
    outline: 2px solid var(--orange-muted);
    outline-offset: 2px;
}

/* === RESPONSIVE DESIGN === */
@media (max-width: 1200px) {
    .stat-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .search-input {
        width: 300px;
    }
}

@media (max-width: 768px) {
    .content-area {
        flex-direction: column;
    }
    
    .widget-panel {
        flex: none;
        height: 300px;
    }
    
    .stat-cards {
        grid-template-columns: 1fr;
    }
}

/* === GLOBAL CUSTOM TOOLTIP === */
.pc-tooltip {
  position: fixed; /* positioned by JS */
  z-index: 10000;
  background: var(--grey-900);
  color: var(--text-inverse);
  border: 1px solid var(--border-dark);
  border-radius: var(--border-radius-sm);
  box-shadow: var(--elevation-card);
  padding: 6px 8px;
  font-size: 12px;
  line-height: 1.25;
  max-width: min(320px, calc(100vw - 16px));
  opacity: 0;               /* JS toggles to 1 */
  visibility: hidden;       /* JS toggles to visible */
  pointer-events: none;     /* never capture mouse */
  white-space: nowrap;
  transition: opacity var(--transition-fast), transform var(--transition-fast), visibility var(--transition-fast);
  --arrow-size: 8px;
}

.pc-tooltip.visible { visibility: visible; }

/* Tooltip arrow (uses same border/fill layering pattern as popovers) */
.pc-tooltip::before,
.pc-tooltip::after {
  content: "";
  position: absolute;
  width: var(--arrow-size);
  height: var(--arrow-size);
  transform: rotate(45deg);
  pointer-events: none;
}

/* When placed above the anchor (arrow on bottom edge of tooltip) */
.pc-tooltip[data-placement="top"]::before {
  bottom: calc(-1 * var(--arrow-size) / 2 + 1px);
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  background: var(--border-dark);
}
.pc-tooltip[data-placement="top"]::after {
  bottom: calc(-1 * var(--arrow-size) / 2 + 2px);
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  background: var(--grey-900);
}

/* When placed below the anchor (arrow on top edge of tooltip) */
.pc-tooltip[data-placement="bottom"]::before {
  top: calc(-1 * var(--arrow-size) / 2 + 1px);
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  background: var(--border-dark);
}
.pc-tooltip[data-placement="bottom"]::after {
  top: calc(-1 * var(--arrow-size) / 2 + 2px);
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  background: var(--grey-900);
}

/* === CONTACT TITLE INLINE ACTIONS === */
.contact-title-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.contact-title-row .title-actions {
  display: flex;
  align-items: center;
  gap: 6px;
  overflow: hidden;              /* prevent layout jump */
  max-width: 0;                  /* collapsed by default */
  opacity: 0;
  transform: translateX(-4px);
  transition: max-width var(--transition-fast), opacity var(--transition-fast), transform var(--transition-fast);
}

.contact-title-row:hover .title-actions,
.contact-title-row:focus-within .title-actions {
  max-width: 160px;              /* enough room for 3 small icon buttons */
  opacity: 1;
  transform: translateX(0);
}

/* Name input focus ring aligns with app accent preference */
input.contact-name-input.input-dark:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--orange-muted);
}
