<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Choosers CRM</title>
    <meta name="description" content="Power Choosers CRM - Manage your energy procurement accounts and customer relationships">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://powerchoosers.com/crm-dashboard">
    <meta property="og:title" content="Power Choosers CRM">
    <meta property="og:description" content="Manage your energy procurement accounts and customer relationships">
    <meta property="og:image" content="https://raw.githubusercontent.com/powerchoosers/power-choosers-crm/main/Images/City%20Choosers.png">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://powerchoosers.com/crm-dashboard">
    <meta property="twitter:title" content="Power Choosers CRM">
    <meta property="twitter:description" content="Manage your energy procurement accounts and customer relationships">
    <meta property="twitter:image" content="https://raw.githubusercontent.com/powerchoosers/power-choosers-crm/main/Images/City%20Choosers.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" href="https://cdn.prod.website-files.com/6801ddaf27d1495f8a02fd3f/68645bd391ea20fecb011c85_2656%20Webclip%20PChoosers.png" type="image/png">
    <!-- Twilio Voice SDK for browser calling -->
    <script src="https://unpkg.com/@twilio/voice-sdk@2.11.0/dist/twilio.min.js"></script>
    <!-- Algolia Search Library -->
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script>
        // Verify SDK loading
        window.addEventListener('load', () => {
            if (typeof Twilio !== 'undefined' && Twilio.Device) {
                console.log('[Twilio] SDK loaded successfully from unpkg CDN');
            } else {
                console.error('[Twilio] SDK failed to load from unpkg CDN');
            }
        });
    </script>
    <script>
        // API base will be set later based on environment
    </script>
    <script>
        // Algolia Configuration
        window.ALGOLIA_CONFIG = {
          appId: '63BBAAFSUC',
          searchApiKey: 'e0a748084186656052dd3de543547f8b',
          indices: {
            contacts: 'contacts',
            accounts: 'accounts'
          }
        };
        console.log('[Algolia] Configuration loaded');
    </script>
    <script>
        // Optional: Configure your Twilio/Business phone numbers so Calls page can identify the counterparty correctly
        // Set via devtools once and it will persist (example):
        // localStorage.setItem('CRM_BUSINESS_NUMBERS', JSON.stringify(['+18176630380', '+19728342317']))
        (function(){
          try {
            const raw = localStorage.getItem('CRM_BUSINESS_NUMBERS');
            const nums = Array.isArray(JSON.parse(raw || '[]')) ? JSON.parse(raw || '[]') : [];
            if (nums.length) {
              window.CRM_BUSINESS_NUMBERS = nums;
              console.log('[CRM] Business numbers:', nums);
            }
          } catch (e) { /* ignore */ }
        })();
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <img src="https://cdn.prod.website-files.com/6801ddaf27d1495f8a02fd3f/68645bd391ea20fecb011c85_2656%20Webclip%20PChoosers.png" alt="Power Choosers Logo" class="logo">
                <h1 class="app-title">Power Choosers CRM</h1>
            </div>
            <div class="top-bar-center">
                <div class="search-container">
                    <input type="text" placeholder="Search accounts, people, or anything..." class="search-input">
                    <button class="search-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                </div>
                <button class="call-btn" id="header-call-btn" title="Open Phone">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                </button>
            </div>
            <div class="top-bar-right">
                <button class="icon-btn" id="scripts-btn" title="Phone Scripts">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                </button>
                <button class="icon-btn" id="refresh-data-btn" title="Refresh Data">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
                <div class="notification-container">
                    <button class="icon-btn" id="notifications-btn" title="Notifications">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                    <!-- Notification Dropdown -->
                    <div class="notification-dropdown" id="notification-dropdown" hidden>
                        <div class="notification-header">
                            <h3>Notifications</h3>
                            <button class="mark-all-read" id="mark-all-read">Mark all as read</button>
                        </div>
                        <div class="notification-list" id="notification-list">
                            <!-- Notifications will be populated here -->
                        </div>
                        <div class="notification-footer">
                            <button class="view-all-btn" id="view-all-notifications">View all notifications</button>
                        </div>
                    </div>
                </div>
                <div class="profile-container">
                    <button class="profile-btn" id="profile-btn" title="Account">
                        <img id="user-profile-pic" class="profile-pic" src="" alt="Profile" style="display: none;">
                        <div class="profile-avatar" id="profile-avatar-fallback">LP</div>
                    </button>
                    <!-- Profile Dropdown -->
                    <div class="profile-dropdown" id="profile-dropdown" hidden>
                        <div class="profile-dropdown-header">
                            <img id="user-profile-pic-large" class="profile-pic-large" src="" alt="Profile">
                            <div class="profile-info">
                                <div class="profile-name" id="user-profile-name">Loading...</div>
                                <div class="profile-email" id="user-profile-email">Loading...</div>
                            </div>
                        </div>
                        <div class="profile-dropdown-divider"></div>
                        <button class="profile-dropdown-item" id="logout-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign out
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Toast Container -->
        <div class="toast-container" id="toast-container"></div>

        <!-- Global Search Modal -->
        <div id="global-search-modal" class="global-search-modal" hidden>
            <div class="search-modal-content">
                <div class="search-results-container">
                    <div class="search-loading" id="search-loading" hidden>
                        <div class="loading-spinner"></div>
                        <span>Searching...</span>
                    </div>
                    <div class="search-results" id="search-results"></div>
                    <div class="search-empty" id="search-empty" hidden>
                        <div class="empty-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="8" stroke="white" stroke-width="2"/><line x1="21" y1="21" x2="16.65" y2="16.65" stroke="white" stroke-width="2"/></svg></div>
                        <div class="empty-text">No results found</div>
                        <div class="empty-subtext">Try adjusting your search terms</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Overlay -->
        <div id="login-overlay" class="login-overlay" style="display: flex;">
            <div class="login-card">
                <img src="https://cdn.prod.website-files.com/6801ddaf27d1495f8a02fd3f/68645bd391ea20fecb011c85_2656%20Webclip%20PChoosers.png" alt="Power Choosers Logo" class="login-logo">
                <h1 class="login-title">Power Choosers CRM</h1>
                <p class="login-subtitle">Sign in to access your dashboard</p>
                <button class="google-signin-btn" id="google-signin-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>
                <div id="login-error" class="login-error" style="display: none;"></div>
                <p class="login-footer">Secure authentication powered by Google</p>
            </div>
        </div>

        <!-- CRM Content (hidden until authenticated) -->
        <div id="crm-content">
        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar -->
            <nav class="sidebar" id="sidebar">
                <div class="sidebar-content">
                    <a href="#dashboard" class="nav-item active" data-page="dashboard">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span class="nav-text">Dashboard</span>
                    </a>
                    <a href="#people" class="nav-item" data-page="people">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span class="nav-text">People</span>
                    </a>
                    <a href="#accounts" class="nav-item" data-page="accounts">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1"></path>
                        </svg>
                        <span class="nav-text">Accounts</span>
                    </a>
                    <a href="#lists" class="nav-item" data-page="lists">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="4" cy="6" r="1"></circle>
                            <circle cx="4" cy="12" r="1"></circle>
                            <circle cx="4" cy="18" r="1"></circle>
                            <line x1="8" y1="6" x2="20" y2="6"></line>
                            <line x1="8" y1="12" x2="20" y2="12"></line>
                            <line x1="8" y1="18" x2="20" y2="18"></line>
                        </svg>
                        <span class="nav-text">Lists</span>
                    </a>
                    <a href="#calls" class="nav-item" data-page="calls">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <span class="nav-text">Calls</span>
                    </a>
                    <a href="#emails" class="nav-item" data-page="emails">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        <span class="nav-text">Emails</span>
                    </a>
                    <a href="#sequences" class="nav-item" data-page="sequences">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="7 4 20 12 7 20 7 4"></polygon>
                        </svg>
                        <span class="nav-text">Sequences</span>
                    </a>
                    <a href="#tasks" class="nav-item" data-page="tasks">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9,11 12,14 22,4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        <span class="nav-text">Tasks</span>
                    </a>
                    <a href="#deals" class="nav-item" data-page="deals">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        <span class="nav-text">Deals</span>
                    </a>
                    <!-- moved Tasks nav item up under Sequences -->
                    <a href="#insights" class="nav-item" data-page="insights">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                        </svg>
                        <span class="nav-text">Web Insights</span>
                    </a>
                    <div class="nav-divider"></div>
                    <a href="#client-management" class="nav-item" data-page="client-management">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span class="nav-text">Client Management</span>
                    </a>
                    <a href="#agents" class="nav-item admin-only" data-page="agents" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span class="nav-text">Agents</span>
                    </a>
                    <a href="#settings" class="nav-item" data-page="settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        <span class="nav-text">Settings</span>
                    </a>
                </div>
            </nav>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Main Content Section -->
                <main class="main-content" id="main-content">
                    <!-- Dashboard Page (Scrollable) -->
                    <div class="page active" id="dashboard-page" data-page="dashboard">
                        <div class="dashboard-content">
                            <!-- Stat Cards -->
                            <div class="stat-cards">
                                <div class="stat-card">
                                    <div class="stat-value">0</div>
                                    <div class="stat-label">Open Deals</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">$89,420</div>
                                    <div class="stat-label">Monthly Revenue</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">2.4M</div>
                                    <div class="stat-label">Total kWh Managed</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">$0.089</div>
                                    <div class="stat-label">TX Avg Price/kWh</div>
                                </div>
                            </div>

                            <!-- Dashboard Cards -->
                            <div class="dashboard-card">
                                <h3 class="card-title">Suggested Leads</h3>
                                <div class="leads-list">
                                    <div class="lead-item">
                                        <div class="lead-info">
                                            <div class="lead-name">Acme Manufacturing</div>
                                            <div class="lead-details">Industrial • 500kW avg usage</div>
                                        </div>
                                        <div class="lead-score">92%</div>
                                    </div>
                                    <div class="lead-item">
                                        <div class="lead-info">
                                            <div class="lead-name">Downtown Office Complex</div>
                                            <div class="lead-details">Commercial • 300kW avg usage</div>
                                        </div>
                                        <div class="lead-score">87%</div>
                                    </div>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <h3 class="card-title">Recent Activities</h3>
                                <div class="activities-list" id="home-activity-timeline">
                                    <div class="activity-placeholder">
                                        <div class="loading-spinner"></div>
                                        <div class="placeholder-text">Loading activities...</div>
                                    </div>
                                </div>
                                <div class="activity-pagination" id="home-activity-pagination" style="display: none;">
                                    <button class="activity-pagination-btn" id="home-activity-prev" disabled>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="15,18 9,12 15,6"/>
                                        </svg>
                                    </button>
                                    <button class="activity-pagination-btn page-btn active" id="home-activity-page">1</button>
                                    <button class="activity-pagination-btn" id="home-activity-next" disabled>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="9,18 15,12 9,6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sequences Page (Container-based) -->
                    <div class="page" id="sequences-page" data-page="sequences">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Sequences</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="create-sequence-btn">Create sequence</button>
                                    </div>
                                </div>
                                <div class="people-toolbar">
                                    <button class="action-btn" id="toggle-sequences-filters">
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                        <span class="filter-count-badge" id="sequences-filter-count" hidden>0</span>
                                    </button>
                                    <input type="text" class="search-input-small" id="sequences-quick-search" placeholder="Search sequences..." aria-label="Quick search" />
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="sequences-table" aria-label="Sequences">
                                            <thead>
                                                <tr>
                                                    <th class="col-select">Activate</th>
                                                    <th>Name</th>
                                                    <th>Created By</th>
                                                    <th>Active</th>
                                                    <th>Paused</th>
                                                    <th>Not Sent</th>
                                                    <th>Bounced</th>
                                                    <th>Spam Blocked</th>
                                                    <th>Finished</th>
                                                    <th>Scheduled</th>
                                                    <th>Delivered</th>
                                                    <th>Reply</th>
                                                    <th>Interested</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populated by sequences.js -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="table-footer">
                                        <div id="sequences-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                        <div id="sequences-pagination" class="table-pagination" aria-label="Sequences pagination"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sequence Builder Page (Placeholder) -->
                    <div class="page" id="sequence-builder-page" data-page="sequence-builder">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Sequence Builder</h2>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="empty-state">
                                    <div class="empty-title">Sequence builder</div>
                                    <div class="empty-desc">Select or create a sequence to begin building. This is a placeholder inspired by Apollo.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Call Scripts Page (Container-based) -->
                    <div class="page" id="call-scripts-page" data-page="call-scripts">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <div class="page-title-row">
                                        <button class="back-btn back-btn--icon" id="call-scripts-back-to-previous" aria-label="Back to previous page" title="Back to previous page">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                                            </svg>
                                        </button>
                                        <h2 class="page-title">Call Scripts</h2>
                                    </div>
                                    <div class="page-actions"></div>
                                </div>
                                <div class="people-toolbar" id="call-scripts-toolbar">
                                    <button class="action-btn" id="call-scripts-back" title="Back">Back</button>
                                    <button class="action-btn" id="call-scripts-restart" title="Restart">Restart</button>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="script-display" id="call-scripts-display">Click "Dial" to begin the call.</div>
                                <div class="response-buttons" id="call-scripts-responses"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Sequence Create Modal -->
                    <div id="sequence-create-modal" class="pc-modal" role="dialog" aria-modal="true" aria-labelledby="sequence-create-title" hidden>
                        <div class="pc-modal__backdrop"></div>
                        <div class="pc-modal__dialog">
                            <div class="pc-modal__header">
                                <h3 id="sequence-create-title" class="card-title">Create sequence</h3>
                                <button type="button" class="pc-modal__close" id="sequence-modal-close" aria-label="Close">&#215;</button>
                            </div>
                            <div class="pc-modal__body">
                                <div class="form-row" style="flex-direction: column;">
                                    <label for="sequence-name-input">Sequence name</label>
                                    <input type="text" id="sequence-name-input" placeholder="e.g., Warm Outreach Q3" autocomplete="off" aria-describedby="sequence-name-help" />
                                    <div id="sequence-name-help" class="help-text">Give your sequence a short, descriptive name.</div>
                                </div>
                                <div class="form-row" style="align-items: center;">
                                    <label style="display:flex; align-items:center; gap: var(--spacing-sm);">
                                        <input type="checkbox" id="sequence-biz-hours" />
                                        Confirm messaging during business hours
                                    </label>
                                </div>
                            </div>
                            <div class="pc-modal__footer">
                                <button type="button" class="btn-secondary" id="sequence-modal-cancel">Back</button>
                                <button type="button" class="btn-primary" id="sequence-modal-create">Create</button>
                            </div>
                        </div>
                    </div>

                    <!-- Calls Page (Container-based) -->
                    <div class="page" id="calls-page" data-page="calls">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Calls</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="log-call-btn">Log Call</button>
                                    </div>
                                </div>
                                <div class="people-toolbar">
                                    <button class="action-btn" id="toggle-calls-filters">
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                        <span class="filter-count-badge" id="calls-filter-count" hidden>0</span>
                                    </button>
                                    <input type="text" class="search-input-small" id="calls-quick-search" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                                <div class="filter-panel" id="calls-filters" hidden>
                                    <div class="filter-tabs-row">
                                        <button class="filter-tab active" data-mode="simple">Simple</button>
                                        <button class="filter-tab" data-mode="advanced">Advanced</button>
                                    </div>
                                    <div class="filter-grid" data-mode="simple">
                                        <div class="filter-field">
                                            <label for="calls-filter-city">City</label>
                                            <div class="chip-input" id="calls-filter-city-chip">
                                                <div class="chip-list" id="calls-filter-city-chips"></div>
                                                <input type="text" id="calls-filter-city" class="chip-input-field" placeholder="e.g., Austin, Dallas" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-city-clear" aria-label="Clear city filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-city-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-title">Job title</label>
                                            <div class="chip-input" id="calls-filter-title-chip">
                                                <div class="chip-list" id="calls-filter-title-chips"></div>
                                                <input type="text" id="calls-filter-title" class="chip-input-field" placeholder="e.g., manager, director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-title-clear" aria-label="Clear title filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-title-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-company">Company</label>
                                            <div class="chip-input" id="calls-filter-company-chip">
                                                <div class="chip-list" id="calls-filter-company-chips"></div>
                                                <input type="text" id="calls-filter-company" class="chip-input-field" placeholder="e.g., Acme Corp" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-company-clear" aria-label="Clear company filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-company-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-state">State</label>
                                            <div class="chip-input" id="calls-filter-state-chip">
                                                <div class="chip-list" id="calls-filter-state-chips"></div>
                                                <input type="text" id="calls-filter-state" class="chip-input-field" placeholder="e.g., TX, CA" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-state-clear" aria-label="Clear state filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-state-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-employees">Employees</label>
                                            <div class="chip-input" id="calls-filter-employees-chip">
                                                <div class="chip-list" id="calls-filter-employees-chips"></div>
                                                <input type="text" id="calls-filter-employees" class="chip-input-field" placeholder="e.g., 1-10, 50, 500+" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-employees-clear" aria-label="Clear employees filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-employees-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-industry">Industry</label>
                                            <div class="chip-input" id="calls-filter-industry-chip">
                                                <div class="chip-list" id="calls-filter-industry-chips"></div>
                                                <input type="text" id="calls-filter-industry" class="chip-input-field" placeholder="e.g., Industrial, Retail" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-industry-clear" aria-label="Clear industry filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-industry-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-visitor-domain">Website visitors (domain)</label>
                                            <div class="chip-input" id="calls-filter-visitor-domain-chip">
                                                <div class="chip-list" id="calls-filter-visitor-domain-chips"></div>
                                                <input type="text" id="calls-filter-visitor-domain" class="chip-input-field" placeholder="e.g., powerchoosers.com" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-visitor-domain-clear" aria-label="Clear website visitor domains">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-visitor-domain-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-seniority">Seniority</label>
                                            <div class="chip-input" id="calls-filter-seniority-chip">
                                                <div class="chip-list" id="calls-filter-seniority-chips"></div>
                                                <input type="text" id="calls-filter-seniority" class="chip-input-field" placeholder="e.g., Senior, Manager, Director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-seniority-clear" aria-label="Clear seniority filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-seniority-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="calls-filter-department">Department</label>
                                            <div class="chip-input" id="calls-filter-department-chip">
                                                <div class="chip-list" id="calls-filter-department-chips"></div>
                                                <input type="text" id="calls-filter-department" class="chip-input-field" placeholder="e.g., Sales, Marketing, Engineering" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="calls-filter-department-clear" aria-label="Clear department filters">&#215;</button>
                                                <div class="chip-suggest" id="calls-filter-department-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field checkbox">
                                            <label><input type="checkbox" id="calls-filter-has-email" /> Has email</label>
                                        </div>
                                        <div class="filter-field checkbox">
                                            <label><input type="checkbox" id="calls-filter-has-phone" /> Has phone</label>
                                        </div>
                                    </div>
                                    <div class="filter-actions-row">
                                        <button class="btn-secondary" id="clear-calls-filters">Clear all</button>
                                        <button class="btn-primary" id="apply-calls-filters">Apply</button>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="calls-table" aria-label="Calls">
                                        <thead>
                                            <tr>
                                                <th class="col-select"><input type="checkbox" id="select-all-calls" aria-label="Select all calls"></th>
                                                <th>Contact</th>
                                                <th>Title</th>
                                                <th>Company</th>
                                                <th>Call Time</th>
                                                <th>Duration</th>
                                                <th>Outcome</th>
                                                <th>Insights</th>
                                                <th>Quick Actions</th>
                                                <th>Updated</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                             <!-- Populated by calls.js -->
                                         </tbody>
                                        </table>
                                    </div>
                                     <div class="table-footer">
                                         <div id="calls-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                         <div id="calls-pagination" class="table-pagination" aria-label="Calls pagination"></div>
                                     </div>
                                 </div>
                             </div>
                        </div>
                    </div>
                    <!-- Emails Page (Gmail-like Interface) -->
                    <div class="page" id="emails-page" data-page="emails">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Emails</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="compose-email-btn">Compose</button>
                                        <button class="btn-secondary" id="generate-scheduled-btn" style="display: none;">Generate Now</button>
                                    </div>
                                </div>
                                <div class="page-filters">
                                    <div class="filter-tabs">
                                        <button class="filter-tab active" data-folder="inbox">Inbox</button>
                                        <button class="filter-tab" data-folder="sent">Sent</button>
                                        <button class="filter-tab" data-folder="scheduled">Scheduled</button>
                                        <button class="filter-tab" data-folder="starred">Starred</button>
                                        <button class="filter-tab" data-folder="trash">Trash</button>
                                    </div>
                                    <div class="filter-actions">
                                        <input type="text" placeholder="Search emails..." class="search-input-small" id="emails-search">
                                        <button class="btn-text" id="clear-search-btn">Clear</button>
                                        <span class="results-count" id="emails-count">0 emails</span>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="emails-table">
                                            <thead>
                                                <tr>
                                                    <th class="col-select">
                                                        <input type="checkbox" class="row-select" id="select-all-emails">
                                                    </th>
                                                    <th>From</th>
                                                    <th>Subject</th>
                                                    <th>Date</th>
                                                    <th class="qa-cell">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="emails-tbody">
                                                <!-- Email rows will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="table-footer">
                                        <div class="pagination-summary">
                                            <span id="emails-summary">0 emails</span>
                                        </div>
                                        <div class="table-pagination" id="emails-pagination">
                                            <!-- Pagination will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Email Detail Page -->
                    <div class="page" id="email-detail-page" data-page="email-detail">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <button class="back-btn back-btn--icon" id="email-back-btn" aria-label="Back" title="Back">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                                        </svg>
                                    </button>
                                    <h2 class="page-title" id="email-detail-title">Email Subject</h2>
                                </div>
                                <div class="page-actions">
                                    <button class="btn-primary" id="regenerate-email-btn" style="display: none;">Regenerate Email</button>
                                    <button class="quick-action-btn" id="reply-btn" title="Reply" aria-label="Reply">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <polyline points="9,10 4,15 9,20"/>
                                            <path d="M20,4v7a4,4,0,0,1-4,4H4"/>
                                        </svg>
                                    </button>
                                    <button class="quick-action-btn" id="forward-btn" title="Forward" aria-label="Forward">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <polyline points="15,14 20,9 15,4"/>
                                            <path d="M4,20v-7a4,4,0,0,1,4-4h12"/>
                                        </svg>
                                    </button>
                                    <button class="quick-action-btn" id="delete-email-btn" title="Delete" aria-label="Delete">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <polyline points="3,6 5,6 21,6"/>
                                            <path d="M19,6l-1,14a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2L5,6"/>
                                            <path d="M10,11v6M14,11v6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="email-detail-container">
                                    <div class="email-detail-header">
                                        <div class="email-sender-info">
                                            <div class="sender-avatar" id="sender-avatar">
                                                <!-- Favicon will be inserted here -->
                                            </div>
                                            <div class="sender-details">
                                                <div class="sender-name" id="sender-name">Sender Name</div>
                                                <div class="sender-email" id="sender-email">sender@example.com</div>
                                            </div>
                                        </div>
                                        <div class="email-meta">
                                            <div class="email-date" id="email-date">Date</div>
                                            <div class="email-actions">
                                                <button class="btn-icon" id="star-email-btn" title="Star">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="email-detail-body">
                                        <div class="email-content" id="email-content">
                                            <!-- Email content will be inserted here -->
                                        </div>
                                    </div>
                                    <!-- Gmail-style Reply/Forward Compose Container -->
                                    <div class="email-reply-container" id="email-reply-container" style="display: none;">
                                        <div class="email-reply-header">
                                            <div class="email-reply-recipient">
                                                <div class="reply-avatar">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="12" cy="7" r="4"></circle>
                                                    </svg>
                                                </div>
                                                <div class="reply-arrow">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="9,10 4,15 9,20"></polyline>
                                                        <path d="M20,4v7a4,4,0,0,1-4,4H4"></path>
                                                    </svg>
                                                </div>
                                                <div class="reply-to-info">
                                                    <input type="text" class="reply-to-input input-standard" id="reply-to-input" placeholder="To" readonly>
                                                    <button class="reply-cc-toggle" id="reply-cc-toggle" title="Cc, Bcc" type="button">
                                                        Cc Bcc
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="reply-cc-bcc" id="reply-cc-bcc" style="display: none;">
                                                <input type="text" class="reply-cc-input input-standard" id="reply-cc-input" placeholder="Cc">
                                                <input type="text" class="reply-bcc-input input-standard" id="reply-bcc-input" placeholder="Bcc">
                                            </div>
                                            <input type="text" class="reply-subject-input input-standard" id="reply-subject-input" placeholder="Subject">
                                        </div>
                                        <div class="email-reply-toolbar">
                                            <div class="reply-toolbar-left">
                                                <button class="toolbar-btn" data-action="formatting" title="Formatting" aria-label="Text formatting">Aa</button>
                                                <button class="toolbar-btn" data-action="attach" title="Attach files">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                                    </svg>
                                                </button>
                                                <button class="toolbar-btn" data-action="link" title="Insert link">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                                                    </svg>
                                                </button>
                                                <button class="toolbar-btn" data-action="image" title="Insert image">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                                        <polyline points="21,15 16,10 5,21"></polyline>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="reply-toolbar-right">
                                                <button class="toolbar-btn toolbar-ai" data-action="ai" title="Write with AI" aria-label="Write with AI">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 48 48">
                                                        <path fill="white" d="M23.426,31.911l-1.719,3.936c-0.661,1.513-2.754,1.513-3.415,0l-1.719-3.936	c-1.529-3.503-4.282-6.291-7.716-7.815l-4.73-2.1c-1.504-0.668-1.504-2.855,0-3.523l4.583-2.034	c3.522-1.563,6.324-4.455,7.827-8.077l1.741-4.195c0.646-1.557,2.797-1.557,3.443,0l1.741,4.195	c1.503,3.622,4.305,6.514,7.827,8.077l4.583,2.034c1.504,0.668,1.504,2.855,0,3.523l-4.73,2.1	C27.708,25.62,24.955,28.409,23.426,31.911z"></path>
                                                        <path fill="white" d="M38.423,43.248l-0.493,1.131c-0.361,0.828-1.507,0.828-1.868,0l-0.493-1.131	c-0.879-2.016-2.464-3.621-4.44-4.5l-1.52-0.675c-0.822-0.365-0.822-1.56,0-1.925l1.435-0.638c2.027-0.901,3.64-2.565,4.504-4.65	l0.507-1.222c0.353-0.852,1.531-0.852,1.884,0l0.507,1.222c0.864,2.085,2.477,3.749,4.504,4.65l1.435,0.638	c0.822,0.365,0.822,1.56,0,1.925l-1.52,0.675C40.887,39.627,39.303,41.232,38.423,43.248z"></path>
                                                    </svg>
                                                </button>
                                                <button class="toolbar-btn" data-action="more" title="More options">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="1"></circle>
                                                        <circle cx="19" cy="12" r="1"></circle>
                                                        <circle cx="5" cy="12" r="1"></circle>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                        <!-- AI bar (hidden by default, slides down below toolbar) -->
                                        <div class="ai-bar reply-ai-bar" aria-hidden="true">
                                            <div class="ai-inner">
                                                <div class="ai-row">
                                                    <textarea class="ai-prompt input-dark" rows="3" 
                                                              placeholder="Describe the reply you want... (leave empty for AI to generate based on email thread)"></textarea>
                                                </div>
                                                <div class="ai-row actions">
                                                    <button class="fmt-btn ai-generate" data-mode="standard">Generate Standard</button>
                                                    <button class="fmt-btn ai-generate" data-mode="html">Generate HTML</button>
                                                    <div class="ai-status" aria-live="polite"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Formatting bar (hidden by default, slides down below toolbar) -->
                                        <div class="formatting-bar reply-formatting-bar" aria-hidden="true">
                                            <button class="fmt-btn" data-fmt="bold" title="Bold" aria-label="Bold">
                                                <span class="fmt-glyph">B</span>
                                            </button>
                                            <button class="fmt-btn" data-fmt="italic" title="Italic" aria-label="Italic">
                                                <span class="fmt-glyph" style="font-style:italic;">I</span>
                                            </button>
                                            <button class="fmt-btn" data-fmt="underline" title="Underline" aria-label="Underline">
                                                <span class="fmt-glyph" style="text-decoration:underline;">U</span>
                                            </button>
                                            <div class="formatting-divider"></div>
                                            <button class="fmt-btn" data-fmt="insertUnorderedList" title="Bullet list">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                                </svg>
                                            </button>
                                            <button class="fmt-btn" data-fmt="insertOrderedList" title="Numbered list">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <line x1="10" y1="6" x2="21" y2="6"></line>
                                                    <line x1="10" y1="12" x2="21" y2="12"></line>
                                                    <line x1="10" y1="18" x2="21" y2="18"></line>
                                                    <line x1="4" y1="6" x2="4" y2="6"></line>
                                                    <line x1="4" y1="12" x2="4" y2="12"></line>
                                                    <line x1="4" y1="18" x2="4" y2="18"></line>
                                                </svg>
                                            </button>
                                        </div>
                                        <!-- Link bar (hidden by default, slides down below toolbar) -->
                                        <div class="link-bar reply-link-bar" aria-hidden="true">
                                            <input type="text" class="link-text-input input-standard" data-link-text placeholder="Link text">
                                            <input type="url" class="link-url-input input-standard" data-link-url placeholder="URL">
                                            <button class="fmt-btn" data-link-insert type="button">Insert</button>
                                            <button class="fmt-btn" data-link-cancel type="button">Cancel</button>
                                        </div>
                                        <div class="email-reply-body">
                                            <div class="reply-body-input" contenteditable="true" id="reply-body-input" role="textbox" aria-multiline="true" placeholder=""></div>
                                        </div>
                                        <div class="email-reply-footer">
                                            <div class="reply-actions">
                                                <button class="btn-primary reply-send-btn" id="reply-send-btn">Send</button>
                                                <button class="reply-discard-btn" id="reply-discard-btn" title="Discard">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="3,6 5,6 21,6"></polyline>
                                                        <path d="M19,6l-1,14a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2L5,6"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deals Page (Container-based, Kanban board) -->
                    <div class="page" id="deals-page" data-page="deals">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Deals</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="add-deal-btn">Add Deal</button>
                                    </div>
                                </div>
                                <div class="people-toolbar">
                                    <input type="text" class="search-input-small" id="deals-quick-search" placeholder="Search deals..." aria-label="Quick search" />
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="board-container">
                                    <div class="deals-board" id="deals-board" aria-label="Deals board"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tasks Page (Container-based) -->
                    <div class="page" id="tasks-page" data-page="tasks">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">All Tasks</h2>
                                    <div class="page-actions">
                                        <button class="btn-secondary">Sequences</button>
                                        <button class="btn-primary create-task-btn">Create Task</button>
                                    </div>
                                </div>
                                <div class="page-filters">
                                    <div class="filter-tabs">
                                        <button class="filter-tab active">All your tasks</button>
                                        <button class="filter-tab">Phone Tasks</button>
                                        <button class="filter-tab">Email Tasks</button>
                                        <button class="filter-tab">LinkedIn Tasks</button>
                                        <button class="filter-tab">Overdue Tasks</button>
                                    </div>
                                    <div class="filter-actions">
                                        <input type="text" placeholder="Search tasks..." class="search-input-small">
                                        <button class="btn-text">Clear</button>
                                        <span class="results-count">25 tasks</span>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="tasks-table" aria-label="Tasks">
                                            <thead>
                                                <tr>
                                                    <th class="col-select"><input type="checkbox" id="select-all-tasks" aria-label="Select all tasks"></th>
                                                    <th>Task</th>
                                                    <th>Type</th>
                                                    <th>Priority</th>
                                                    <th>Due Date</th>
                                                    <th>Time</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Populated by tasks.js -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="table-footer">
                                        <div id="tasks-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                        <div id="tasks-pagination" class="table-pagination" aria-label="Tasks pagination"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other pages will follow the same container pattern -->
                    <!-- Web Insights Page (Container-based) -->
                    <div class="page" id="insights-page" data-page="insights">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Web Insights</h2>
                                </div>
                                <div class="people-toolbar">
                                    <input type="text" class="search-input-small" id="insights-quick-search" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container --empty">
                                    <div id="insights-empty-state" class="empty-state">
                                        <div class="empty-title">Web Insights</div>
                                        <div class="empty-desc">See which companies are visiting your website. Integration coming soon.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="page" id="people-page" data-page="people">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">People</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="add-contact-btn">Add Contact</button>
                                    </div>
                                </div>
                                <div class="people-toolbar">
                                    <button class="action-btn" id="toggle-people-filters">
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                        <span class="filter-count-badge" id="people-filter-count" hidden>0</span>
                                    </button>
                                    <input type="text" class="search-input-small" id="people-quick-search" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                                <div class="filter-panel" id="people-filters" hidden>
                                    <div class="filter-tabs-row">
                                        <button class="filter-tab active" data-mode="simple">Simple</button>
                                        <button class="filter-tab" data-mode="advanced">Advanced</button>
                                    </div>
                                    <div class="filter-grid" data-mode="simple">
                                        <div class="filter-field">
                                            <label for="filter-city">City</label>
                                            <div class="chip-input" id="filter-city-chip">
                                                <div class="chip-list" id="filter-city-chips"></div>
                                                <input type="text" id="filter-city" class="chip-input-field" placeholder="e.g., Austin, Dallas" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-city-clear" aria-label="Clear city filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-city-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-title">Job title</label>
                                            <div class="chip-input" id="filter-title-chip">
                                                <div class="chip-list" id="filter-title-chips"></div>
                                                <input type="text" id="filter-title" class="chip-input-field" placeholder="e.g., manager, director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-title-clear" aria-label="Clear title filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-title-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-company">Company</label>
                                            <div class="chip-input" id="filter-company-chip">
                                                <div class="chip-list" id="filter-company-chips"></div>
                                                <input type="text" id="filter-company" class="chip-input-field" placeholder="e.g., Acme Corp" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-company-clear" aria-label="Clear company filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-company-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-state">State</label>
                                            <div class="chip-input" id="filter-state-chip">
                                                <div class="chip-list" id="filter-state-chips"></div>
                                                <input type="text" id="filter-state" class="chip-input-field" placeholder="e.g., TX, CA" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-state-clear" aria-label="Clear state filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-state-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-employees">Employees</label>
                                            <div class="chip-input" id="filter-employees-chip">
                                                <div class="chip-list" id="filter-employees-chips"></div>
                                                <input type="text" id="filter-employees" class="chip-input-field" placeholder="e.g., 1-10, 50, 500+" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-employees-clear" aria-label="Clear employees filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-employees-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-industry">Industry</label>
                                            <div class="chip-input" id="filter-industry-chip">
                                                <div class="chip-list" id="filter-industry-chips"></div>
                                                <input type="text" id="filter-industry" class="chip-input-field" placeholder="e.g., Industrial, Retail" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-industry-clear" aria-label="Clear industry filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-industry-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-visitor-domain">Website visitors (domain)</label>
                                            <div class="chip-input" id="filter-visitor-domain-chip">
                                                <div class="chip-list" id="filter-visitor-domain-chips"></div>
                                                <input type="text" id="filter-visitor-domain" class="chip-input-field" placeholder="e.g., powerchoosers.com" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-visitor-domain-clear" aria-label="Clear website visitor domains">&#215;</button>
                                                <div class="chip-suggest" id="filter-visitor-domain-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-seniority">Seniority</label>
                                            <div class="chip-input" id="filter-seniority-chip">
                                                <div class="chip-list" id="filter-seniority-chips"></div>
                                                <input type="text" id="filter-seniority" class="chip-input-field" placeholder="e.g., Senior, Manager, Director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-seniority-clear" aria-label="Clear seniority filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-seniority-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-department">Department</label>
                                            <div class="chip-input" id="filter-department-chip">
                                                <div class="chip-list" id="filter-department-chips"></div>
                                                <input type="text" id="filter-department" class="chip-input-field" placeholder="e.g., Sales, Marketing, Engineering" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" aria-autocomplete="list" />
                                                <button type="button" class="chip-clear" id="filter-department-clear" aria-label="Clear department filters">&#215;</button>
                                                <div class="chip-suggest" id="filter-department-suggest" hidden></div>
                                            </div>
                                        </div>
                                        <div class="filter-field checkbox">
                                            <label><input type="checkbox" id="filter-has-email" /> Has email</label>
                                        </div>
                                        <div class="filter-field checkbox">
                                            <label><input type="checkbox" id="filter-has-phone" /> Has phone</label>
                                        </div>
                                    </div>
                                    <div class="filter-actions-row">
                                        <button class="btn-secondary" id="clear-people-filters">Clear all</button>
                                        <button class="btn-primary" id="apply-people-filters">Apply</button>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="people-table" aria-label="Contacts">
                                        <thead>
                                            <tr>
                                                <th class="col-select"><input type="checkbox" id="select-all-contacts" aria-label="Select all contacts"></th>
                                                <th>Name</th>
                                                <th>Title</th>
                                                <th>Company</th>
                                                <th>Email</th>
                                                <th>Phone</th>
                                                <th>Location</th>
                                                <th>Quick Actions</th>
                                                <th>Updated</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                             <!-- Populated by people.js -->
                                         </tbody>
                                        </table>
                                    </div>
                                     <div class="table-footer">
                                         <div id="people-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                         <div id="people-pagination" class="table-pagination" aria-label="Contacts pagination"></div>
                                     </div>
                                 </div>
                             </div>
                        </div>
                    </div>

                    <!-- Accounts Page (Container-based) -->
                    <div class="page" id="accounts-page" data-page="accounts">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Accounts</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="add-account-btn">Add Account</button>
                                    </div>
                                </div>
                                <div class="people-toolbar">
                                    <button class="action-btn" id="toggle-accounts-filters">
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                        <span class="filter-count-badge" id="accounts-filter-count" hidden>0</span>
                                    </button>
                                    <input type="text" class="search-input-small" id="accounts-quick-search" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                                <div class="filter-panel" id="accounts-filters" hidden>
                                    <div class="filter-tabs-row">
                                        <button class="filter-tab active" data-mode="simple">Simple</button>
                                        <button class="filter-tab" data-mode="advanced">Advanced</button>
                                    </div>
                                    <div class="filter-grid" data-mode="simple">
                                        <div class="filter-field">
                                            <label for="filter-acct-name">Account name</label>
                                            <input type="text" id="filter-acct-name" class="input-dark" placeholder="e.g., Acme Corp" />
                                        </div>
                                        <div class="filter-field">
                                            <label for="accounts-filter-industry">Industry</label>
                                            <input type="text" id="accounts-filter-industry" class="input-dark" placeholder="e.g., Industrial, Retail" />
                                        </div>
                                        <div class="filter-field">
                                            <label for="filter-domain">Domain</label>
                                            <input type="text" id="filter-domain" class="input-dark" placeholder="e.g., acme.com" />
                                        </div>
                                        <div class="filter-field checkbox">
                                            <label><input type="checkbox" id="filter-acct-has-phone" /> Has phone</label>
                                        </div>
                                    </div>
                                    <div class="filter-actions-row">
                                        <button class="btn-secondary" id="clear-accounts-filters">Clear all</button>
                                        <button class="btn-primary" id="apply-accounts-filters">Apply</button>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-scroll">
                                        <table class="data-table" id="accounts-table" aria-label="Accounts">
                                        <thead>
                                            <tr>
                                                <th class="col-select"><input type="checkbox" id="select-all-accounts" aria-label="Select all accounts"></th>
                                                <th>Account</th>
                                                <th>Industry</th>
                                                <th>Domain</th>
                                                <th>Company Phone</th>
                                                <th>Contract End Date</th>
                                                <th>Sq Ft</th>
                                                <th>Occupancy %</th>
                                                <th>Employees</th>
                                                <th>Location</th>
                                                <th>Quick Actions</th>
                                                <th>Updated</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                             <!-- Populated by accounts.js -->
                                         </tbody>
                                        </table>
                                    </div>
                                     <div class="table-footer">
                                         <div id="accounts-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                         <div id="accounts-pagination" class="table-pagination" aria-label="Accounts pagination"></div>
                                     </div>
                                 </div>
                             </div>
                        </div>
                    </div>

                    <!-- Client Management Page (Container-based) -->
                    <div class="page" id="client-management-page" data-page="client-management">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Client Management</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="add-account-client-mgmt-btn">Add Account</button>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <!-- Loading and Error States -->
                                <div class="loading-state" style="display: none; text-align: center; padding: 40px;">
                                    <div class="spinner"></div>
                                    <p style="margin-top: 16px; color: var(--text-secondary);">Loading client data...</p>
                                </div>
                                <div class="error-message" style="display: none; background: #fee; border: 1px solid #fcc; color: #c33; padding: 16px; border-radius: 8px; margin: 16px 0;"></div>

                                <div class="client-dashboard">
                                    <!-- Overview Stats -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Client Portfolio Overview</h3>
                                        <div class="stats-grid">
                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="9" cy="7" r="4"></circle>
                                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-value">0</div>
                                                    <div class="stat-label">Total Clients</div>
                                                </div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <polyline points="12,6 12,12 16,14"></polyline>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-value">0</div>
                                                    <div class="stat-label">Contracts Expiring (30 days)</div>
                                                </div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M9 12l2 2 4-4"></path>
                                                        <path d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z"></path>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-value">0</div>
                                                    <div class="stat-label">Overdue Tasks</div>
                                                </div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-4"></path>
                                                        <rect x="9" y="11" width="6" height="11"></rect>
                                                        <path d="M9 7v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
                                                    </svg>
                                                </div>
                                                <div class="stat-content">
                                                    <div class="stat-value">0</div>
                                                    <div class="stat-label">Active Contracts</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contract Renewals -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Contract Renewals</h3>
                                        <div class="cards-grid">
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Contract Renewals</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="card-content">
                                                    <div class="metric-row">
                                                        <span class="metric-label">Expiring in 30 days</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Expiring in 90 days</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Expired contracts</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Active contracts</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Task Management</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="card-content">
                                                    <div class="metric-row">
                                                        <span class="metric-label">Overdue tasks</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Pending tasks</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Total tasks</span>
                                                        <span class="metric-value">0</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Client Segmentation -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Client Segmentation</h3>
                                        <div class="cards-grid">
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Client Segmentation</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="card-content">
                                                        <div class="segment-item">
                                                        <div class="segment-label">Enterprise (1000+ employees)</div>
                                                        <div class="segment-value">0 clients</div>
                                                            </div>
                                                    <div class="segment-item">
                                                        <div class="segment-label">Mid-market (100-999 employees)</div>
                                                        <div class="segment-value">0 clients</div>
                                                        </div>
                                                        <div class="segment-item">
                                                        <div class="segment-label">SMB (<100 employees)</div>
                                                        <div class="segment-value">0 clients</div>
                                                            </div>
                                                        </div>
                                                            </div>

                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Top Industries</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                        </div>
                                                    </div>
                                                <div class="card-content" id="top-industries-content">
                                                    <div class="metric-row">
                                                        <span class="metric-label">Loading...</span>
                                                        <span class="metric-value">-</span>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Operational Management -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Operational Management</h3>
                                        <div class="cards-grid">
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Client Communication</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="card-content">
                                                    <div class="communication-stats">
                                                        <div class="comm-stat">
                                                            <div class="comm-icon">
                                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                                                </svg>
                                                            </div>
                                                            <div class="comm-details">
                                                                <div class="comm-value">47</div>
                                                                <div class="comm-label">Recent calls</div>
                                                        </div>
                                                    </div>
                                                        <div class="comm-stat">
                                                            <div class="comm-icon">
                                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                                                    <polyline points="22,6 12,13 2,6"></polyline>
                                                                </svg>
                                                </div>
                                                            <div class="comm-details">
                                                                <div class="comm-value">89%</div>
                                                                <div class="comm-label">Email open rate</div>
                                            </div>
                                        </div>
                                                        <div class="comm-stat">
                                                            <div class="comm-icon">
                                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                                                </svg>
                                                            </div>
                                                            <div class="comm-details">
                                                                <div class="comm-value">12</div>
                                                                <div class="comm-label">Scheduled meetings</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Energy Portfolio</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                        </svg>
                                    </div>
                                </div>
                                                <div class="card-content" id="energy-portfolio-content">
                                                    <div class="metric-row">
                                                        <span class="metric-label">Total kW Managed</span>
                                                        <span class="metric-value" id="total-kw-managed">0 kWh</span>
                            </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Average per Client</span>
                                                        <span class="metric-value" id="avg-kw-per-client">0 kWh</span>
                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Clients with Usage Data</span>
                                                        <span class="metric-value" id="clients-with-usage">0</span>
                                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                                    <!-- Strategic Management -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Strategic Management</h3>
                                        <div class="cards-grid">
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Client Segmentation</h4>
                                                    <div class="card-action">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                            </svg>
                                    </div>
                                </div>
                                                <div class="card-content">
                                                    <div class="segmentation-chart">
                                                        <div class="segment-item">
                                                            <div class="segment-bar enterprise"></div>
                                                            <div class="segment-info">
                                                                <span class="segment-label">Enterprise</span>
                                                                <span class="segment-value">45 clients</span>
                            </div>
                                </div>
                                                        <div class="segment-item">
                                                            <div class="segment-bar midmarket"></div>
                                                            <div class="segment-info">
                                                                <span class="segment-label">Mid-market</span>
                                                                <span class="segment-value">128 clients</span>
                                </div>
                                    </div>
                                                        <div class="segment-item">
                                                            <div class="segment-bar smb"></div>
                                                            <div class="segment-info">
                                                                <span class="segment-label">SMB</span>
                                                                <span class="segment-value">74 clients</span>
                                    </div>
                                    </div>
                                    </div>
                                        </div>
                                    </div>
                                    
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Energy Usage Insights</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                </div>
                            </div>
                                                <div class="card-content" id="energy-usage-content">
                                                    <div class="metric-row">
                                                        <span class="metric-label">Total Annual kWh</span>
                                                        <span class="metric-value" id="total-annual-kwh">0 kWh</span>
                        </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Enterprise Clients</span>
                                                        <span class="metric-value" id="enterprise-kwh">0 kWh</span>
                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">Mid-market Clients</span>
                                                        <span class="metric-value" id="midmarket-kwh">0 kWh</span>
                                    </div>
                                                    <div class="metric-row">
                                                        <span class="metric-label">SMB Clients</span>
                                                        <span class="metric-value" id="smb-kwh">0 kWh</span>
                                </div>
                            </div>
                                </div>
                                </div>
                                        </div>
                                    <!-- Client List -->
                                    <div class="dashboard-section">
                                        <h3 class="section-title">Client List</h3>
                                        <div class="cards-grid">
                                            <div class="dashboard-card">
                                                <div class="card-header">
                                                    <h4 class="card-title">Client List</h4>
                                                    <div class="card-action">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                            </div>
                                        </div>
                                                <div class="card-content">
                                                    <div class="client-list">
                                                        <!-- Client items will be dynamically inserted here -->
                                    </div>
                                        </div>
                                        </div>
                                            </div>
                                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                    <!-- Account Details Page (Container-based) -->
                    <div class="page" id="account-details-page" data-page="account-details">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <button class="back-btn back-btn--icon" id="back-to-accounts" aria-label="Back to Accounts" title="Back to Accounts">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <h2 class="page-title" id="account-detail-title">Account Details</h2>
                                    <div class="page-actions">
                                        <button class="action-btn" id="edit-account-btn">Edit Account</button>
                                    </div>
                                </div>
                            </div>
                            <div class="page-content">
                                <div class="table-container">
                                    <div id="account-details-empty" class="empty-state">
                                        <div class="empty-title">Account Details</div>
                                        <div class="empty-desc">Select an account to view details.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lists Page (Container-based) -->
                    <div class="page" id="lists-page" data-page="lists">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <button class="back-btn back-btn--icon" id="lists-back-btn" aria-label="Back to Lists" title="Back to Lists" hidden>
                                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                      </svg>
                                    </button>
                                    <h2 class="page-title" id="lists-detail-title">Lists</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="lists-add-contact-btn" hidden>Add Contact</button>
                                        <button class="btn-primary" id="add-list-btn">Create List</button>
                                    </div>
                                </div>
                                <div class="people-toolbar" id="lists-header-toolbar">
                                    <button class="action-btn" id="toggle-lists-filters" type="button" hidden>
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                        <span class="filter-count-badge" id="lists-filter-count" hidden>0</span>
                                    </button>
                                    <div class="view-toggle" id="lists-view-toggle">
                                        <button class="toggle-btn filter-tab active" data-view="people" aria-selected="true">People Lists</button>
                                        <button class="toggle-btn filter-tab" data-view="accounts" aria-selected="false">Account Lists</button>
                                    </div>
                                    <input type="text" class="search-input-small" id="lists-quick-search" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                            </div>
                            <div class="page-content lists-grid">
                                <div id="lists-empty-state" class="empty-state">
                                    <div class="empty-title">No lists added</div>
                                    <div class="empty-desc">Get started by creating your first list to organize people or companies. Click the "Create List" button above or use the button below.</div>
                                    <div class="empty-actions">
                                        <button class="btn-primary" id="create-first-list-btn">Create your first list</button>
                                    </div>
                                </div>
                                <!-- List cards will be rendered here by lists-overview.js -->
                            </div>
                        </div>
                    </div>

                    <!-- List Detail Page -->
                    <div class="page" id="list-detail-page" data-page="list-detail">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <button class="back-btn back-btn--icon" id="list-detail-back-btn" aria-label="Back to Lists">
                                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                      </svg>
                                    </button>
                                    <h2 class="page-title" id="list-detail-title">List Details</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="list-detail-contacts-btn">Contacts</button>
                                    </div>
                                </div>
                                <div class="people-toolbar" id="list-detail-header-toolbar">
                                    <button class="action-btn" id="list-detail-filters-btn">
                                        <span class="filter-icon" aria-hidden="true">&#9881;</span>
                                        <span class="filter-text">Show Filters</span>
                                    </button>
                                    <input type="text" id="list-detail-quick-search" class="search-input-small" placeholder="Quick search..." aria-label="Quick search" />
                                </div>
                            </div>
                            
                            <div class="page-content">
                                <div class="table-container">
                                    <div class="table-toolbar">
                                        <div class="table-toolbar-left"></div>
                                        <div class="table-toolbar-right"></div>
                                    </div>
                            
                                    <div id="list-detail-filters" class="filter-panel" hidden>
                                        <div class="filter-tabs-row">
                                            <button class="filter-tab active" data-mode="simple" aria-selected="true">Simple</button>
                                            <button class="filter-tab" data-mode="advanced" aria-selected="false">Advanced</button>
                                        </div>
                                        <div id="list-detail-people-filters-grid" class="filter-grid" data-mode="simple">
                                            <div class="filter-field">
                                                <label for="list-detail-filter-city">City</label>
                                                <div class="chip-input" id="list-detail-filter-city-chip">
                                                    <div class="chip-list" id="list-detail-filter-city-chips"></div>
                                                    <input type="text" id="list-detail-filter-city" class="chip-input-field" placeholder="e.g., Austin, Dallas" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-city-clear" aria-label="Clear city filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-city-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-title">Job title</label>
                                                <div class="chip-input" id="list-detail-filter-title-chip">
                                                    <div class="chip-list" id="list-detail-filter-title-chips"></div>
                                                    <input type="text" id="list-detail-filter-title" class="chip-input-field" placeholder="e.g., manager, director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-title-clear" aria-label="Clear title filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-title-suggest" hidden></div>
                                                </div>
                                                <label for="list-detail-filter-seniority">Seniority</label>
                                                <div class="chip-input" id="list-detail-filter-seniority-chip">
                                                    <div class="chip-list" id="list-detail-filter-seniority-chips"></div>
                                                    <input type="text" id="list-detail-filter-seniority" class="chip-input-field" placeholder="e.g., Senior, Manager, Director" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-seniority-clear" aria-label="Clear seniority filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-seniority-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-company">Company</label>
                                                <div class="chip-input" id="list-detail-filter-company-chip">
                                                    <div class="chip-list" id="list-detail-filter-company-chips"></div>
                                                    <input type="text" id="list-detail-filter-company" class="chip-input-field" placeholder="e.g., Acme Corp" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-company-clear" aria-label="Clear company filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-company-suggest" hidden></div>
                                                </div>
                                                <label for="list-detail-filter-department">Department</label>
                                                <div class="chip-input" id="list-detail-filter-department-chip">
                                                    <div class="chip-list" id="list-detail-filter-department-chips"></div>
                                                    <input type="text" id="list-detail-filter-department" class="chip-input-field" placeholder="e.g., Sales, Marketing, Engineering" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-department-clear" aria-label="Clear department filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-department-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-state">State</label>
                                                <div class="chip-input" id="list-detail-filter-state-chip">
                                                    <div class="chip-list" id="list-detail-filter-state-chips"></div>
                                                    <input type="text" id="list-detail-filter-state" class="chip-input-field" placeholder="e.g., TX, CA" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-state-clear" aria-label="Clear state filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-state-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-employees">Employees</label>
                                                <div class="chip-input" id="list-detail-filter-employees-chip">
                                                    <div class="chip-list" id="list-detail-filter-employees-chips"></div>
                                                    <input type="text" id="list-detail-filter-employees" class="chip-input-field" placeholder="e.g., 1-10, 50, 500+" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-employees-clear" aria-label="Clear employees filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-employees-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-industry">Industry</label>
                                                <div class="chip-input" id="list-detail-filter-industry-chip">
                                                    <div class="chip-list" id="list-detail-filter-industry-chips"></div>
                                                    <input type="text" id="list-detail-filter-industry" class="chip-input-field" placeholder="e.g., Industrial, Retail" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-industry-clear" aria-label="Clear industry filters">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-industry-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field">
                                                <label for="list-detail-filter-visitor-domain">Website visitors (domain)</label>
                                                <div class="chip-input" id="list-detail-filter-visitor-domain-chip">
                                                    <div class="chip-list" id="list-detail-filter-visitor-domain-chips"></div>
                                                    <input type="text" id="list-detail-filter-visitor-domain" class="chip-input-field" placeholder="e.g., powerchoosers.com" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
                                                    <button type="button" class="chip-clear" id="list-detail-filter-visitor-domain-clear" aria-label="Clear website visitor domains">&#215;</button>
                                                    <div class="chip-suggest" id="list-detail-filter-visitor-domain-suggest" hidden></div>
                                                </div>
                                            </div>
                                            <div class="filter-field checkbox">
                                                <label><input type="checkbox" id="list-detail-filter-has-email" /> Has email</label>
                                            </div>
                                            <div class="filter-field checkbox">
                                                <label><input type="checkbox" id="list-detail-filter-has-phone" /> Has phone</label>
                                            </div>
                                        </div>
                                        <div class="filter-actions-row">
                                            <button class="btn-secondary" id="list-detail-clear-filters">Clear all</button>
                                            <button class="btn-primary" id="list-detail-apply-filters">Apply</button>
                                        </div>
                                    </div>
                                    
                                    <div class="table-scroll">
                                        <table class="data-table" id="list-detail-table" aria-label="List members">
                                            <thead>
                                                <tr></tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="table-footer">
                                        <div id="list-detail-pagination-summary" class="pagination-summary" aria-live="polite"></div>
                                        <div id="list-detail-pagination" class="table-pagination" aria-label="List pagination"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agents Page (Admin Only) -->
                    <div class="page" id="agents-page" data-page="agents">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Agents</h2>
                                    <div class="page-actions">
                                        <button class="action-btn" id="add-agent-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                            </svg>
                                            Add Agent
                                        </button>
                                        <button class="action-btn" id="refresh-agents-data">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="23,4 23,10 17,10"></polyline>
                                                <polyline points="1,20 1,14 7,14"></polyline>
                                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                            </svg>
                                            Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="page-content">
                                <!-- Loading and Error States -->
                                <div class="loading-state" style="display: none; text-align: center; padding: 40px;">
                                    <div class="spinner"></div>
                                    <p style="margin-top: 16px; color: var(--text-secondary);">Loading agents data...</p>
                                </div>
                                
                                <div class="error-message" style="display: none; text-align: center; padding: 40px; color: var(--red-500);">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom: 10px;">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="15" y1="9" x2="9" y2="15"></line>
                                        <line x1="9" y1="9" x2="15" y2="15"></line>
                                    </svg>
                                    <div class="error-text"></div>
                                </div>

                                <!-- Agents Dashboard -->
                                <div class="agents-dashboard" style="display: none;">
                                    <!-- Overview Metrics -->
                                    <div class="agents-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-base); margin-bottom: var(--spacing-base);">
                                        <div class="dashboard-card">
                                            <div class="card-header" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <div class="metric-icon" style="width: 24px; height: 24px; color: var(--orange-subtle);">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="9" cy="7" r="4"></circle>
                                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                    </svg>
                                                </div>
                                                <h3 class="card-title">Active Agents</h3>
                                            </div>
                                            <div class="metric-value" id="active-agents-count" style="font-size: 2rem; font-weight: 600; color: var(--text-inverse); margin-top: var(--spacing-sm);">0</div>
                                        </div>
                                        
                                        <div class="dashboard-card">
                                            <div class="card-header" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <div class="metric-icon" style="width: 24px; height: 24px; color: var(--orange-subtle);">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                                    </svg>
                                                </div>
                                                <h3 class="card-title">Total Calls Today</h3>
                                            </div>
                                            <div class="metric-value" id="total-calls-today" style="font-size: 2rem; font-weight: 600; color: var(--text-inverse); margin-top: var(--spacing-sm);">0</div>
                                        </div>
                                        
                                        <div class="dashboard-card">
                                            <div class="card-header" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <div class="metric-icon" style="width: 24px; height: 24px; color: var(--orange-subtle);">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                                        <polyline points="22,6 12,13 2,6"></polyline>
                                                    </svg>
                                                </div>
                                                <h3 class="card-title">Emails Sent Today</h3>
                                            </div>
                                            <div class="metric-value" id="total-emails-today" style="font-size: 2rem; font-weight: 600; color: var(--text-inverse); margin-top: var(--spacing-sm);">0</div>
                                        </div>
                                        
                                        <div class="dashboard-card">
                                            <div class="card-header" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <div class="metric-icon" style="width: 24px; height: 24px; color: var(--orange-subtle);">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="9,11 12,14 22,4"></polyline>
                                                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                                    </svg>
                                                </div>
                                                <h3 class="card-title">Tasks Completed</h3>
                                            </div>
                                            <div class="metric-value" id="tasks-completed-today" style="font-size: 2rem; font-weight: 600; color: var(--text-inverse); margin-top: var(--spacing-sm);">0</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Agents Table -->
                                    <div class="dashboard-card">
                                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-base);">
                                            <h3 class="card-title">Agent Management</h3>
                                            <div class="table-filters" style="display: flex; gap: var(--spacing-sm);">
                                                <select id="agent-status-filter" class="filter-select" style="background: var(--bg-card); border: 1px solid var(--border-light); border-radius: var(--border-radius); padding: var(--spacing-sm); color: var(--text-inverse);">
                                                    <option value="all">All Status</option>
                                                    <option value="online">Online</option>
                                                    <option value="offline">Offline</option>
                                                    <option value="busy">Busy</option>
                                                </select>
                                                <select id="agent-territory-filter" class="filter-select" style="background: var(--bg-card); border: 1px solid var(--border-light); border-radius: var(--border-radius); padding: var(--spacing-sm); color: var(--text-inverse);">
                                                    <option value="all">All Territories</option>
                                                    <option value="west_coast">West Coast</option>
                                                    <option value="east_coast">East Coast</option>
                                                    <option value="midwest">Midwest</option>
                                                    <option value="south">South</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="table-container">
                                            <div class="table-scroll">
                                                <table class="data-table" id="agents-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Agent</th>
                                                            <th>Status</th>
                                                            <th>Phone Number</th>
                                                            <th>Email Address</th>
                                                            <th>Calls Today</th>
                                                            <th>Emails Today</th>
                                                            <th>Tasks Completed</th>
                                                            <th>Current Activity</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="agents-table-body">
                                                        <!-- Populated by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Details Page (Admin Only) -->
                    <div class="page" id="agent-details-page" data-page="agent-details">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <button class="back-btn" id="agent-details-back">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="15,18 9,12 15,6"></polyline>
                                        </svg>
                                        Back to Agents
                                    </button>
                                    <h2 class="page-title" id="agent-details-title">Agent Details</h2>
                                    <div class="page-actions">
                                        <button class="action-btn" id="edit-agent-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                            Edit Agent
                                        </button>
                                        <button class="action-btn" id="refresh-agent-data">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="23,4 23,10 17,10"></polyline>
                                                <polyline points="1,20 1,14 7,14"></polyline>
                                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                            </svg>
                                            Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="page-content">
                                <!-- Loading and Error States -->
                                <div class="loading-state" style="display: none; text-align: center; padding: 40px;">
                                    <div class="spinner"></div>
                                    <p style="margin-top: 16px; color: var(--text-secondary);">Loading agent data...</p>
                                </div>
                                
                                <div class="error-message" style="display: none;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="15" y1="9" x2="9" y2="15"></line>
                                        <line x1="9" y1="9" x2="15" y2="15"></line>
                                    </svg>
                                    <span class="error-text"></span>
                                </div>

                                <!-- Agent Details Dashboard -->
                                <div class="agent-details-dashboard" style="display: none;">
                                    <!-- Agent Profile Section -->
                                    <div class="agent-profile-section">
                                        <div class="agent-profile-card">
                                            <div class="agent-avatar-large">
                                                <span id="agent-avatar-text">A</span>
                                            </div>
                                            <div class="agent-profile-info">
                                                <h3 id="agent-profile-name">Agent Name</h3>
                                                <p id="agent-profile-email">agent@powerchoosers.com</p>
                                                <div class="agent-status">
                                                    <span class="status-badge" id="agent-status-badge">offline</span>
                                                    <span class="last-active" id="agent-last-active">Last active: Never</span>
                                                </div>
                                            </div>
                                            <div class="agent-profile-actions">
                                                <div class="resource-assignments">
                                                    <div class="resource-item">
                                                        <label>Phone Number:</label>
                                                        <div class="resource-value" id="agent-phone-display">
                                                            <span class="assigned-resource">Not assigned</span>
                                                            <button class="assign-btn small" onclick="reassignPhoneNumber()">Change</button>
                                                        </div>
                                                    </div>
                                                    <div class="resource-item">
                                                        <label>Email Address:</label>
                                                        <div class="resource-value" id="agent-email-display">
                                                            <span class="assigned-resource">Not assigned</span>
                                                            <button class="assign-btn small" onclick="reassignEmailAddress()">Change</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Performance Metrics -->
                                    <div class="agent-metrics-section">
                                        <h3>Performance Metrics</h3>
                                        <div class="metrics-grid">
                                            <div class="metric-card">
                                                <div class="metric-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                                    </svg>
                                                </div>
                                                <div class="metric-content">
                                                    <h4>Total Calls</h4>
                                                    <div class="metric-value" id="total-calls-metric">0</div>
                                                </div>
                                            </div>
                                            
                                            <div class="metric-card">
                                                <div class="metric-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                                        <polyline points="22,6 12,13 2,6"></polyline>
                                                    </svg>
                                                </div>
                                                <div class="metric-content">
                                                    <h4>Total Emails</h4>
                                                    <div class="metric-value" id="total-emails-metric">0</div>
                                                </div>
                                            </div>
                                            
                                            <div class="metric-card">
                                                <div class="metric-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                                    </svg>
                                                </div>
                                                <div class="metric-content">
                                                    <h4>Deals Closed</h4>
                                                    <div class="metric-value" id="deals-closed-metric">0</div>
                                                </div>
                                            </div>
                                            
                                            <div class="metric-card">
                                                <div class="metric-icon">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                                                    </svg>
                                                </div>
                                                <div class="metric-content">
                                                    <h4>Conversion Rate</h4>
                                                    <div class="metric-value" id="conversion-rate-metric">0%</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Goals and Progress -->
                                    <div class="agent-goals-section">
                                        <h3>Goals & Progress</h3>
                                        <div class="goals-grid">
                                            <div class="goal-card">
                                                <div class="goal-header">
                                                    <h4>Daily Call Goal</h4>
                                                    <span class="goal-target" id="call-goal-target">50</span>
                                                </div>
                                                <div class="goal-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" id="call-progress-fill" style="width: 0%"></div>
                                                    </div>
                                                    <span class="goal-current" id="call-goal-current">0 / 50</span>
                                                </div>
                                            </div>
                                            
                                            <div class="goal-card">
                                                <div class="goal-header">
                                                    <h4>Daily Email Goal</h4>
                                                    <span class="goal-target" id="email-goal-target">20</span>
                                                </div>
                                                <div class="goal-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" id="email-progress-fill" style="width: 0%"></div>
                                                    </div>
                                                    <span class="goal-current" id="email-goal-current">0 / 20</span>
                                                </div>
                                            </div>
                                            
                                            <div class="goal-card">
                                                <div class="goal-header">
                                                    <h4>Monthly Deal Goal</h4>
                                                    <span class="goal-target" id="deal-goal-target">5</span>
                                                </div>
                                                <div class="goal-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" id="deal-progress-fill" style="width: 0%"></div>
                                                    </div>
                                                    <span class="goal-current" id="deal-goal-current">0 / 5</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Recent Activity Timeline -->
                                    <div class="agent-activity-section">
                                        <h3>Recent Activity</h3>
                                        <div class="activity-timeline" id="agent-activity-timeline">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Page (Container-based) -->
                    <div class="page" id="settings-page" data-page="settings">
                        <div class="page-container">
                            <div class="page-header">
                                <div class="page-title-section">
                                    <h2 class="page-title">Settings</h2>
                                    <div class="page-actions">
                                        <button class="btn-primary" id="save-settings-btn">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="page-content">
                                <div class="settings-sections">
                                    <!-- Email Settings Section -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                                <polyline points="22,6 12,13 2,6"></polyline>
                                            </svg>
                                            Email Settings
                                        </h3>
                                        <div class="settings-content">
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Email Signature</h4>
                                                <div class="settings-field">
                                                    <label for="email-signature-text">Text Signature</label>
                                                    <textarea id="email-signature-text" class="settings-textarea" placeholder="Enter your email signature text..." rows="4"></textarea>
                                                </div>
                                                <div class="settings-field">
                                                    <label for="email-signature-image">Image Signature</label>
                                                    <div class="image-upload-area">
                                                        <input type="file" id="email-signature-image" accept="image/*" hidden>
                                                        <button type="button" class="btn-secondary" id="upload-signature-image">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
                                                                <circle cx="12" cy="13" r="3"></circle>
                                                            </svg>
                                                            Upload Image
                                                        </button>
                                                        <button type="button" class="btn-secondary" id="convert-signature-image" style="margin-left: 8px;">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3 4-3 9-3 9 1.34 9 3z"></path>
                                                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5c0-1.66-4-3-9-3s-9 1.34-9 3z"></path>
                                                            </svg>
                                                            Fix Broken Image
                                                        </button>
                                                        <div id="signature-image-preview" class="image-preview" hidden></div>
                                                    </div>
                                                    <div class="settings-field" style="margin-top: 12px;">
                                                        <label for="signature-image-size-width">Image Size (Width)</label>
                                                        <input type="number" id="signature-image-size-width" class="settings-input" min="50" max="800" value="200" step="10" style="width: 120px;">
                                                        <span style="margin-left: 8px; color: var(--text-secondary);">px</span>
                                                        <label for="signature-image-size-height" style="margin-left: 20px;">Height</label>
                                                        <input type="number" id="signature-image-size-height" class="settings-input" min="25" max="400" value="100" step="10" style="width: 120px;">
                                                        <span style="margin-left: 8px; color: var(--text-secondary);">px</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>

                                    <!-- Meeting Preferences Section -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M8 2v4"/>
                                                <path d="M16 2v4"/>
                                                <rect width="18" height="18" x="3" y="4" rx="2"/>
                                                <path d="M3 10h18"/>
                                            </svg>
                                            Meeting Preferences
                                        </h3>
                                        <div class="settings-content">
                                            <div class="settings-field">
                                                <label class="settings-checkbox-label">
                                                    <input type="checkbox" id="meeting-preferences-enabled" class="settings-checkbox" checked>
                                                    <span class="settings-checkbox-text">Enable Meeting Preferences</span>
                                                </label>
                                                <p class="settings-hint">Configure meeting time preferences for all email templates</p>
                                            </div>
                                            
                                            <div class="meeting-preferences-fields">
                                                <div class="settings-field">
                                                    <label class="settings-checkbox-label">
                                                        <input type="checkbox" id="meeting-use-hardcoded" class="settings-checkbox" checked>
                                                        <span class="settings-checkbox-text">Use Hardcoded Meeting Times</span>
                                                    </label>
                                                    <p class="settings-hint">When enabled, uses specific time slots. When disabled, AI generates custom CTAs.</p>
                                                </div>
                                                
                                                <div class="settings-field">
                                                    <label for="meeting-slot1-time">First Time Slot</label>
                                                    <input type="text" id="meeting-slot1-time" class="settings-input" placeholder="2-3pm" value="2-3pm">
                                                    <p class="settings-hint">First available time slot (e.g., "2-3pm", "Tuesday 2-3pm")</p>
                                                </div>
                                                
                                                <div class="settings-field">
                                                    <label for="meeting-slot2-time">Second Time Slot</label>
                                                    <input type="text" id="meeting-slot2-time" class="settings-input" placeholder="10-11am" value="10-11am">
                                                    <p class="settings-hint">Second available time slot (e.g., "10-11am", "Thursday 10-11am")</p>
                                                </div>
                                                
                                                <div class="settings-field">
                                                    <label for="meeting-call-duration">Call Duration</label>
                                                    <input type="text" id="meeting-call-duration" class="settings-input" placeholder="15-minute" value="15-minute">
                                                    <p class="settings-hint">Meeting duration (e.g., "15-minute", "30-minute", "brief")</p>
                                                </div>
                                                
                                                <div class="settings-field">
                                                    <label for="meeting-timezone">Time Zone</label>
                                                    <input type="text" id="meeting-timezone" class="settings-input" placeholder="EST" value="EST">
                                                    <p class="settings-hint">Time zone for meetings (e.g., "EST", "PST", "CST")</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Deliverability & Tracking Section (SendGrid Optimized) -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                            </svg>
                                            Email Deliverability & Tracking
                                        </h3>
                                        <div class="settings-content">
                                            <p class="section-desc">Global defaults for SendGrid email delivery. These settings apply to manual emails from the CRM. Sequence steps have their own independent settings.</p>
                                            
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">SendGrid Service</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="sendgrid-enabled" checked>
                                                        <span class="checkmark"></span>
                                                        Enable SendGrid for email sending
                                                    </label>
                                                    <div class="settings-hint">Use Twilio SendGrid API for sending emails. Provides better deliverability, tracking, and automation features.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="sandbox-mode">
                                                        <span class="checkmark"></span>
                                                        Sandbox Mode (Testing)
                                                    </label>
                                                    <div class="settings-hint">Enable sandbox mode for testing. Emails won't actually be sent, but SendGrid will validate and process them.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label for="ip-pool-name">IP Pool Name (Optional)</label>
                                                    <input type="text" id="ip-pool-name" class="settings-input" placeholder="Leave blank to use default">
                                                    <div class="settings-hint">Specify a dedicated IP pool for sending. Only use if you have a dedicated IP setup with SendGrid.</div>
                                                </div>
                                            </div>

                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Tracking & Analytics</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-trk-enabled" checked>
                                                        <span class="checkmark"></span>
                                                        SendGrid Open Tracking
                                                    </label>
                                                    <div class="settings-hint">Track when recipients open your emails using SendGrid's native tracking system. Email records are always saved regardless of this setting.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-click-trk-enabled" checked>
                                                        <span class="checkmark"></span>
                                                        SendGrid Click Tracking
                                                    </label>
                                                    <div class="settings-hint">Track when recipients click links in your emails using SendGrid's native tracking system. Links are rewritten through SendGrid's tracking domain.</div>
                                                </div>
                                            </div>

                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Headers & Compliance</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-list-unsub" checked>
                                                        <span class="checkmark"></span>
                                                        Add List-Unsubscribe Header
                                                    </label>
                                                    <div class="settings-hint">Adds one-click unsubscribe header. Recommended by Gmail and improves deliverability for bulk sends.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="include-physical-address" checked>
                                                        <span class="checkmark"></span>
                                                        Include Physical Address
                                                    </label>
                                                    <div class="settings-hint">Add your business address to email footer. Required by CAN-SPAM law for commercial emails.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="gdpr-compliant" checked>
                                                        <span class="checkmark"></span>
                                                        GDPR Compliance Mode
                                                    </label>
                                                    <div class="settings-hint">Enables GDPR-compliant handling of EU contacts. Includes consent tracking and data processing notices.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-bulk-headers">
                                                        <span class="checkmark"></span>
                                                        Add "Precedence: bulk" Header
                                                    </label>
                                                    <div class="settings-hint">Signals bulk mail to inbox providers. Use only for newsletters; avoid for one-to-one outreach.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-priority-headers">
                                                        <span class="checkmark"></span>
                                                        Add Priority/Importance Headers
                                                    </label>
                                                    <div class="settings-hint">Marks emails as high priority. Use sparingly—can look artificial and hurt deliverability if overused.</div>
                                                </div>
                                            </div>

                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Advanced SendGrid Options</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="bypass-list-mgmt">
                                                        <span class="checkmark"></span>
                                                        Bypass List Management
                                                    </label>
                                                    <div class="settings-hint">Bypasses SendGrid's suppression lists. Only use for transactional emails like password resets. Not recommended for marketing.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="spam-score-check">
                                                        <span class="checkmark"></span>
                                                        Check Spam Score Before Sending
                                                    </label>
                                                    <div class="settings-hint">Analyze email content for spam triggers before sending. May slow down sends but improves deliverability.</div>
                                                </div>
                                            </div>

                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Template & Content</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-branded-html">
                                                        <span class="checkmark"></span>
                                                        Use Branded HTML Template
                                                    </label>
                                                    <div class="settings-hint">Sends styled HTML emails with branding. For cold outreach, keep this off for a more personal look.</div>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-sig-image-enabled" checked>
                                                        <span class="checkmark"></span>
                                                        Include Image in Signature
                                                    </label>
                                                    <div class="settings-hint">Shows your signature image/logo. Makes emails look professional but adds an image load.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Twilio Settings Section -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                            </svg>
                                            Twilio Phone Numbers
                                        </h3>
                                        <div class="settings-content">
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Business Phone Numbers</h4>
                                                <div class="phone-numbers-list" id="twilio-numbers-list">
                                                    <div class="phone-number-item">
                                                        <div class="phone-info">
                                                            <span class="phone-number">+1 (555) 123-4567</span>
                                                            <span class="phone-label">Primary Business Line</span>
                                                        </div>
                                                        <div class="phone-actions">
                                                            <button class="btn-small btn-secondary" data-action="edit">Edit</button>
                                                            <button class="btn-small btn-danger" data-action="remove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn-secondary" id="add-phone-number">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                                    </svg>
                                                    Add Phone Number
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- General Settings Section -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="3"></circle>
                                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                            </svg>
                                            General Settings
                                        </h3>
                                        <div class="settings-content">
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Profile Information</h4>
                                                <p class="settings-hint" style="margin: 0 0 16px 0;">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 4px; vertical-align: middle;">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <line x1="12" y1="16" x2="12" y2="12"></line>
                                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                                    </svg>
                                                    Auto-populated from your Google login. Update these fields to customize your email signatures across all 7 AI templates.
                                                </p>
                                                
                                                <!-- Avatar Preview - Left aligned above First Name -->
                                                <div style="margin-bottom: 16px;">
                                                    <div id="user-avatar-preview" style="display: inline-block;"></div>
                                                </div>
                                                
                                                <!-- First Name & Last Name -->
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                                                    <div class="settings-field" style="margin-bottom: 0;">
                                                        <label for="user-first-name">First Name</label>
                                                        <input 
                                                            type="text" 
                                                            id="user-first-name" 
                                                            class="settings-input" 
                                                            placeholder="From Google"
                                                            readonly
                                                            style="background: var(--grey-700); cursor: not-allowed;"
                                                        >
                                                        <small style="color: var(--text-muted); font-size: 11px; margin-top: 4px; display: block;">
                                                            From Google (read-only)
                                                        </small>
                                                    </div>
                                                    <div class="settings-field" style="margin-bottom: 0;">
                                                        <label for="user-last-name">Last Name</label>
                                                        <input 
                                                            type="text" 
                                                            id="user-last-name" 
                                                            class="settings-input" 
                                                            placeholder="From Google"
                                                            readonly
                                                            style="background: var(--grey-700); cursor: not-allowed;"
                                                        >
                                                        <small style="color: var(--text-muted); font-size: 11px; margin-top: 4px; display: block;">
                                                            From Google (read-only)
                                                        </small>
                                                    </div>
                                                </div>
                                                
                                                <!-- Email (Read-only) -->
                                                <div class="settings-field">
                                                    <label for="user-email">Email</label>
                                                    <input 
                                                        type="email" 
                                                        id="user-email" 
                                                        class="settings-input" 
                                                        placeholder="From Google"
                                                        readonly
                                                        style="background: var(--grey-700); cursor: not-allowed;"
                                                    >
                                                    <small style="color: var(--text-muted); font-size: 11px; margin-top: 4px; display: block;">
                                                        From Google (read-only)
                                                    </small>
                                                </div>
                                                
                                                <!-- Job Title (Editable) -->
                                                <div class="settings-field">
                                                    <label for="user-job-title">Job Title</label>
                                                    <input 
                                                        type="text" 
                                                        id="user-job-title" 
                                                        class="settings-input" 
                                                        placeholder="Energy Strategist"
                                                    >
                                                    <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                                        Appears in all email signatures
                                                    </small>
                                                </div>
                                                
                                                <!-- Location (Editable) -->
                                                <div class="settings-field">
                                                    <label for="user-location">Location</label>
                                                    <input 
                                                        type="text" 
                                                        id="user-location" 
                                                        class="settings-input" 
                                                        placeholder="Fort Worth, TX"
                                                    >
                                                    <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                                        Your city and state
                                                    </small>
                                                </div>
                                                
                                                <!-- Phone (Editable) -->
                                                <div class="settings-field">
                                                    <label for="user-phone">Direct Phone</label>
                                                    <input 
                                                        type="tel" 
                                                        id="user-phone" 
                                                        class="settings-input" 
                                                        placeholder="(817) 555-1234"
                                                    >
                                                    <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                                        Your direct line (optional - shown in email signatures)
                                                    </small>
                                                </div>
                                                
                                                <!-- Company Name (Editable) -->
                                                <div class="settings-field">
                                                    <label for="company-name">Company Name</label>
                                                    <input 
                                                        type="text" 
                                                        id="company-name" 
                                                        class="settings-input" 
                                                        placeholder="Power Choosers"
                                                    >
                                                    <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                                        Your company name (white-label support)
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">User Preferences</h4>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="auto-save-notes" checked>
                                                        <span class="checkmark"></span>
                                                        Auto-save notes and activities
                                                    </label>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="email-notifications" checked>
                                                        <span class="checkmark"></span>
                                                        Email notifications for new activities
                                                    </label>
                                                </div>
                                                <div class="settings-field">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="call-recording-notifications">
                                                        <span class="checkmark"></span>
                                                        Notifications for call recordings
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Display Settings</h4>
                                                <div class="settings-field">
                                                    <label for="items-per-page">Items per page</label>
                                                    <select id="items-per-page" class="settings-select">
                                                        <option value="25">25</option>
                                                        <option value="50" selected>50</option>
                                                        <option value="100">100</option>
                                                    </select>
                                                </div>
                                                <div class="settings-field">
                                                    <label for="default-view">Default view</label>
                                                    <select id="default-view" class="settings-select">
                                                        <option value="table" selected>Table View</option>
                                                        <option value="cards">Card View</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Algolia Reindex Tool Section -->
                                    <div class="settings-section">
                                        <h3 class="settings-section-title">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                            </svg>
                                            Algolia Reindex Tool
                                        </h3>
                                        <div class="settings-content">
                                            <div class="settings-group">
                                                <h4 class="settings-group-title">Database Synchronization</h4>
                                                <p class="settings-hint" style="margin: 0 0 16px 0;">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 4px; vertical-align: middle;">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <line x1="12" y1="16" x2="12" y2="12"></line>
                                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                                    </svg>
                                                    Trigger a full reindex of your Firebase data to Algolia. Use this after clearing your Algolia index or if search results are missing records.
                                                </p>
                                                
                                                <div class="settings-field" style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                                                    <strong>⚠️ Important:</strong> This tool uses direct Algolia API calls to bypass Firebase extension issues. You'll need your Algolia Application ID and Admin API Key.
                                                </div>
                                                
                                                <form id="algolia-credentials-form">
                                                    <div class="settings-field" style="margin-bottom: 16px;">
                                                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Algolia Credentials (Optional - will prompt if not set)</label>
                                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                                            <input type="text" id="algolia-app-id" class="settings-input" placeholder="Application ID" style="margin-bottom: 0;">
                                                            <input type="password" id="algolia-api-key" class="settings-input" placeholder="Admin API Key" style="margin-bottom: 0;">
                                                        </div>
                                                        <small style="color: var(--text-muted); font-size: 11px; margin-top: 4px; display: block;">
                                                            These will be stored in localStorage for convenience. You can also set them as environment variables.
                                                        </small>
                                                    </div>
                                                </form>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                                                    <button class="btn-primary" id="algolia-reindex-accounts-btn" style="width: 100%;">
                                                        📊 Reindex Accounts
                                                    </button>
                                                    <button class="btn-primary" id="algolia-reindex-contacts-btn" style="width: 100%;">
                                                        👥 Reindex Contacts
                                                    </button>
                                                </div>
                                                
                                                <div id="algolia-status" style="display: none; padding: 12px; border-radius: 4px; margin-bottom: 12px;"></div>
                                                
                                                <div class="settings-field">
                                                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Reindex Log</label>
                                                    <div id="algolia-log" style="background: var(--grey-800); border: 1px solid var(--grey-600); border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; color: var(--text-primary);"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Detail Page -->
                    <div class="page" id="task-detail-page" data-page="task-detail">
                        <div class="page-container">
                            <div class="page-header">
                                <button class="back-btn back-btn--icon" id="task-detail-back-btn" aria-label="Back to Tasks">
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                                    <path d="M19 12H5M12 19l-7-7 7-7"></path>
                                  </svg>
                                </button>
                                <div class="page-title-section">
                                    <div class="contact-header-profile">
                                        <div class="contact-header-text">
                                            <h2 class="page-title" id="task-detail-title">Task Details</h2>
                                            <div class="contact-subtitle" id="task-detail-subtitle">Loading task...</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="page-actions">
                                    <button class="btn-secondary" id="task-reschedule-btn">Reschedule</button>
                                    <div class="task-navigation">
                                        <button class="btn-primary" id="task-complete-btn">Complete Task</button>
                                        <button class="btn-icon" id="task-prev-btn" aria-label="Previous Task" title="Previous Task">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M15 18l-6-6 6-6"/>
                                            </svg>
                                        </button>
                                        <button class="btn-icon" id="task-next-btn" aria-label="Next Task" title="Next Task">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M9 18l6-6-6-6"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Task Content Area -->
                            <div class="page-content" id="task-detail-content">
                                <!-- Content will be dynamically loaded based on task type -->
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Loading task details...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </main>

                <aside class="widget-panel" id="widget-panel">
                    <div class="widget-content">
                        <!-- Quick Actions -->
                        <div class="widget-card">
                            <h4 class="widget-title">Quick Actions</h4>
                            <div class="quick-actions">
                                <button class="action-btn" data-action="create" data-type="contact">Add Contact</button>
                                <button class="action-btn" data-action="create" data-type="account">Add Account</button>
                                <button class="action-btn" data-action="create" data-type="bulk-import">Bulk Import CSV</button>
                            </div>
                        </div>

                        <!-- Today's Tasks -->
                        <div class="widget-card">
                            <h4 class="widget-title">Today's Tasks</h4>
                            <div class="tasks-list"><!-- Populated by main.js loadTodaysTasks() --></div>
                        </div>

                        <!-- Energy News -->
                        <div class="widget-card">
                            <div class="widget-card-header">
                                <h4 class="widget-title">Energy News</h4>
                                <div class="news-time" id="news-last-refreshed" aria-live="polite">Last updated: —</div>
                            </div>
                            <div class="news-list">
                                <!-- Populated by loadEnergyNews() -->
                            </div>
                        </div>

                        <!-- Live TX Price -->
                        <div class="widget-card">
                            <h4 class="widget-title">Live TX Electricity Price</h4>
                            <div class="price-display">
                                <div class="current-price">$0.089</div>
                            </div>
                        </div>
                    </div>
                </aside>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div id="modal-add-contact" class="pc-modal" hidden>
        <div class="pc-modal__backdrop" data-close="contact"></div>
        <div class="pc-modal__dialog">
            <div class="pc-modal__header">
                <h3 id="add-contact-title">Add Contact</h3>
                <button class="pc-modal__close" data-close="contact" aria-label="Close">×</button>
            </div>
            <form id="form-add-contact" class="pc-modal__form">
                <div class="pc-modal__body">
                    <div class="form-row">
                        <label>First name<input type="text" name="firstName" required class="input-dark" /></label>
                        <label>Last name<input type="text" name="lastName" required class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Title<input type="text" name="title" class="input-dark" /></label>
                        <label>Company<input type="text" name="companyName" class="input-dark" placeholder="Exact account name" /></label>
                    </div>
                    <div class="form-row">
                        <label>Email<input type="email" name="email" class="input-dark" /></label>
                        <label>Email Status<select name="emailStatus" class="input-dark"><option value="">Not Verified</option><option value="verified">Verified</option></select></label>
                    </div>
                    <div class="form-row">
                        <label>Mobile Phone<input type="tel" name="mobile" class="input-dark" /></label>
                        <label>Work Direct Phone<input type="tel" name="workDirectPhone" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Other Phone<input type="tel" name="otherPhone" class="input-dark" /></label>
                        <label>City<input type="text" name="city" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>State<input type="text" name="state" class="input-dark" /></label>
                        <label>Industry<input type="text" name="industry" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Seniority<input type="text" name="seniority" class="input-dark" /></label>
                        <label>Department<input type="text" name="department" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>LinkedIn URL<input type="url" name="linkedin" class="input-dark" /></label>
                    </div>
                </div>
                <div class="pc-modal__footer">
                    <button type="button" class="btn-text" data-close="contact">Cancel</button>
                    <button type="submit" class="btn-primary">Create contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Client Management: Add Account Search Modal -->
    <div id="modal-client-mgmt-search" class="pc-modal" hidden>
        <div class="pc-modal__backdrop" data-close="client-search"></div>
        <div class="pc-modal__dialog" style="max-width: 600px;">
            <div class="pc-modal__header">
                <h3>Add Account to Client Management</h3>
                <button class="pc-modal__close" data-close="client-search" aria-label="Close">×</button>
            </div>
            <div class="pc-modal__body">
                <div class="account-search-container">
                    <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">
                        Search for an existing account
                    </label>
                    <div class="account-search-wrap">
                        <input 
                            type="text" 
                            id="client-mgmt-account-search" 
                            class="input-dark" 
                            placeholder="Type company name, industry, city, or state..."
                            autocomplete="off"
                            style="width: 100%; padding: 12px 16px; font-size: 1rem;"
                        />
                        <div id="client-mgmt-search-results" class="account-search-dropdown" hidden>
                            <div class="search-results-list">
                                <!-- Results populated by JavaScript -->
                            </div>
                            <div class="search-empty" hidden>
                                <p style="padding: 16px; text-align: center; color: var(--text-muted);">
                                    No accounts found
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div id="modal-add-account" class="pc-modal" hidden>
        <div class="pc-modal__backdrop" data-close="account"></div>
        <div class="pc-modal__dialog">
            <div class="pc-modal__header">
                <h3 id="add-account-title">Add Account</h3>
                <button class="pc-modal__close" data-close="account" aria-label="Close">×</button>
            </div>
            <form id="form-add-account" class="pc-modal__form">
                <div class="pc-modal__body">
                    <div class="form-row">
                        <label>Account name<input type="text" name="accountName" required class="input-dark" /></label>
                        <label>Industry<input type="text" name="industry" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Website<input type="text" name="website" class="input-dark" placeholder="https://example.com" /></label>
                        <label>Phone<input type="text" name="phone" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>City<input type="text" name="city" class="input-dark" /></label>
                        <label>State<input type="text" name="state" class="input-dark" /></label>
                    </div>
                    <div class="form-row" style="grid-template-columns: 1fr;">
                        <label>Service Addresses
                            <div id="service-addresses-container" style="display: flex; flex-direction: column; gap: 8px;">
                                <div class="service-address-input-row" style="display: flex; gap: 8px; align-items: center;">
                                    <input type="text" name="serviceAddress_0" class="input-dark" placeholder="123 Main St, City, State" style="flex: 1;" />
                                    <button type="button" class="remove-service-address-btn" style="background: var(--grey-600); color: white; border: none; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;" title="Remove this service address">-</button>
                                    <button type="button" class="add-service-address-btn" style="background: var(--orange-primary); color: white; border: none; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;" title="Add another service address">+</button>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>LinkedIn URL<input type="url" name="linkedin" class="input-dark" /></label>
                        <label>Square Footage<input type="number" name="squareFootage" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Occupancy %<input type="number" name="occupancyPct" class="input-dark" min="0" max="100" /></label>
                        <label>Employees<input type="number" name="employees" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label style="position: relative;">Parent Company
                            <input type="text" name="parentCompanyName" class="input-dark" id="parent-company-search" placeholder="Search for parent company..." autocomplete="off" />
                            <input type="hidden" name="parentCompanyId" id="parent-company-id" />
                            <div id="parent-company-dropdown" class="parent-company-dropdown" style="display: none;"></div>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>Short Description<textarea name="shortDescription" class="input-dark" rows="3"></textarea></label>
                    </div>
                    <div class="form-row">
                        <label>Electricity Supplier<input type="text" name="electricitySupplier" class="input-dark" /></label>
                        <label>Annual Usage (kWh)<input type="number" name="annualUsage" class="input-dark" /></label>
                    </div>
                    <div class="form-row">
                        <label>Current Rate ($/kWh)<input type="number" name="currentRate" class="input-dark" step="0.001" /></label>
                        <label>Contract End Date<input type="date" name="contractEndDate" class="input-dark" /></label>
                    </div>
                    <div class="form-row" style="grid-template-columns: 1fr;">
                        <label>Icon URL (Company logo or favicon)
                            <input type="url" name="logoUrl" class="input-dark" placeholder="https://example.com/logo.png" />
                        </label>
                    </div>
                </div>
                <div class="pc-modal__footer">
                    <button type="button" class="btn-text" data-close="account">Cancel</button>
                    <button type="submit" class="btn-primary">Create account</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Import CSV Modal -->
    <div id="modal-bulk-import" class="pc-modal" hidden>
        <div class="pc-modal__backdrop" data-close="bulk-import"></div>
        <div class="pc-modal__dialog csv-import-modal" role="dialog" aria-modal="true" aria-labelledby="bulk-import-title">
            <div class="pc-modal__header">
                <h3 id="bulk-import-title">Bulk Import CSV</h3>
                <button class="pc-modal__close" data-close="bulk-import" aria-label="Close">×</button>
            </div>
            
            <!-- Step Indicator -->
            <div class="csv-steps-indicator">
                <div class="csv-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Upload File</div>
                </div>
                <div class="csv-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Map Fields</div>
                </div>
                <div class="csv-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Review & Import</div>
                </div>
            </div>

            <!-- Step 1: File Upload -->
            <div class="csv-step-content" id="csv-step-1">
                <div class="pc-modal__body">
                    <div class="csv-upload-section">
                        <div class="upload-type-selector">
                            <h4>What would you like to import?</h4>
                            <div class="type-options">
                                <label class="type-option">
                                    <input type="radio" name="importType" value="contacts" checked>
                                    <div class="option-content">
                                        <div class="option-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                        </div>
                                        <div class="option-text">
                                            <div class="option-title">Contacts</div>
                                            <div class="option-desc">People and their information</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="type-option">
                                    <input type="radio" name="importType" value="accounts">
                                    <div class="option-content">
                                        <div class="option-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                                <path d="M19 21V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1"></path>
                                            </svg>
                                        </div>
                                        <div class="option-text">
                                            <div class="option-title">Accounts</div>
                                            <div class="option-desc">Companies and organizations</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="csv-drop-zone" id="csv-drop-zone">
                            <div class="drop-zone-content">
                                <div class="upload-icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="12" y1="11" x2="12" y2="17"></line>
                                        <polyline points="9 14 12 11 15 14"></polyline>
                                    </svg>
                                </div>
                                <div class="upload-text">
                                    <h4>Drop your CSV file here</h4>
                                    <p>or <button type="button" class="btn-link" id="csv-browse-btn">browse to upload</button></p>
                                </div>
                                <div class="file-requirements">
                                    <small>Supported format: .csv (max 10MB)</small>
                                </div>
                            </div>
                            <input type="file" id="csv-file-input" accept=".csv" hidden>
                        </div>
                        
                        <div class="csv-file-info" id="csv-file-info" hidden>
                            <div class="file-details">
                                <div class="file-name" id="csv-file-name"></div>
                                <div class="file-stats">
                                    <span id="csv-file-size"></span> • 
                                    <span id="csv-row-count"></span> rows detected
                                </div>
                            </div>
                            <button type="button" class="btn-text" id="csv-remove-file">Remove file</button>
                        </div>
                    </div>
                </div>
                <div class="pc-modal__footer">
                    <button type="button" class="btn-secondary" data-close="bulk-import">Cancel</button>
                    <button type="button" class="btn-primary" id="csv-next-step-1" disabled>Next: Map Fields</button>
                </div>
            </div>

            <!-- Step 2: Field Mapping -->
            <div class="csv-step-content" id="csv-step-2" hidden>
                <div class="pc-modal__body">
                    <div class="csv-mapping-section">
                        <div class="mapping-header">
                            <h4>Map your CSV columns to CRM fields</h4>
                            <p>Match the columns from your CSV file to the appropriate fields in your CRM.</p>
                        </div>
                        
                        <div class="csv-preview">
                            <h5>CSV Preview (first 3 rows)</h5>
                            <div class="preview-table" id="csv-preview-table">
                                <!-- Preview table will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="field-mapping">
                            <h5>Field Mapping</h5>
                            <div class="mapping-list" id="csv-field-mapping">
                                <!-- Field mapping controls will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="mapping-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="csv-update-existing" checked>
                                Update existing records if found
                            </label>
                        </div>
                        
                        <div class="list-assignment-section">
                            <h5>Add to List (Optional)</h5>
                            <div class="form-row">
                                <label>Assign imported records to a list</label>
                                <div class="csv-list-dropdown-wrap">
                                    <button type="button" class="csv-list-trigger input-dark" id="csv-list-trigger">
                                        <span class="selected-list-name">No list assignment</span>
                                        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 5L6 8L9 5"></path>
                                        </svg>
                                    </button>
                                    <div class="csv-list-dropdown" id="csv-list-dropdown" hidden>
                                        <!-- Dropdown content will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            <p class="help-text">All imported contacts/accounts will be added to the selected list</p>
                        </div>
                    </div>
                </div>
                <div class="pc-modal__footer">
                    <button type="button" class="btn-secondary" id="csv-back-step-2">Back</button>
                    <button type="button" class="btn-primary" id="csv-next-step-2">Next: Review</button>
                </div>
            </div>

            <!-- Step 3: Review & Import -->
            <div class="csv-step-content" id="csv-step-3" hidden>
                <div class="pc-modal__body">
                    <div class="csv-review-section">
                        <div class="review-header">
                            <h4>Review your import</h4>
                            <p>Please review the details below before importing your data.</p>
                        </div>
                        
                        <div class="review-summary" id="csv-review-summary">
                            <!-- Summary will be populated by JavaScript -->
                        </div>
                        
                        <div class="review-data">
                            <h5>Data Preview</h5>
                            <div class="preview-table" id="csv-final-preview">
                                <!-- Final preview will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="import-progress" id="csv-import-progress" hidden>
                            <div class="progress-header">
                                <h5>Importing data...</h5>
                                <div class="progress-stats" id="csv-progress-stats"></div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="csv-progress-fill"></div>
                            </div>
                        </div>
                        
                        <div class="import-results" id="csv-import-results" hidden>
                            <div class="results-summary" id="csv-results-summary"></div>
                        </div>
                    </div>
                </div>
                <div class="pc-modal__footer">
                    <button type="button" class="btn-secondary" id="csv-back-step-3">Back</button>
                    <button type="button" class="btn-primary" id="csv-start-import">Start Import</button>
                    <button type="button" class="btn-primary" id="csv-finish-import" hidden>Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Deal Modal -->
    <div id="modal-add-deal" class="pc-modal" hidden>
        <div class="pc-modal__backdrop" data-close="deal"></div>
        <div class="pc-modal__dialog deal-modal-dialog">
            <div class="pc-modal__header">
                <h3 id="add-deal-title">Add Deal</h3>
                <button class="pc-modal__close" data-close="deal" aria-label="Close">×</button>
            </div>
            
            <!-- Step Indicator -->
            <div class="deal-steps-indicator">
                <div class="deal-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Account & Title</div>
                </div>
                <div class="deal-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Energy & Contract</div>
                </div>
                <div class="deal-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Deal Calculator</div>
                </div>
            </div>

            <form id="form-add-deal" class="pc-modal__form">
                <div class="pc-modal__body">
                    
                    <!-- Step 1: Account Search & Deal Title -->
                    <div class="deal-step-content active" id="deal-step-1">
                        <div class="form-row">
                            <label style="position: relative;">Account
                                <input type="text" name="accountName" class="input-dark" id="deal-account-search" placeholder="Search for account..." autocomplete="off" required />
                                <input type="hidden" name="accountId" id="deal-account-id" />
                                <div id="deal-account-dropdown" class="account-dropdown" style="display: none;"></div>
                            </label>
                        </div>
                        <div class="form-row">
                            <label>Deal Title<input type="text" name="dealTitle" class="input-dark" placeholder="Enter deal title..." required /></label>
                        </div>
                        <div class="form-row">
                            <label>Initial Stage
                                <select name="dealStage" class="input-dark" required>
                                    <option value="interested">Interested</option>
                                    <option value="call-scheduled">Call Scheduled</option>
                                    <option value="invoice-received">Invoice Received</option>
                                    <option value="proposal">Proposal</option>
                                    <option value="negotiation">Negotiation</option>
                                    <option value="won">Closed Won</option>
                                    <option value="lost">Closed Lost</option>
                                </select>
                            </label>
                        </div>
                    </div>

                    <!-- Step 2: Energy & Contract Details -->
                    <div class="deal-step-content" id="deal-step-2">
                        <div class="form-row">
                            <label>Electricity Supplier<input type="text" name="electricitySupplier" class="input-dark" /></label>
                            <label>Annual Usage (kWh)<input type="number" name="annualUsage" class="input-dark" /></label>
                        </div>
                        <div class="form-row">
                            <label>Current Rate ($/kWh)<input type="number" name="currentRate" class="input-dark" step="0.001" /></label>
                            <label>Contract End Date<input type="date" name="contractEndDate" class="input-dark" /></label>
                        </div>
                        <div class="form-row" style="grid-template-columns: 1fr;">
                            <label>Service Addresses
                                <div id="deal-service-addresses-container" style="display: flex; flex-direction: column; gap: 8px;">
                                    <div class="service-address-input-row" style="display: flex; gap: 8px; align-items: center;">
                                        <input type="text" name="serviceAddress_0" class="input-dark" placeholder="123 Main St, City, State" style="flex: 1;" />
                                        <button type="button" class="remove-service-address-btn" style="background: var(--grey-600); color: white; border: none; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;" title="Remove this service address">-</button>
                                        <button type="button" class="add-service-address-btn" style="background: var(--orange-primary); color: white; border: none; border-radius: 4px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;" title="Add another service address">+</button>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Step 3: Deal Calculator -->
                    <div class="deal-step-content" id="deal-step-3">
                        <div class="form-row">
                            <label>Annual Usage (kWh)<input type="text" name="calcAnnualUsage" class="input-dark" placeholder="Enter annual usage (kWh)" /></label>
                            <label>Mills (Margin)<input type="number" name="mills" class="input-dark" placeholder="Enter mills (e.g., 8 for 0.008)" min="0" step="0.1" /></label>
                        </div>
                        <div class="form-row">
                            <label>Contract Length (Years)<input type="number" name="contractLength" class="input-dark" placeholder="Enter contract length in years" min="0.5" step="0.5" /></label>
                            <label>Projected Close Date<input type="date" name="projectedCloseDate" class="input-dark" /></label>
                        </div>
                        <div class="form-row">
                            <label>Commission Type
                                <div class="deal-radio-group" style="display: flex; gap: 16px; margin-top: 8px;">
                                    <label class="deal-radio-label" style="display: flex; align-items: center; gap: 8px;">
                                        <input type="radio" name="commissionType" value="annual" checked />
                                        <span>Annual</span>
                                    </label>
                                    <label class="deal-radio-label" style="display: flex; align-items: center; gap: 8px;">
                                        <input type="radio" name="commissionType" value="monthly" />
                                        <span>Monthly</span>
                                    </label>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Deal Calculator Results -->
                        <div class="deal-calculator-results" id="deal-calculator-results" style="display: none;">
                            <div class="deal-result-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                                <div class="deal-result-item" style="background: var(--grey-700); padding: 12px; border-radius: 6px;">
                                    <div class="deal-result-label" style="font-size: 0.875rem; color: var(--text-secondary);">Agency Yearly Value</div>
                                    <div class="deal-result-value" id="deal-yearly-value" style="font-size: 1.25rem; font-weight: 600; color: var(--text-inverse);">$0</div>
                                </div>
                                <div class="deal-result-item" style="background: var(--grey-700); padding: 12px; border-radius: 6px;">
                                    <div class="deal-result-label" style="font-size: 0.875rem; color: var(--text-secondary);">Agency Total Value</div>
                                    <div class="deal-result-value" id="deal-total-value" style="font-size: 1.25rem; font-weight: 600; color: var(--orange-primary);">$0</div>
                                </div>
                                <div class="deal-result-item" style="background: var(--grey-700); padding: 12px; border-radius: 6px;">
                                    <div class="deal-result-label" style="font-size: 0.875rem; color: var(--text-secondary);">Commission Per Year</div>
                                    <div class="deal-result-value" id="deal-yearly-commission" style="font-size: 1.25rem; font-weight: 600; color: var(--text-inverse);">$0</div>
                                </div>
                                <div class="deal-result-item" id="deal-monthly-commission-item" style="background: var(--grey-700); padding: 12px; border-radius: 6px; display: none;">
                                    <div class="deal-result-label" style="font-size: 0.875rem; color: var(--text-secondary);">Commission Per Month</div>
                                    <div class="deal-result-value" id="deal-monthly-commission" style="font-size: 1.25rem; font-weight: 600; color: var(--text-inverse);">$0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pc-modal__footer">
                    <button type="button" class="btn-text" data-close="deal">Cancel</button>
                    <button type="button" class="btn-secondary" id="deal-prev-step" style="display: none;">Previous</button>
                    <button type="button" class="btn-primary" id="deal-next-step">Next</button>
                    <button type="submit" class="btn-primary" id="deal-create-btn" style="display: none;">Create Deal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Client Config (from Vercel env vars) -->
    <script>
        // Expose Firebase config to window for client-side auth
        // These are set by Vercel and injected at build time
        window.NEXT_PUBLIC_FIREBASE_API_KEY = 'AIzaSyDHTBM2i3iKNBb6VTMSRUgn9xhsF4KJBMM';
        window.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN = 'power-choosers-crm.firebaseapp.com';
        window.NEXT_PUBLIC_FIREBASE_PROJECT_ID = 'power-choosers-crm';
        window.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET = 'power-choosers-crm.firebasestorage.app';
        window.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID = '792458658491';
        window.NEXT_PUBLIC_FIREBASE_APP_ID = '1:792458658491:web:0ad91d0b47ae39e1e2d6df';
    </script>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="scripts/firebase.js"></script>
    <script src="scripts/auth.js"></script>
    
    <!-- Lazy Load Manager - loads CRM scripts only after authentication -->
    <script>
        window.crmScriptsLoaded = false;
        window._loadedPageScripts = new Set();
        
        // Helper to load a single script
        window.loadScript = function(src) {
            return new Promise((resolve, reject) => {
                // Check if already loaded
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    console.log('[LazyLoad] ✓ Loaded:', src);
                    resolve();
                };
                script.onerror = () => {
                    console.warn('[LazyLoad] Failed to load:', src);
                    resolve(); // Continue even if one fails
                };
                document.body.appendChild(script);
            });
        };
        
        // Load core CRM scripts (essentials only)
        window.loadCRMScripts = function() {
            if (window.crmScriptsLoaded) {
                console.log('[LazyLoad] Scripts already loaded');
                return Promise.resolve();
            }
            
            console.log('[LazyLoad] Loading core CRM scripts...');
            
            // Core scripts loaded immediately (cache manager MUST be first)
            const coreScripts = [
                'scripts/cache-manager.js',        // NEW - cache system
                'scripts/fix-duplicate-listeners.js', // NEW - prevent 60,000+ hidden logs
                'scripts/badge-loader.js',         // NEW - lightweight badge data loader
                'scripts/algolia-search.js',       // NEW - Algolia search helper
                'scripts/supplier-data.js',
                'scripts/data-manager.js',
                'scripts/bulk-assignment.js',
                'scripts/employee-welcome.js',
                'scripts/shared-ci-processor.js',
                'scripts/global-search.js',
                'scripts/toast-manager.js',        // MOVED - load before phone.js for incoming call notifications
                'scripts/pages/call-scripts.js',   // NEW - load call-scripts BEFORE phone.js so FLOW is available
                'scripts/widgets/phone.js',        // Load after call-scripts.js so FLOW is available
                'scripts/widgets/notes.js',
                'scripts/widgets/health.js',
                'scripts/widgets/deal.js',
                'scripts/widgets/apollo.js',
                'scripts/widgets/maps.js',
                'scripts/notifications.js',
                'scripts/click-to-call.js',
                'scripts/click-to-email.js',
                'scripts/activity-manager.js',
                'scripts/pages/tasks.js',          // NEW - load tasks immediately for widget
                'scripts/pages/task-detail.js',    // NEW - load task-detail for Today's Tasks clicks
                'scripts/pages/account-detail.js', // NEW - load account-detail for account navigation
                'scripts/pages/contact-detail.js', // NEW - load contact-detail for contact navigation
                'scripts/background-calls-loader.js', // NEW - background calls loading for badges
                'scripts/background-contacts-loader.js', // NEW - background contacts loading for instant access
                'scripts/background-accounts-loader.js', // NEW - background accounts loading for instant access
                'scripts/background-emails-loader.js', // NEW - background emails loading for instant access
                'scripts/background-tasks-loader.js', // NEW - background tasks loading for instant access
                'scripts/background-sequences-loader.js', // NEW - background sequences loading for instant access
                'scripts/background-lists-loader.js', // NEW - background lists loading for instant access
                'scripts/email-compose-global.js', // NEW - Global email compose functionality
                // 'scripts/pages/emails.js',         // REMOVED - replaced with emails-redesigned.js
                'scripts/contact-merger.js',
                'scripts/email-tracking.js',
                'scripts/pages/settings.js',       // NEW - settings loaded immediately to activate configurations
                'scripts/task-notifications.js',
                'scripts/main.js'                  // Main must be last
            ];
            
            // Load core scripts sequentially
            return coreScripts.reduce((promise, src) => {
                return promise.then(() => window.loadScript(src));
            }, Promise.resolve()).then(() => {
                window.crmScriptsLoaded = true;
                console.log('[LazyLoad] ✓ Core CRM scripts loaded!');
            });
        };
        
        // Load page-specific scripts on demand
        window.loadPageScripts = async function(pageName) {
            // Map of page names to their required scripts
            const pageScriptMap = {
                people: [
                    'scripts/pages/contact-detail.js',
                    'scripts/pages/people.js'
                ],
                accounts: [
                    'scripts/pages/account-detail.js',
                    'scripts/pages/accounts.js'
                ],
                calls: [
                    'scripts/pages/calls.js'
                ],
                tasks: [
                    'scripts/pages/task-detail.js',
                    'scripts/pages/tasks.js'
                ],
                emails: [
                    'scripts/pages/emails-redesigned.js'
                ],
                'email-detail': [
                    'scripts/pages/email-detail.js'
                ],
                sequences: [
                    'scripts/pages/sequence-builder.js',
                    'scripts/pages/sequences.js'
                ],
                deals: [
                    'scripts/pages/deals.js'
                ],
                lists: [
                    'scripts/pages/list-detail.js',
                    'scripts/pages/lists-overview.js'
                ],
                'call-scripts': [
                    // call-scripts.js now loaded as core script - no need to lazy load
                ],
                // settings.js now loaded as core script - removed from lazy load
                'client-management': [
                    'scripts/pages/client-management.js'
                ],
                'agents': [
                    'scripts/pages/agents.js'
                ],
                'agent-details': [
                    'scripts/pages/agent-details.js'
                ]
            };
            
            const scripts = pageScriptMap[pageName];
            if (!scripts) {
                console.log(`[LazyLoad] No scripts needed for page: ${pageName}`);
                return;
            }
            
            // Check if already loaded
            if (window._loadedPageScripts.has(pageName)) {
                console.log(`[LazyLoad] Page scripts already loaded for: ${pageName}`);
                return;
            }
            
            console.log(`[LazyLoad] Loading scripts for page: ${pageName}`);
            
            // Load scripts for this page
            for (const src of scripts) {
                await window.loadScript(src);
            }
            
            window._loadedPageScripts.add(pageName);
            console.log(`[LazyLoad] ✓ Page scripts loaded for: ${pageName}`);
        };
    </script>
    <!-- API Base URL (global) -->
    <script>
      (function(){
        try {
          // Detect if running locally
          const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
          
          if (isLocal) {
            // Use local server for API calls when running locally
            window.API_BASE_URL = window.location.origin;
            console.log('API_BASE_URL (Local server):', window.API_BASE_URL);
          } else {
            // Use Cloud Run deployment for Twilio serverless functions when deployed
            const cloudRunUrl = 'https://power-choosers-crm-792458658491.us-south1.run.app';
            window.API_BASE_URL = cloudRunUrl;
            console.log('API_BASE_URL (Cloud Run backend):', window.API_BASE_URL);
          }
        } catch (e) {
          console.warn('API_BASE_URL init error:', e);
        }
      })();
    </script>
    <script>
      // Google Maps API Key Configuration (fetched from Vercel serverless function)
      (function(){
        async function setMapsConfig() {
          try {
            const res = await fetch('/api/maps/config', { method: 'GET', cache: 'no-store' });
            if (!res.ok) throw new Error('Failed to fetch maps config');
            const data = await res.json();
            window.GOOGLE_MAPS_API = data.apiKey || '';
            if (data.mapId) window.GOOGLE_MAP_ID = data.mapId;
            console.log('[Maps] Config loaded');
            // Signal that config is ready so the loader can proceed
            document.dispatchEvent(new CustomEvent('google-maps-api-ready'));
          } catch (e) {
            console.warn('[Maps] Failed to load config from /api/maps/config', e);
            // Fallback: try using any pre-set global (e.g., from dev tools)
            if (window.GOOGLE_MAPS_API) {
              document.dispatchEvent(new CustomEvent('google-maps-api-ready'));
            }
          }
        }
        setMapsConfig();
      })();
    </script>
    <script>
      // Development cache-busting: append timestamp to script URLs to force reload
      (function(){
        const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        if (isDev) {
          const cacheBuster = '?v=' + Date.now();
          window.__PC_CACHE_BUSTER = cacheBuster;
          console.log('[Dev] Cache busting enabled:', cacheBuster);
        }
      })();
    </script>
    <!-- All CRM scripts now loaded lazily after authentication via window.loadCRMScripts() -->
    <script>
      (function(){
        function formatUsdPerKwh(n){
          if (typeof n !== 'number' || !isFinite(n)) return '$—';
          return `$${n.toFixed(3)}`;
        }
        function findTxPriceValueEl(){
          const labels = document.querySelectorAll('.stat-card .stat-label');
          for (const lbl of labels){
            if (lbl && lbl.textContent && lbl.textContent.trim() === 'TX Avg Price/kWh'){
              const card = lbl.closest('.stat-card');
              if (card) return card.querySelector('.stat-value');
            }
          }
          return null;
        }
        async function loadTxPrice(opts){
          const refresh = opts && opts.refresh;
          const base = (window.API_BASE_URL || '').replace(/\/$/, '');
          const url = `${base}/api/tx-price${refresh ? '?refresh=1' : ''}`;
          try{
            const res = await fetch(url, { credentials: 'include' });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            const el = findTxPriceValueEl();
            if (el){
              el.textContent = formatUsdPerKwh(data.price);
              el.title = data.lastUpdated ? `Last updated: ${new Date(data.lastUpdated).toLocaleString()}` : '';
            }
          }catch(err){
            console.error('[TX Price] Fetch failed:', err);
          }
        }
        window.addEventListener('DOMContentLoaded', function(){
          // Force refresh so we can see current value
          loadTxPrice({ refresh: true });
        });
      })();
    </script>

    <!-- Load List Detail Page Script -->
    <script src="scripts/pages/list-detail.js"></script>

    <!-- Gmail-style Compose Window -->
    <div class="compose-window" id="compose-window" style="display: none;">
        
        <div class="compose-header">
            <div class="compose-title">New Message</div>
            <div class="compose-controls">
                <button class="compose-control-btn" id="compose-minimize" title="Minimize">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
                <button class="compose-control-btn" id="compose-maximize" title="Maximize">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    </svg>
                </button>
                <button class="compose-control-btn" id="compose-close" title="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="compose-content">
            <div class="compose-recipients">
                <div class="recipient-row" style="position: relative;">
                    <label class="recipient-label">To</label>
                    <input type="text" class="recipient-input" id="compose-to" placeholder="Recipients" autocomplete="off" aria-autocomplete="list" aria-haspopup="listbox" aria-expanded="false" aria-controls="compose-to-suggestions">
                    <div class="recipient-suggestions" id="compose-to-suggestions" role="listbox" aria-label="Suggested recipients" hidden></div>
                </div>
                <div class="recipient-row" id="cc-bcc-row" style="display: none;">
                    <label class="recipient-label">Cc</label>
                    <input type="text" class="recipient-input" id="compose-cc" placeholder="Cc">
                </div>
                <div class="recipient-row" id="bcc-row" style="display: none;">
                    <label class="recipient-label">Bcc</label>
                    <input type="text" class="recipient-input" id="compose-bcc" placeholder="Bcc">
                </div>
                <div class="recipient-actions">
                    <button class="recipient-toggle" id="toggle-cc-bcc">Cc Bcc</button>
                </div>
            </div>
            
            <div class="compose-subject">
                <input type="text" class="subject-input" id="compose-subject" placeholder="Subject">
            </div>
            
            
            <div class="compose-editor">
                <div class="editor-toolbar" role="toolbar" aria-label="Email editor actions">
                    <button class="toolbar-btn toolbar-ai" type="button" data-action="ai" aria-label="Write with AI" title="Write with AI">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 48 48">
                            <path fill="white" d="M23.426,31.911l-1.719,3.936c-0.661,1.513-2.754,1.513-3.415,0l-1.719-3.936	c-1.529-3.503-4.282-6.291-7.716-7.815l-4.73-2.1c-1.504-0.668-1.504-2.855,0-3.523l4.583-2.034	c3.522-1.563,6.324-4.455,7.827-8.077l1.741-4.195c0.646-1.557,2.797-1.557,3.443,0l1.741,4.195	c1.503,3.622,4.305,6.514,7.827,8.077l4.583,2.034c1.504,0.668,1.504,2.855,0,3.523l-4.73,2.1	C27.708,25.62,24.955,28.409,23.426,31.911z"></path>
                            <path fill="white" d="M38.423,43.248l-0.493,1.131c-0.361,0.828-1.507,0.828-1.868,0l-0.493-1.131	c-0.879-2.016-2.464-3.621-4.44-4.5l-1.52-0.675c-0.822-0.365-0.822-1.56,0-1.925l1.435-0.638c2.027-0.901,3.64-2.565,4.504-4.65	l0.507-1.222c0.353-0.852,1.531-0.852,1.884,0l0.507,1.222c0.864,2.085,2.477,3.749,4.504,4.65l1.435,0.638	c0.822,0.365,0.822,1.56,0,1.925l-1.52,0.675C40.887,39.627,39.303,41.232,38.423,43.248z"></path>
                        </svg>
                        <span class="label">Write with AI</span>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="formatting" aria-label="Text formatting" title="Text formatting">Aa</button>
                    <button class="toolbar-btn" type="button" data-action="link" aria-label="Insert link" title="Insert link">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="image" aria-label="Upload image" title="Upload image">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21,15 16,10 5,21"></polyline>
                        </svg>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="attach" aria-label="Attach files" title="Attach files">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83l8.49-8.49"></path>
                        </svg>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="code" aria-label="Edit raw HTML" title="Edit raw HTML">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="7 8 3 12 7 16"></polyline>
                            <polyline points="17 8 21 12 17 16"></polyline>
                            <path d="M14 4l-4 16"></path>
                        </svg>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="templates" aria-label="Load templates" title="Load templates">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <path d="M14 2v6h6"></path>
                            <path d="M8 13h8M8 17h8M8 9h2"></path>
                        </svg>
                    </button>
                    <button class="toolbar-btn" type="button" data-action="variables" aria-label="Add dynamic variables" title="Add dynamic variables">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 3a3 3 0 0 0-3 3v2a3 3 0 0 1-3 3 3 3 0 0 1 3 3v2a3 3 0 0 0 3 3"></path>
                            <path d="M16 3a3 3 0 0 1 3 3v2a3 3 0 0 0 3 3 3 3 0 0 0-3 3v2a3 3 0 0 1-3 3"></path>
                        </svg>
                    </button>
                    <!-- Preview toggle: eye (preview) / pencil (editor) icon-only -->
                    <button class="toolbar-btn" type="button" data-action="preview" aria-label="Preview message" title="Preview">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                </div>
                
                <div class="formatting-bar" aria-hidden="true">
                    <div class="fmt-group">
                        <button class="fmt-btn" type="button" data-fmt="font" aria-haspopup="true" aria-expanded="false" aria-label="Font" title="Font">
                            <span class="fmt-label" data-current-font>Sans Serif</span>
                        </button>
                        <div class="format-popover font-popover" role="menu">
                            <button class="popover-item font-item" data-font="Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif" style="font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif">Inter</button>
                            <button class="popover-item font-item" data-font="Arial, Helvetica, sans-serif" style="font-family:Arial, Helvetica, sans-serif">Arial</button>
                            <button class="popover-item font-item" data-font="Helvetica, Arial, sans-serif" style="font-family:Helvetica, Arial, sans-serif">Helvetica</button>
                            <button class="popover-item font-item" data-font="Georgia, serif" style="font-family:Georgia, serif">Georgia</button>
                            <button class="popover-item font-item" data-font="Times New Roman, Times, serif" style="font-family:Times New Roman, Times, serif">Times New Roman</button>
                        </div>
                    </div>
                    <div class="fmt-group">
                        <button class="fmt-btn" type="button" data-fmt="size" aria-haspopup="true" aria-expanded="false" aria-label="Size" title="Size">
                            <span class="fmt-label" data-current-size>12</span>
                        </button>
                        <div class="format-popover size-popover" role="menu">
                            <button class="popover-item size-item" data-size="10" style="font-size:10px">10</button>
                            <button class="popover-item size-item" data-size="12" style="font-size:12px">12</button>
                            <button class="popover-item size-item" data-size="14" style="font-size:14px">14</button>
                            <button class="popover-item size-item" data-size="16" style="font-size:16px">16</button>
                            <button class="popover-item size-item" data-size="18" style="font-size:18px">18</button>
                            <button class="popover-item size-item" data-size="20" style="font-size:20px">20</button>
                            <button class="popover-item size-item" data-size="24" style="font-size:24px">24</button>
                        </div>
                    </div>
                    <button class="fmt-btn" type="button" data-fmt="bold" aria-label="Bold" title="Bold"><span class="fmt-glyph">B</span></button>
                    <button class="fmt-btn" type="button" data-fmt="italic" aria-label="Italic" title="Italic"><span class="fmt-glyph" style="font-style:italic;">I</span></button>
                    <button class="fmt-btn" type="button" data-fmt="underline" aria-label="Underline" title="Underline"><span class="fmt-glyph" style="text-decoration:underline;">U</span></button>
                    <div class="fmt-group">
                        <button class="fmt-btn" type="button" data-fmt="color" aria-haspopup="true" aria-expanded="false" aria-label="Text Color" title="Text Color">
                            <span class="fmt-glyph" style="color:#fff;">A</span>
                        </button>
                        <div class="format-popover color-popover" role="menu">
                            <div class="color-swatches">
                                <button class="color-swatch" data-color="transparent" style="background:transparent; border:2px dashed #666; position:relative;" title="Default color">
                                    <span style="position:absolute; top:2px; left:2px; bottom:2px; right:2px; background:linear-gradient(45deg, transparent 45%, #666 45%, #666 55%, transparent 55%), linear-gradient(-45deg, transparent 45%, #666 45%, #666 55%, transparent 55%);"></span>
                                </button>
                                <button class="color-swatch" data-color="#FF0000" style="background:#FF0000;"></button>
                                <button class="color-swatch" data-color="#00FF00" style="background:#00FF00;"></button>
                                <button class="color-swatch" data-color="#0000FF" style="background:#0000FF;"></button>
                                <button class="color-swatch" data-color="#FFFF00" style="background:#FFFF00;"></button>
                                <button class="color-swatch" data-color="#FF00FF" style="background:#FF00FF;"></button>
                                <button class="color-swatch" data-color="#00FFFF" style="background:#00FFFF;"></button>
                                <button class="color-swatch" data-color="#808080" style="background:#808080;"></button>
                            </div>
                        </div>
                    </div>
                    <div class="fmt-group">
                        <button class="fmt-btn" type="button" data-fmt="highlight" aria-haspopup="true" aria-expanded="false" aria-label="Highlight" title="Highlight">
                            <span class="fmt-glyph" style="position:relative;">A<span style="position:absolute; bottom:-2px; left:0; right:0; height:2px; background:#FFFF00;"></span></span>
                        </button>
                        <div class="format-popover highlight-popover" role="menu">
                            <div class="color-swatches">
                                <button class="color-swatch" data-color="transparent" style="background:transparent; border:2px dashed #666; position:relative;" title="No highlight">
                                    <span style="position:absolute; top:2px; left:2px; bottom:2px; right:2px; background:linear-gradient(45deg, transparent 45%, #666 45%, #666 55%, transparent 55%), linear-gradient(-45deg, transparent 45%, #666 45%, #666 55%, transparent 55%);"></span>
                                </button>
                                <button class="color-swatch" data-color="#FFFF00" style="background:#FFFF00;"></button>
                                <button class="color-swatch" data-color="#FF0000" style="background:#FF0000;"></button>
                                <button class="color-swatch" data-color="#00FF00" style="background:#00FF00;"></button>
                            </div>
                        </div>
                    </div>
                    <button class="fmt-btn" type="button" data-fmt="insertOrderedList" aria-label="Numbered List" title="Numbered List">
                        <svg viewBox="0 0 18 18" aria-hidden="true" focusable="false">
                            <line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"></line>
                            <line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"></line>
                            <line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"></line>
                            <line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"></line>
                            <path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"></path>
                            <path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"></path>
                            <path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"></path>
                        </svg>
                    </button>
                    <button class="fmt-btn" type="button" data-fmt="insertUnorderedList" aria-label="Bulleted List" title="Bulleted List">
                        <svg viewBox="0 0 18 18" aria-hidden="true" focusable="false">
                            <line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"></line>
                            <line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"></line>
                            <line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"></line>
                            <line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"></line>
                            <line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"></line>
                            <line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"></line>
                        </svg>
                    </button>
                </div>
                
                <div class="link-bar" aria-hidden="true">
                    <div class="field">
                        <label class="fmt-label" for="compose-link-text">Text</label>
                        <input id="compose-link-text" class="input-dark" type="text" placeholder="Display text" data-link-text />
                    </div>
                    <div class="field">
                        <label class="fmt-label" for="compose-link-url">URL</label>
                        <input id="compose-link-url" class="input-dark" type="url" placeholder="https://" data-link-url />
                    </div>
                    <div class="actions">
                        <button class="fmt-btn" type="button" data-link-insert>Insert</button>
                        <button class="fmt-btn" type="button" data-link-cancel>Cancel</button>
                    </div>
                </div>
                
                <!-- Variables toolbar: slides down similar to link/formatting bars -->
                <div class="variables-bar" aria-hidden="true"></div>
                
                <!-- AI Bar: slides down from underneath the toolbar -->
                <div class="ai-bar" aria-hidden="true" role="region" aria-label="AI email generation">
                    <!-- Content filled by renderAIBar() -->
                </div>
                
                <div class="compose-body">
                    <div class="body-input" contenteditable="true" role="textbox" aria-multiline="true" data-editor="rich" placeholder="Compose email..."></div>
                    <div class="compose-preview" hidden></div>
                </div>
            </div>
        </div>
        
        <div class="compose-footer">
            <div class="compose-actions">
                <button class="compose-send-btn" id="compose-send">
                    <span style="font-weight: bold;">Send</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    </div><!-- End #crm-content -->

    <script>
      // Google Maps API Key Configuration
      (function(){
        try {
          // Set Google Maps API key directly
          window.GOOGLE_MAPS_API = 'AIzaSyCydOVPsFnyY83M5ABb2lBZWcMqh4wqV2k';
          console.log('Google Maps API key configured');
        } catch (e) {
          console.warn('Google Maps API key init error:', e);
        }
      })();
    </script>
    
    <!-- Client Management Dashboard Script -->
    <script src="scripts/pages/client-management.js"></script>
    
    <!-- Agents Management Scripts -->
    <script src="scripts/pages/agents.js"></script>
    <script src="scripts/pages/agent-details.js"></script>
    <script>
      (function(){
        function initGoogleMapsCallback() {
          // API is ready
          window.googleMapsApiReady = true;
          document.dispatchEvent(new CustomEvent('google-maps-api-ready'));
        }

        // Dynamically load the Google Maps script
        function loadGoogleMapsScript(apiKey) {
          if (document.getElementById('google-maps-script')) {
            // Already loaded or loading
            if (window.googleMapsApiReady) {
              initGoogleMapsCallback();
            }
            return;
          }
          const script = document.createElement('script');
          script.id = 'google-maps-script';
          script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places,marker&callback=initGoogleMapsCallback`;
          script.async = true;
          script.defer = true;
          document.head.appendChild(script);
        }

        // Listen for config ready event to get API key
        window.addEventListener('google-maps-api-ready', function() {
          loadGoogleMapsScript(window.GOOGLE_MAPS_API);
        });
      })();
    </script>
</body>
</html>

